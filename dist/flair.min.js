/**
 * @preserve
 * Flair.js
 * True Object Oriented JavaScript
 * 
 * Assembly: flair
 *     File: ./flair.js
 *  Version: 0.55.59
 *  Tue, 20 Aug 2019 01:39:03 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * MIT
 */
!function(e,t){"use strict";if("function"==typeof!0&&(!0).amd)(!0)(()=>t());else if("object"==typeof exports){let e=t();"undefined"!=typeof module&&module.exports&&(exports=module.exports=e),module.exports=exports=e}else e.flair=t()}(this||globalThis,function(){"use strict";let e=new Function("try {return this===global;}catch(e){return false;}")(),t=!1,r=[],n="FLAIR_SYMBOLS",i="",s=Symbol("[meta]"),a="modules",o=[],l={},c=["class","enum","interface","mixin","struct"],u=["instance","sinstance"],f={},p={},d=!1;if(e)try{let e=require("worker_threads");t=e.isMainThread}catch(e){t=!1}else t=void 0!==!0;let m=async(e,t)=>{let r=null,n=null;if("string"==typeof e?n={main:e}:e.main&&e.module&&e.engine?n=e:r=e,n)return"string"==typeof t&&(n.config=t),d||(d=await m.AppDomain.boot(n)),m.AppDomain.app();r&&m.AppDomain.registerAdo(r)};if(e)if(t){let e;i=require("worker_threads").workerData.symbols||""}else{let e=process.argv.findIndex(e=>!!e.startsWith(`--${n}`));-1!==e&&(i=process.argv[e].substr(2).split("=")[1]),process.env[n]&&(i&&(i+=","),i+=process.env[n])}else t?i=(!0)[n]||"":i+=(!0)[n]||"";i&&(r=i.split(",").map(e=>e.trim())),l.symbols=Object.freeze(r),l.env=Object.freeze({type:e?"server":"client",isServer:e,isClient:!e,isWorker:t,isMain:!t,cores:(e?require("os").cpus().length:(!0).navigator.hardwareConcurrency)||4,isCordova:!e&&!!(!0).cordova,isNodeWebkit:e&&process.versions["node-webkit"],isProd:-1!==r.indexOf("PROD")&&-1===r.indexOf("DEV")&&-1===r.indexOf("STAGE"),isStage:-1!==r.indexOf("STAGE")&&-1===r.indexOf("DEV")&&-1===r.indexOf("PROD"),isDev:-1!==r.indexOf("DEV")&&-1===r.indexOf("STAGE")&&-1===r.indexOf("PROD"),isLocal:-1!==(e?require("os").hostname():self.location.host).indexOf("local"),isDebug:-1!==r.indexOf("DEBUG"),isTest:-1!==r.indexOf("TEST"),isAppMode:()=>d}),m.members=[],m.options=Object.freeze(l),m.env=m.options.env;const h=(e,t,r)=>{m[e]=Object.freeze(t),m.members.push(e),"function"==typeof r&&o.push(r)},y=()=>{};h("noop",y);const g={get:()=>{throw v.NotImplemented("prop",g.get)},set:()=>{throw v.NotImplemented("prop",g.set)},ni:!0};h("nip",g);const b=()=>{throw v.NotImplemented("func",b)};b.ni=!0,h("nim",b);const v=function(e,t,r,n){let i=new Error,s=v;switch(typeof e){case"string":switch(i.name=e,typeof t){case"string":switch(i.message=t,typeof r){case"object":i.error=r,"function"==typeof n&&(s=n);break;case"function":s=r;break}break;case"object":i.message=t.message||"",i.error=t,"function"==typeof r&&(s=r);break;case"function":s=t;break}break;case"object":i.name=e.name||"Unknown",i.message=e.message||"",i.error=e,"function"==typeof t&&(s=t);break}return i.name=i.name||"Undefined",i.name.endsWith("Exception")||(i.name+="Exception"),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(i,s),i.error&&(i.message+="["+i.error+"]"),Object.freeze(i)};v.InvalidArgument=((e,t=v.InvalidArgument)=>new v("InvalidArgument",`Argument type is invalid. (${e})`,t)),v.OperationFailed=((e,t,r=v.OperationFailed)=>new v("OperationFailed",`Operation failed with error. (${e})`,t,r)),v.Duplicate=((e,t=v.Duplicate)=>new v("Duplicate",`Item already exists.(${e})`,t)),v.NotFound=((e,t=v.NotFound)=>new v("NotFound",`Item not found. (${e})`,t)),v.InvalidDefinition=((e,t=v.InvalidDefinition)=>new v("InvalidDefinition",`Item definition is invalid. (${e})`,t)),v.InvalidOperation=((e,t=v.InvalidOperation)=>new v("InvalidOperation",`Operation is invalid in current context. (${e})`,t)),v.Circular=((e,t=v.Circular)=>new v("Circular",`Circular calls found. (${e})`,t)),v.NotImplemented=((e,t=v.NotImplemented)=>new v("NotImplemented",`Member is not implemented. (${e})`,t)),v.NotDefined=((e,t=v.NotDefined)=>new v("NotDefined",`Member is not defined or is not accessible. (${e})`,t)),v.NotAvailable=((e,t=v.NotDefined)=>new v("NotAvailable",`Feature is not available. (${e})`,t)),h("Exception",v);const w=()=>"_xxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx".replace(/[xy]/g,e=>{var t=16*Math.random()|0,r;return("x"==e?t:3&t|8).toString(16)}),x=(e,t)=>{if(t){if(-1!==e.indexOf("{.min}"))return l.env.isDebug?e.replace("{.min}",""):e.replace("{.min}",".min")}else if(-1!==e.indexOf("|")){let t=e.split("|"),r="";return"x"===(r=l.env.isServer?t[0].trim():t[1].trim())&&(r=""),-1!==r.indexOf("~")&&(t=r.split("~"),"x"===(r=l.env.isWorker?t[1].trim():t[0].trim())&&(r="")),r}return e},O=e=>!e.hasOwnProperty("prototype")&&"Function"===e.constructor.name,I=e=>"AsyncFunction"===e.constructor.name,A=(e,t,r)=>e.findIndex(e=>e[t]===r),$=(e,t,r)=>{let n=e.findIndex(e=>e[t]===r);return-1!==n?e[n]:null},k=(e,t)=>(t||(t=","),e.split(t).map(e=>e.trim())),j=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),T=(e,t,r)=>e.replace(new RegExp(j(t),"g"),r),S=(e,t)=>{if("string"==typeof e&&Array.isArray(t)&&t.length>0){let r=0;for(let n of t)e=T(e,`%${++r}`,n)}return e},N=(e,t,r,n)=>{n||(n=[]);for(let i in t)if(t.hasOwnProperty(i)&&-1===n.indexOf(i)){if(!r&&i in e)continue;e[i]=t[i]}return e},C=async t=>{let r=null;return r=X(e?"serverFile":"clientFile"),await r(t)},D=async(r,n,i)=>{if(e)return await X("serverModule").require(r);{let e=await X("clientModule").require(r);if(e||"string"!=typeof n||(t?(e=(!0)[n]||null,i&&delete WorkerGlobalScope[n]):(e=(!0)[n]||null,i&&delete window[n])),e)return e}},P=(e,t)=>t.split(".").reduce((e,t)=>e&&e[t]?e[t]:null,e),F=(e,t,r)=>{let n=l.env.isAppMode()?le.config().global:{},i=P(n,e),s="";return"object"!=typeof i||r?s=i:l.env.isLocal?s=i.local:l.env.isStage?s=i.stage:l.env.isProd?s=i.prod:l.env.isDev&&(s=i.dev),s||t},E=(e,t)=>{if(e){let r=r=>{let n="";"R"===r.toUpperCase()&&-1!==t.indexOf(`*${r}*`)?l.env.isLocal?n=e[r].local:l.env.isStage?n=e[r].stage:l.env.isProd?n=e[r].prod:l.env.isDev&&(n=e[r].dev):-1!==t.indexOf(`*${r}*`)&&"string"!=typeof(n=e[r])&&(l.env.isLocal?n=e[r].local:l.env.isStage?n=e[r].stage:l.env.isProd?n=e[r].prod:l.env.isDev&&(n=e[r].dev)),n&&(t=T(t,`*${r}*`,n),n="")};if("string"==typeof e)e.endsWith("/")||(e+="/"),t.startsWith("/")&&(t=t.substr(1)),t=e+t;else{r("R");for(let t in e)"R"!==t.toUpperCase()&&r(t)}}return t},z=async(t,r,n,i)=>{let s=null,a=F(`flair.api.connections.${n}`,null,!0)||F(`flair.api.connections.auto`,null,!0),o=E(a,t);return s=X(e?"serverFetch":"clientFetch"),await s(o,r,i)},M=(e,t,r,n)=>{let i=t?k(t):Object.keys(e);const s=t=>{let s={};if(i.length>0)for(let e of i)s[e]=t[e];else for(let t in e)e.hasOwnProperty(t)&&(s[t]=e[t]);if(n)for(let e in n)s[e]=n[e];return r&&(s=Object.freeze(s)),s};if(Array.isArray(e)){let t=[];for(let r of e)t.push(s(r));return t}return s(e)},R=e=>btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function e(t,r){return String.fromCharCode("0x"+r)})),_=e=>decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join("")),L=t=>{e?X("serverModule").undef(t):X("clientModule").undef(t)},U=(e,t=!0)=>{const r=e=>e&&"object"==typeof e;return e.reduce((e,n)=>(Object.keys(n).forEach(i=>{const s=e[i],a=n[i];Array.isArray(s)&&Array.isArray(a)?e[i]=t?s.concat(...a):[].concat(...a):r(s)&&r(a)?e[i]=U([s,a],t):e[i]=a}),e),{})},W=(...r)=>{if(e||t)return"";let n="",i="",s=null;for(let e of r){for(let t of(!0).document.scripts)if(t.src.endsWith(e)){(s=(!0).document.createElement("a")).href=t.src,i=s.protocol+"//"+s.host+"/",s=null,n="./"+t.src.replace(i,"");break}if(n)break}return n},q=e=>{let t="";return void 0===e&&(t="undefined"),t||null!==e||(t="null"),t||"number"!=typeof e||!1!==isFinite(e)||(t="infinity"),!t&&Array.isArray(e)&&(t="array"),!t&&e instanceof Date&&(t="date"),!t&&e[s]&&(t=e[s].type),t||(t=typeof e),t};h("typeOf",q);const B=(e,t)=>{if(t[s]&&(t=t[s].name),"string"!==q(t))throw v.InvalidArgument("type",B);let r=!1;if(e)switch(t){case"NaN":r=isNaN(e);break;case"infinity":r="number"==typeof e&&!1===isFinite(e);break;case"array":case"Array":r=Array.isArray(e);break;case"date":case"Date":r=e instanceof Date;break;case"flairtype":r=e[s]&&-1!==c.indexOf(e[s].type);break;case"flairinstance":r=e[s]&&-1!==u.indexOf(e[s].type);break;case"flair":r=void 0!==e[s];break;case"cfunction":r="function"==typeof e&&!O(e);break;case"afunction":r="function"==typeof e&&O(e);break;default:r||(r=typeof e===t),!r&&e[s]&&(r||(r=t===e[s].type),r||-1===u.indexOf(e[s].type)||(r=$e(e,t)),r||"class"!==e[s].type||(r=ve(e,t)),r||-1===c.indexOf(e[s].type)||(r=e[s].name===t))}else switch(t){case"undefined":r=void 0===e;break;case"null":r=null===e;break;case"NaN":r=isNaN(e);break}return r};h("is",B);const V=(e,t)=>{let r=!1;try{e[t],r=void 0===e[t]}catch(e){r=!0}return!r};h("isDefined",V);const G=(...e)=>{if(0===e.length)throw v.InvalidArgument("patterns",G);let t=(...r)=>{let n=null,i=null,s="",a="",o=-1,l=-1,c=!1,u=0,f="",p={raw:r||[],index:-1,isInvalid:!1,error:null,values:{}};if(e)for(let t of e){o++,l=-1,c=!1,u=0,n=t.split(",");for(let e of n){if(l++,2!==(i=e.split(":")).length?(s=`_${o}_${l}`,a=e.trim()||""):(s=i[0].trim()||"",a=i[1].trim()||""),l>p.raw.length){c=!1;break}if(!B(p.raw[l],a)){c=!1,f=s;break}p.values[s]=p.raw[l],c=!0,u++}if(c&&u===n.length){p.index=o;break}}return p.isInvalid=-1===p.index,p.error=p.isInvalid?v.InvalidArgument(f):null,p.throwOnError=(e=>{if(p.error)throw new v(p.error,e||t)}),Object.freeze(p)};return Object.freeze(t)};h("Args",G);const J=e=>{let t;return G("argsProcessor: undefined","argsProcessor: afunction")(e).throwOnError(J),(e=e||((...e)=>e)).event=!0,e};h("event",J);const H=J(()=>{throw v.NotImplemented("event",H)});H.ni=!0,h("nie",H);const K=function(e){let t={};e=e||"",this.add=((e,r)=>{let n;G("event: string, handler: afunction")(e,r).throwOnError(this.add),t[e]||(t[e]=[]),t[e].push(r)}),this.remove=((e,r)=>{let n;if(G("event: string, handler: afunction")(e,r).throwOnError(this.remove),t[e]){let n=t[e].indexOf(r);-1!==n&&t[e].splice(n,1)}}),this.dispatch=((r,n)=>{let i;G("event: string")(r).throwOnError(this.dispatch),t[r]&&t[r].forEach(t=>{setTimeout(()=>{t(Object.freeze({host:e,name:r,args:n||[]}))},0)})}),this.count=(e=>{let r;return G("event: string")(e).throwOnError(this.count),t[e]?t[e].length:0}),this.clear=(()=>{t={}})};let Y={};const X=e=>{if("string"!=typeof e)throw v.InvalidArgument("name",X);return Y[e]?Y[e].handler?Y[e].handler:Y[e].inbuilt:null};X.define=((e,t,r)=>{let n=G("name: string, members: array, inbuilt: afunction","name: string, inbuilt: afunction","name: string, members: array","name: string")(e,t,r);if(n.throwOnError(X.define),Y[e])throw v.Duplicate(e,X.define);Y[e]={type:n.values.members?"object":"function",members:n.values.members||null,handler:null,inbuilt:n.values.inbuilt?n.values.inbuilt(l.env):null}}),X.connect=((e,t)=>{let r;if(G("name: string, handler: afunction")(e,t).throwOnError(X.connect),!Y[e])throw v.NotFound(e,X.connect);let n=t(l.env);if(typeof n!==Y[e].type)throw v.InvalidArgument("handler",X.connect);let i=Y[e].members;if(i)for(let e of i)if(void 0===n[e])throw v.NotImplemented(e,X.connect);Y[e].handler=n}),X.disconnect=(e=>{if("string"!=typeof e)throw v.InvalidArgument("name",X.disconnect);Y[e]&&(Y[e].handler=null)}),X.isDefined=(e=>{if("string"!=typeof e)throw v.InvalidArgument("name",X.isDefined);return!!Y[e]}),X.isConnected=(e=>{if("string"!=typeof e)throw v.InvalidArgument("name",X.isConnected);return!Y[e]||!Y[e].handler}),h("Port",X,()=>{for(let e in Y)Y.hasOwnProperty(e)&&(Y[e].handler=null);Y={}});const Q=function(t,r,n,i,o){let l={},u={},f={},p={},d={},h={},y={},g=!1,b="";this.name=t,this.domain=r,this.isUnloaded=(()=>g||r.isUnloaded()),this.unload=(()=>{if(!g){g=!0,delete o[t];for(let e in p)e.hasOwnProperty(e)&&Pe(p[e]);l={},d={},h={},u={},f={},p={},y={}}}),this.current=(()=>{if(this.isUnloaded())throw v.InvalidOperation(`Context is already unloaded. (${this.name})`,this.current);return 0===i.length?n||this:i[i.length-1]}),this.registerType=(e=>{if(this.isUnloaded())throw v.InvalidOperation(`Context is already unloaded. (${this.name})`,this.registerType);let t="",r="",n=e[s];if(n.Type?(t=n.Type[s].name,r=n.Type[s].type):(t=n.name,r=n.type),-1===c.indexOf(r))throw v.InvalidArgument("Type",this.registerType);let i=t.substr(0,t.lastIndexOf(".")),a=t.replace(i+".","");if(l[t])throw v.Duplicate(t,this.registerType);if(u[t])throw v.Duplicate(`Already registered as Resource. (${t})`,this.registerType);if(f[t])throw v.Duplicate(`Already registered as Route. (${t})`,this.registerType);return l[t]=e,i?(y[i]||(y[i]={}),y[i][a]=e):y[a]=e,i}),this.getType=(e=>{if(this.isUnloaded())throw v.InvalidOperation(`Context is already unloaded. (${this.name})`,this.getType);if("string"!=typeof e)throw v.InvalidArgument("qualifiedName",this.getType);return l[e]||null}),this.ensureType=(async e=>{if(this.isUnloaded())throw v.InvalidOperation(`Context is already unloaded. (${this.name})`);if("string"!=typeof e)throw v.InvalidArgument("qualifiedName");let t=this.getType(e);if(!t){let n=r.resolve(e);if(!n)throw v.NotFound(e);if(await this.loadAssembly(n),!(t=this.getType(e)))throw v.OperationFailed(`Assembly could not be loaded. (${n})`)}return t}),this.allTypes=(()=>{if(this.isUnloaded())throw v.InvalidOperation(`Context is already unloaded. (${this.name})`,this.allTypes);return Object.keys(l)}),this.execute=(async(e,t)=>{if(this.isUnloaded())throw v.InvalidOperation(`Context is already unloaded. (${this.name})`);e.type=e.type||"",e.typeArgs=e.typeArgs||[],e.func=e.func||"",e.args=e.args||[],e.ctx=e.ctx||{},e.keepAlive=void 0!==e.keepAlive&&e.keepAlive;const r=async()=>{let r,n=new(await this.ensureType(e.type))(...e.typeArgs);return"function"==typeof t&&B(n,"IProgressReporter")&&n.progress.add(t),n},n=async t=>{let r=t[e.func](...e.args);return r&&"function"==typeof r.then?await r:r};let i=null;if(e.keepAlive)return p[e.type]?(i=p[e.type],await n(i)):(i=await r(),p[e.type]=i,await n(i));if(p[e.type])if(i=p[e.type],e.func)try{return await n(i)}finally{Pe(i),delete p[e.type]}else Pe(i),delete p[e.type];else{let e=await r();try{return await n(e)}finally{Pe(e)}}}),this.namespace=(e=>{e&&"(root)"===e&&(e="");let t=null;return(t=e?y[e]||null:y)?Object.freeze(N({},t)):null}),this.currentAssemblyBeingLoaded=(e=>(void 0!==e&&(b=x(e,!0)),b));const w=(e,t,n,i)=>{let s=r.getAsmFileKey(e);!d[s]&&t&&n&&i&&(d[s]=Object.freeze(new Z(t,n,i)),h[i.name]=d[s])};this.getAssemblyFile=(t=>{let r=this.domain.getAdo(t),n=t;return n.startsWith("./")&&(n=n.substr(2)),n=r&&r.package?e?`${r.package}/${n}`:`./${a}/${r.package}/${n}`:this.domain.root()+n}),this.getAssemblyAssetsPath=(e=>{let t=this.getAssemblyFile(e);return-1!==t.indexOf(".min.js")?t.replace(".min.js","/"):t.replace(".js","/")}),this.loadAssembly=(async e=>{if(this.isUnloaded())throw v.InvalidOperation(`Context is already unloaded. (${this.name})`);let t=r.getAsmFileKey(e);if(!d[t]&&this.currentAssemblyBeingLoaded()!==e){i.push(this);let t=this.domain.getAdo(e),r=this.getAssemblyFile(e);L(r);try{let n=await D(r,t.name,!0),s=await n(m,r),a=this.current();w(e,t,a,s)}finally{i.pop()}}}),this.loadBundledAssembly=((e,t,r)=>{if(this.isUnloaded())throw v.InvalidOperation(`Context is already unloaded. (${this.name})`);let n={};i.push(this);let s=t;try{n=r(m,s);let t=this.current();i.pop();let a=this.domain.getAdo(e);w(e,a,t,n)}finally{i.pop()}return n}),this.getAssembly=(e=>{if(this.isUnloaded())throw v.InvalidOperation(`Context is already unloaded. (${this.name})`,this.getAssembly);if("string"!=typeof e)throw v.InvalidArgument("file",this.getAssembly);let t=r.getAsmFileKey(e);return d[t]||null}),this.getAssemblyByName=(e=>{if(this.isUnloaded())throw v.InvalidOperation(`Context is already unloaded. (${this.name})`,this.getAssemblyByName);if("string"!=typeof e)throw v.InvalidArgument("name",this.getAssemblyByName);return h[e]||null}),this.allAssemblies=(e=>{if(this.isUnloaded())throw v.InvalidOperation(`Context is already unloaded. (${this.name})`,this.allAssemblies);if(e){let e=[],t=Object.keys(d);for(let r of t)e.push(d[r]);return e}return Object.keys(d)}),this.registerResource=(e=>{if(this.isUnloaded())throw v.InvalidOperation(`Context is already unloaded. (${this.name})`,this.registerResource);if("string"!=typeof e.name||""===e.name||"string"!=typeof e.encodingType||""===e.encodingType||"string"!=typeof e.file||""===e.file||"string"!=typeof e.data||""===e.data)throw v.InvalidArgument("rdo",this.registerResource);let t=e.name.substr(0,e.name.lastIndexOf(".")),r=e.name.replace(t+".","");if(u[e.name])throw v.Duplicate(e.name,this.registerResource);if(l[e.name])throw v.Duplicate(`Already registered as Type. (${e.name})`,this.registerResource);if(f[e.name])throw v.Duplicate(`Already registered as Route. (${e.name})`,this.registerResource);return u[e.name]=Object.freeze(new ee(e,t,this)),t?(y[t]||(y[t]={}),y[t][r]=u[e.name]):y[r]=u[e.name],t}),this.getResource=(e=>{if(this.isUnloaded())throw v.InvalidOperation(`Context is already unloaded. (${this.name})`,this.getResource);if("string"!=typeof e)throw v.InvalidArgument("qualifiedName",this.getResource);return u[e]||null}),this.allResources=(e=>{if(this.isUnloaded())throw v.InvalidOperation(`Context is already unloaded. (${this.name})`,this.allResources);if(e){let e=[],t=Object.keys(u);for(let r of t)e.push(u[r]);return e}return Object.keys(u)}),this.registerRoutes=((e,t)=>{if(this.isUnloaded())throw v.InvalidOperation(`Context is already unloaded. (${this.name})`,this.registerRoutes);for(let r of e){if("string"!=typeof r.name||""===r.name||"number"!=typeof r.index||"string"==typeof r.mount&&""===r.mount||Array.isArray(r.mount)&&0===r.mount.length||Array.isArray(r.mount)&&"string"!=typeof r.mount[0]||"string"!=typeof r.mount&&!Array.isArray(r.mount)||"string"!=typeof r.path||""===r.path||"string"!=typeof r.handler||""===r.handler)throw v.InvalidArgument("route: "+r.name,this.registerRoutes);let e=r.name.substr(0,r.name.lastIndexOf(".")),n=r.name.replace(e+".","");if(f[r.name])throw v.Duplicate(r.name,this.registerRoutes);if(l[r.name])throw v.Duplicate(`Already registered as Type. (${r.name})`,this.registerRoutes);if(u[r.name])throw v.Duplicate(`Already registered as Resource. (${r.name})`,this.registerRoutes);f[r.name]=Object.freeze(new te(t,r,e,this)),e?(y[e]||(y[e]={}),y[e][n]=f[r.name]):y[n]=f[r.name]}}),this.getRoute=(e=>{if(this.isUnloaded())throw v.InvalidOperation(`Context is already unloaded. (${this.name})`,this.getRoute);if("string"!=typeof e)throw v.InvalidArgument("qualifiedName",this.getRoute);return f[e]||null}),this.allRoutes=(e=>{if(this.isUnloaded())throw v.InvalidOperation(`Context is already unloaded. (${this.name})`,this.allRoutes);if(e){let e=[],t=Object.keys(f);for(let r of t)e.push(f[r]);return e}return Object.keys(f)}),this.isBusy=(()=>!1),this.hasActiveInstances=(()=>Object.keys(p).length)},Z=function(e,t,r){this.context=t,this.domain=t.domain,this.name=e.name,this.file=e.file,this.package=e.package,this.desc=e.desc,this.title=e.title,this.version=e.version,this.copyright=e.copyright,this.license=e.license,this.lupdate=e.lupdate,this.builder=e.builder.name,this.builderVersion=e.builder.version,this.format=Object.freeze({name:e.builder.format,version:e.builder.formatVersion,contains:e.builder.contains.slice()}),this.types=(()=>e.types.slice()),this.getType=(t=>{if("string"!=typeof t)throw v.InvalidArgument("qualifiedName",this.getType);if(-1===e.types.indexOf(t))throw v.NotFound(t,this.getType);return this.context.getType(t)}),this.getTypes=(t=>{if(["string","interface"]!==q(t))throw v.InvalidArgument("intf",this.getTypes);let r=[];for(let n of e.types)try{let e=this.context.getType(n);Te(e,t)&&r.push(e)}catch(e){}return r}),this.resources=(()=>e.resources.slice()),this.getResource=(t=>{if("string"!=typeof t)throw v.InvalidArgument("qualifiedName",this.getResource);if(-1===e.resources.indexOf(t))throw v.NotFound(t,this.getResource);return this.context.getResource(t)}),this.routes=(()=>e.routes.slice()),this.getRoute=(t=>{if("string"!=typeof t)throw v.InvalidArgument("qualifiedName",this.getRoute);if(-1===e.routes.indexOf(t))throw v.NotFound(t,this.getRoute);return this.context.getRoute(t)}),this.assets=(()=>e.assets.slice()),this.path=(()=>this.alc.getAssemblyFile(this.file)),this.assetsPath=(()=>t.getAssemblyAssetsPath(this.file)),this.getAssetFilePath=(t=>{if("string"!=typeof t)throw v.InvalidArgument("file",this.getAssetFilePath);let r=t.replace("./",this.assetsPath());if(-1===e.assets.indexOf(r))throw v.NotFound(r,this.getAssetFilePath);return r}),this.getLocaleFilePath=((e,t)=>{if("string"!=typeof e)throw v.InvalidArgument("locale",this.getLocaleFilePath);if("string"!=typeof t)throw v.InvalidArgument("file",this.getLocaleFilePath);let r;return t.replace("./",this.assetsPath()+"locales/"+e+"/")}),this.config=(()=>r.config),this.settings=(()=>r.settings)},ee=function(t,r,n){this.context=n,this.name=t.name,this.ns=r,this.assembly=(()=>n.getAssembly(x(t.asmFile,!0))||null),this.encodingType=t.encodingType,this.file=t.file,this.type=t.file.substr(t.file.lastIndexOf(".")+1).toLowerCase(),this.data=t.data;try{if(-1!==t.encodingType.indexOf("utf8;"))if(e){let e=Buffer.from(t.data,"base64");this.data=e.toString("utf8")}else this.data=_(t.data);else e&&(this.data=Buffer.from(t.data,"base64"))}catch(e){throw v.OperationFailed(`Resource data could not be decoded. (${t.name})`,ee)}"json"===this.type&&(this.data=Object.freeze(JSON.parse(this.data)))},te=function(t,r,n,i){this.context=i,this.name=r.name,this.ns=n,this.assembly=(()=>i.getAssembly(t)||null),this.index=r.index,this.mount=r.mount,this.verbs=r.verbs||(e?["get"]:["view"]),this.path=r.path,this.handler=r.handler},re=function(t,r){let n={},i=0,s=null,a=null;const o=function(){let e="<<{{isServer}}>>"=="true",t,r=null;WorkerGlobalScope["FLAIR_SYMBOLS"]="<<{{symbols}}>>";const n=e=>{let t=e.data.func,n=null;const i=t=>{r.postMessage({data:{id:e.data.id,isComplete:!0,isError:!1,error:null,ctx:e.data.ctx,result:e.data.returnsAsIs?t:!!t}})},s=t=>{r.postMessage({data:{id:e.data.id,isComplete:!1,isError:!1,error:null,ctx:e.data.ctx,result:t}})},a=t=>{r.postMessage({data:{id:e.data.id,isComplete:!0,isError:!0,error:t?t.toString():"UnknownError",ctx:e.data.ctx,result:null}})},o=()=>{try{"alc"===e.data.obj&&"execute"===t&&e.data.args.push(e=>{s(e.args)});let r=n(...e.data.args);r&&"function"==typeof r.then?r.then(i).catch(a):i(r)}catch(e){a(e)}};switch(e.data.obj){case"ad":n=se[t],o();break;case"alc":n=se.contexts(e.data.name)[t],o();break}};if(e){require("<<{{entryPoint}}>>");let e=require("worker_threads").parentPort;r=e,e.once("message",e=>{(r=e.privatePort).on("message",n)})}else importScripts("<<{{requirejs}}>>","<<{{entryPoint}}>>"),(r=this).onmessage=n};let c=o.toString().replace("<<{{entryPoint}}>>",se.entryPoint());c=`(${c=(c=(c=c.replace("<<{{requirejs}}>>",W("require.js","require.min.js"))).replace("<<{{isServer}}>>",e.toString())).replace("<<{{symbols}}>>",l.symbols.toString())})();`;const u=(e,t,r,s,o,l,c)=>new Promise((u,f)=>{let p=w();n[p]={resolve:u,reject:f,progressListener:c},i++,a.postMessage({data:{id:p,obj:e,name:t,returnsAsIs:r,ctx:l||{},func:s,args:o&&Array.isArray(o)?o:[]}})}),f=e=>{if(n[e.data.id]){let t=n[e.data.id];e.data.isComplete?(delete n[e.data.id],i--,e.data.isError?t.reject(e.data.error):t.resolve(Object.freeze({ctx:e.data.ctx,result:e.data.result}))):"function"==typeof progressListener&&t.progressListener&&setTimeout(()=>{t.progressListener(Object.freeze({host:e.data.ctx._?e.data.ctx._.host:"",name:"progress",args:e.data.result}))},0)}else r(`Unknown operation is not supported. (${e.data.id})`)};if(e){const{Worker:e,MessageChannel:t}=require("worker_threads");a=new e(c,{eval:!0,workerData:{argv:process.argv,symbols:l.symbols.toString()}});const n=new t;a.postMessage({privatePort:n.port1},[n.port1]),n.port2.on("error",r),n.port2.on("message",f)}else{let e=new Blob([c]),t=(!0).URL.createObjectURL(e,{type:"application/javascript; charset=utf-8"});(a=new(!0).Worker(t)).onmessage=f,a.onerror=r}this.remoteCall=u,this.close=(()=>{e&&(s.close(),a.unref()),a.terminate()}),this.isBusy=(()=>i)},ne=function(e,t,r){let n=!1,i={},s=new re(r,e=>{throw v.OperationFailed("Remote operation failed.",e)});this.name=e,this.isRemote=!0,this.isUnloaded=(()=>n),this.unload=(()=>{n||(n=!0,delete t[e],i={},s.remoteCall("ad","",!1,"unload").finally(()=>{s.close()}))}),this.context=Object.freeze(new ie("default",this,s)),this.contexts=(e=>i[e]||null),this.createContext=(async e=>{if("string"!=typeof e||e&&"default"===e||i[e])throw v.InvalidArguments("name");let t;if(await s.remoteCall("ad","",!1,"createContext",[e])){let t=Object.freeze(new ie(e,this,s));return i[e]=t,t}throw v.OperationFailed("Context could not be created.",e)}),this.loadScripts=(async(...e)=>{if(this.isUnloaded())throw v.InvalidOperation(`AppDomain is already unloaded. (${this.name})`,this.loadScripts);return await s.remoteCall("ad","",!1,"loadScripts",e)})},ie=function(e,t,r){let n=!1;this.name=e,this.domain=t,this.isUnloaded=(()=>n||t.isUnloaded()),this.unload=(()=>{n||(n=!0,r.remoteCall("alc",e,!1,"unload"))}),this.execute=((t,n)=>{if(this.isUnloaded())throw v.InvalidOperation(`Context is already unloaded. (${this.name})`,this.execute);let i=t.ctx||{};return i._={host:t.type},r.remoteCall("alc",e,!0,"execute",[t],i,n)}),this.loadAssembly=(t=>{if(this.isUnloaded())throw v.InvalidOperation(`Context is already unloaded. (${this.name})`,this.loadAssembly);return r.remoteCall("alc",e,!1,"loadAssembly",[t])}),this.isBusy=(()=>{if(this.isUnloaded())throw v.InvalidOperation(`Context is already unloaded. (${this.name})`,this.isBusy);return r.isBusy()}),this.hasActiveInstances=(()=>{r.remoteCall("alc",e,!1,"hasActiveInstances")})},se=function(t){let r={},n={},i={},s={},a=[],o=[],l={},c="",u="",f=null,d=null,h=null,y=null,g=null,b=!1,w=!1;i[t]=this,this.name=t,this.isRemote=!1,this.isUnloaded=(()=>b),this.unload=(async()=>{if(!b){b=!0,d&&"function"==typeof d.stop&&(await d.stop(),Pe(d)),h&&"function"==typeof h.stop&&(await h.stop(),Pe(h));for(let e in s)s.hasOwnProperty(e)&&"function"==typeof s[e].unload&&s[e].unload();g();for(let e in i)i.hasOwnProperty(e)&&i[e]!==this&&i[e].unload();r={},n={},s={},i={},a=[],o=[],l={},c="",u="",f=null,d=null,h=null,y=null,g=null}}),this.createDomain=(async t=>{if("string"!=typeof t||t&&"default"===t||i[t])throw v.InvalidArguments("name");if(e)try{let e=require("worker_threads")}catch(e){throw v.NotAvailable("worker_threads")}let r=Object.freeze(new ne(t,i,o));return i[t]=r,r}),this.domains=(e=>i[e]||null);const O=()=>(y=new Q("default",this,null,a,s),g=y.unload,delete y.unload,y=Object.freeze(y),s[y.name]=y,y);this.context=O(),this.contexts=(e=>s[e]||null),this.createContext=(async e=>{if("string"!=typeof e||e&&"default"===e||s[e])throw v.InvalidArguments("name");let t=Object.freeze(new Q(e,this,y,a,s));return s[e]=t,t}),this.getAsmFileKey=(e=>(-1!==e.indexOf("{.min}")?e=e.replace("{.min}",""):-1!==e.indexOf(".min.js")&&(e=e.replace(".min.js",".js")),e)),this.registerAdo=(e=>{if("string"==typeof e&&(e=JSON.parse(e)),"array"!==q(e.types)||"array"!==q(e.resources)||"array"!==q(e.routes)||"array"!==q(e.assets)||"string"!=typeof e.name||"string"!=typeof e.file||""===e.file)throw v.InvalidArgument("ado",this.registerAdo);e.file=x(e.file,!0);let t=this.getAsmFileKey(e.file);r[t]||(r[t]=Object.freeze(e),e.types.forEach(t=>{if(n[t])throw v.Duplicate(t,this.registerAdo);n[t]=e.file}),e.resources.forEach(t=>{if(n[t])throw v.Duplicate(t,this.registerAdo);n[t]=e.file}),this.context.registerRoutes(e.routes,e.file),o.push(e))}),this.getAdo=(e=>{if("string"!=typeof e)throw v.InvalidArgument("file",this.getAdo);let t=this.getAsmFileKey(e);return r[t]||null}),this.allAdos=(()=>Object.keys(r)),this.resolve=(e=>{if("string"!=typeof e)throw v.InvalidArgument("qualifiedName",this.resolve);return n[e]||null}),this.allTypes=(()=>Object.keys(n)),this.boot=(async t=>{let r="",n=(t=t||{}).main||this.entryPoint(),i=t.module||p.bootModule,s=t.engine||p.bootEngine;if(r="string"==typeof t.config?t.config:this.config()||x(p.config),!i||!s)return console.log("Boot configuration is not available, boot aborted."),!1;if(!n)return console.log("No entry point defined, boot aborted."),!1;w&&(await this.unload(),b=!1,O()),this.root(e?process.cwd():"./"),n&&this.entryPoint(n),r&&await this.config(r);let a=i+"/preamble.js",o=await De(a);if(!o)return console.log("Could not load boot module preamble, boot aborted."),!1;await o(m);let l=await De(s);return l?w=await l.start():(console.log("Could not load boot engine, boot aborted."),!1)}),this.config=(e=>!f&&e?new Promise((t,r)=>{De(e).then(e=>{f=e,t(Object.assign({},f))}).catch(r)}):f?Object.assign({},f):null),this.entryPoint=(e=>("string"!=typeof e||c||(c=e),c)),this.app=(e=>(e&&!d&&(d=e),d)),this.host=(e=>(e&&(h=e),h)),this.loadPathOf=((e,t)=>{if("string"!=typeof e)throw v.InvalidArgument("file",this.loadPath);return t&&(l[e]||(t.endsWith("/")||(t+="/"),l[e]=t)),l[e]||""}),this.root=(e=>("string"!=typeof e||u||(u=e).endsWith("/")||(u+="/"),u)),this.resolvePath=(e=>{if("string"!=typeof e)throw v.InvalidArgument("path",this.resolvePath);return e.replace("./",this.root())}),this.loadScripts=(async(...e)=>await Ce(e)),this.onError=(e=>{if(!h)throw e;h.raiseError(e)})};let ae=new se("default"),oe=ae.unload;delete ae.unload;const le=ae;h("AppDomain",le,()=>{oe()});const ce=(e,t,r)=>{let n=G("obj: flairinstance, memberName: string","obj: flairinstance, memberName: string, attrName: string","obj: flairtype","obj: flairtype, attrName: string")(e,t,r);n.throwOnError(ce);let i=[],a=e[s],o=null,l=null;return n.values.attrName?(l=n.index>1?a.attrs.type.probe(n.values.attrName).current():a.attrs.members.probe(n.values.attrName,n.values.memberName).current())&&i.push(M(l,"name, isCustom, args, type",!0)):(o=n.index>1?a.attrs.type.all().current():a.attrs.members.all(n.values.memberName).current())&&i.push(...M(o,"name, isCustom, args, type",!0)),i};h("getAttr",ce);const ue=e=>{let t=G("Type: flairtype","Type: flairinstance","Type: string")(e);t.throwOnError(ue);let r=null,n="",i="";switch(t.index){case 0:r=e[s].assembly();break;case 1:r=e[s].Type[s].assembly();break;case 2:e.startsWith("[")&&e.endsWith("]")?(i=e.substr(1,e.length-2),r=le.context.getAssemblyByName(i)):(n=le.resolve(e))&&(r=le.context.getAssembly(n));break}return r};h("getAssembly",ue);const fe=e=>{let t;return G("Type: string")(e).throwOnError(fe),le.resolve(e)};h("getAssemblyOf",fe);const pe=e=>{let t;return G("Type: flairtype")(e).throwOnError(pe),e[s].context};h("getContext",pe);const de=e=>{let t;G("qualifiedName: string")(e).throwOnError(de);let r=le.context.getResource(e)||null;return r?r.data:null};h("getResource",de);const me=e=>{let t;G("qualifiedName: string")(e).throwOnError(me),le.context.getRoute(e)};h("getRoute",me);const he=e=>{let t;return G("qualifiedName: string")(e).throwOnError(he),le.context.getType(e)};h("getType",he);const ye=e=>{let t;G("obj: flair")(e).throwOnError(ye);let r=e[s];return r&&r.Type||null};h("getTypeOf",ye);const ge=e=>{let t;G("obj: flair")(e).throwOnError(ge);let r=e[s].Type?e[s].Type[s]:e[s];return r&&r.name||""};h("getTypeName",ge);const be=(e,t)=>{let r;return G("name: undefined","name: string","name: string, asInType: string")(e,t).throwOnError(be),"string"==typeof t?new Promise((r,n)=>{De(t).then(()=>{r(le.context.namespace(e))}).catch(n)}):le.context.namespace(e)};h("ns",be);const ve=(e,t)=>{if("class"!==q(e))throw v.InvalidArgument("Type",ve);if(-1===["string","class"].indexOf(q(t)))throw v.InvalidArgument("Parent",ve);return e[s].isDerivedFrom(t)};h("isDerivedFrom",ve);const we=e=>{if("class"!==q(e))throw v.InvalidArgument("Type",we);return e[s].isAbstract()};h("isAbstract",we);const xe=e=>{if("class"!==q(e))throw v.InvalidArgument("Type",xe);return e[s].isSealed()};h("isSealed",xe);const Oe=e=>{if("class"!==q(e))throw v.InvalidArgument("Type",Oe);return e[s].isStatic()};h("isStatic",Oe);const Ie=e=>{if("class"!==q(e))throw v.InvalidArgument("Type",Ie);return e[s].isSingleton()};h("isSingleton",Ie);const Ae=e=>{if("class"!==q(e))throw v.InvalidArgument("Type",Ae);return e[s].isDeprecated()};h("isDeprecated",Ae);const $e=(e,t)=>{let r=q(e),n=q(t),i=!1;if(-1===u.indexOf(r))throw v.InvalidArgument("obj",$e);if(-1===c.indexOf(n)&&"string"!==n)throw v.InvalidArgument("Type",$e);let a=e[s];switch(n){case"class":(i=a.isInstanceOf(t))||(i=a.Type[s].isDerivedFrom(t));break;case"struct":i=a.isInstanceOf(t);break;case"interface":i=a.isImplements(t);break;case"mixin":i=a.isMixed(t);break;case"string":(i=a.isInstanceOf(t))||"function"!=typeof a.isImplements||(i=a.isImplements(t)),i||"function"!=typeof a.isMixed||(i=a.isMixed(t));break}return i};h("isInstanceOf",$e);const ke=(e,t)=>{if(t[s]&&(t=t[s].name),"string"!==q(t))throw v.InvalidArgument("type",ke);return B(e,t)?e:null};h("as",ke);const je=(e,t)=>{if(!e)throw v.InvalidArgument("obj",je);if("interface"!==q(t))throw v.InvalidArgument("intf",je);let r=!0;for(let n in t)if(t.hasOwnProperty(n)&&n!==s){if(!e[n]){r=!1;break}if("function"==typeof t[n]&&"function"!=typeof e[n]){r=!1;break}}return r};h("isComplies",je);const Te=(e,t)=>{if(-1===["class","instance"].indexOf(q(e)))throw v.InvalidArgument("obj",Te);if(-1===["string","interface"].indexOf(q(t)))throw v.InvalidArgument("intf",Te);return e[s].isImplements(t)};h("isImplements",Te);const Se=(e,t)=>{if(-1===["class","instance"].indexOf(q(e)))throw v.InvalidArgument("obj",Se);if(-1===["string","mixin"].indexOf(q(t)))throw v.InvalidArgument("mixin",Se);return e[s].isMixed(t)};h("isMixed",Se);const Ne=[],Ce=(t,r)=>{let n=G("deps: string, fn: afunction","deps: array, fn: afunction")(t,r);n.throwOnError(Ce),0===n.index&&(t=[t]);let i=[],s=t.slice(),o=()=>{r(...i)},l=()=>{if(0!==s.length){let t=s.shift().trim(),r=null,n=e=>{if(t.startsWith("[")&&t.endsWith("]")&&-1===t.indexOf(".")){let e=t.substr(1,t.length-2).trim();"string"==typeof(r=st.resolve(e,!1))&&(t=r,r=null)}e()},o=e=>{-1===t.indexOf("/")&&((r=he(t))||(r=de(t))),e()},c=e=>{if(-1===t.indexOf("/")){let n=fe(t);n?le.context.loadAssembly(n).then(()=>{(r=he(t))||(r=de(t)),e()}).catch(e=>{throw v.OperationFailed(`Assembly could not be loaded. (${n})`,e,Ce)}):e()}else e()},u=n=>{if(t.startsWith("./")){let i=t.substr(t.lastIndexOf(".")+1).toLowerCase();if(t=le.resolvePath(t),i)if("js"===i||"mjs"===i)t=x(t,!0),D(t).then(e=>{r=e||!0,n()}).catch(e=>{throw v.OperationFailed(`Module/File could not be loaded. (${t})`,e,Ce)});else if(e)if("json"===i)D(t).then(e=>{r=e||!0,n()}).catch(e=>{throw v.OperationFailed(`Local Module/File could not be loaded. (${t})`,e,Ce)});else{let e=require("fs");try{r=e.readFileSync(t),n()}catch(e){throw v.OperationFailed(`Local File could not be read. (${t})`,e,Ce)}}else C(t).then(e=>{r=e,n()}).catch(e=>{throw v.OperationFailed(`File could not be loaded. (${t})`,e,Ce)});else n()}else n()},f=n=>{t.startsWith("./")?n():(e||(t=`./${a}/${t}`),t=x(t,!0),D(t).then(e=>{r=e||!0,n()}).catch(e=>{throw v.OperationFailed(`Module could not be loaded. (${t})`,e,Ce)}))},p=e=>{i.push(r),e||Ne.pop(),l()};if(""===(t=x(t)))return r=!0,void p(!0);if(-1!==Ne.indexOf(t))throw v.Circular(t,Ce);Ne.push(t),n(()=>{r?p():o(()=>{r?p():c(()=>{r?p():u(()=>{r?p():f(()=>{if(!r)throw v.OperationFailed(`Dependency could not be resolved. (${t})`,Ce);p()})})})})})}else o()};l()};h("bring",Ce,()=>{Ne.length=0});const De=(e,t)=>new Promise((r,n)=>{if("string"==typeof e)try{Ce([e],i=>{i?"boolean"!=typeof i||"string"!=typeof t||(i=(!0)[t])?r(i):n(v.OperationFailed(`Dependency object could not be located. (${e})`)):n(v.OperationFailed(`Dependency could not be resolved. (${e})`))})}catch(e){n(e)}else n(v.InvalidArgument("dep"))});h("include",De);const Pe=e=>{let t=G("obj: instance","obj: boolean")(e);t.throwOnError(Pe),1===t.index&&!0===e?(Je(),o.forEach(e=>{e()}),o.length=0):"function"==typeof e[s].dispose&&e[s].dispose()};h("dispose",Pe);const Fe=(e,t)=>{let r=G("obj: instance, fn: afunction","obj: string, fn: afunction")(e,t);if(r.throwOnError(Fe),1===r.index){let t=he(e);if(!t)throw v.NotFound(e,Fe);e=new t}let n=null,i=!1,a=!1,o=()=>{i||"function"!=typeof e[s].dispose||(i=!0,e[s].dispose())};try{(n=t(e))&&"function"==typeof n.finally&&(a=!0,n=n.finally(()=>{o()}))}finally{a||o()}return n};h("using",Fe);let Ee=!1;const ze=(e,...t)=>{let r=G("name: string","name: Attribute")(e);r.throwOnError(ze);let n=null,i=null,a=null;if(0===r.index){if(!(a=Le.inbuilt[e]||null)){if(!(n=he(e)))throw v.NotFound(e,ze);e=n[s].name}}else e=(n=e)[s].name;if(-1!==A(Le.bucket,"name",e))throw v.Duplicate(e,ze);if(n){try{i=new n(...t)}catch(e){throw new v(e,ze)}a=new Me(i.constraints)}Ee?Le.bucket.unshift({name:e,cfg:a,isCustom:null!==i,attr:i,args:t}):Le.bucket.push({name:e,cfg:a,isCustom:null!==i,attr:i,args:t})},Me=function(e,t){let r=G("isModifier: boolean, constraints: string","constraints: string","isModifier: boolean,")(e,t),n;return r.throwOnError(Me),{isModifier:r.values.isModifier||!1,constraints:r.values.constraints}},Re=(e,...t)=>ze(e,...t),_e=(e,...t)=>{Ee=!0;let r=ze(e,...t);return Ee=!1,r},Le=Re[s]=Object.freeze({bucket:[],inbuilt:Object.freeze({static:new Me(!0,"(class && !$abstract) || ((class && (prop || func)) && !($abstract || $virtual || $override))"),abstract:new Me(!0,"(class && !$sealed && !$static) || ((class && (prop || func || event)) && !($override || $sealed || $static))"),virtual:new Me(!0,"class && (prop || func || construct || dispose || event) && !($abstract || $override || $sealed || $static)"),override:new Me(!0,"(class && (prop || func || construct || dispose || event) && ((@virtual || @abstract || @override) && !(virtual || abstract)) && !(@sealed || $static))"),sealed:new Me(!0,"(class || ((class && (prop || func || event)) && override))"),private:new Me(!0,"(class || struct) && (prop || func || event) && !($protected || @private || $static)"),protected:new Me(!0,"(class) && (prop || func || event) && !($private || $static)"),readonly:new Me(!0,"(class || struct) && prop && !abstract"),async:new Me(!0,"(class || struct) && func"),privateSet:new Me(!0,"(class || struct) && prop && !($private || $static)"),protectedSet:new Me(!0,"(class) && prop && !($protected || $private || $static)"),overload:new Me("((class || struct) && (func || construct) && !($virtual || $abstract || $override || $args))"),enumerate:new Me("(class || struct) && prop || func || event"),dispose:new Me("class && prop"),post:new Me("(class || struct) && event"),fetch:new Me("(class || struct) && (func && async) && !(timer || on || @fetch)"),on:new Me("class && func && !(event || $async || $args || $overload || $inject || $static)"),timer:new Me("class && func && !(event || $async || $args || $inject || @timer || $static)"),type:new Me("(class || struct) && prop"),args:new Me("(class || struct) && (func || construct) && !$on && !$overload"),inject:new Me("class && (prop || func || construct) && !(static || session || state || fetch)"),resource:new Me("class && prop && !(session || state || inject || asset)"),asset:new Me("class && prop && !(session || state || inject || resource)"),singleton:new Me("(class && !(prop || func || event) && !($abstract || $static))"),serialize:new Me("((class || struct) || ((class || struct) && prop)) && !($abstract || $static || noserialize)"),deprecate:new Me("!construct && !dispose"),session:new Me("(class && prop) && !($static || $state || $readonly || $abstract || $virtual)"),state:new Me("(class && prop) && !($static || $session || $readonly || $abstract || $virtual)"),conditional:new Me("(class || struct) && (prop || func || event)"),noserialize:new Me("(class || struct) && prop"),aspects:new Me("(class && func)"),ns:new Me("(class || struct || mixin || interface || enum) && !(prop || func || event || construct || dispose)"),mixin:new Me("class && (prop || func || event)"),interface:new Me("class && (prop || func || event)")})});for(let e in Le.inbuilt)Le.inbuilt.hasOwnProperty(e)&&(ze[`$$${e}`]=((...t)=>{ze(e,...t)}));Re.collect=(()=>{let e=Le.bucket.slice();return Re.clear(),e}),Re.has=(e=>{if("string"!=typeof e)throw v.InvalidArgument("name");return-1!==Le.bucket.findIndex(t=>t.name===e)}),Re.get=(e=>{if("string"!=typeof e)throw v.InvalidArgument("name");let t=Le.bucket.findIndex(t=>t.name===e);return-1!==t?Le.bucket[t]:null}),Re.count=(()=>Le.bucket.length),Re.clear=(()=>{Le.bucket.length=0}),h("$$",ze);const Ue=(e,t,r,n,i)=>{let a=Re.collect(),o=null,l=null,u=We(!0,e,t),f=We(!1,e,t),p="";if(n?(o=t.attrs.type,l=t.modifiers.type,p=`${t.name}`):(o=e.attrs.members[r],l=e.modifiers.members[r],p=`${e.name}::${r}`),!i)for(let e of a)if(e.isCustom)throw v.InvalidOperation(`Custom attribute cannot be applied. (${e.name})`,He);const d=i=>{let a=!1,o=c,l=["prop","func","construct","dispose","event"],d=["static","abstract","sealed","virtual","override","private","privateSet","protected","protectedSet","readonly","async"],m=[],h=[],y=i.cfg.constraints;const g=e=>{let t={withWhat:"",matchType:"",original:e,name:"",value:!1};switch(e.substr(0,1)){case"$":t.matchType="anywhere",t.name=e.substr(1);break;case"@":t.matchType="inherited",t.name=e.substr(1);break;default:t.matchType="current",t.name=e;break}e.endsWith("^")?(t.withWhat="typeName",t.name=t.name.replace("^","")):-1!==o.indexOf(t.name)?(t.withWhat="typeType",t.matchType="current"):-1!==l.indexOf(t.name)?(t.withWhat="memberType",t.matchType="current"):d.indexOf(t.name)!==0-1?t.withWhat="modifier":t.withWhat="attribute","struct"===t.name?h.push(t):m.push(t)},b=()=>{let e=new RegExp("[^!&!|()]","g"),t="",r=[],n=0;for(;1&&null!==(t=e.exec(y));)r.push(t);t="",n=0;for(let e of r)n++," "!==e[0]?(t+=e[0],n===r.length&&(""!==t&&g(t),t="")):(""!==t&&g(t),t="");m=m.concat(h)};b();for(let i of m){switch(i.withWhat){case"typeName":switch(i.matchType){case"anywhere":i.value=i.name===t.name||t.Type[s].isDerivedFrom(i.name);break;case"inherited":i.value=t.Type[s].isDerivedFrom(i.name);break;case"current":i.value=i.name===t.name;break}break;case"typeType":i.value=t.type===i.name;break;case"memberType":i.value=!n&&e.members[r]===i.name;break;case"modifier":i.value=n?!!u.type.probe(i.name)[i.matchType]():!!u.members.probe(i.name,r)[i.matchType]();break;case"attribute":i.value=n?!!f.type.probe(i.name)[i.matchType]():!!f.members.probe(i.name,r)[i.matchType]();break}y=T(y,i.original,i.value.toString())}try{if(!(a=new Function("try {return ("+y+");}catch(e){return false;}")()))throw v.InvalidOperation(`${i.cfg.isModifier?"Modifier":"Attribute"} ${i.name} could not be applied. (${p} --\x3e [${y}])`,He)}catch(e){throw v.OperationFailed(`${i.cfg.isModifier?"Modifier":"Attribute"} ${i.name} could not be applied. (${p} --\x3e [${y}])`,e,He)}return a};for(let r of a)d(r)&&((r=M(r,null,!1,{type:n?t.name:e.name})).isCustom?o.push(r):r.cfg.isModifier?l.push(r):o.push(r))},We=(e,t,r)=>{let n=e?"modifiers":"attrs",i=(e,i,s,a)=>{let o=null;if(i&&"construct"===i&&(i="_construct"),i&&"dispose"===i&&(i="_dispose"),a)if(s){let t=r.previous();for(;1&&null!==t&&(t[n]&&t[n].type&&(o=$(t[n].type,"name",e)),!o);)t=t.previous()}else r[n]&&r[n].type&&(o=$(r[n].type,"name",e));else if(s){let r=t.previous();for(;1&&null!==r&&(r[n]&&r[n].members[i]&&(o=$(r[n].members[i],"name",e)),!o);)r=r.previous()}else t[n]&&t[n].members[i]&&(o=$(t[n].members[i],"name",e));return o},s=(e,t,r,n)=>null!==i(e,t,r,n);const a=(e,t)=>{let r;return Object.freeze({anywhere:()=>i(e,t,!1,!1)||i(e,t,!0,!1),current:()=>i(e,t,!1,!1),inherited:()=>i(e,t,!0,!1),only:Object.freeze({current:()=>i(e,t,!1,!1)&&!i(e,t,!0,!1),inherited:()=>!i(e,t,!1,!1)&&i(e,t,!0,!1)})})},o=e=>{let t;return Object.freeze({anywhere:()=>i(e,null,!1,!0)||i(e,null,!0,!0),current:()=>i(e,null,!1,!0),inherited:()=>i(e,null,!0,!0),only:Object.freeze({current:()=>i(e,null,!1,!0)&&!i(e,null,!0,!0),inherited:()=>!i(e,null,!1,!0)&&i(e,null,!0,!0)})})},l=e=>{let r=Object.freeze({current:()=>t[n].members[e].slice(),inherited:()=>{let r=[],i=null,s=t.previous();for(;1&&null!==s;)s[n]&&s[n].members&&(i=$(s[n].members,"name",e)),i&&r.push(...i),s=s.previous();return r},anywhere:()=>[...r.current(),...r.inherited()]});return r},c=()=>{let e=Object.freeze({current:()=>r[n].type.slice(),inherited:()=>{let e=[],t=null,i=r.previous();for(;1&&null!==i;)i[n]&&i[n].type&&(t=i[n].type.slice()),t&&e.push(...t),i=i.previous();return e},anywhere:()=>[...e.current(),...e.inherited()]});return e},u={type:Object.freeze({get:(e,t)=>i(e,null,t,!0),has:(e,t)=>s(e,null,t,!0),all:c,probe:o}),members:{get:(e,t,r)=>i(e,t,r,!1),has:(e,t,r)=>s(e,t,r,!1),all:l,probe:a}};return e&&(u.members.is=((e,t)=>{let r=a(e,t);switch(e){case"static":return r.anywhere();case"abstract":return r.anywhere()&&!(a("virtual",t).anywhere()||a("override",t).anywhere());case"virtual":return r.anywhere()&&!a("override",t).anywhere();case"override":return r.anywhere()&&!a("sealed",t).anywhere();case"sealed":return r.anywhere();case"private":return r.anywhere();case"protected":return r.anywhere();case"readonly":return r.anywhere();case"async":return r.anywhere()}}),u.members.type=(e=>{let r,n="";if(!("type"===t.level)){let r=t;for(;1&&null!==r&&(r.members[e]&&(n=r.members[e]),!n);)r=r.previous()}return n}),u.members.isProperty=(e=>"prop"===u.members.type(e)),u.members.isFunction=(e=>"func"===u.members.type(e)),u.members.isEvent=(e=>"event"===u.members.type(e))),u.members=Object.freeze(u.members),Object.freeze(u)},qe=e=>{let t={getType:function(){let e;return this.instance.def.Type}},r={id:w()};e.ex.instance=N(e.ex.instance,t,!1),e.mex.instance=N(e.mex.instance,r,!1);let n={getName:function(e){let t=this.type.def;return e?t.flatname:t.name},getType:function(){let e;return this.type.def.type},getAssembly:function(){let e,t,r;return this.type.Type[this.type.meta].assembly()},getNamespace:function(){let e,t,r;return this.type.Type[this.type.meta].namespace}},i={id:w()};e.ex.type=N(e.ex.type,n,!1),e.mex.type=N(e.mex.type,i,!1)},Be=(e,t,r,n,i,s,a)=>{let o={type:{Type:t,def:n,attrs:i,modifiers:s,meta:a}};for(let t in e)e.hasOwnProperty(t)&&("function"==typeof e[t]?Object.defineProperty(r,t,{configurable:!0,enumerable:!1,value:e[t].bind(o)}):Object.defineProperty(r,t,{configurable:!0,enumerable:!1,value:e[t]}))},Ve=(e,t,r,n,i,s,a,o,l,c,u)=>{let f={instance:{obj:t,def:i,attrs:a,modifiers:o,meta:u},type:{Type:n,typeDef:s,attrs:l,modifiers:c,meta:u}};for(let t in e)"function"==typeof e[t]?Object.defineProperty(r,t,{configurable:!0,enumerable:!1,value:e[t].bind(f)}):Object.defineProperty(r,t,{configurable:!0,enumerable:!1,value:e[t]})},Ge=(e,t,r,n,i,...a)=>{let o=t[s],c=null,u=o.def(),f="___flag___",p={_flagName:f};if(void 0!==n&&n===f?(p.isNeedProtected=!0,p.isTopLevelInstance=!1,p.staticInterface=e.static?i:null,p.args=a):(p.isNeedProtected=!1,p.isTopLevelInstance=!0,p.staticInterface=e.static?t:null,p.args=void 0!==n?void 0!==i?[n,i].concat(a):[n]:[]),c=p.staticInterface||t,e.singleton&&!u.staticConstructionCycle&&!Pt&&p.isTopLevelInstance&&o.singleInstance.value)return o.singleInstance.value;let d={},m="parentObjs",h=null,g=null,b=null,w="_construct",x="_dispose",A={},$={},j=null,S={name:e.params.typeName,flatname:T(e.params.typeName,".","_"),type:e.types.type,Type:t,level:"object",members:{},scope:{},attrs:{members:{}},modifiers:{members:{}},previous:()=>j},C=null,D=!1,P=null,F=e.storage?X("sessionStorage"):null,E=e.storage?X("localStorage"):null;const M=(e,t,r,n)=>{for(let i of ae.members.all(t).current())if(i.isCustom){if("prop"===r){let r=i.attr.decorateProperty(S.name,t,n);if(!r.get||!r.set)throw v.OperationFailed(`${i.name} decoration result is unexpected. (${S.name}::${t})`,He);r.get=r.get.bind(e),r.set=r.set.bind(e),n=r}else{let s=null;if("func"===r){if(s=i.attr.decorateFunction(S.name,t,n),I(n)!==I(s))throw v.OperationFailed(`${i.name} decoration result is unexpected. (${S.name}::${t})`,He)}else s=i.attr.decorateEvent(S.name,t,n);if(!s)throw v.OperationFailed(`${i.name} decoration result is unexpected. (${S.name}::${t})`,He);n=s.bind(e)}i.attr=null}return n},R=(e,t,r)=>{let n=null,i=[];return i=pt(S.name,e,r),S.aspects.members[e]=i,i.length>0&&(n=dt(t,S.name,e,i))&&(t=n),t},_=(e,t,n,i)=>{let a=null;if(e!==s)switch(n){case"private":a=r;break;case"protected":for(let t of r[m])if(void 0!==t[e]){a=t;break}a||(a=r);break;case"public":if(i){a=d;break}if("event"===t){a=void 0!==r[e]?r:d;break}a=d;break;default:if(i){if(void 0!==d[e]){a=d;break}if(void 0===r[e])throw v.NotDefined(e,He);a=r}else if("function"==typeof r[e]&&void 0!==d[e]&&"function"==typeof d[e].add&&"function"==typeof d[e].remove)a=r;else if(void 0!==d[e])a=d;else{if(void 0===r[e])throw v.NotDefined(e,He);a=r}}else a=r;return a},L=()=>{let n=!1,i=e=>{Object.defineProperty(d,e,Object.getOwnPropertyDescriptor(r,e))},a=Object.getOwnPropertyDescriptor(r,s);a.enumerable=!1,Object.defineProperty(d,s,a),g=d[s];for(let e in r)if(n=!1,r.hasOwnProperty(e)&&e!==s&&e!==m){if(n=!0,S.members[e]?(se.members.probe("private",e).current()&&(n=!1),n&&se.members.probe("protected",e).current()&&!p.isNeedProtected&&(n=!1)):se.members.probe("protected",e).anywhere()&&!p.isNeedProtected&&(n=!1),n&&i(e),n&&se.members.isProperty(e))if(se.members.probe("privateSet",e).current()){let t=Object.getOwnPropertyDescriptor(d,e);t.set=y,Object.defineProperty(d,e,t)}else if(se.members.probe("protectedSet",e).current()&&!p.isNeedProtected){let t=Object.getOwnPropertyDescriptor(d,e);t.set=y,Object.defineProperty(d,e,t)}if(n&&se.members.is("abstract",e)){if(!p.isNeedProtected)throw v.NotImplemented(`Abstract member is not implemented. (${S.name}::${e})`,He);if(!se.type.probe("abstract").current())throw v.InvalidDefinition(`Abstract member can exists only in abstract type. (${S.name}::${e})`,He)}if(n){let t=ae.members.probe("enumerate",e).current();if(t&&!1===t.args[0]){let t=Object.getOwnPropertyDescriptor(d,e);t.enumerable=!1,Object.defineProperty(d,e,t)}}if(n&&!p.isNeedProtected&&se.members.isEvent(e)){let t=Object.getOwnPropertyDescriptor(d,e);t.enumerable=!1,t.value=d[e].strip(),Object.defineProperty(d,e,t)}}p.isTopLevelInstance&&(Ve(e.ex.instance,d,d,t,S,u,ae,se,o.attrs,o.modifiers,s),Ve(e.mex.instance,d,g,t,S,u,ae,se,o.attrs,o.modifiers,s)),p.isTopLevelInstance||(g.def=S),void 0===r[m]&&(r[m]=[]),r[m].unshift(r),p.isTopLevelInstance||(d[m]=r[m])},U=(t,r)=>{if((-1===Object.keys(d).indexOf(t)||se.members.type(t)!==r[s].modifiers.members.type(t))&&("dispose"!==t||"function"!=typeof d[x]&&"function"!=typeof g.dispose))throw v.NotImplemented(`Interface member is not implemented. (${r[s].name+":"+t})`,He);Re("interface",r[s].name),Ue(S,u,t,!1,e.customAttrs)},W=()=>{if(S.interfaces){for(let e of S.interfaces)for(let t in e)e.hasOwnProperty(t)&&U(t,e);delete S.interfaces}},V=(t,r,n)=>{switch(-1!==["func","prop","event"].indexOf(r)&&t.startsWith("_")&&new v("InvalidName",`Name is not valid. (${S.name}::${t})`),r){case"func":if(!e.func)throw v.InvalidOperation(`Function cannot be defined on this type. (${S.name})`,He);break;case"prop":if(!e.prop)throw v.InvalidOperation(`Property cannot be defined on this type. (${S.name})`,He);break;case"event":if(!e.event)throw v.InvalidOperation(`Event cannot be defined on this type. (${S.name})`,He);break;case"construct":if(!e.construct)throw v.InvalidOperation(`Constructor cannot be defined on this type. (${S.name})`,He);r="func";break;case"dispose":if(!e.dispose)throw v.InvalidOperation(`Dispose cannot be defined on this type. (${S.name})`,He);r="func";break}return r},J=(t,n,i,s)=>{let a=!0,c=ae.members.probe("conditional",n).current();if(c){let e=k(c.args[0]||[]);for(let t of e){if("test"!==(t=t.toLowerCase())||!l.env.isTest){a=!1;break}if("stage"!==t||!l.env.isStage){a=!1;break}if("server"!==t||!l.env.isServer){a=!1;break}if("client"!==t||!l.env.isClient){a=!1;break}if("worker"!==t||!l.env.isWorker){a=!1;break}if("main"!==t||!l.env.isMain){a=!1;break}if("local"!==t||!l.env.isLocal){a=!1;break}if("debug"!==t||!l.env.isDebug){a=!1;break}if("dev"!==t||!l.env.isDev){a=!1;break}if("prod"!==t||!l.env.isProd){a=!1;break}if("cordova"!==t||!l.env.isCordova){a=!1;break}if("nodewebkit"!==t||!l.env.isNodeWebkit){a=!1;break}if(-1===l.symbols.indexOf(t)){a=!1;break}}if(!a)return a}if(e.inheritance&&se.members.probe("abstract",n).current()&&!0!==s.ni)throw v.InvalidDefinition(`Abstract member must not be implemented. (${S.name}::${n})`,He);if((c=se.type.probe("static").current())&&e.static)if(o.isStatic()){if(e.construct&&n===w&&0!==s.length)throw v.InvalidDefinition(`Static constructors cannot have arguments. (${S.name}::construct)`,He);if(e.dispose&&n===x)throw v.InvalidDefinition(`Static types cannot have destructors. (${S.name}::dispose)`,He)}else{if(e.construct&&n===w)throw v.InvalidDefinition(`Non-static types cannot have static constructors. (${S.name}::construct)`,He);if(e.dispose&&n===x)throw v.InvalidDefinition(`Static destructors cannot be defined. (${S.name}::dispose)`,He)}if(e.dispose&&n===x&&0!==s.length&&(s.length>1||1===s.length&&!se.members.probe("override",n).current()))throw v.InvalidDefinition(`Destructor method cannot have arguments. (${S.name}::dispose)`,He);if(-1!==Object.keys(r).indexOf(n)&&(!e.inheritance||e.inheritance&&!se.members.probe("override",n).current())){if("prop"!==i||0!==S.attrs.members[n].length||0!==S.modifiers.members[n].length||s&&(!s||s.get||s.set))throw v.Duplicate(S.name+"::"+n,He);return t[n]=s,!1}if(e.inheritance&&se.members.probe("override",n).current()){if(-1===Object.keys(r).indexOf(n))throw v.InvalidDefinition(`Member not found to override. (${S.name}::${n})`,He);if(se.members.type(n)!==i)throw v.InvalidDefinition(`Overriding member type is invalid. (${S.name}::${n})`,He)}if(e.static&&(se.members.probe("static",n).current()||o.isStatic()))if("func"===i){if(O(s))throw v.InvalidDefinition(`Static functions cannot be defined as an arrow function. (${S.name}::${n})`,He)}else if("prop"===i){if(s&&s.get&&"function"==typeof s.get&&O(s))throw v.InvalidDefinition(`Static property getters cannot be defined as an arrow function. (${S.name}::${n})`,He);if(s&&s.set&&"function"==typeof s.set&&O(s))throw v.InvalidDefinition(`Static property setters cannot be defined as an arrow function. (${S.name}::${n})`,He)}if(e.storage&&ae.members.probe("session",n).current()&&s&&s.get&&"function"==typeof s.get)throw v.InvalidDefinition(`Session properties cannot be defined with a custom getter/setter. (${S.name}::${n})`,He);if(e.storage&&ae.members.probe("state",n).current()){if(s&&s.get&&"function"==typeof s.get)throw v.InvalidDefinition(`State properties cannot be defined with a custom getter/setter. (${S.name}::${n})`,He);if(!E)throw v.InvalidOperation("Port is not configured. (localStorage)",He)}return a},Y=(t,n,i)=>{let a={get:null,set:null},o=y,l=y,u=se.members.probe("readonly",t).anywhere(),f=se.members.probe("static",t).anywhere(),d=ae.members.probe("session",t).anywhere(),m=ae.members.probe("state",t).anywhere(),h=ae.members.probe("deprecate",t).current(),g=ae.members.probe("inject",t).current(),b=ae.members.probe("asset",t).current(),w=ae.members.probe("resource",t).current(),x=ae.members.probe("type",t).current(),O=null!==h,I=O?h.args[0]||`Event is marked as deprecate. (${S.name}::${t})`:"",$=A,k=r,j=e.storage&&(d||m),T=S.flatname+"_"+t,N=null;if(i&&(i.get||i.set)){if(!e.propGetterSetter)throw v.InvalidDefinition(`Getter/Setter are not allowed. (${S.name}::${t})`,He);i.get&&"function"==typeof i.get&&(o=i.get),i.set&&"function"==typeof i.set&&(l=i.set),e.static&&f&&(k=p.staticInterface),a.get=function(){return O&&console.log(I),o.apply(k)}.bind(k),a.set=function(e){if(O&&console.log(I),u&&!k[s].constructing)throw v.InvalidOperation(`Property is readonly. (${S.name}::${t})`,He);if(x&&x.args[0]&&!B(e,x.args[0]))throw v.InvalidArgument("value",He);return l.apply(k,[e])}.bind(k)}else{if(e.static&&f){if($=p.staticInterface[s].props,k=p.staticInterface,x&&x.args[0]&&!B(i,x.args[0]))throw v.InvalidArgument("value",He);$[T]=i}else if(e.storage&&(d||m)){if(d?($=F,T=r[s].id+"_"+T):$=E,ie(d?"session":"state",T),!$.getItem(T)){if(x&&x.args[0]&&!B(i,x.args[0]))throw v.InvalidArgument("value",He);$.setItem(T,JSON.stringify({value:i}))}}else{if(x&&x.args[0]&&!B(i,x.args[0]))throw v.InvalidArgument("value",He);if(e.numOnlyProps&&"number"!=typeof i)throw v.InvalidArgument("value",He);$[T]=i}a.get=function(){if(O&&console.log(I),j){let e=$.getItem(T);return e?JSON.parse(e).value:null}return $[T]}.bind(k),a.set=function(e){if(O&&console.log(I),u&&!k[s].constructing)throw v.InvalidOperation(`Property is readonly. (${S.name}::${t})`,He);if(x&&x.args[0]&&!B(e,x.args[0]))throw v.InvalidArgument("value",He);if(j){let t={value:e};$.setItem(T,JSON.stringify(t))}else $[T]=e}.bind(k)}if(g&&!f&&!j){let e=g.args[0],t=g.args.length>0?g.args[1]:[],r=g.args.length>1&&g.args[2],n=null;try{switch(q(e)){case"class":case"struct":n=t;break;case"string":if(n=he(e)){if(-1===["class","struct"].indexOf(q(n)))throw v.InvalidArgument("inject",He)}else N=st.resolve(e,t,r),Array.isArray(N)||(N=[N]);break;default:throw v.InvalidArgument("inject",He)}!N&&n&&(N=[],t.length>0?N.push(new n(...t)):N.push(new n))}catch(e){throw new v(e,He)}a.set(N)}if((ae.members.probe("dispose",t).anywhere()||g)&&ie("prop",t),(w||b)&&!j){let e=null;if(w)w.args[0]&&(e=de(w.args[0]));else if(b.args[0]){let t=b.args[0];e=c.getAssembly().getAssetFilePath(t)}e&&a.set(e)}return e.customAttrs&&(a=M(k,t,n,a)),a},Q=(t,n,i)=>{if("func"===n){let n=Re.get("overload");if(n){let s,a=e.static&&se.members.probe("static",t).current()?p.staticInterface:r;if(Z(t,i,n),a[t]){if(Re.count()>1)throw v.InvalidDefinition(`Overloaded function cannot define additional modifiers or attributes. (${S.name}::${t})`,He);return Re.collect(),!0}}}return!1},Z=(t,n,i)=>{let a=e.static&&se.members.probe("static",t).current(),o=a?p.staticInterface:r,l,c,u;(a?o[s].overloads:$)[t+"_"+k(i.args[0]).join("_")]=n},ee=(t,...n)=>{let i=e.static&&se.members.probe("static",t).current(),a=i?p.staticInterface:r,o=i?a[s].overloads:$,l="",c="";for(let e of n)l+="_"+typeof e;return l.startsWith("_")&&(l=l.substr(1)),o[c=t+"_"+l]||null},te=(t,n,i)=>{let a=null,o=r,l=e.inheritance&&se.members.probe("override",t).current(),c=e.static&&se.members.probe("static",t).current(),u=se.members.probe("async",t).current(),f=ae.members.probe("deprecate",t).current(),d=ae.members.probe("inject",t).current(),m=ae.members.probe("on",t).current(),h=ae.members.probe("timer",t).current(),g=ae.members.probe("args",t).current(),b=ae.members.probe("aspects",t).current(),w=ae.members.probe("fetch",t).current(),x=ae.members.probe("overload",t).current(),O=null!==f,A=O?f.args[0]||`Function is marked as deprecate. (${S.name}::${t})`:"",$=null,k="",j="",T="",N="",C=null,D=null,P=[];if(l?!0!==($=r[t].bind(o)).ni&&$!==y||($=null):c&&(o=p.staticInterface),d){let e=d.args[0],t=d.args.length>0?d.args[1]:[],r=d.args.length>1&&d.args[2];P=st.resolve(e,t,r),Array.isArray(P)||(P=[P])}if((u=u||I(i))?(w&&w.args.length>0?(k=w.args[0],j=w.args[1],T=w.args[2],N=w.args[3]||"",C=(async(e={})=>(e.method=k,D&&(e.signal=D.signal,D=null),await z(T,j,N,e)))):C=null,a=async function(...e){O&&console.log(A),w&&w.args.length>0&&e.length>0&&e[0]instanceof AbortController&&(D=e[0],e.splice(0,1));let r=[];if($&&r.push($),C&&r.push(C),P.length>0&&r.push(P),g&&g.args.length>0){let t=G(...g.args)(...e);if(t.error)throw t.error;r.push(t)}else r=r.concat(e);x&&(i=ee(t,...r));let n=i.apply(o,r);return n&&"function"==typeof n.then?await n:n}.bind(o)):a=function(...e){O&&console.log(A);let r=[];if($&&r.push($),P.length>0&&r.push(P),g&&g.args.length>0){let t=G(...g.args)(...e);t.throwOnError(He),r.push(t)}else r=r.concat(e);return x&&(i=ee(t,...r)),i.apply(o,r)}.bind(o),e.customAttrs&&(a=M(o,t,n,a)),e.aop){let e=[];b&&b.args.length>0&&(b.args.forEach(e=>{if(!B(e,"Aspect"))throw v.InvalidArgument(`Only Aspect types can be statically weaved on function. (${S.name}::${t})`,He)}),e=b.args),a=R(t,a,e)}if(m&&m.args.length>0&&(rt(m.args[0],a),ie("handler",{name:m.args[0],handler:a})),h&&h.args.length>0){let e=!1,n=setInterval(()=>{o[s].constructing||e||(e=!0,r[t](),e=!1)},1e3*h.args[0]);ie("timer",n)}return a},re=(t,n,i)=>{let a=null,o=null,l=null,c=null,u=e.inheritance&&se.members.probe("override",t).current(),f=ae.members.probe("deprecate",t).current(),p=ae.members.probe("post",t).current(),d=null!==f,m=d?f.args[0]||`Event is marked as deprecate. (${S.name}::${t})`:"",h=r;return P||(P=new K(S.name),ie("event",P)),u&&!0===(l=r[t][s].processor).ni&&(l=null),a=function(...e){return d&&console.log(m),c=l?[l].concat(e):e,i.apply(h,c)}.bind(h),e.customAttrs&&(a=M(h,t,n,a)),o=a,(a=function(...e){let r=e;"function"==typeof o&&(r=o(...e)),P.dispatch(t,r),p&&p.args.length>0&&nt(p.args[0],r)}.bind(h))[s]=Object.freeze({processor:o}),a.add=(e=>{P.add(t,e)}),a.remove=(e=>{P.remove(t,e)}),a.strip=(()=>{let e=N({},a,!0,["strip"]);return delete a.strip,Object.freeze(e)}),a},ne=(t,n,i)=>{if(n=V(t,n,i),Q(t,n,i))return;S.members[t]=n,S.attrs.members[t]=[],S.modifiers.members[t]=[],e.aop&&(S.aspects={members:{}}),e.mixins&&null!==b&&Re("mixin",b[s].name),"func"===n&&I(i)&&!Re.has("async")&&_e("async"),Ue(S,u,t,!1,e.customAttrs);let a=null,o=e.static&&se.members.probe("static",t).current(),l=o?p.staticInterface:r;if(o){if(!u.staticConstructionCycle)return}else if(u.staticConstructionCycle)return;if(J(l,t,n,i)){switch(n){case"func":a=te(t,n,i),Object.defineProperty(l,t,{configurable:!0,enumerable:!0,value:a});break;case"prop":a=Y(t,n,i),Object.defineProperty(l,t,{configurable:!0,enumerable:!0,get:a.get,set:a.set});break;case"event":a=re(t,n,i),Object.defineProperty(l,t,{configurable:!0,enumerable:!0,value:a});break}se.members.probe("private",t).current()?S.scope[t]="private":se.members.probe("protected",t).current()?S.scope[t]="protected":S.scope[t]="public"}},ie=(e,t)=>{h.disposables.push({type:e,data:t})},se=We(!0,S,u),ae=We(!1,S,u);if(e.inheritance){if(p.isTopLevelInstance&&!u.staticConstructionCycle&&!Pt&&se.type.probe("abstract").current())throw v.InvalidOperation(`Cannot create instance of an abstract type. (${S.name})`,He);let e=o.inherits,t=null;if(e){if((t=e[s]).isSealed()||t.isSingleton()||t.isStatic())throw v.InvalidDefinition(`Cannot inherit from a sealed, static or singleton type. (${t.name})`,He);if(t.type!==o.type)throw v.InvalidDefinition(`Cannot inherit from another type family. (${t.type})`,He);if(t.context&&t.context.isUnloaded())throw v.InvalidOperation(`Parent context is not active anymore. (${t.name})`,He);r=new e(p._flagName,p.staticInterface,p.args),h=r[s],j=h.def,delete h.def}else if(o.context&&o.context.isUnloaded())throw v.InvalidOperation(`Type context is not active anymore. (${o.name})`,He)}if(void 0===r[s]&&(r[s]={},h=r[s],e.dispose&&(h.disposables=[])),e.mixins&&(S.mixins=e.params.mixins),e.interfaces&&(S.interfaces=e.params.interfaces),h.type=e.types.instance,p.isTopLevelInstance&&(h.Type=t,e.new&&(h.isInstanceOf=(e=>{if(e[s]&&(e=e[s].name),!e)throw v.InvalidArgument("name",He);return o.name===e||o.isDerivedFrom(e)})),e.mixins&&(h.isMixed=(e=>o.isMixed(e))),e.interfaces&&(h.isImplements=(e=>o.isImplements(e))),h.modifiers=se,h.attrs=ae,Pt&&(h.def=S,h.typeDef=u,h.obj=r)),C=new Proxy({},{get:(t,r)=>{if(e.new&&r!==s&&"$"===r.substr(0,1)){if("$Type"===r)return c;if("$static"===r)return S.Type}let n;return"construct"===r?r=w:"dispose"===r&&(r=x),_(r,S.members[r],S.scope[r])[r]},set:(t,r,n)=>{if(e.new&&r!==s&&"$"===r.substr(0,1))throw v.InvalidOperation(`Special members cannot be custom defined. (${r})`,He);if(D){let e="";"construct"===r?(e="construct",r=w):"dispose"===r?(e="dispose",r=x):"function"==typeof n?!0===n.event?(n!==H&&delete n.event,e="event"):e="func":e="prop",ne(r,e,n)}else{if("function"==typeof n)throw v.InvalidOperation(`Redefinition of members is not allowed. (${r})`,He);let e;_(r,S.members[r],S.scope[r],!0)[r]=n}return!0}}),D=!0,e.mixins&&S.mixins&&!u.staticConstructionCycle){for(let e of S.mixins)b=e,e.apply(C),b=null;delete S.mixins}if(e.params.factory.apply(C),Re.clear(),D=!1,p.isTopLevelInstance&&(e.construct&&"function"==typeof r[w]&&(h.construct=r[w],delete r[w]),e.dispose&&"function"==typeof r[x])){let e=r[x];delete r[x],h.dispose=(()=>{for(let e of h.disposables)switch(e.type){case"session":F.removeItem(e.data);break;case"state":E.removeItem(e.data);break;case"prop":r[e.data]=null;break;case"event":e.data.clear();break;case"handler":rt(e.data.name,e.data.handler,!0);break;case"timer":clearInterval(e.data);break}"function"==typeof e&&e(),h.disposables.length=0,A=null,j=null,S=null,C=null,P=null,d=null,r=null})}return e.static&&o.isStatic()&&u.staticConstructionCycle&&t.construct&&"function"==typeof t[w]&&(o.construct=t[w],delete t[w]),L(),!e.interfaces||u.staticConstructionCycle||Pt||W(),e.construct&&p.isTopLevelInstance&&!u.staticConstructionCycle&&!Pt&&"function"==typeof g.construct&&(g.constructing=!0,g.construct(...p.args),delete g.constructing),e.construct&&u.staticConstructionCycle&&"function"==typeof o.construct&&(o.constructing=!0,o.construct(),delete o.constructing),!p.isTopLevelInstance||u.staticConstructionCycle||Pt||e.singleton&&ae.type.probe("singleton").current()&&(o.singleInstance.value=d),!p.isTopLevelInstance||u.staticConstructionCycle||Pt||(g=Object.freeze(g),d=Object.seal(d)),d},Je=()=>{let t=X("sessionStorage");t?t.clear():e?(!0).sessionStorage&&delete global.sessionStorage:sessionStorage.clear()},He=e=>{if(e.new=e.new||!1,e.mixins=e.mixins||!1,e.interfaces=e.interfaces||!1,e.inheritance=e.inheritance||!1,e.singleton=e.singleton||!1,e.static=e.static||!1,e.const=e.const||!1,e.func=e.func||!1,e.construct=e.construct||!1,e.dispose=e.dispose||!1,e.prop=e.prop||!1,e.propGetterSetter=e.propGetterSetter||!1,e.numOnlyProps=e.numOnlyProps||!1,e.event=e.event||!1,e.storage=e.storage||!1,e.aop=e.aop||!1,e.customAttrs=e.customAttrs||!1,e.types=e.types||{},e.types.instance=e.types.instance||"unknown",e.types.type=e.types.type||"unknown",e.params=e.params||{},e.params.typeName=e.params.typeName||"",e.params.inherits=e.params.inherits||null,e.params.mixinsAndInterfaces=e.params.mixinsAndInterfaces||null,e.params.factory=e.params.factory||null,e.mex=e.mex||{},e.mex.instance=e.mex&&e.mex.instance?e.mex.instance:{},e.mex.type=e.mex&&e.mex.type?e.mex.type:{},e.ex=e.ex||{},e.ex.instance=e.ex&&e.ex.instance?e.ex.instance:{},e.ex.type=e.ex&&e.ex.type?e.ex.type:{},e.params.ns="",e.params.mixins=[],e.params.interfaces=[],e.func||(e.construct=!1,e.dispose=!1),e.prop||(e.storage=!1),e.inheritance||(e.singleton=!1),e.func||e.prop||e.event||(e.aop=!1),e.new&&(e.const=!1),!e.params.typeName||-1!==e.params.typeName.indexOf("."))throw v.InvalidDefinition(`Type name is invalid. (${e.params.typeName})`,He);let t=Re.get("ns"),r=t?t.args[0]:"";if(r)switch(r){case"(auto)":throw v.InvalidDefinition(`Namespace '(auto)' should be used only when bundling the type in an assembly. (${r})`,He);case"(root)":break;default:if(r.startsWith(".")||r.endsWith(".")||/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g.test(r))throw`Namespace name is invalid. (${r})`;e.params.typeName=r+"."+e.params.typeName,e.params.ns=r;break}if(e.params.mixinsAndInterfaces)for(let t of e.params.mixinsAndInterfaces)if(t[s])switch(t[s].type){case"mixin":e.params.mixins.push(t);break;case"interface":e.params.interfaces.push(t);break}delete e.params.mixinsAndInterfaces,qe(e);let n=le.context.current(),i=null,a=null;if(e.new)if(e.inheritance){if(e.params.inherits&&(Oe(e.params.inherits)||Ie(e.params.inherits)||xe(e.params.inherits)))throw v.InvalidDefinition(`Cannot inherit from a sealed, static or singleton type. (${e.params.inherits[s].name})`,He);i=function(t,r,...n){return Ge(e,i,{},t,r,...n)}}else i=function(...t){return Ge(e,i,{},null,null,...t)};else i=e.const?function(){return Ge(e,i,{})}:function(...t){if(new.target)throw v.InvalidOperation(`Construction cannot be done for this type. (${e.params.typeName})`,i);e.params.factory.apply(this,...t)};let o={name:e.params.typeName,flatname:T(e.params.typeName,".","_"),type:e.types.type,Type:i,level:"type",attrs:{type:[]},modifiers:{type:[]},previous:()=>i[s].inherits?i[s].inherits[s].def():null};const l=We(!0,null,o),c=We(!1,null,o);if(i[s]={},(a=i[s]).name=e.params.typeName,a.type=e.types.type,a.namespace=null,a.assembly=(()=>{let t=fe(e.params.typeName);return n.getAssembly(t)||null}),a.context=n,e.inheritance&&(a.inherits=e.params.inherits||null,a.isAbstract=(()=>!!l.type.probe("abstract").current()),a.isSealed=(()=>!!l.type.probe("sealed").current()),a.isDerivedFrom=(t=>{if(t[s]&&(t=t[s].name),"string"!=typeof t)throw v.InvalidArgument("name",a.isDerivedFrom);let r=!1,n=e.params.inherits;if(!r)for(;1&&null!==n;){if(n[s].name===t){r=!0;break}n=n[s].inherits}return r}),a.inherits)){let e=c.type.probe("deprecate").anywhere();if(e){let t=e.args[0]||`Type is marked as deprecated. (${a.name})`;console.log(t)}}if(e.static&&(a.isStatic=(()=>!!l.type.probe("static").current()),a.props={},a.overloads={}),e.singleton&&(a.isSingleton=(()=>!!c.type.probe("singleton").current()),a.singleInstance={value:null}),e.mixins&&(a.mixins=e.params.mixins,a.isMixed=(e=>{if(e[s]&&(e=e[s].name),"string"!=typeof e)throw v.InvalidArgument("name",a.isMixed);let t=!1,r=i;for(;1&&null!==r&&(r[s].mixins&&(t=-1!==$(r[s].mixins,"name",e)),!t);)r=r[s].inherits;return t})),e.interfaces&&(a.interfaces=e.params.interfaces,a.isImplements=(e=>{if(e[s]&&(e=e[s].name),"string"!=typeof e)throw v.InvalidArgument("name",a.isImplements);let t=!1,r=i;for(;1&&null!==r&&(r[s].interfaces&&(t=-1!==$(r[s].interfaces,"name",e)),!t);)r=r[s].inherits;return t})),a.isDeprecated=(()=>!!c.type.probe("deprecate").current()),a.def=(()=>o),a.modifiers=l,a.attrs=c,Ue(null,o,null,!0,e.customAttrs),e.static&&l.type.probe("static").current()){if(e.params.interfaces.length>0)throw v.InvalidDefinition("Static types cannot implement interfaces.",He);if(e.params.mixins.length>0)throw v.InvalidDefinition("Static types cannot implement mixins.",He)}if(e.static){let t=e.params.factory?e.params.factory.toString():"";if(a.isStatic()||-1!==t.indexOf(`$$('static')`)||-1!==t.indexOf(`$$("static")`)){o.staticConstructionCycle=!0;let e=new i;Pe(e),delete o.staticConstructionCycle}}Be(e.ex.type,i,i,o,c,l,s),Be(e.mex.type,i,a,o,c,l,s);let u=null,f=!1;return e.static&&a.isStatic()||e.const?(u=new i,e.const&&(f=!0)):(f=!0,u=i),r&&(a.namespace=le.context.current().registerType(u)),i[s]=Object.freeze(a),f&&Object.freeze(u),u},Ke=(e,t,r,n)=>{let i=G("name: string, inherits: class, factory: cfunction","name: string, inherits: class, mixints: array, factory: cfunction","name: string, factory: cfunction","name: string, mixints: array, factory: cfunction")(e,t,r,n);i.throwOnError(Ke);let s={new:!0,mixins:!0,interfaces:!0,inheritance:!0,singleton:!0,static:!0,func:!0,construct:!0,dispose:!0,prop:!0,propGetterSetter:!0,event:!0,storage:!0,aop:!0,customAttrs:!0,types:{instance:"instance",type:"class"},params:{typeName:i.values.name,inherits:i.values.inherits,mixinsAndInterfaces:i.values.mixints,factory:i.values.factory},mex:{instance:{},type:{}},ex:{instance:{},type:{}}};return He(s)};h("Class",Ke);const Ye=(e,t)=>{let r=G("name: string, factory: cfunction")(e,t);r.throwOnError(Ye);let n={const:!0,func:!0,dispose:!0,prop:!0,propGetterSetter:!0,event:!0,types:{instance:"interface",type:"interface"},params:{typeName:r.values.name,factory:r.values.factory}};return He(n)};h("Interface",Ye);const Xe=(e,t)=>{let r=G("name: string, factory: cfunction")(e,t);r.throwOnError(Xe);let n={new:!0,func:!0,construct:!0,prop:!0,propGetterSetter:!0,types:{instance:"sinstance",type:"struct"},params:{typeName:r.values.name,factory:r.values.factory}};return He(n)};h("Struct",Xe);const Qe=(e,t)=>{let r=G("name: string, factory: cfunction")(e,t);r.throwOnError(Qe);let n={const:!0,prop:!0,numOnlyProps:!0,types:{instance:"enum",type:"enum"},params:{typeName:r.values.name,factory:r.values.factory},mex:{instance:{getName:function(e){let t=this.instance.obj,r=this.instance.def,n="";for(let i in r.members)if(r.members.hasOwnProperty(i)&&"prop"===r.members[i]&&t[i]===e){n=i;break}return n},getNames:function(){let e=this.instance.def,t=[];for(let r in e.members)e.members.hasOwnProperty(r)&&"prop"===e.members[r]&&t.push(r);return t},getValues:function(){let e=this.instance.def,t=this.instance.obj,r=[];for(let n in e.members)e.members.hasOwnProperty(n)&&"prop"===e.members[n]&&r.push(t[n]);return r}}}};return He(n)};Qe.getName=((e,t)=>{let r;return G("enumType: enum, enumValue: number")(e,t).throwOnError(Qe.getName),e[s].getName(t)}),Qe.getNames=(e=>{let t;return G("enumType: enum")(e).throwOnError(Qe.getNames),e[s].getNames()}),Qe.getValues=(e=>{let t;return G("enumType: enum")(e).throwOnError(Qe.getValues),e[s].getValues()}),Qe.isDefined=((e,t)=>{let r=G("enumType: enum, nameOrValue: number","enumType: enum, nameOrValue: string")(e,t);return r.throwOnError(Qe.isDefined),1===r.index?-1!==e[s].getNames().indexOf(t):""!==e[s].getName(t)}),h("Enum",Qe);const Ze=(e,t)=>{let r=G("name: string, factory: cfunction")(e,t);r.throwOnError(Ze);let n={func:!0,prop:!0,propGetterSetter:!0,event:!0,customAttrs:!0,types:{type:"mixin"},params:{typeName:r.values.name,factory:r.values.factory}};return He(n)};h("Mixin",Ze);const et=new K,tt=et.dispatch,rt=(e,t,r)=>{let n;G("event: string, handler: afunction")(e,t).throwOnError(rt),r?et.remove(e,t):et.add(e,t)};h("on",rt,()=>{et.clear()});const nt=(e,t)=>{if("string"!=typeof e)throw v.InvalidArgument("event",nt);tt(e,t)};h("post",nt);let it={};const st={isRegistered:e=>{if("string"!=typeof e)throw v.InvalidArgument("alias",st.isRegistered);return void 0!==it[e]&&it[e].length>0},get:(e,t)=>{if("string"!=typeof e)throw v.InvalidArgument("alias",st.get);return t?it[e]?it[e].slice():[]:it[e]?it[e][0]:null},register:(e,t)=>{if("string"!=typeof e)throw v.InvalidArgument("alias",st.register);if(!t)throw v.InvalidArgument("item",st.register);if(-1!==e.indexOf("."))throw v.InvalidArgument("alias",st.register);"string"==typeof t&&((t=x(t)).endsWith(".js")||t.endsWith(".mjs"))&&(t=x(t,!0)),it[e]||(it[e]=[]),it[e].push(t)},resolve:(e,t,...r)=>{if("string"!=typeof e)throw v.InvalidArgument("alias",st.resolve);if("boolean"!=typeof t)throw v.InvalidArgument("isAll",st.resolve);let n=null;const i=e=>{let t=e;if("string"==typeof e)if(e.endsWith(".js")||e.endsWith(".mjs"));else{let t=he(e);t&&(e=t)}if(-1!==["class","struct"].indexOf(q(e)))try{t=r?new e(...r):new e}catch(t){throw v.OperationFailed(`Type could not be instantiated. (${e[s].name})`,st.resolve)}return t};return it[e]&&it[e].length>0&&(t?(n=[],it[e].forEach(e=>{n.push(i(e))})):n=i(it[e][0])),n}};h("Container",st,()=>{it={}});let at=y,ot=[],lt=500;const ct={on:(e,...t)=>{at===y&&("string"==typeof e?t.unshift(e):"function"==typeof e&&rt("telemetry",e),at=((e,r)=>{if(0===t.length||-1!==t.indexOf(e)){let t=Object.freeze({type:e,data:r});ot.push(t),ot.length>lt-25&&ot.splice(0,25),nt("telemetry",t)}}))},collect:()=>{if(at!==y){let e=ot.slice();return ot.length=0,e}return[]},off:e=>at!==y?("function"==typeof e&&rt("telemetry",e,!0),at=y,ct.collect()):[],isOn:()=>at!==y,types:Object.freeze({RAW:"raw",EXEC:"exec",INFO:"info",INCL:"incl"})};h("telemetry",ct,()=>{ot.length=0});const ut=[],ft={register:(e,t)=>{let r;G("pointcut: string, aspect: Aspect")(e,t).throwOnError(ft.register);let n=e,i="",s="",a="",o="",l=null;-1!==n.indexOf(":")&&(n=(l=n.split(":"))[0].trim(),a=l[1].trim()||"*"),-1!==n.indexOf(".")?(i=n.substr(0,n.lastIndexOf(".")),s=n.substr(n.lastIndexOf(".")+1)):(i="",s=n),o=T(o=i+"/"+s+":"+a,".","[.]"),o=T(o,"?","."),o=T(o,"*",".*"),ut.push({rex:new RegExp(o),Aspect:t})}},pt=(e,t,r)=>{let n=[],i="",a="",o=t.trim(),l="";return-1!==e.indexOf(".")?(i=e.substr(0,e.lastIndexOf(".")).trim(),a=e.substr(e.lastIndexOf(".")+1).trim()):(i="",a=e.trim()),l=i+"/"+a+":"+o,r&&n.push(...r),ut.forEach(e=>{e.rex.test(l)&&-1===A(n,"name",e.Aspect[s].name)&&n.push({name:e.Aspect[s].name,Aspect:e.Aspect})}),n},dt=(e,t,r,n)=>{let i=[],s=[],a=[],o=null,l;for(let e of n)(o=new e.Aspect).before!==y&&i.push(o.before),o.around!==y&&a.push(o.around),o.after!==y&&s.push(o.after);return a.length>0&&a.reverse(),function(...n){let o=null,l=null,c={typeName:()=>t,funcName:()=>r,error:e=>(e&&(o=e),o),result:e=>(void 0!==e&&(l=e),l),args:()=>n,data:{}};for(let e of i)try{e(c)}catch(e){o=e}const u=e=>{for(let t of s)try{t(e)}catch(e){c.error(e)}};let f=e,p=null;for(let e of a)f=e(c,f);try{(p=f(...n))&&"function"==typeof p.then?c.result(new Promise((e,t)=>{p.then(t=>{c.result(t),u(c),e(c.result())}).catch(e=>{c.error(e),u(c),t(c.error())})})):(c.result(p),u(c))}catch(e){c.error(e)}return c.result()}};h("Aspects",ft,()=>{ut.length=0});const mt=(e,t)=>{let r=null,n=null,i=t?JSON.parse(e):e,a=t?null:e[s].Type,o=a[s];const l=(e,t)=>{let r=e[s],n=r.attrs,i=r.modifiers,a=[],o=!1;for(let r in e)e.hasOwnProperty(r)&&r!==s&&((o=i.members.isProperty(r))&&(o=t?!n.members.probe("noserialize",r).anywhere():n.members.probe("serialize",r).anywhere())&&(o=!(i.members.is("private",r)||i.members.is("protected",r)||i.members.is("static",r)||i.members.is("readonly",r)||n.members.probe("resource",r).anywhere()||n.members.probe("asset",r).anywhere()||n.members.probe("inject",r).anywhere())),o&&a.push(r));return a};if(t){if(!i.type&&!i.data)throw v.InvalidArgument("json");if(!(a=he(i.type)))throw v.NotFound(i.type,ht.deserialize);try{r=new a}catch(e){throw v.OperationFailed(`Object could not be deserialized. (${i.type})`,e,ht.deserialize)}n=o.attrs.type.probe("serialize").anywhere()?l(r,!0):l(r,!1);for(let e of n)r[e]=i.data[e]}else{n=o.attrs.type.probe("serialize").anywhere()?l(i,!0):l(i,!1),r={type:i[s].Type[s].name,data:{}};for(let e of n)r.data[e]=i[e];try{r=JSON.stringify(r)}catch(e){throw v.OperationFailed(`Object could not be serialized. (${i[s].Type[s].name})`,e,ht.serialize)}}return r},ht={serialize:e=>{if(u.indexOf(-1===q(e)))throw v.InvalidArgument("instance",ht.serialize);return mt(e)},deserialize:e=>{if(!e||"string"!=typeof e)throw v.InvalidArgument("json",ht.deserialize);return mt(e,!0)}};h("Serializer",ht);const yt=4*l.env.cores,gt=Math.round(yt/4),bt=[],vt=()=>{if(bt.length<=gt)return;let e=bt.slice(0),t=()=>{if(0!==e.length){let r=e.shift();r.context.isBusy()?t():r.context.hasActiveInstances().then(e=>{0===e?(r.unload(),bt.shift(),bt.length>gt&&t()):t()}).catch(()=>{t()})}};t()},wt=async()=>{let e=null;if(0===!bt.length)for(let t of bt)if(!t.context.isBusy()&&0===await t.context.hasActiveInstances()){e=t;break}if(!e){if(bt.length>=yt)throw v.OperationFailed("AppDomain pool limit reached.");e=await le.createDomain(w())}return e},xt={TaskInfo:function(e,...t){if("string"!=typeof e)throw v.InvalidArgument("qualifiedName",xt.TaskInfo);return Object.freeze({type:e,typeArgs:t})},getHandle:async(e,t)=>{let r=await wt(),n;return{run:async(...n)=>await r.context.execute({type:e.type,typeArgs:e.typeArgs,func:"run",args:n,keepAlive:!0},t),close:async()=>{try{return r.context.execute({type:e.type,typeArgs:e.typeArgs,func:"",args:[],keepAlive:!1},t)}finally{vt()}}}},invoke:async(e,t)=>{let r=await wt();try{return await r.context.execute({type:e.type,typeArgs:e.typeArgs,func:"run",args:[],keepAlive:!1},t)}finally{vt()}},parallel:Object.freeze({invokeMany:(...e)=>{let t=[];for(let r of e)t.push(xt.invoke(r));return t},invoke:Object.freeze({any:(...e)=>Promise.race(xt.parallel.invokeMany(...e)),all:(...e)=>Promise.all(xt.parallel.invokeMany(...e)),each:(e,t,...r)=>new Promise((n,i)=>{let s=xt.parallel.invokeMany(...r),a=0;for(let r of s)r.then(e).catch(t).finally(()=>{a++,s.length===a&&n()})})})}),sequence:Object.freeze({invoke:async(...e)=>{let t=[];for(let r of e)t.push(await xt.invoke(r));return t}})};h("Tasks",xt,()=>{bt.forEach(e=>{e.unload()}),bt.length=0});const Ot=e=>{if(e.isServer){if(!(!0).sessionStorage){const e=function(){let e={};this.key=(t=>{if(!t)throw v.InvalidArgument("key",this.key);return!!e.key}),this.getItem=(t=>{if(!t)throw v.InvalidArgument("key",this.getItem);return e.key||null}),this.setItem=((t,r)=>{if(!t)throw v.InvalidArgument("key",this.setItem);if(void 0===r)throw v.InvalidArgument("value",this.setItem);e[t]=r}),this.removeItem=(t=>{if(!t)throw v.InvalidArgument("key",this.removeItem);delete e[t]}),this.clear=(()=>{e={}})};global.sessionStorage=new e}return(!0).sessionStorage}return(!0).sessionStorage};X.define("sessionStorage",["key","getItem","setItem","removeItem","clear"],Ot);const It=e=>e.isServer?Ot(e):(!0).localStorage;X.define("localStorage",["key","getItem","setItem","removeItem","clear"],It);const At=e=>{let t={require:async e=>{if("string"!=typeof e)throw v.InvalidArgument("module");try{return require(e)}catch(e){throw new v(e)}},undef:e=>{if("string"!=typeof e)throw v.InvalidArgument("module",t.undef);try{delete require.cache[require.resolve(e)]}catch(e){throw new v(e,t.undef)}}};return t};X.define("serverModule",["require","undef"],At);const $t=e=>{let t={require:async t=>{if("string"!=typeof t)throw v.InvalidArgument("module");let r=()=>new Promise((e,r)=>{require([t],e,r)}),n=()=>new Promise((e,r)=>{let n=t.substr(t.lastIndexOf(".")+1).toLowerCase(),i=(!0).document.createElement("script");i.type="mjs"===n?"module":"text/javascript",i.name=t,i.src=t,i.onload=(()=>{e()}),i.onerror=(e=>{r(new v(e))}),(!0).document.head.appendChild(i)});return"undefined"!=typeof require?await r():e.isWorker?void importScripts(t):await n()},undef:e=>{if("string"!=typeof e)throw v.InvalidArgument("module",t.undef);let r=null;(r=(!0).requirejs||null)&&r.undef(e)}};return t};X.define("clientModule",["require","undef"],$t);const kt=e=>e=>new Promise((t,r)=>{if("string"!=typeof e)return void r(v.InvalidArgument("file"));let n=e.substr(e.lastIndexOf(".")+1).toLowerCase();try{let i=null,s="";(i=e.startsWith("https")?require("https"):require("http")).get(e,e=>{e.on("data",e=>{s+=e}),e.on("end",()=>{let i=e.headers["content-type"];if("json"===n||/^application\/json/.test(i))try{let e=JSON.parse(s);t(e)}catch(e){r(new v(e))}else t(s)})}).on("error",e=>{r(new v(e))})}catch(e){r(new v(e))}});X.define("serverFile",kt);const jt=e=>async e=>{if("string"!=typeof e)throw v.InvalidArgument("file");let t=e.substr(e.lastIndexOf(".")+1).toLowerCase(),r=await fetch(e);if(!r.ok)throw v.OperationFailed(e,r.status);let n=r.headers["content-type"];return"json"===t||/^application\/json/.test(n)?r.json():r.text()};X.define("clientFile",jt);const Tt=e=>t=>{let r={},n=le.config();return n&&n[t]&&(r=U([r,n[t]],!1)),e.isWorker&&n&&n[`worker:${t}`]&&(r=U([r,n[`worker:${t}`]],!1)),r};X.define("settingsReader",Tt);const St=e=>{let t=X("localStorage"),r="__cache_",n="__savedAt_",i;return{get:async(e,i)=>{if("string"!=typeof e)throw v.InvalidArgument("cacheId");if(!i||!i.duration)throw v.InvalidArgument("cacheConfig");let s=`${r}${e}`,a=`${s}${n}`,o=JSON.parse(t.getItem(s)).value,l=parseInt(t.getItem(a));if(Date.now()-l<=i.duration)return o;throw t.removeItem(s),t.removeItem(a),v.NotFound(e)},set:async(e,i,s)=>{if("string"!=typeof e)throw v.InvalidArgument("cacheId");if(!i)throw v.InvalidArgument("cacheConfig");if(void 0===s)throw v.InvalidArgument("fetchedData");let a=`${r}${e}`,o=`${a}${n}`,l=JSON.stringify({value:s}),c=Date.now().toString();t.setItem(a,l),t.setItem(o,c)},remove:async(e,i)=>{if("string"!=typeof e)throw v.InvalidArgument("cacheId");if(!i)throw v.InvalidArgument("cacheConfig");let s=`${r}${e}`,a=`${s}${n}`;t.removeItem(s),t.removeItem(a)}}};X.define("cacheHandler",["get","set","remove"],St);const Nt=async(e,t,r,n)=>{if("string"!=typeof t)throw v.InvalidArgument("url");if("string"!=typeof r||-1===["text","json","buffer","form","blob"].indexOf(r))throw v.InvalidArgument("resDataType");if(!n)throw v.InvalidArgument("reqData");let i=await e(t,n);if(!i.ok)throw v.OperationFailed(t,i.status);let s="";switch(r){case"text":s="text";break;case"json":s="json";break;case"buffer":s="arrayBuffer";break;case"form":s="formData";break;case"blob":s="blob";break}return await i[s]()},Ct=e=>(e,t,r)=>Nt(require("node-fetch"),e,t,r);X.define("serverFetch",Ct);const Dt=e=>(e,t,r)=>Nt(fetch,e,t,r);X.define("clientFetch",Dt);let Pt=!1;const Ft=[],Et=function(e){if(!e||!e[s]&&-1!==c.indexOf(e[s].type))throw v.InvalidArgument("Type",Et);let t=null,r=null,n=null,i=null,a=null,o=null,l=null;const u=function(e){this.getType=(()=>"modifier"),this.getName=(()=>e.name),this.getArgs=(()=>e.args.slice()),this.getConstraints=(()=>e.cfg.constraints)},f=function(e){this.getType=(()=>"attribute"),this.getName=(()=>e.name),this.getArgs=(()=>e.args.slice()),this.getConstraints=(()=>e.cfg.constraints),this.isCustom=(()=>e.isCustom)},p=function(){this.getTarget=(()=>n),this.getTargetType=(()=>t.type),this.getName=(()=>t.name||""),this.getType=(()=>t.type),this.getId=(()=>t.id),this.getNamespace=(()=>t.namespace),this.getAssembly=(()=>t.assembly()),this.getContext=(()=>t.context),this.isClass=(()=>"class"===t.type),this.isEnum=(()=>"enum"===t.type),this.isStruct=(()=>"struct"===t.type),this.isMixin=(()=>"mixin"===t.type),this.isInterface=(()=>"interface"===t.type),this.isDeprecated=(()=>t.isDeprecated()),this.getModifiers=(()=>{let e=[];for(let t of o.modifiers.type)e.push(u(t));return e}),this.getAttributes=(()=>{let e=[];for(let t of o.attrs.type)e.push(f(t));return e}),this.getAttribute=(e=>{if("string"!=typeof e)throw v.InvalidArgument("name",this.getAttribute);let t=$(o.attrs.type,"name",e);return t?f(t):null}),this.getModifier=(e=>{if("string"!=typeof e)throw v.InvalidArgument("name",this.getModifier);let t=$(o.modifiers.type,"name",e);return t?u(t):null})},d=function(e){e.getMixins=(()=>{let e=[];if(t.mixins)for(let r of t.mixins)e.push(Et(r));return e}),e.isMixed=(r=>{if(!r)throw v.InvalidArgument("name",e.isMixed);return!!t.isMixed&&t.isMixed(r)})},m=function(e){e.getInterfaces=(()=>{let e=[];if(t.interfaces)for(let r of t.interfaces)e.push(Et(r));return e}),e.isImplements=(r=>{if(!r)throw v.InvalidArgument("name",e.isImplements);return!!t.isImplements&&t.isImplements(r)})},h=function(e){e.getInstanceType=(()=>r.type),e.isInstanceOf=(t=>{if(!t)throw v.InvalidArgument("name",e.isInstanceOf);return!!r.isInstanceOf&&r.isInstanceOf(t)})},y=e=>{let t=r.def;for(;1&&null!==t&&!t.members[e];)t=t.previous();return t},g=()=>{let e=null,t=null;l={};for(let n in r.obj){switch((e=y(n)).members[n]){case"prop":t=new x(n,e);break;case"func":t=new O(n,e);break;case"event":t=new I(n,e);break;case"construct":t=new O(n,e);break;case"dispose":t=new O(n,e);break}l[n]=t}},b=()=>{l||g()},w=function(e,r){this.getType=(()=>"member"),this.getMemberType=(()=>r.members[e]),this.getName=(()=>e),this.getModifiers=(()=>{let t=[];for(let r of a.modifiers[e])t.push(u(r));return t}),this.getAttributes=(()=>{let t=[];for(let r of a.attrs[e])t.push(f(r));return t}),this.getAttribute=(t=>{if("string"!=typeof t)throw v.InvalidArgument("name",this.getAttribute);let r=$(a.attrs[e],"name",t);return r?f(r):null}),this.getModifier=(t=>{if("string"!=typeof t)throw v.InvalidArgument("name",this.getModifier);let r=$(a.modifiers[e],"name",t);return r?u(r):null}),this.isPrivate=(()=>null!==$(a.modifiers[e],"name","private")),this.isProtected=(()=>null!==$(a.modifiers[e],"name","protected")),this.isPublic=(()=>!this.isPrivate()&&!this.isProtected()),this.isStatic=(()=>null!==$(a.modifiers[e],"name","static")),this.isSealed=(()=>null!==$(a.modifiers[e],"name","sealed")),this.isAbstract=(()=>null!==$(a.modifiers[e],"name","abstract")),this.isVirtual=(()=>null!==$(a.modifiers[e],"name","virtual")),this.isOverride=(()=>null!==$(a.modifiers[e],"name","virtual")),this.isEnumerable=(()=>Object.getOwnPropertyDescriptor(i,e).enumerable),this.isDeprecated=(()=>null!==$(a.attrs[e],"name","deprecate")),this.isConditional=(()=>null!==$(a.attrs[e],"name","conditional")),this.isMixed=(()=>null!==$(a.attrs[e],"name","mixin")),this.isInterfaced=(()=>null!==$(a.attrs[e],"name","interface")),this.getMixin=(()=>{let r=null,n=$(a.attrs[e],"name","mixin");if(n&&t.mixins)for(let e of t.mixins)if(e===n.name){r=Et(e);break}return r}),this.getInterface=(()=>{let r=null,n=$(a.attrs[e],"name","interface");if(n&&t.interfaces)for(let e of t.interfaces)if(e===n.name){r=Et(e);break}return r})},x=function(e,t){let r=new w(e,t);return r.isReadOnly=(()=>null!==$(a.modifiers[e],"name","readonly")),r.isSerializable=(()=>null!==$(a.attrs[e],"name","serialize")||null===$(a.attrs[e],"name","noserialize")&&null!==$(o.attrs.type,"name","serialize")),r.getValueType=(()=>{let t=$(a.attrs[e],"name","type");if(t)return t.args[0]}),r.isDisposable=(()=>null!==$(a.attrs[e],"name","dispose")),r.isInjectable=(()=>null!==$(a.attrs[e],"name","inject")),r.isResource=(()=>null!==$(a.attrs[e],"name","resource")),r.isAsset=(()=>null!==$(a.attrs[e],"name","asset")),r.isSession=(()=>null!==$(a.attrs[e],"name","session")),r.isState=(()=>null!==$(a.attrs[e],"name","state")),r},O=function(e,t){let r=new w(e,t);return r.isASync=(()=>null!==$(a.modifiers[e],"name","async")),r.isConstructor=(()=>"_construct"===e),r.isDestructor=(()=>"_dispose"===e),r.isSub=(()=>null!==$(a.attrs[e],"name","on")),r.isTimered=(()=>null!==$(a.attrs[e],"name","timer")),r.isInjectable=(()=>null!==$(a.attrs[e],"name","inject")),r.getArgs=(()=>{let t=$(a.attrs[e],"name","args");return t?t.args.slice():null}),r.getAspects=(()=>{if(a.aspects&&a.aspects[e].length>0){let t=[];for(let r of a.aspects[e])t.push(Et(r));return t}return null}),r.getAspect=(t=>{if("string"!=typeof t)throw v.InvalidArgument("name",r.getAspect);if(a.aspects&&a.aspects[e].length>0){let r=$(a.aspects[e],"name",t);if(r)return Et(r)}return null}),r},I=function(e,t){let r=new w(e,t);return delete r.isStatic,r.isPub=(()=>null!==$(a.attrs[e],"name","post")),r},k=function(e){e.getMembers=(e=>{(e=e||{}).types=e.types||[],e.modifiers=e.modifiers||[],e.attrs=e.attrs||[],e.aspects=e.aspects||[],e.inherited=void 0===e.inherited||e.inherited,b();let t=null,r=!0,n=[];for(let i in l)if(r=!0,l.hasOwnProperty(i)){if(t=l[i],e.types.length>0&&-1===e.types.indexOf(t.getMemberType())&&(r=!1),!r||e.inherited||a.members[i]||(r=!1),r&&e.modifiers.length>0)for(let t of e.modifiers)if(-1===A(a.modifiers[i],"name",t)){r=!1;break}if(r&&e.attrs.length>0)for(let t of e.attrs)if(-1===A(a.attrs[i],"name",t)){r=!1;break}if(r&&e.aspects.length>0&&"func"===t.getMemberType())for(let t of e.aspects)if(-1===A(a.aspects[i],"name",t)){r=!1;break}r&&n.push(l[i])}return n}),e.getMember=(t=>{if("string"!=typeof t)throw v.InvalidArgument("memberName",e.getMember);return b(),l[t]||null})},j=function(){let e=new p;return e.getParent=(()=>null!==t.inherits?Et(t.inherits):null),e.isDerivedFrom=(r=>{if(!r)throw v.InvalidArgument("name",e.isDerivedFrom);return!!t.isDerivedFrom&&t.isDerivedFrom(r)}),e.getFamily=(()=>{let e=[],r=t.inherits;for(null!==t.inherits&&e.push(Et(t.inherits));1&&null!==r;)e.push(Et(r)),r=r[s].inherits;return e}),e.isSealed=(()=>!!t.isSealed&&t.isSealed()),e.isAbstract=(()=>!!t.isAbstract&&t.isAbstract()),d(e),m(e),e.isSerializable=(()=>null!==$(o.attrs.type,"name","serialize")),e.isStatic=(()=>!!t.isStatic&&t.isStatic()),e.isSingleton=(()=>!!t.isSingleton&&t.isSingleton()),e.isSingleInstanceCreated=(()=>!!t.singleInstance.value),h(e),k(e),e},T=function(){let e=new p;return e.isSerializable=(()=>null!==$(o.attrs.type,"name","serialize")),h(e),k(e),e},S=function(){let e=new p;return k(e),e},N=function(){let e=new p;return k(e),e},C=function(){let e=new p;return e.getNames=(()=>{let e=[];for(let t of Qe.getNames(i))e.push(x(t,a));return e}),e.getName=(t=>{if(!t)throw v.InvalidArgument("enumValue",e.getName);let r=Qe.getName(i,t);return r?x(r,a):null}),e.getValues=(()=>Qe.getValues(i)),e.isDefined=(t=>{if(!t)throw v.InvalidArgument("nameOrValue",e.isDefined);return Qe.isDefined(i,t)}),e};let D=null,P=null,F=!1;switch(Pt=!0,e[s].type){case"class":n=e,i=new e,F=!0,D=new j;break;case"struct":n=e,i=new e,F=!0,D=new T;break;case"enum":n=e[s].Type,i=e,D=new C;break;case"mixin":P=Ke("temp",[n=e],function(){}),i=new P,F=!0,D=new S;break;case"interface":n=e[s].Type,i=e,D=new N;break}return Pt=!1,F&&Ft.push(i),t=n[s],r=i[s],a=r.def,o=r.typeDef,D};Et.dispose=(()=>{if(Ft.length>0)for(let e of Ft)Pe(e);Ft.length=0}),h("Reflector",Et,()=>{Et.dispose()});const zt=()=>{};zt.guid=w,zt.stuff=S,zt.replaceAll=T,zt.splitAndTrim=k,zt.findIndexByProp=A,zt.findItemByProp=$,zt.which=x,zt.isArrowFunc=O,zt.isASyncFunc=I,zt.sieve=M,zt.deepMerge=U,zt.getLoadedScript=W,zt.b64EncodeUnicode=R,zt.b64DecodeUnicode=_,zt.lens=P,zt.globalSetting=F,h("utils",zt),m.members=Object.freeze(m.members);let Mt=e?__filename:t?self.location.href:W("flair.js","flair.min.js");m.info=Object.freeze({name:"flairjs",title:"Flair.js",desc:"True Object Oriented JavaScript",asm:"flair",file:Mt,version:"0.55.59",copyright:"(c) 2017-2019 Vikas Burman",license:"MIT",lupdate:new Date("Tue, 20 Aug 2019 01:39:03 GMT")});let Rt=x("./flair{.min}.js",!0);le.context.current().loadBundledAssembly(Rt,Mt,(e,t)=>{const{Class:r,Struct:n,Enum:i,Interface:s,Mixin:a,Aspects:o,AppDomain:l,$$:c,attr:u,bring:f,Container:p,include:d,Port:m,on:h,post:y,telemetry:g,Reflector:b,Serializer:v,Tasks:w,as:x,is:O,isDefined:I,isComplies:A,isDerivedFrom:$,isAbstract:k,isSealed:j,isStatic:T,isSingleton:S,isDeprecated:N,isImplements:C,isInstanceOf:D,isMixed:P,getAssembly:F,getAttr:E,getContext:z,getResource:M,getRoute:R,getType:_,ns:L,getTypeOf:U,getTypeName:W,typeOf:q,dispose:B,using:V,Args:G,Exception:J,noop:H,nip:K,nim:Y,nie:X,event:Q}=e,{TaskInfo:Z}=e.Tasks,{env:ee}=e.options,{guid:te,stuff:re,replaceAll:ne,splitAndTrim:ie,findIndexByProp:se,findItemByProp:ae,which:oe,isArrowFunc:le,isASyncFunc:ce,sieve:ue,deepMerge:fe,getLoadedScript:pe,b64EncodeUnicode:de,b64DecodeUnicode:me,lens:he,globalSetting:ye}=e.utils,{$$static:ge,$$abstract:be,$$virtual:ve,$$override:we,$$sealed:xe,$$private:Oe,$$privateSet:Ie,$$protected:Ae,$$protectedSet:$e,$$readonly:ke,$$async:je,$$overload:Te,$$enumerate:Se,$$dispose:Ne,$$post:Ce,$$on:De,$$timer:Pe,$$type:Fe,$$args:Ee,$$inject:ze,$$resource:Me,$$asset:Re,$$singleton:_e,$$serialize:Le,$$deprecate:Ue,$$session:We,$$state:qe,$$conditional:Be,$$noserialize:Ve,$$ns:Ge}=c,Je=ee.isServer||ee.isWorker?null:(!0).document,He=l.context.current().name,Ke=t,Ye=Ke.substr(0,Ke.lastIndexOf("/")+1);l.loadPathOf("flair",Ye);let Xe=JSON.parse("{}"),Qe=e.Port("settingsReader");if("function"==typeof Qe){let e=Qe("flair");e&&(Xe=fe([Xe,e],!1))}Xe=Object.freeze(Xe);let Ze=JSON.parse('{"bootModule":"flairjs-fabric","bootEngine":"flair.app.BootEngine","config":"./appConfig.json | ./webConfig.json"}');return Ze=Object.freeze(Ze),l.context.current().currentAssemblyBeingLoaded("./flair{.min}.js"),c("abstract"),c("ns","(root)"),r("Aspect",function(){c("virtual"),this.before=Y,c("virtual"),this.around=Y,c("virtual"),this.after=Y}),c("abstract"),c("ns","(root)"),r("Attribute",function(){c("virtual"),this.construct=((...e)=>{this.args=Object.freeze(e)}),c("readonly"),this.args=[],c("readonly"),this.constraints="",c("virtual"),this.decorateProperty=Y,c("virtual"),this.decorateFunction=Y,c("virtual"),this.decorateEvent=Y}),c("ns","(root)"),s("IDisposable",function(){this.dispose=Y}),c("ns","(root)"),s("IProgressReporter",function(){this.progress=X}),(()=>{const{IProgressReporter:e,IDisposable:t}=L();c("ns","(root)"),r("Task",[e,t],function(){let e=!1,t=!1,r=l.context.current().name;this.construct=((...e)=>{this.args=e,this.context=l.contexts(r),this.domain=this.context.domain}),c("abstract"),this.dispose=Y,c("protected"),this.args=[],c("protected"),this.context=null,c("protected"),this.domain=null,this.run=(async(...r)=>{if(t)throw J.InvalidOperation("Task is already running",this.run);if(t=!0,!e)try{await this.setup(),e=!0}catch(e){throw t=!1,e}try{let e;return await this.onRun(...r)}catch(e){throw e}finally{t=!1}}),this.progress=Q(e=>({data:e})),c("virtual"),c("protected"),c("async"),this.setup=H,c("abstract"),c("protected"),c("async"),this.onRun=Y})})(),(()=>{const{Attribute:e}=L();c("ns","(root)"),r("cache",e,function(){c("override"),this.construct=((e,t)=>{e(t),this.cacheConfig="number"==typeof t?{duration:t}:t,this.enabled=this.cacheConfig&&this.cacheConfig.duration,this.cacheHandler=m("cacheHandler"),this.constraints="(class || struct) && (func && async) && !(timer || on || @fetch || @cache)"}),c("readonly"),this.cacheConfig=null,c("private"),this.cacheHandler=null,c("private"),this.enabled=!1,c("override"),this.decorateFunction=((e,t,r,n)=>{let i=this,s=`${t}___${r}`,a=async(...e)=>{let t=await n(...e);return i.enabled&&await i.cacheHandler.set(s,i.cacheConfig,t),t};return async function(...e){if(i.enabled)try{return await i.cacheHandler.get(s,i.cacheConfig)}catch(e){}return await a(...e)}})})})(),l.context.current().currentAssemblyBeingLoaded(""),l.registerAdo('{"name":"flair","file":"./flair{.min}.js","package":"flairjs","desc":"True Object Oriented JavaScript","title":"Flair.js","version":"0.55.59","lupdate":"Tue, 20 Aug 2019 01:39:03 GMT","builder":{"name":"flairBuild","version":"1","format":"fasm","formatVersion":"1","contains":["init","func","type","vars","reso","asst","rout","sreg"]},"copyright":"(c) 2017-2019 Vikas Burman","license":"MIT","types":["Aspect","Attribute","IDisposable","IProgressReporter","Task","cache"],"resources":[],"assets":[],"routes":[]}'),"function"==typeof onLoadComplete&&onLoadComplete(),Object.freeze({name:"flair",settings:Xe,config:Ze})});let _t=ue("[flair]");return f=_t.settings(),p=_t.config(),Object.freeze(m)});