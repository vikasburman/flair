/**
 * @preserve
 * Flair.js
 * True Object Oriented JavaScript
 * 
 * Assembly: flair
 *     File: ./flair.js
 *  Version: 0.63.97
 *  Thu, 27 Feb 2020 13:58:07 GMT
 * 
 * (c) 2017-2020 Vikas Burman
 * MIT
 */
!function(e,t){"use strict";if("function"==typeof!0&&(!0).amd)(!0)(()=>t());else if("object"==typeof exports){let e=t();"undefined"!=typeof module&&module.exports&&(exports=module.exports=e),module.exports=exports=e}else e.flair=t()}(this||globalThis,function(){"use strict";let e=new Function("try {return this===global;}catch(e){return false;}")(),t=!1,n=[],r="FLAIR_SYMBOLS",i="",s=Symbol("[meta]"),a="modules",o=[],l={},c=["class","enum","interface","mixin","struct"],u=["instance","sinstance"],f={},p={},d=null,m={},h=!1;if(e)try{let e=require("worker_threads");t=e.isMainThread}catch(e){t=!1}else t=void 0!==!0;if(e)if(t){let e;i=require("worker_threads").workerData.symbols||""}else{let e=process.argv.findIndex(e=>!!e.startsWith(`--${r}`));-1!==e&&(i=process.argv[e].substr(2).split("=")[1]),process.env[r]&&(i&&(i+=","),i+=process.env[r])}else t?i=(!0)[r]||"":i+=(!0)[r]||"";i&&(n=i.split(",").map(e=>e.trim())),l.symbols=Object.freeze(n),l.env=Object.freeze({type:e?"server":"client",isServer:e,isClient:!e,isWorker:t,isMain:!t,cores:(e?require("os").cpus().length:(!0).navigator.hardwareConcurrency)||4,isCordova:!e&&!!(!0).cordova,isNodeWebkit:e&&process.versions["node-webkit"],isProd:(-1!==n.indexOf("PROD")||-1!==n.indexOf("STAGE"))&&-1===n.indexOf("DEV"),isStage:-1!==n.indexOf("STAGE")&&-1===n.indexOf("DEV"),isDev:-1!==n.indexOf("DEV"),isLocal:-1!==(e?require("os").hostname():self.location.host).indexOf("local"),isDebug:-1!==n.indexOf("DEBUG"),isTest:-1!==n.indexOf("TEST"),isAppMode:()=>h,x:e=>(!d&&e&&(d=Object.freeze(e)),d||{}),props:(e,t,n)=>{if(void 0===n)return void 0===t?m[e]||{}:m[e]?m[e][t]:null;m[e]=m[e]||{},null===n?delete m[e][t]:m[e][t]=n}});let y=async(e,t)=>{let n=null,r=null;if("string"==typeof e?r={main:e}:e.main&&e.module&&e.engine?r=e:n=e,r)return"string"==typeof t&&(r.config=t),h||(h=await y.AppDomain.boot(r)),y.AppDomain.app();n&&y.AppDomain.registerAdo(n)};y.members=[],y.options=Object.freeze(l),y.env=y.options.env;const g=(e,t,n)=>{"function"==typeof n&&o.push(n),y[e]=Object.freeze(t),y.members.push(e)},b=()=>{};g("noop",b);const w={get:()=>{throw x.NotImplemented("prop",w.get)},set:()=>{throw x.NotImplemented("prop",w.set)},ni:!0};g("nip",w);const v=()=>{throw x.NotImplemented("func",v)};v.ni=!0,g("nim",v);const x=function(e,t,n,r){let i=new Error,s=x;switch(typeof e){case"string":switch(i.name=e,typeof t){case"string":switch(i.message=t,typeof n){case"object":i.error=n,"function"==typeof r&&(s=r);break;case"function":s=n;break}break;case"object":i.message=t.message||"",i.error=t,"function"==typeof n&&(s=n);break;case"function":s=t;break}break;case"object":i.name=e.name||"Unknown",i.message=e.message||"",i.error=e,"function"==typeof t&&(s=t);break}return i.name=i.name||"Undefined",i.name.endsWith("Exception")||(i.name+="Exception"),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(i,s),i.error&&(i.message+="["+i.error+"]"),Object.freeze(i)};x.OperationFailed=((e,t,n=x.OperationFailed)=>new x("OperationFailed",`Operation failed with error. (${e})`,t,n)),x.OperationConflict=((e,t=x.OperationConflict)=>new x("OperationConflict",`Operation failed with conflict. (${e})`,t)),x.Unauthorized=((e,t=x.Unauthorized)=>new x("Unauthorized",`Access is not authorized. (${e})`,t)),x.Circular=((e,t=x.Circular)=>new x("Circular",`Circular calls found. (${e})`,t)),x.Continue=((e,t=x.Continue)=>new x("Continue",`Continue requested. (${e})`,t)),x.Redirect=((e,t=x.Continue)=>new x("Redirect",`Redirect requested. (${e})`,t)),x.Duplicate=((e,t=x.Duplicate)=>new x("Duplicate",`Item already exists. (${e})`,t)),x.NotFound=((e,t=x.NotFound)=>new x("NotFound",`Item not found. (${e})`,t)),x.InvalidArgument=((e,t=x.InvalidArgument)=>new x("InvalidArgument",`Argument type is invalid. (${e})`,t)),x.InvalidDefinition=((e,t=x.InvalidDefinition)=>new x("InvalidDefinition",`Item definition is invalid. (${e})`,t)),x.InvalidOperation=((e,t=x.InvalidOperation)=>new x("InvalidOperation",`Operation is invalid in current context. (${e})`,t)),x.NotImplemented=((e,t=x.NotImplemented)=>new x("NotImplemented",`Member is not implemented. (${e})`,t)),x.NotDefined=((e,t=x.NotDefined)=>new x("NotDefined",`Member is not defined or is not accessible. (${e})`,t)),x.NotAvailable=((e,t=x.NotAvailable)=>new x("NotAvailable",`Feature is not available. (${e})`,t)),x.NotSupported=((e,t=x.NotSupported)=>new x("NotSupported",`Operation is not supported. (${e})`,t)),x.NotAllowed=((e,t=x.NotAllowed)=>new x("NotAllowed",`Operation is not allowed. (${e})`,t)),x.NoContent=((e,t=x.NoContent)=>new x("NoContent",`No content to return. (${e})`,t)),x.NotModified=((e,t=x.NotModified)=>new x("NotModified",`Content is not changed. (${e})`,t)),g("Exception",x);const O=()=>"_xxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx".replace(/[xy]/g,e=>{var t=16*Math.random()|0,n;return("x"==e?t:3&t|8).toString(16)}),I=e=>{let t=e,n=null,r=null;return-1!==t.indexOf("|")&&(n=t.split("|"),"x"===(t=l.env.isServer?n[0].trim():n[1].trim())&&(t="")),-1!==t.indexOf("~")&&(n=t.split("~"),"x"===(t=l.env.isWorker?n[1].trim():n[0].trim())&&(t="")),-1!==t.indexOf("::")&&(r=(n=t.split("::"))[0].trim(),t=n[1].trim(),l.env[r]||l.env.x()[r]||(t="")),-1!==t.indexOf("{.min}")&&(t=l.env.isDebug?t.replace("{.min}",""):t.replace("{.min}",".min")),t},A=e=>!e.hasOwnProperty("prototype")&&"Function"===e.constructor.name,$=e=>"AsyncFunction"===e.constructor.name,k=(e,t,n)=>e.findIndex(e=>e[t]===n),j=(e,t,n)=>{let r=e.findIndex(e=>e[t]===n);return-1!==r?e[r]:null},N=(e,t)=>(t||(t=","),e.split(t).map(e=>e.trim())),T=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),C=(e,t,n)=>e.replace(new RegExp(T(t),"g"),n),S=(e,t)=>{if("string"==typeof e&&Array.isArray(t)&&t.length>0){let n=0;for(let r of t)e=C(e,`%${++n}`,r)}return e},P=(e,t,n,r)=>{r||(r=[]);for(let i in t)if(t.hasOwnProperty(i)&&-1===r.indexOf(i)){if(!n&&i in e)continue;e[i]=t[i]}return e},D=async t=>{let n=null;return n=H(e?"serverFile":"clientFile"),await n(t)},M=async(n,r,i)=>{if(e)return await H("serverModule").require(n);{let e=await H("clientModule").require(n);if(e||"string"!=typeof r||(t?(e=(!0)[r]||null,i&&delete WorkerGlobalScope[r]):(e=(!0)[r]||null,i&&delete window[r])),e)return e}},F=(e,t)=>t.split(".").reduce((e,t)=>e&&e[t]?e[t]:null,e),z=(e,t,n="global")=>{let r=ce.config()&&ce.config()[n]||{};return F(r,e)||t},R=(e,t,n,r)=>{let i=t?N(t):Object.keys(e);const s=t=>{let s={};if(i.length>0)for(let e of i)s[e]=t[e];else for(let t in e)e.hasOwnProperty(t)&&(s[t]=e[t]);if(r)for(let e in r)s[e]=r[e];return n&&(s=Object.freeze(s)),s};if(Array.isArray(e)){let t=[];for(let n of e)t.push(s(n));return t}return s(e)},E=e=>btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function e(t,n){return String.fromCharCode("0x"+n)})),W=e=>decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join("")),L=t=>{e?H("serverModule").undef(t):H("clientModule").undef(t)},_=(e,t=!0)=>{const n=e=>e&&"object"==typeof e;return e.reduce((e,r)=>(Object.keys(r).forEach(i=>{const s=e[i],a=r[i];Array.isArray(s)&&Array.isArray(a)?e[i]=t?s.concat(...a):[].concat(...a):n(s)&&n(a)?e[i]=_([s,a],t):e[i]=a}),e),{})},U=(...n)=>{if(e||t)return"";let r="",i="",s=null;for(let e of n){for(let t of(!0).document.scripts)if(t.src.endsWith(e)){(s=(!0).document.createElement("a")).href=t.src,i=s.protocol+"//"+s.host+"/",s=null,r="./"+t.src.replace(i,"");break}if(r)break}return r},q=e=>{let t="";return void 0===e&&(t="undefined"),t||null!==e||(t="null"),t||"number"!=typeof e||!1!==isFinite(e)||(t="infinity"),!t&&Array.isArray(e)&&(t="array"),!t&&e instanceof Date&&(t="date"),!t&&e[s]&&(t=e[s].type),t||(t=typeof e),t};g("typeOf",q);const B=(e,t)=>{if(t[s]&&(t=t[s].name||t[s].Type.getName()),"string"!==q(t))throw x.InvalidArgument("type",B);let n=!1;if(e)switch(t){case"NaN":n=isNaN(e);break;case"infinity":n="number"==typeof e&&!1===isFinite(e);break;case"array":case"Array":n=Array.isArray(e);break;case"date":case"Date":n=e instanceof Date;break;case"flairtype":n=e[s]&&-1!==c.indexOf(e[s].type);break;case"flairinstance":n=e[s]&&-1!==u.indexOf(e[s].type);break;case"flair":n=void 0!==e[s];break;case"cfunction":n="function"==typeof e&&!A(e);break;case"afunction":n="function"==typeof e&&A(e);break;default:n||(n=typeof e===t),!n&&e[s]&&(n||(n=t===e[s].type),n||-1===u.indexOf(e[s].type)||(n=ke(e,t)),n||"class"!==e[s].type||(n=ve(e,t)),n||-1===c.indexOf(e[s].type)||(n=e[s].name===t))}else switch(t){case"undefined":n=void 0===e;break;case"null":n=null===e;break;case"NaN":n=isNaN(e);break}return n};g("is",B);const G=(e,t)=>{let n=!1;try{e[t],n=void 0===e[t]}catch(e){n=!0}return!n};g("isDefined",G);const V=(...e)=>{if(0===e.length)throw x.InvalidArgument("patterns",V);let t=(...n)=>{let r=null,i=null,s="",a="",o=-1,l=-1,c=!1,u=0,f="",p={raw:n||[],index:-1,isInvalid:!1,error:null,values:{}};if(e)for(let t of e){o++,l=-1,c=!1,u=0,r=t.split(",");for(let e of r){if(l++,2!==(i=e.split(":")).length?(s=`_${o}_${l}`,a=e.trim()||""):(s=i[0].trim()||"",a=i[1].trim()||""),l>p.raw.length){c=!1;break}if(!B(p.raw[l],a)){c=!1,f=s;break}p.values[s]=p.raw[l],c=!0,u++}if(c&&u===r.length){p.index=o;break}}return p.isInvalid=-1===p.index,p.error=p.isInvalid?x.InvalidArgument(f):null,p.throwOnError=(e=>{if(p.error)throw new x(p.error,e||t)}),Object.freeze(p)};return Object.freeze(t)};g("Args",V);const Z=e=>{let t;return V("argsProcessor: undefined","argsProcessor: afunction")(e).throwOnError(Z),(e=e||((...e)=>e)).event=!0,e};g("event",Z);const J=Z(()=>{throw x.NotImplemented("event",J)});J.ni=!0,g("nie",J);const X=function(e){let t={};e=e||"",this.add=((e,n)=>{let r;V("event: string, handler: afunction")(e,n).throwOnError(this.add),t[e]||(t[e]=[]),t[e].push(n)}),this.remove=((e,n)=>{let r;if(V("event: string, handler: afunction")(e,n).throwOnError(this.remove),t[e]){let r=t[e].indexOf(n);-1!==r&&t[e].splice(r,1)}}),this.dispatch=((n,r)=>{let i;V("event: string")(n).throwOnError(this.dispatch),t[n]&&t[n].forEach(t=>{setTimeout(()=>{t(Object.freeze({host:e,name:n,args:r||[]}))},0)})}),this.count=(e=>{let n;return V("event: string")(e).throwOnError(this.count),t[e]?t[e].length:0}),this.clear=(()=>{t={}})},K=function(e){this.value=e};K.filter=(e=>{let t=[];if(e)for(let n of e)n instanceof K||t.push(n);return t}),K.extract=(e=>{let t=[];if(e)for(let n of e)n instanceof K&&t.push(n.value);return t.reverse()}),g("InjectedArg",Object.freeze(K));let Y={};const H=e=>{if("string"!=typeof e)throw x.InvalidArgument("name",H);return Y[e]&&Y[e].handler?Y[e].handler:null};H.define=((e,t)=>{if("string"!=typeof e)throw x.InvalidArgument("name",H);if(!Array.isArray(t)||0===t.length)throw x.InvalidArgument("members",H);if(Y[e])throw x.Duplicate(e,H.define);Y[e]={members:t,handler:null}}),H.connect=(e=>{const{IPortHandler:t}=we();if(!je(e,t))throw x.InvalidArgument("ph",H.connect);if(!e.name)throw x.InvalidArgument("ph",H.connect);if(!Y[e.name])throw x.NotFound(name,H.connect);let n=[e.name].members;for(let t of n)if(void 0===e[t])throw x.NotImplemented(t,H.connect);Y[name].handler=e}),H.disconnect=(e=>{if("string"!=typeof e)throw x.InvalidArgument("name",H.disconnect);Y[e]&&(Y[e].handler=null)}),H.isDefined=(e=>{if("string"!=typeof e)throw x.InvalidArgument("name",H.isDefined);return!!Y[e]}),H.isConnected=(e=>{if("string"!=typeof e)throw x.InvalidArgument("name",H.isConnected);return!(!Y[e]||null===Y[e].handler)}),g("Port",H,()=>{Y={}});const Q=function(t,n,r,i,o){let l={},u={},f={},p={},d={},m={},h={},g=!1,b=[],w={};this.name=t,this.domain=n,this.isUnloaded=(()=>g||n.isUnloaded()),this.unload=(()=>{if(!g){g=!0,delete o[t];for(let e in p)e.hasOwnProperty(e)&&Me(p[e]);l={},d={},m={},u={},f={},p={},h={}}}),this.current=(()=>{if(this.isUnloaded())throw x.InvalidOperation(`Context is already unloaded. (${this.name})`,this.current);return 0===i.length?r||this:i[i.length-1]}),this.registerType=(e=>{if(this.isUnloaded())throw x.InvalidOperation(`Context is already unloaded. (${this.name})`,this.registerType);let t="",n="",r=e[s];if(r.Type?(t=r.Type[s].name,n=r.Type[s].type):(t=r.name,n=r.type),-1===c.indexOf(n))throw x.InvalidArgument("Type",this.registerType);let i=t.substr(0,t.lastIndexOf(".")),a=t.replace(i+".","");if(l[t])throw x.Duplicate(t,this.registerType);if(u[t])throw x.Duplicate(`Already registered as Resource. (${t})`,this.registerType);if(f[t])throw x.Duplicate(`Already registered as Route. (${t})`,this.registerType);return l[t]=e,i?(h[i]||(h[i]={}),h[i][a]=e):h[a]=e,i}),this.getType=(e=>{if(this.isUnloaded())throw x.InvalidOperation(`Context is already unloaded. (${this.name})`,this.getType);if("string"!=typeof e)throw x.InvalidArgument("qualifiedName",this.getType);return l[e]||null}),this.ensureType=(async e=>{if(this.isUnloaded())throw x.InvalidOperation(`Context is already unloaded. (${this.name})`);if("string"!=typeof e)throw x.InvalidArgument("qualifiedName");let t=this.getType(e);if(!t){let r=n.resolve(e);if(!r)throw x.NotFound(e);if(await this.loadAssembly(r),!(t=this.getType(e)))throw x.OperationFailed(`Assembly could not be loaded. (${r})`)}return t}),this.allTypes=(()=>{if(this.isUnloaded())throw x.InvalidOperation(`Context is already unloaded. (${this.name})`,this.allTypes);return Object.keys(l)}),this.execute=(async(e,t)=>{if(this.isUnloaded())throw x.InvalidOperation(`Context is already unloaded. (${this.name})`);e.type=e.type||"",e.typeArgs=e.typeArgs||[],e.func=e.func||"",e.args=e.args||[],e.ctx=e.ctx||{},e.keepAlive=void 0!==e.keepAlive&&e.keepAlive;const n=async()=>{let n,r=new(await this.ensureType(e.type))(...e.typeArgs);return"function"==typeof t&&B(r,"IProgressReporter")&&r.progress.add(t),r},r=async t=>{let n=t[e.func](...e.args);return n&&"function"==typeof n.then?await n:n};let i=null;if(e.keepAlive)return p[e.type]?(i=p[e.type],await r(i)):(i=await n(),p[e.type]=i,await r(i));if(p[e.type])if(i=p[e.type],e.func)try{return await r(i)}finally{Me(i),delete p[e.type]}else Me(i),delete p[e.type];else{let e=await n();try{return await r(e)}finally{Me(e)}}}),this.namespace=(async(e,t)=>{e&&"(root)"===e&&(e=""),t||(t="");let r=null;if(e){if("*"===t){let t=n.allAdos();for(let n of t)-1!==n.namespaces.indexOf(e)&&await this.loadAssembly(n.file)}else""!==t&&await this.loadAssembly(t);r=h[e]||null}else r=h;return r?Object.freeze(P({},r)):null}),this.namespace.root=(()=>h),this.currentAssemblyBeingLoaded=((e,t)=>{if(e){let t=n.getAsmFileKey(e);b.push(t)}else e=b.pop(),w[e]=t}),this.isAssemblyLoadedOrLoading=(e=>{if(this.isUnloaded())throw x.InvalidOperation(`Context is already unloaded. (${this.name})`);let t=n.getAsmFileKey(e);return!(!d[t]&&-1===b.indexOf(t))});const v=(e,t,r,i)=>{let s=n.getAsmFileKey(e);if(!d[s]&&t&&r&&i){d[s]=Object.freeze(new ee(t,r,i)),m[i.name]=d[s];let n=w[e];delete w[e],"function"==typeof n&&n(d[s])}};this.getAssemblyFile=(t=>{let n=this.domain.getAdo(t),r=t;return r.startsWith("./")&&(r=r.substr(2)),r=n&&n.package?e?`${n.package}/${r}`:`./${a}/${n.package}/${r}`:this.domain.root()+r}),this.getAssemblyAssetsPath=(e=>{let t=this.getAssemblyFile(e);return-1!==t.indexOf(".min.js")?t.replace(".min.js","/"):t.replace(".js","/")}),this.loadAssembly=(async e=>{if(this.isUnloaded())throw x.InvalidOperation(`Context is already unloaded. (${this.name})`);if(!this.isAssemblyLoadedOrLoading(e)){i.push(this);let t=this.domain.getAdo(e),n=this.getAssemblyFile(e);L(n);try{let r=await M(n,t.name,!0),s=await r(y,n),a=this.current();v(e,t,a,s)}catch(t){throw x.OperationFailed(e,t)}finally{i.pop()}}}),this.loadBundledAssembly=((e,t,n)=>{if(this.isUnloaded())throw x.InvalidOperation(`Context is already unloaded. (${this.name})`);let r={};i.push(this);let s=t;try{r=n(y,s);let t=this.current();i.pop();let a=this.domain.getAdo(e);v(e,a,t,r)}finally{i.pop()}return r}),this.getAssembly=(e=>{if(this.isUnloaded())throw x.InvalidOperation(`Context is already unloaded. (${this.name})`,this.getAssembly);if("string"!=typeof e)throw x.InvalidArgument("file",this.getAssembly);let t=n.getAsmFileKey(e);return d[t]||null}),this.getAssemblyByName=(e=>{if(this.isUnloaded())throw x.InvalidOperation(`Context is already unloaded. (${this.name})`,this.getAssemblyByName);if("string"!=typeof e)throw x.InvalidArgument("name",this.getAssemblyByName);return m[e]||null}),this.allAssemblies=(e=>{if(this.isUnloaded())throw x.InvalidOperation(`Context is already unloaded. (${this.name})`,this.allAssemblies);if(e){let e=[],t=Object.keys(d);for(let n of t)e.push(d[n]);return e}return Object.keys(d)}),this.registerResource=(e=>{if(this.isUnloaded())throw x.InvalidOperation(`Context is already unloaded. (${this.name})`,this.registerResource);if("string"!=typeof e.name||""===e.name||"string"!=typeof e.encodingType||""===e.encodingType||"string"!=typeof e.file||""===e.file||"string"!=typeof e.data||""===e.data)throw x.InvalidArgument("rdo",this.registerResource);let t=e.name.substr(0,e.name.lastIndexOf(".")),n=e.name.replace(t+".","");if(u[e.name])throw x.Duplicate(e.name,this.registerResource);if(l[e.name])throw x.Duplicate(`Already registered as Type. (${e.name})`,this.registerResource);if(f[e.name])throw x.Duplicate(`Already registered as Route. (${e.name})`,this.registerResource);return u[e.name]=Object.freeze(new te(e,t,this)),t?(h[t]||(h[t]={}),h[t][n]=u[e.name]):h[n]=u[e.name],t}),this.getResource=(e=>{if(this.isUnloaded())throw x.InvalidOperation(`Context is already unloaded. (${this.name})`,this.getResource);if("string"!=typeof e)throw x.InvalidArgument("qualifiedName",this.getResource);return u[e]||null}),this.allResources=(e=>{if(this.isUnloaded())throw x.InvalidOperation(`Context is already unloaded. (${this.name})`,this.allResources);if(e){let e=[],t=Object.keys(u);for(let n of t)e.push(u[n]);return e}return Object.keys(u)}),this.registerRoutes=((e,t)=>{if(this.isUnloaded())throw x.InvalidOperation(`Context is already unloaded. (${this.name})`,this.registerRoutes);for(let n of e){if("string"!=typeof n.name||""===n.name||"number"!=typeof n.index||"string"==typeof n.mount&&""===n.mount||Array.isArray(n.mount)&&0===n.mount.length||Array.isArray(n.mount)&&"string"!=typeof n.mount[0]||"string"!=typeof n.mount&&!Array.isArray(n.mount)||"string"!=typeof n.path||""===n.path||"string"!=typeof n.handler||""===n.handler)throw x.InvalidArgument("route: "+n.name,this.registerRoutes);let e=n.name.substr(0,n.name.lastIndexOf(".")),r=n.name.replace(e+".","");if(f[n.name])throw x.Duplicate(n.name,this.registerRoutes);if(l[n.name])throw x.Duplicate(`Already registered as Type. (${n.name})`,this.registerRoutes);if(u[n.name])throw x.Duplicate(`Already registered as Resource. (${n.name})`,this.registerRoutes);f[n.name]=Object.freeze(new ne(t,n,e,this)),e?(h[e]||(h[e]={}),h[e][r]=f[n.name]):h[r]=f[n.name]}}),this.getRoute=(e=>{if(this.isUnloaded())throw x.InvalidOperation(`Context is already unloaded. (${this.name})`,this.getRoute);if("string"!=typeof e)throw x.InvalidArgument("qualifiedName",this.getRoute);return f[e]||null}),this.allRoutes=(e=>{if(this.isUnloaded())throw x.InvalidOperation(`Context is already unloaded. (${this.name})`,this.allRoutes);if(e){let e=[],t=Object.keys(f);for(let n of t)e.push(f[n]);return e}return Object.keys(f)}),this.isBusy=(()=>!1),this.hasActiveInstances=(()=>Object.keys(p).length)},ee=function(e,t,n){this.context=t,this.domain=t.domain,this.name=e.name,this.file=e.file,this.package=e.package,this.desc=e.desc,this.title=e.title,this.version=e.version,this.copyright=e.copyright,this.license=e.license,this.lupdate=e.lupdate,this.builder=e.builder.name,this.builderVersion=e.builder.version,this.format=Object.freeze({name:e.builder.format,version:e.builder.formatVersion,contains:e.builder.contains.slice()}),this.types=(()=>e.types.slice()),this.namespaces=(()=>e.namespaces.slice()),this.hasType=(t=>{if("string"!=typeof t)throw x.InvalidArgument("qualifiedName",this.hasType);return-1!==e.types.indexOf(t)}),this.getType=(e=>this.hasType(e)?this.context.getType(e):null),this.getTypes=(t=>{if(["string","interface"]!==q(t))throw x.InvalidArgument("intf",this.getTypes);let n=[];for(let r of e.types)try{let e=this.context.getType(r);Te(e,t)&&n.push(e)}catch(e){}return n}),this.resources=(()=>e.resources.slice()),this.hasResource=(t=>{if("string"!=typeof t)throw x.InvalidArgument("qualifiedName",this.hasResource);return-1!==e.resources.indexOf(t)}),this.getResource=(e=>this.hasResource(e)?this.context.getResource(e):null),this.routes=(()=>e.routes.slice()),this.hasRoute=(t=>{if("string"!=typeof t)throw x.InvalidArgument("qualifiedName",this.hasRoute);return-1!==e.routes.indexOf(t)}),this.getRoute=(e=>this.hasRoute(e)?this.context.getRoute(e):null);const r=t=>{let n=t,r="",i="",s="",a=!1;return-1!==n.indexOf("{.min}")?a=!0:-1!==n.indexOf(".min")?(a=!0,n=n.replace(".min","{.min}")):(a=!1,n=n.substr(0,n.lastIndexOf("."))+"{.min}"+n.substr(n.lastIndexOf("."))),!l.env.isDebug&&a&&(a=!1),n.startsWith("./")||(n="./"+n),s=n.replace("{.min}",".min"),i=n.replace("{.min}",""),a?-1!==e.assets.indexOf(n.substr(2))?r=s:-1!==e.assets.indexOf(i.substr(2))&&(r=i):-1!==e.assets.indexOf(i.substr(2))?r=i:-1!==e.assets.indexOf(n.substr(2))&&(r=i),r&&(r=r.replace("./",this.assetsPath())),r},i=(e,t)=>(t.startsWith("./")||(t="./"+t),t=t.replace("./",`./locales/${e}/`),r(t));this.assets=(()=>e.assets.slice()),this.hasAsset=(e=>{if("string"!=typeof e)throw x.InvalidArgument("file",this.hasAsset);return r(e)||!1}),this.getAsset=(e=>this.hasAsset(e)||null),this.hasLocale=((e,t)=>{if("string"!=typeof e)throw x.InvalidArgument("locale",this.hasLocale);if("string"!=typeof t)throw x.InvalidArgument("file",this.hasLocale);return i(e,t)||!1}),this.getLocale=((e,t)=>this.hasLocale(e,t)||null),this.path=(()=>this.alc.getAssemblyFile(this.file)),this.assetsPath=(()=>t.getAssemblyAssetsPath(this.file)),this.localesPath=(e=>{let t=this.assetsPath()+"locales/";return e&&(t+=e+"/"),t}),this.config=(()=>n.config),this.settings=(()=>n.settings)},te=function(t,n,r){this.context=r,this.name=t.name,this.ns=n,this.assembly=(()=>r.getAssembly(I(t.asmFile))||null),this.encodingType=t.encodingType,this.file=t.file,this.type=t.file.substr(t.file.lastIndexOf(".")+1).toLowerCase(),this.data=t.data;try{if(-1!==t.encodingType.indexOf("utf8;"))if(e){let e=Buffer.from(t.data,"base64");this.data=e.toString("utf8")}else this.data=W(t.data);else e&&(this.data=Buffer.from(t.data,"base64"))}catch(e){throw x.OperationFailed(`Resource data could not be decoded. (${t.name})`,te)}"json"===this.type&&(this.data=Object.freeze(JSON.parse(this.data)))},ne=function(t,n,r,i){this.context=i,this.name=n.name,this.ns=r,this.assembly=(()=>i.getAssembly(t)||null),this.index=n.index,this.type=n.type||-1,this.connection=n.connection||"",this.mount=n.mount,this.verbs=n.verbs||(e?["get"]:["view"]),this.mw=n.mw||[],this.path=n.path,this.handler=n.handler},re=function(t,n){let r={},i=0,s=null,a=null;const o=function(){let e="<<{{isServer}}>>"=="true",t,n=null;WorkerGlobalScope["FLAIR_SYMBOLS"]="<<{{symbols}}>>";const r=e=>{let t=e.data.func,r=null;const i=t=>{n.postMessage({data:{id:e.data.id,isComplete:!0,isError:!1,error:null,ctx:e.data.ctx,result:e.data.returnsAsIs?t:!!t}})},s=t=>{n.postMessage({data:{id:e.data.id,isComplete:!1,isError:!1,error:null,ctx:e.data.ctx,result:t}})},a=t=>{n.postMessage({data:{id:e.data.id,isComplete:!0,isError:!0,error:t?t.toString():"UnknownError",ctx:e.data.ctx,result:null}})},o=()=>{try{"alc"===e.data.obj&&"execute"===t&&e.data.args.push(e=>{s(e.args)});let n=r(...e.data.args);n&&"function"==typeof n.then?n.then(i).catch(a):i(n)}catch(e){a(e)}};switch(e.data.obj){case"ad":r=ae[t],o();break;case"alc":r=ae.contexts(e.data.name)[t],o();break}};if(e){require("<<{{entryPoint}}>>");let e=require("worker_threads").parentPort;n=e,e.once("message",e=>{(n=e.privatePort).on("message",r)})}else importScripts("<<{{requirejs}}>>","<<{{entryPoint}}>>"),(n=this).onmessage=r};let c=o.toString().replace("<<{{entryPoint}}>>",ae.entryPoint());c=`(${c=(c=(c=c.replace("<<{{requirejs}}>>",U("require.js","require.min.js"))).replace("<<{{isServer}}>>",e.toString())).replace("<<{{symbols}}>>",l.symbols.toString())})();`;const u=(e,t,n,s,o,l,c)=>new Promise((u,f)=>{let p=O();r[p]={resolve:u,reject:f,progressListener:c},i++,a.postMessage({data:{id:p,obj:e,name:t,returnsAsIs:n,ctx:l||{},func:s,args:o&&Array.isArray(o)?o:[]}})}),f=e=>{if(r[e.data.id]){let t=r[e.data.id];e.data.isComplete?(delete r[e.data.id],i--,e.data.isError?t.reject(e.data.error):t.resolve(Object.freeze({ctx:e.data.ctx,result:e.data.result}))):"function"==typeof progressListener&&t.progressListener&&setTimeout(()=>{t.progressListener(Object.freeze({host:e.data.ctx._?e.data.ctx._.host:"",name:"progress",args:e.data.result}))},0)}else n(`Unknown operation is not supported. (${e.data.id})`)};if(e){const{Worker:e,MessageChannel:t}=require("worker_threads");a=new e(c,{eval:!0,workerData:{argv:process.argv,symbols:l.symbols.toString()}});const r=new t;a.postMessage({privatePort:r.port1},[r.port1]),r.port2.on("error",n),r.port2.on("message",f)}else{let e=new Blob([c]),t=(!0).URL.createObjectURL(e,{type:"application/javascript; charset=utf-8"});(a=new(!0).Worker(t)).onmessage=f,a.onerror=n}this.remoteCall=u,this.close=(()=>{e&&(s.close(),a.unref()),a.terminate()}),this.isBusy=(()=>i)},ie=function(e,t,n){let r=!1,i={},s=new re(n,e=>{throw x.OperationFailed("Remote operation failed.",e)});this.name=e,this.isRemote=!0,this.isUnloaded=(()=>r),this.unload=(()=>{r||(r=!0,delete t[e],i={},s.remoteCall("ad","",!1,"unload").finally(()=>{s.close()}))}),this.context=Object.freeze(new se("default",this,s)),this.contexts=(e=>i[e]||null),this.createContext=(async e=>{if("string"!=typeof e||e&&"default"===e||i[e])throw x.InvalidArguments("name");let t;if(await s.remoteCall("ad","",!1,"createContext",[e])){let t=Object.freeze(new se(e,this,s));return i[e]=t,t}throw x.OperationFailed("Context could not be created.",e)}),this.loadScripts=(async(...e)=>{if(this.isUnloaded())throw x.InvalidOperation(`AppDomain is already unloaded. (${this.name})`,this.loadScripts);return await s.remoteCall("ad","",!1,"loadScripts",e)})},se=function(e,t,n){let r=!1;this.name=e,this.domain=t,this.isUnloaded=(()=>r||t.isUnloaded()),this.unload=(()=>{r||(r=!0,n.remoteCall("alc",e,!1,"unload"))}),this.execute=((t,r)=>{if(this.isUnloaded())throw x.InvalidOperation(`Context is already unloaded. (${this.name})`,this.execute);let i=t.ctx||{};return i._={host:t.type},n.remoteCall("alc",e,!0,"execute",[t],i,r)}),this.loadAssembly=(t=>{if(this.isUnloaded())throw x.InvalidOperation(`Context is already unloaded. (${this.name})`,this.loadAssembly);return n.remoteCall("alc",e,!1,"loadAssembly",[t])}),this.isBusy=(()=>{if(this.isUnloaded())throw x.InvalidOperation(`Context is already unloaded. (${this.name})`,this.isBusy);return n.isBusy()}),this.hasActiveInstances=(()=>{n.remoteCall("alc",e,!1,"hasActiveInstances")})},ae=function(t){let n={},r={},i={},s={},a=[],o=[],l={},c="",u="",f=null,d=null,m=null,h=null,g=null,b=!1,w=!1;i[t]=this,this.name=t,this.isRemote=!1,this.isUnloaded=(()=>b),this.unload=(async()=>{if(!b){b=!0,d&&"function"==typeof d.stop&&(await d.stop(),Me(d)),m&&"function"==typeof m.stop&&(await m.stop(),Me(m));for(let e in s)s.hasOwnProperty(e)&&"function"==typeof s[e].unload&&s[e].unload();g();for(let e in i)i.hasOwnProperty(e)&&i[e]!==this&&i[e].unload();n={},r={},s={},i={},a=[],o=[],l={},c="",u="",f=null,d=null,m=null,h=null,g=null}}),this.createDomain=(async t=>{if("string"!=typeof t||t&&"default"===t||i[t])throw x.InvalidArguments("name");if(e)try{let e=require("worker_threads")}catch(e){throw x.NotAvailable("worker_threads")}let n=Object.freeze(new ie(t,i,o));return i[t]=n,n}),this.domains=(e=>i[e]||null);const v=()=>(h=new Q("default",this,null,a,s),g=h.unload,delete h.unload,h=Object.freeze(h),s[h.name]=h,h);this.context=v(),this.contexts=(e=>s[e]||null),this.createContext=(async e=>{if("string"!=typeof e||e&&"default"===e||s[e])throw x.InvalidArguments("name");let t=Object.freeze(new Q(e,this,h,a,s));return s[e]=t,t}),this.getAsmFileKey=(e=>(-1!==e.indexOf("{.min}")?e=e.replace("{.min}",""):-1!==e.indexOf(".min.js")&&(e=e.replace(".min.js",".js")),e)),this.registerAdo=(e=>{if("string"==typeof e&&(e=JSON.parse(e)),"array"!==q(e.types)||"array"!==q(e.resources)||"array"!==q(e.routes)||"array"!==q(e.assets)||"string"!=typeof e.name||"string"!=typeof e.file||""===e.file)throw x.InvalidArgument("ado",this.registerAdo);e.file=I(e.file);let t=this.getAsmFileKey(e.file);if(!n[t]){let i="";e.namespaces=[],e.types.forEach(t=>{if(r[t])throw x.Duplicate(t,this.registerAdo);r[t]=e.file,i=t.substr(0,t.lastIndexOf(".")),-1===e.namespaces.indexOf(i)&&e.namespaces.push(i)}),e.resources.forEach(t=>{if(r[t])throw x.Duplicate(t,this.registerAdo);r[t]=e.file,i=t.substr(0,t.lastIndexOf(".")),-1===e.namespaces.indexOf(i)&&e.namespaces.push(i)}),e.routes.forEach(t=>{let n=t.name;if(r[n])throw x.Duplicate(n,this.registerAdo);r[n]=e.file,i=n.substr(0,n.lastIndexOf(".")),-1===e.namespaces.indexOf(i)&&e.namespaces.push(i)}),this.context.registerRoutes(e.routes,e.file),n[t]=Object.freeze(e),o.push(e)}}),this.getAdo=(e=>{if("string"!=typeof e)throw x.InvalidArgument("file",this.getAdo);let t=this.getAsmFileKey(e);return n[t]||null}),this.allAdos=(()=>o.slice()),this.resolve=(e=>{if("string"!=typeof e)throw x.InvalidArgument("qualifiedName",this.resolve);return r[e]||null}),this.allTypes=(()=>Object.keys(r)),this.boot=(async t=>{let n="",r=(t=t||{}).main||this.entryPoint(),i=t.module||p.bootModule,s=t.engine||p.bootEngine;if(n="string"==typeof t.config?t.config:this.config()||I(p.config),!i||!s)return console.log("Boot configuration is not available, boot aborted."),!1;if(!r)return console.log("No entry point defined, boot aborted."),!1;w&&(await this.unload(),b=!1,v()),this.root(e?process.cwd():"./"),r&&this.entryPoint(r),n&&await this.config(n);let a=i+"/preamble{.min}.js",o=await De(a);if(!o)return console.log("Could not load boot module preamble, boot aborted."),!1;await o(y);let l=await De(s);return l?w=await l.start():(console.log("Could not load boot engine, boot aborted."),!1)}),this.config=(e=>!f&&e?new Promise((t,n)=>{De(e).then(e=>{f=e,t(Object.assign({},f))}).catch(n)}):f?Object.assign({},f):null),this.entryPoint=(e=>("string"!=typeof e||c||(c=e),c)),this.app=(e=>(e&&!d&&(d=e),d)),this.host=(e=>(e&&(m=e),m)),this.loadPathOf=((e,t)=>{if("string"!=typeof e)throw x.InvalidArgument("file",this.loadPath);return t&&(l[e]||(t.endsWith("/")||(t+="/"),l[e]=t)),l[e]||""}),this.root=(e=>("string"!=typeof e||u||(u=e).endsWith("/")||(u+="/"),u)),this.resolvePath=(e=>{if("string"!=typeof e)throw x.InvalidArgument("path",this.resolvePath);return e.replace("./",this.root())}),this.loadScripts=(async(...e)=>await Pe(e)),this.onError=(e=>{if(!m)throw e;m.raiseError(e)})};let oe=new ae("default"),le=oe.unload;delete oe.unload;const ce=oe;g("AppDomain",ce,()=>{le()});const ue=(e,t,n)=>{let r=V("obj: flairinstance, memberName: string","obj: flairinstance, memberName: string, attrName: string","obj: flairtype","obj: flairtype, attrName: string")(e,t,n);r.throwOnError(ue);let i=[],a=e[s],o=null,l=null;return r.values.attrName?(l=r.index>1?a.attrs.type.probe(r.values.attrName).current():a.attrs.members.probe(r.values.attrName,r.values.memberName).current())&&i.push(R(l,"name, isCustom, args, type",!0)):(o=r.index>1?a.attrs.type.all().current():a.attrs.members.all(r.values.memberName).current())&&i.push(...R(o,"name, isCustom, args, type",!0)),i};g("getAttr",ue);const fe=e=>{let t=V("Type: flairtype","Type: flairinstance","Type: string")(e);t.throwOnError(fe);let n=null,r="",i="";switch(t.index){case 0:n=e[s].assembly();break;case 1:n=e[s].Type[s].assembly();break;case 2:e.startsWith("[")&&e.endsWith("]")?(i=e.substr(1,e.length-2),n=ce.context.getAssemblyByName(i)):(r=ce.resolve(e))&&(n=ce.context.getAssembly(r));break}return n};g("getAssembly",fe);const pe=e=>{let t;return V("Type: string")(e).throwOnError(pe),ce.resolve(e)};g("getAssemblyOf",pe);const de=e=>{let t;return V("Type: flairtype")(e).throwOnError(de),e[s].context};g("getContext",de);const me=e=>{let t;V("qualifiedName: string")(e).throwOnError(me);let n=ce.context.getResource(e)||null;return n||-1!==e.indexOf(".")||(n=ot.get(e,!1))&&n instanceof te&&n.data||(n=null),n?n.data:null};g("getResource",me);const he=e=>{let t;V("qualifiedName: string")(e).throwOnError(he),ce.context.getRoute(e)};g("getRoute",he);const ye=e=>{let t;V("qualifiedName: string")(e).throwOnError(ye);let n=ce.context.getType(e);return n||-1!==e.indexOf(".")||(n=ot.get(e,!1)),n};g("getType",ye);const ge=e=>{let t;V("obj: flair")(e).throwOnError(ge);let n=e[s];return n&&n.Type||null};g("getTypeOf",ge);const be=e=>{let t;V("obj: flair")(e).throwOnError(be);let n=e[s].Type?e[s].Type[s]:e[s];return n&&n.name||""};g("getTypeName",be);const we=(e,t)=>e?ce.context.namespace(e,t):ce.context.namespace.root();g("ns",we);const ve=(e,t)=>{if("class"!==q(e))throw x.InvalidArgument("Type",ve);if(-1===["string","class"].indexOf(q(t)))throw x.InvalidArgument("Parent",ve);return e[s].isDerivedFrom(t)};g("isDerivedFrom",ve);const xe=e=>{if("class"!==q(e))throw x.InvalidArgument("Type",xe);return e[s].isAbstract()};g("isAbstract",xe);const Oe=e=>{if("class"!==q(e))throw x.InvalidArgument("Type",Oe);return e[s].isSealed()};g("isSealed",Oe);const Ie=e=>{if("class"!==q(e))throw x.InvalidArgument("Type",Ie);return e[s].isStatic()};g("isStatic",Ie);const Ae=e=>{if("class"!==q(e))throw x.InvalidArgument("Type",Ae);return e[s].isSingleton()};g("isSingleton",Ae);const $e=e=>{if("class"!==q(e))throw x.InvalidArgument("Type",$e);return e[s].isDeprecated()};g("isDeprecated",$e);const ke=(e,t)=>{let n=q(e),r=q(t),i=!1;if(-1===u.indexOf(n))throw x.InvalidArgument("obj",ke);if(-1===c.indexOf(r)&&"string"!==r)throw x.InvalidArgument("Type",ke);let a=e[s];switch(r){case"class":(i=a.isInstanceOf(t))||(i=a.Type[s].isDerivedFrom(t));break;case"struct":i=a.isInstanceOf(t);break;case"interface":i=a.isImplements(t);break;case"mixin":i=a.isMixed(t);break;case"string":(i=a.isInstanceOf(t))||"function"!=typeof a.isImplements||(i=a.isImplements(t)),i||"function"!=typeof a.isMixed||(i=a.isMixed(t));break}return i};g("isInstanceOf",ke);const je=(e,t)=>{if(t[s]&&(t=t[s].name||t[s].Type.getName()),"string"!==q(t))throw x.InvalidArgument("type",je);return B(e,t)?e:null};g("as",je);const Ne=(e,t)=>{if(!e)throw x.InvalidArgument("obj",Ne);if("interface"!==q(t))throw x.InvalidArgument("intf",Ne);let n=!0,r=!1;for(let i in t)if(t.hasOwnProperty(i)&&i!==s){if((r=i.endsWith("_"))&&(i=i.substr(0,i.length-1)),!e[i]&&!r){n=!1;break}if("function"==typeof t[i]&&"function"!=typeof e[i]){n=!1;break}}return n};g("isComplies",Ne);const Te=(e,t)=>{if(-1===["class","instance"].indexOf(q(e)))throw x.InvalidArgument("obj",Te);if(-1===["string","interface"].indexOf(q(t)))throw x.InvalidArgument("intf",Te);return e[s].isImplements(t)};g("isImplements",Te);const Ce=(e,t)=>{if(-1===["class","instance"].indexOf(q(e)))throw x.InvalidArgument("obj",Ce);if(-1===["string","mixin"].indexOf(q(t)))throw x.InvalidArgument("mixin",Ce);return e[s].isMixed(t)};g("isMixed",Ce);const Se=[],Pe=(t,n)=>{let r=V("deps: string, fn: afunction","deps: array, fn: afunction")(t,n);r.throwOnError(Pe),0===r.index&&(t=[t]);let i=[],s=t.slice(),o=()=>{n(...i)},l=()=>{if(0!==s.length){let t=s.shift().trim(),n=null,r=e=>{if(t.startsWith("[")&&t.endsWith("]")&&-1===t.indexOf(".")){let e=t.substr(1,t.length-2).trim();"string"==typeof(n=ot.resolve(e,!1))&&(t=n,n=null)}e()},o=e=>{-1===t.indexOf("/")&&((n=ye(t))||(n=me(t))),e()},c=e=>{if(-1===t.indexOf("/")){let r=pe(t);r?ce.context.loadAssembly(r).then(()=>{(n=ye(t))||(n=me(t)),e()}).catch(e=>{throw x.OperationFailed(`Assembly could not be loaded. (${r})`,e,Pe)}):e()}else e()},u=r=>{if(t.startsWith("./")){let i=t.substr(t.lastIndexOf(".")+1).toLowerCase();if(t=ce.resolvePath(t),i)if("js"===i||"mjs"===i)M(t).then(e=>{n=e||!0,r()}).catch(e=>{throw x.OperationFailed(`Module/File could not be loaded. (${t})`,e,Pe)});else if(e)if("json"===i)M(t).then(e=>{n=e||!0,r()}).catch(e=>{throw x.OperationFailed(`Local Module/File could not be loaded. (${t})`,e,Pe)});else{let e=require("fs");try{n=e.readFileSync(t),r()}catch(e){throw x.OperationFailed(`Local File could not be read. (${t})`,e,Pe)}}else D(t).then(e=>{n=e,r()}).catch(e=>{throw x.OperationFailed(`File could not be loaded. (${t})`,e,Pe)});else r()}else r()},f=r=>{t.startsWith("./")?r():(e||(t=`./${a}/${t}`),M(t).then(e=>{n=e||!0,r()}).catch(e=>{throw x.OperationFailed(`Module could not be loaded. (${t})`,e,Pe)}))},p=e=>{i.push(n),e||Se.pop(),l()};if(""===(t=I(t)))return n=!0,void p(!0);if(-1!==Se.indexOf(t))throw x.Circular(t,Pe);Se.push(t),r(()=>{n?p():o(()=>{n?p():c(()=>{n?p():u(()=>{n?p():f(()=>{if(!n)throw x.OperationFailed(`Dependency could not be resolved. (${t})`,Pe);p()})})})})})}else o()};l()};g("bring",Pe,()=>{Se.length=0});const De=(e,t)=>new Promise((n,r)=>{if("string"==typeof e)try{Pe([e],i=>{i?"boolean"!=typeof i||"string"!=typeof t||(i=(!0)[t])?n(i):r(x.OperationFailed(`Dependency object could not be located. (${e})`)):r(x.OperationFailed(`Dependency could not be resolved. (${e})`))})}catch(e){r(e)}else r(x.InvalidArgument("dep"))});g("include",De);const Me=e=>{let t=V("obj: instance","obj: boolean")(e);t.throwOnError(Me),1===t.index&&!0===e?(Xe(),o.forEach(e=>{e()}),o.length=0):"function"==typeof e[s].dispose&&e[s].dispose()};g("dispose",Me);const Fe=(e,t)=>{let n=V("obj: instance, fn: afunction","obj: string, fn: afunction")(e,t);if(n.throwOnError(Fe),1===n.index){let t=ye(e);if(!t)throw x.NotFound(e,Fe);e=new t}let r=null,i=!1,a=!1,o=()=>{i||"function"!=typeof e[s].dispose||(i=!0,e[s].dispose())};try{(r=t(e))&&"function"==typeof r.finally&&(a=!0,r=r.finally(()=>{o()}))}finally{a||o()}return r};g("using",Fe);let ze=!1,Re={};const Ee=(e,...t)=>{if("string"!=typeof e)throw x.InvalidArgument("name");let n=null,r=Ue.inbuilt[e]||null;if(!r){if(!(n=Re[e]||null))throw x.NotFound(e,Ee);r=new We(n.constraints)}if(-1!==k(Ue.bucket,"name",e))throw x.Duplicate(e,Ee);ze?Ue.bucket.unshift({name:e,cfg:r,isCustom:null!==n,attr:n,args:t}):Ue.bucket.push({name:e,cfg:r,isCustom:null!==n,attr:n,args:t})};Ee.register=(e=>{const{IAttribute:t}=we();if(!je(e,t))throw x.InvalidArgument("ca");if(!e.name||!e.constraints)throw x.InvalidArgument("ca");if(Ue.inbuilt[e.name])throw x.Duplicate("ca");if(Re[e.name])throw x.Duplicate("ca");Re[name]=e});const We=function(e,t){return{constraints:e||"",isModifier:t||!1}},Le=(e,...t)=>Ee(e,...t),_e=(e,...t)=>{ze=!0;let n=Ee(e,...t);return ze=!1,n},Ue=Le[s]=Object.freeze({bucket:[],inbuilt:Object.freeze({static:new We("(class && !$abstract) || ((class && (prop || func)) && !($abstract || $virtual || $override))",!0),abstract:new We("(class && !$sealed && !$static) || ((class && (prop || func || event)) && !($override || $sealed || $static))",!0),virtual:new We("class && (prop || func || construct || dispose || event) && !($abstract || $override || $sealed || $static)",!0),override:new We("(class && (prop || func || construct || dispose || event) && ((@virtual || @abstract || @override) && !(virtual || abstract)) && !(@sealed || $static))",!0),sealed:new We("(class || ((class && (prop || func || event)) && override))",!0),private:new We("(class || struct) && (prop || func || event) && !($protected || @private || $static)",!0),protected:new We("(class) && (prop || func || event) && !($private || $static)",!0),readonly:new We("(class || struct) && prop && !abstract",!0),async:new We("(class || struct) && func",!0),privateSet:new We("(class || struct) && prop && !($private || $static)",!0),protectedSet:new We("(class) && prop && !($protected || $private || $static)",!0),overload:new We("((class || struct) && (func || construct) && !($virtual || $abstract || $override || $args))"),enumerate:new We("(class || struct) && prop || func || event"),dispose:new We("class && prop"),post:new We("(class || struct) && event"),on:new We("class && func && !(event || $async || $args || $overload || $inject || $static)"),timer:new We("class && func && !(event || $async || $args || $inject || @timer || $static)"),type:new We("(class || struct) && prop"),args:new We("(class || struct) && (func || construct) && !$on && !$overload"),inject:new We("class && (prop || func || construct) && !(static || session || state)"),resource:new We("class && prop && !(session || state || inject || asset)"),asset:new We("class && prop && !(session || state || inject || resource)"),singleton:new We("(class && !(prop || func || event) && !($abstract || $static))"),serialize:new We("((class || struct) || ((class || struct) && prop)) && !($abstract || $static || noserialize)"),deprecate:new We("!construct && !dispose"),session:new We("(class && prop) && !($static || $state || $readonly || $abstract || $virtual)"),state:new We("(class && prop) && !($static || $session || $readonly || $abstract || $virtual)"),conditional:new We("(class || struct) && (prop || func || event)"),noserialize:new We("(class || struct) && prop"),ns:new We("(class || struct || mixin || interface || enum) && !(prop || func || event || construct || dispose)"),mixin:new We("class && (prop || func || event)"),interface:new We("class && (prop || func || event)")})});Le.collect=(()=>{let e=Ue.bucket.slice();return Le.clear(),e}),Le.has=(e=>{if("string"!=typeof e)throw x.InvalidArgument("name");return-1!==Ue.bucket.findIndex(t=>t.name===e)}),Le.get=(e=>{if("string"!=typeof e)throw x.InvalidArgument("name");let t=Ue.bucket.findIndex(t=>t.name===e);return-1!==t?Ue.bucket[t]:null}),Le.count=(()=>Ue.bucket.length),Le.clear=(()=>{Ue.bucket.length=0}),g("$$",Ee,()=>{Re={}});const qe=(e,t,n,r,i)=>{let a=Le.collect(),o=null,l=null,u=Be(!0,e,t),f=Be(!1,e,t),p="";if(r?(o=t.attrs.type,l=t.modifiers.type,p=`${t.name}`):(o=e.attrs.members[n],l=e.modifiers.members[n],p=`${e.name}::${n}`),!i)for(let e of a)if(e.isCustom)throw x.InvalidOperation(`Custom attribute cannot be applied. (${e.name})`,Ke);const d=i=>{let a=!1,o=c,l=["prop","func","construct","dispose","event"],d=["static","abstract","sealed","virtual","override","private","privateSet","protected","protectedSet","readonly","async"],m=[],h=[],y=i.cfg.constraints;const g=e=>{let t={withWhat:"",matchType:"",original:e,name:"",value:!1};switch(e.substr(0,1)){case"$":t.matchType="anywhere",t.name=e.substr(1);break;case"@":t.matchType="inherited",t.name=e.substr(1);break;default:t.matchType="current",t.name=e;break}e.endsWith("^")?(t.withWhat="typeName",t.name=t.name.replace("^","")):-1!==o.indexOf(t.name)?(t.withWhat="typeType",t.matchType="current"):-1!==l.indexOf(t.name)?(t.withWhat="memberType",t.matchType="current"):d.indexOf(t.name)!==0-1?t.withWhat="modifier":t.withWhat="attribute","struct"===t.name?h.push(t):m.push(t)},b=()=>{let e=new RegExp("[^!&!|()]","g"),t="",n=[],r=0;for(;1&&null!==(t=e.exec(y));)n.push(t);t="",r=0;for(let e of n)r++," "!==e[0]?(t+=e[0],r===n.length&&(""!==t&&g(t),t="")):(""!==t&&g(t),t="");m=m.concat(h)};b();for(let i of m){switch(i.withWhat){case"typeName":switch(i.matchType){case"anywhere":i.value=i.name===t.name||t.Type[s].isDerivedFrom(i.name);break;case"inherited":i.value=t.Type[s].isDerivedFrom(i.name);break;case"current":i.value=i.name===t.name;break}break;case"typeType":i.value=t.type===i.name;break;case"memberType":i.value=!r&&e.members[n]===i.name;break;case"modifier":i.value=r?!!u.type.probe(i.name)[i.matchType]():!!u.members.probe(i.name,n)[i.matchType]();break;case"attribute":i.value=r?!!f.type.probe(i.name)[i.matchType]():!!f.members.probe(i.name,n)[i.matchType]();break}y=C(y,i.original,i.value.toString())}try{if(!(a=new Function("try {return ("+y+");}catch(e){return false;}")()))throw x.InvalidOperation(`${i.cfg.isModifier?"Modifier":"Attribute"} ${i.name} could not be applied. (${p} --\x3e [${y}])`,Ke)}catch(e){throw x.OperationFailed(`${i.cfg.isModifier?"Modifier":"Attribute"} ${i.name} could not be applied. (${p} --\x3e [${y}])`,e,Ke)}return a};for(let n of a)d(n)&&((n=R(n,null,!1,{type:r?t.name:e.name})).isCustom?o.push(n):n.cfg.isModifier?l.push(n):o.push(n))},Be=(e,t,n)=>{let r=e?"modifiers":"attrs",i=(e,i,s,a)=>{let o=null;if(i&&"construct"===i&&(i="_construct"),i&&"dispose"===i&&(i="_dispose"),a)if(s){let t=n.previous();for(;1&&null!==t&&(t[r]&&t[r].type&&(o=j(t[r].type,"name",e)),!o);)t=t.previous()}else n[r]&&n[r].type&&(o=j(n[r].type,"name",e));else if(s){let n=t.previous();for(;1&&null!==n&&(n[r]&&n[r].members[i]&&(o=j(n[r].members[i],"name",e)),!o);)n=n.previous()}else t[r]&&t[r].members[i]&&(o=j(t[r].members[i],"name",e));return o},s=(e,t,n,r)=>null!==i(e,t,n,r);const a=(e,t)=>{let n;return Object.freeze({anywhere:()=>i(e,t,!1,!1)||i(e,t,!0,!1),current:()=>i(e,t,!1,!1),inherited:()=>i(e,t,!0,!1),only:Object.freeze({current:()=>i(e,t,!1,!1)&&!i(e,t,!0,!1),inherited:()=>!i(e,t,!1,!1)&&i(e,t,!0,!1)})})},o=e=>{let t;return Object.freeze({anywhere:()=>i(e,null,!1,!0)||i(e,null,!0,!0),current:()=>i(e,null,!1,!0),inherited:()=>i(e,null,!0,!0),only:Object.freeze({current:()=>i(e,null,!1,!0)&&!i(e,null,!0,!0),inherited:()=>!i(e,null,!1,!0)&&i(e,null,!0,!0)})})},l=e=>{let n=Object.freeze({current:()=>t[r].members[e].slice(),inherited:()=>{let n=[],i=null,s=t.previous();for(;1&&null!==s;)s[r]&&s[r].members&&(i=j(s[r].members,"name",e)),i&&n.push(...i),s=s.previous();return n},anywhere:()=>[...n.current(),...n.inherited()]});return n},c=()=>{let e=Object.freeze({current:()=>n[r].type.slice(),inherited:()=>{let e=[],t=null,i=n.previous();for(;1&&null!==i;)i[r]&&i[r].type&&(t=i[r].type.slice()),t&&e.push(...t),i=i.previous();return e},anywhere:()=>[...e.current(),...e.inherited()]});return e},u={type:Object.freeze({get:(e,t)=>i(e,null,t,!0),has:(e,t)=>s(e,null,t,!0),all:c,probe:o}),members:{get:(e,t,n)=>i(e,t,n,!1),has:(e,t,n)=>s(e,t,n,!1),all:l,probe:a}};return e&&(u.members.is=((e,t)=>{let n=a(e,t);switch(e){case"static":return n.anywhere();case"abstract":return n.anywhere()&&!(a("virtual",t).anywhere()||a("override",t).anywhere());case"virtual":return n.anywhere()&&!a("override",t).anywhere();case"override":return n.anywhere()&&!a("sealed",t).anywhere();case"sealed":return n.anywhere();case"private":return n.anywhere();case"protected":return n.anywhere();case"readonly":return n.anywhere();case"async":return n.anywhere()}}),u.members.type=(e=>{let n,r="";if(!("type"===t.level)){let n=t;for(;1&&null!==n&&(n.members[e]&&(r=n.members[e]),!r);)n=n.previous()}return r}),u.members.isProperty=(e=>"prop"===u.members.type(e)),u.members.isFunction=(e=>"func"===u.members.type(e)),u.members.isEvent=(e=>"event"===u.members.type(e))),u.members=Object.freeze(u.members),Object.freeze(u)},Ge=e=>{let t={getType:function(){let e;return this.instance.def.Type}},n={id:O()};e.ex.instance=P(e.ex.instance,t,!1),e.mex.instance=P(e.mex.instance,n,!1);let r={getName:function(e){let t=this.type.def;return e?t.flatname:t.name},getType:function(){let e;return this.type.def.type},getAssembly:function(){let e,t,n;return this.type.Type[this.type.meta].assembly()},getNamespace:function(){let e,t,n;return this.type.Type[this.type.meta].namespace}},i={id:O()};e.ex.type=P(e.ex.type,r,!1),e.mex.type=P(e.mex.type,i,!1)},Ve=(e,t,n,r,i,s,a)=>{let o={type:{Type:t,def:r,attrs:i,modifiers:s,meta:a}};for(let t in e)e.hasOwnProperty(t)&&("function"==typeof e[t]?Object.defineProperty(n,t,{configurable:!0,enumerable:!1,value:e[t].bind(o)}):Object.defineProperty(n,t,{configurable:!0,enumerable:!1,value:e[t]}))},Ze=(e,t,n,r,i,s,a,o,l,c,u)=>{let f={instance:{obj:t,def:i,attrs:a,modifiers:o,meta:u},type:{Type:r,typeDef:s,attrs:l,modifiers:c,meta:u}};for(let t in e)"function"==typeof e[t]?Object.defineProperty(n,t,{configurable:!0,enumerable:!1,value:e[t].bind(f)}):Object.defineProperty(n,t,{configurable:!0,enumerable:!1,value:e[t]})},Je=(e,t,n,r,i,...a)=>{let o=t[s],c=null,u=o.def(),f="___flag___",p={_flagName:f};if(void 0!==r&&r===f?(p.isNeedProtected=!0,p.isTopLevelInstance=!1,p.staticInterface=e.static?i:null,p.args=a):(p.isNeedProtected=!1,p.isTopLevelInstance=!0,p.staticInterface=e.static?t:null,p.args=void 0!==r?void 0!==i?[r,i].concat(a):[r]:[]),c=p.staticInterface||t,e.singleton&&!u.staticConstructionCycle&&!Rt&&p.isTopLevelInstance&&o.singleInstance.value)return o.singleInstance.value;let d={},m=!1,h="parentObjs",y=null,g=null,w=null,v="_construct",O="_dispose",I={},k={},j=null,T={name:e.params.typeName,flatname:C(e.params.typeName,".","_"),type:e.types.type,Type:t,level:"object",members:{},scope:{},attrs:{members:{}},modifiers:{members:{}},previous:()=>j,constructing:e=>{if("boolean"!=typeof e)return m;{m=e;let t=T.previous();for(;1&&null!==t;)t.constructing(e),t=t.previous()}}},S=null,D=!1,M=null,F=e.storage?H("sessionStorage"):null,z=e.storage?H("localStorage"):null;const R=(e,t,n,r)=>{for(let i of oe.members.all(t).current())if(i.isCustom){if("prop"===n){let n=i.attr.decorateProperty(T.name,t,r,...i.args);if(!n.get||!n.set)throw x.OperationFailed(`${i.name} decoration result is unexpected. (${T.name}::${t})`,Ke);n.get=n.get.bind(e),n.set=n.set.bind(e),r=n}else{let s=null;if("func"===n){if(s=i.attr.decorateFunction(T.name,t,r,...i.args),$(r)!==$(s))throw x.OperationFailed(`${i.name} decoration result is unexpected. (${T.name}::${t})`,Ke)}else s=i.attr.decorateEvent(T.name,t,r,...i.args);if(!s)throw x.OperationFailed(`${i.name} decoration result is unexpected. (${T.name}::${t})`,Ke);r=s.bind(e)}i.attr=null}return r},E=(e,t,n)=>{let r=null,i=[];return i=wt(T.name,e,t=>ae.members.probe(t,e).anywhere()),T.aspects.members[e]=i,i.length>0&&(r=vt(T.name,e,i,t,n))&&(t=r),t},W=(e,t)=>{let r=null,i=T.members[e]||"",a=T.scope[e]||"";const o=(e,n)=>(t&&"prop"!==e&&(n=null),n);if(e!==s)switch(a){case"private":r=o(i,n);break;case"protected":for(let t of n[h])if(void 0!==t[e]){r=t;break}r||(r=n),r=o(i,r);break;case"public":r=o(i,t?d:r="event"===i&&void 0!==n[e]?n:d);break;default:if(t){if(void 0!==d[e]){r=d;break}if(void 0===n[e])throw x.NotDefined(e,Ke);r=n,r=o(ae.members.type(e),r)}else if("function"==typeof n[e]&&void 0!==d[e]&&"function"==typeof d[e].add&&"function"==typeof d[e].remove)r=n;else if(void 0!==d[e])r=d;else{if(void 0===n[e])throw x.NotDefined(e,Ke);r=n}}else r=n;return r},L=()=>{let r=!1,i=e=>{Object.defineProperty(d,e,Object.getOwnPropertyDescriptor(n,e))},a=Object.getOwnPropertyDescriptor(n,s);a.enumerable=!1,Object.defineProperty(d,s,a),g=d[s];for(let e in n)if(r=!1,n.hasOwnProperty(e)&&e!==s&&e!==h){if(r=!0,T.members[e]?(ae.members.probe("private",e).current()&&(r=!1),r&&ae.members.probe("protected",e).current()&&!p.isNeedProtected&&(r=!1)):ae.members.probe("protected",e).anywhere()&&!p.isNeedProtected&&(r=!1),r&&i(e),r&&ae.members.isProperty(e))if(ae.members.probe("privateSet",e).current()){let t=Object.getOwnPropertyDescriptor(d,e);t.set=b,Object.defineProperty(d,e,t)}else if(ae.members.probe("protectedSet",e).current()&&!p.isNeedProtected){let t=Object.getOwnPropertyDescriptor(d,e);t.set=b,Object.defineProperty(d,e,t)}if(r&&ae.members.is("abstract",e)){if(!p.isNeedProtected)throw x.NotImplemented(`Abstract member is not implemented. (${T.name}::${e})`,Ke);if(!ae.type.probe("abstract").current())throw x.InvalidDefinition(`Abstract member can exists only in abstract type. (${T.name}::${e})`,Ke)}if(r){let t=oe.members.probe("enumerate",e).current();if(t&&!1===t.args[0]){let t=Object.getOwnPropertyDescriptor(d,e);t.enumerable=!1,Object.defineProperty(d,e,t)}}if(r&&!p.isNeedProtected&&ae.members.isEvent(e)){let t=Object.getOwnPropertyDescriptor(d,e);t.enumerable=!1,t.value=d[e].strip(),Object.defineProperty(d,e,t)}}p.isTopLevelInstance&&(Ze(e.ex.instance,d,d,t,T,u,oe,ae,o.attrs,o.modifiers,s),Ze(e.mex.instance,d,g,t,T,u,oe,ae,o.attrs,o.modifiers,s)),p.isTopLevelInstance||(g.def=T),void 0===n[h]&&(n[h]=[]),n[h].unshift(n),p.isTopLevelInstance||(d[h]=n[h])},_=(t,n)=>{let r=t.endsWith("_"),i=t;if(r&&(i=t.substr(0,t.length-1)),-1===Object.keys(d).indexOf(i)||ae.members.type(t)!==n[s].modifiers.members.type(t))if("dispose"!==t||"function"!=typeof d[O]&&"function"!=typeof g.dispose){if(!r)throw x.NotImplemented(`Interface member is not implemented. (${n[s].name+":"+t})`,Ke)}else;Le("interface",n[s].name),qe(T,u,t,!1,e.customAttrs)},U=()=>{if(T.interfaces){for(let e of T.interfaces)for(let t in e)e.hasOwnProperty(t)&&_(t,e);delete T.interfaces}},G=(t,n,r)=>{switch(-1!==["func","prop","event"].indexOf(n)&&t.startsWith("_")&&new x("InvalidName",`Name is not valid. (${T.name}::${t})`),n){case"func":if(!e.func)throw x.InvalidOperation(`Function cannot be defined on this type. (${T.name})`,Ke);break;case"prop":if(!e.prop)throw x.InvalidOperation(`Property cannot be defined on this type. (${T.name})`,Ke);break;case"event":if(!e.event)throw x.InvalidOperation(`Event cannot be defined on this type. (${T.name})`,Ke);break;case"construct":if(!e.construct)throw x.InvalidOperation(`Constructor cannot be defined on this type. (${T.name})`,Ke);n="func";break;case"dispose":if(!e.dispose)throw x.InvalidOperation(`Dispose cannot be defined on this type. (${T.name})`,Ke);n="func";break}return n},Z=(t,r,i,s)=>{let a=!0,c=oe.members.probe("conditional",r).current();if(c){let e=N(c.args[0]||[]);for(let t of e){if("server"!==(t=t.toLowerCase())||!l.env.isServer){a=!1;break}if("client"!==t||!l.env.isClient){a=!1;break}if("worker"!==t||!l.env.isWorker){a=!1;break}if("main"!==t||!l.env.isMain){a=!1;break}if("local"!==t||!l.env.isLocal){a=!1;break}if("stage"!==t||!l.env.isStage){a=!1;break}if("prod"!==t||!l.env.isProd){a=!1;break}if("dev"!==t||!l.env.isDev){a=!1;break}if("debug"!==t||!l.env.isDebug){a=!1;break}if("test"!==t||!l.env.isTest){a=!1;break}if("cordova"!==t||!l.env.isCordova){a=!1;break}if("nodewebkit"!==t||!l.env.isNodeWebkit){a=!1;break}if(-1===l.symbols.indexOf(t)){a=!1;break}}if(!a)return a}if(e.inheritance&&ae.members.probe("abstract",r).current()&&!0!==s.ni)throw x.InvalidDefinition(`Abstract member must not be implemented. (${T.name}::${r})`,Ke);if((c=ae.type.probe("static").current())&&e.static)if(o.isStatic()){if(e.construct&&r===v&&0!==s.length)throw x.InvalidDefinition(`Static constructors cannot have arguments. (${T.name}::construct)`,Ke);if(e.dispose&&r===O)throw x.InvalidDefinition(`Static types cannot have destructors. (${T.name}::dispose)`,Ke)}else{if(e.construct&&r===v)throw x.InvalidDefinition(`Non-static types cannot have static constructors. (${T.name}::construct)`,Ke);if(e.dispose&&r===O)throw x.InvalidDefinition(`Static destructors cannot be defined. (${T.name}::dispose)`,Ke)}if(e.dispose&&r===O&&0!==s.length&&(s.length>1||1===s.length&&!ae.members.probe("override",r).current()))throw x.InvalidDefinition(`Destructor method cannot have arguments. (${T.name}::dispose)`,Ke);if(-1!==Object.keys(n).indexOf(r)&&(!e.inheritance||e.inheritance&&!ae.members.probe("override",r).current())){if("prop"!==i||0!==T.attrs.members[r].length||0!==T.modifiers.members[r].length||s&&(!s||s.get||s.set))throw x.Duplicate(T.name+"::"+r,Ke);return t[r]=s,!1}if(e.inheritance&&ae.members.probe("override",r).current()){if(-1===Object.keys(n).indexOf(r))throw x.InvalidDefinition(`Member not found to override. (${T.name}::${r})`,Ke);if(ae.members.type(r)!==i)throw x.InvalidDefinition(`Overriding member type is invalid. (${T.name}::${r})`,Ke)}if(e.static&&(ae.members.probe("static",r).current()||o.isStatic()))if("func"===i){if(A(s))throw x.InvalidDefinition(`Static functions cannot be defined as an arrow function. (${T.name}::${r})`,Ke)}else if("prop"===i){if(s&&s.get&&"function"==typeof s.get&&A(s))throw x.InvalidDefinition(`Static property getters cannot be defined as an arrow function. (${T.name}::${r})`,Ke);if(s&&s.set&&"function"==typeof s.set&&A(s))throw x.InvalidDefinition(`Static property setters cannot be defined as an arrow function. (${T.name}::${r})`,Ke)}if(e.storage&&oe.members.probe("session",r).current()&&s&&s.get&&"function"==typeof s.get)throw x.InvalidDefinition(`Session properties cannot be defined with a custom getter/setter. (${T.name}::${r})`,Ke);if(e.storage&&oe.members.probe("state",r).current()){if(s&&s.get&&"function"==typeof s.get)throw x.InvalidDefinition(`State properties cannot be defined with a custom getter/setter. (${T.name}::${r})`,Ke);if(!z)throw x.InvalidOperation("Port is not configured. (localStorage)",Ke)}return a},Y=(t,r,i)=>{let a={get:null,set:null},o=b,l=b,f=ae.members.probe("readonly",t).anywhere(),d=ae.members.probe("static",t).anywhere(),m=oe.members.probe("session",t).anywhere(),h=oe.members.probe("state",t).anywhere(),y=oe.members.probe("deprecate",t).current(),g=oe.members.probe("inject",t).current(),w=oe.members.probe("asset",t).current(),v=oe.members.probe("resource",t).current(),O=oe.members.probe("type",t).current(),A=null!==y,$=A?y.args[0]||`Event is marked as deprecate. (${T.name}::${t})`:"",k=I,j=n,N=e.storage&&(m||h),C=T.flatname+"_"+t,S=null;if(i&&(i.get||i.set)){if(!e.propGetterSetter)throw x.InvalidDefinition(`Getter/Setter are not allowed. (${T.name}::${t})`,Ke);i.get&&"function"==typeof i.get&&(o=i.get),i.set&&"function"==typeof i.set&&(l=i.set),e.static&&d&&(j=p.staticInterface),a.get=function(){return A&&console.log($),o.apply(j)}.bind(j),a.set=function(e){if(A&&console.log($),f&&!(u.staticConstructionCycle?u.constructing():T.constructing()))throw x.InvalidOperation(`Property is readonly. (${T.name}::${t})`,Ke);if(O&&O.args[0]&&!B(e,O.args[0]))throw x.InvalidArgument("value",Ke);return l.apply(j,[e])}.bind(j)}else{if(e.static&&d){if(k=p.staticInterface[s].props,j=p.staticInterface,O&&O.args[0]&&!B(i,O.args[0]))throw x.InvalidArgument("value",Ke);k[C]=i}else if(e.storage&&(m||h)){if(m?(k=F,C=n[s].id+"_"+C):k=z,se(m?"session":"state",C),!k.getItem(C)){if(O&&O.args[0]&&!B(i,O.args[0]))throw x.InvalidArgument("value",Ke);k.setItem(C,JSON.stringify({value:i}))}}else{if(O&&O.args[0]&&!B(i,O.args[0]))throw x.InvalidArgument("value",Ke);if(e.numOnlyProps&&"number"!=typeof i)throw x.InvalidArgument("value",Ke);k[C]=i}a.get=function(){if(A&&console.log($),N){let e=k.getItem(C);return e?JSON.parse(e).value:null}return k[C]}.bind(j),a.set=function(e){if(A&&console.log($),f&&!(u.staticConstructionCycle?u.constructing():T.constructing()))throw x.InvalidOperation(`Property is readonly. (${T.name}::${t})`,Ke);if(O&&O.args[0]&&!B(e,O.args[0]))throw x.InvalidArgument("value",Ke);if(N){let t={value:e};k.setItem(C,JSON.stringify(t))}else k[C]=e}.bind(j)}if(g&&!d&&!N){let e=g.args[0],t=g.args.length>0?g.args[1]:[],n=g.args.length>1&&g.args[2],r=null;try{switch(q(e)){case"class":case"struct":r=t;break;case"string":if(r=ye(e)){if(-1===["class","struct"].indexOf(q(r)))throw x.InvalidArgument("inject",Ke)}else S=ot.resolve(e,t,n),Array.isArray(S)||(S=[S]);break;default:throw x.InvalidArgument("inject",Ke)}!S&&r&&(S=[],t.length>0?S.push(new r(...t)):S.push(new r))}catch(e){throw new x(e,Ke)}a.set(S)}if((oe.members.probe("dispose",t).anywhere()||g)&&se("prop",t),(v||w)&&!N){let e=null;if(v)v.args[0]&&(e=me(v.args[0]));else if(w.args[0]){let t=w.args[0];e=c.getAssembly().getAsset(t)}e&&a.set(e)}return e.customAttrs&&(a=R(j,t,r,a)),a},Q=(t,r,i)=>{if("func"===r){let r=Le.get("overload");if(r){let s,a=e.static&&ae.members.probe("static",t).current()?p.staticInterface:n;if(ee(t,i,r),a[t]){if(Le.count()>1)throw x.InvalidDefinition(`Overloaded function cannot define additional modifiers or attributes. (${T.name}::${t})`,Ke);return Le.collect(),!0}}}return!1},ee=(t,r,i)=>{let a=e.static&&ae.members.probe("static",t).current(),o=a?p.staticInterface:n,l,c,u;(a?o[s].overloads:k)[t+"_"+N(i.args[0]).join("_")]=r},te=(t,...r)=>{let i=e.static&&ae.members.probe("static",t).current(),a=i?p.staticInterface:n,o=i?a[s].overloads:k,l="",c="";for(let e of r)l+="_"+typeof e;return l.startsWith("_")&&(l=l.substr(1)),o[c=t+"_"+l]||null},ne=(t,r,i)=>{let s=null,a=n,o=e.inheritance&&ae.members.probe("override",t).current(),l=e.static&&ae.members.probe("static",t).current(),c=ae.members.probe("async",t).current(),f=oe.members.probe("deprecate",t).current(),d=oe.members.probe("inject",t).current(),m=oe.members.probe("on",t).current(),h=oe.members.probe("timer",t).current(),y=oe.members.probe("args",t).current(),g=oe.members.probe("overload",t).current(),w=null!==f,v=w?f.args[0]||`Function is marked as deprecate. (${T.name}::${t})`:"",x=null,O=[];if(o?!0!==(x=n[t].bind(a)).ni&&x!==b||(x=null):l&&(a=p.staticInterface),d){let e=d.args[0],t=d.args.length>0?d.args[1]:[],n=d.args.length>1&&d.args[2];O=ot.resolve(e,t,n),Array.isArray(O)||(O=[O])}if(s=(c=c||$(i))?async function(...e){w&&console.log(v);let n=[];x&&n.push(x);let r=K.extract(e);if(r&&n.push(...r),O.length>0&&n.push(O),y&&y.args.length>0){let t=V(...y.args)(...e);t.throwOnError(Ke),n.push(t)}let s=K.filter(e);s&&n.push(...s),g&&(i=te(t,...s));let o=i.apply(a,n);return o&&"function"==typeof o.then?await o:o}.bind(a):function(...e){w&&console.log(v);let n=[];if(x&&n.push(x),O.length>0&&n.push(O),y&&y.args.length>0){let t=V(...y.args)(...e);t.throwOnError(Ke),n.push(t)}return n=n.concat(e),g&&(i=te(t,...e)),i.apply(a,n)}.bind(a),e.customAttrs&&(s=R(a,t,r,s)),e.aop&&(s=E(t,s,c)),m&&m.args.length>0&&(it(m.args[0],s),se("handler",{name:m.args[0],handler:s})),h&&h.args.length>0){let e=!1,r=setInterval(()=>{(u.staticConstructionCycle?u.constructing():T.constructing())||e||(e=!0,n[t](),e=!1)},1e3*h.args[0]);se("timer",r)}return s},re=(t,r,i)=>{let a=null,o=null,l=null,c=null,u=e.inheritance&&ae.members.probe("override",t).current(),f=oe.members.probe("deprecate",t).current(),p=oe.members.probe("post",t).current(),d=null!==f,m=d?f.args[0]||`Event is marked as deprecate. (${T.name}::${t})`:"",h=n;return M||(M=new X(T.name),se("event",M)),u&&!0===(l=n[t][s].processor).ni&&(l=null),a=function(...e){return d&&console.log(m),c=l?[l].concat(e):e,i.apply(h,c)}.bind(h),e.customAttrs&&(a=R(h,t,r,a)),o=a,(a=function(...e){let n=e;"function"==typeof o&&(n=o(...e)),M.dispatch(t,n),p&&p.args.length>0&&st(p.args[0],n)}.bind(h))[s]=Object.freeze({processor:o}),a.add=(e=>{M.add(t,e)}),a.remove=(e=>{M.remove(t,e)}),a.strip=(()=>{let e=P({},a,!0,["strip"]);return delete a.strip,Object.freeze(e)}),a},ie=(t,r,i)=>{if(r=G(t,r,i),Q(t,r,i))return;T.members[t]=r,T.attrs.members[t]=[],T.modifiers.members[t]=[],e.aop&&(T.aspects={members:{}}),e.mixins&&null!==w&&Le("mixin",w[s].name),"func"===r&&$(i)&&!Le.has("async")&&_e("async"),qe(T,u,t,!1,e.customAttrs);let a=null,o=e.static&&ae.members.probe("static",t).current(),l=o?p.staticInterface:n;if(o){if(!u.staticConstructionCycle)return}else if(u.staticConstructionCycle)return;if(Z(l,t,r,i)){switch(r){case"func":a=ne(t,r,i),Object.defineProperty(l,t,{configurable:!0,enumerable:!0,value:a});break;case"prop":a=Y(t,r,i),Object.defineProperty(l,t,{configurable:!0,enumerable:!0,get:a.get,set:a.set});break;case"event":a=re(t,r,i),Object.defineProperty(l,t,{configurable:!0,enumerable:!0,value:a});break}ae.members.probe("private",t).current()?T.scope[t]="private":ae.members.probe("protected",t).current()?T.scope[t]="protected":T.scope[t]="public"}},se=(e,t)=>{y.disposables.push({type:e,data:t})},ae=Be(!0,T,u),oe=Be(!1,T,u);if(e.inheritance){if(p.isTopLevelInstance&&!u.staticConstructionCycle&&!Rt&&ae.type.probe("abstract").current())throw x.InvalidOperation(`Cannot create instance of an abstract type. (${T.name})`,Ke);let e=o.inherits,t=null;if(e){if((t=e[s]).isSealed()||t.isSingleton()||t.isStatic())throw x.InvalidDefinition(`Cannot inherit from a sealed, static or singleton type. (${t.name})`,Ke);if(t.type!==o.type)throw x.InvalidDefinition(`Cannot inherit from another type family. (${t.type})`,Ke);if(t.context&&t.context.isUnloaded())throw x.InvalidOperation(`Parent context is not active anymore. (${t.name})`,Ke);n=new e(p._flagName,p.staticInterface,p.args),y=n[s],j=y.def,delete y.def}else if(o.context&&o.context.isUnloaded())throw x.InvalidOperation(`Type context is not active anymore. (${o.name})`,Ke)}if(void 0===n[s]&&(n[s]={},y=n[s],e.dispose&&(y.disposables=[])),e.mixins&&(T.mixins=e.params.mixins),e.interfaces&&(T.interfaces=e.params.interfaces),y.type=e.types.instance,p.isTopLevelInstance&&(y.Type=t,e.new&&(y.isInstanceOf=(e=>{if(e[s]&&(e=e[s].name),!e)throw x.InvalidArgument("name",Ke);return o.name===e||o.isDerivedFrom(e)})),e.mixins&&(y.isMixed=(e=>o.isMixed(e))),e.interfaces&&(y.isImplements=(e=>o.isImplements(e))),y.modifiers=ae,y.attrs=oe,Rt&&(y.def=T,y.typeDef=u,y.obj=n)),S=new Proxy({},{get:(t,n)=>{if(e.new&&n!==s&&"$"===n.substr(0,1)){if("$Type"===n)return c;if("$static"===n)return T.Type}let r;return"construct"===n?n=v:"dispose"===n&&(n=O),W(n)[n]},set:(t,n,r)=>{if(e.new&&n!==s&&"$"===n.substr(0,1))throw x.InvalidOperation(`Special members cannot be custom defined. (${n})`,Ke);if(D){let e="";"construct"===n?(e="construct",n=v):"dispose"===n?(e="dispose",n=O):"function"==typeof r?!0===r.event?(r!==J&&delete r.event,e="event"):e="func":e="prop",ie(n,e,r)}else{let e=W(n,!0);if(!e)throw x.InvalidOperation(`Redefinition of members is not allowed. (${n})`,Ke);e[n]=r}return!0}}),D=!0,e.mixins&&T.mixins&&!u.staticConstructionCycle){for(let e of T.mixins)w=e,e.apply(S),w=null;delete T.mixins}if(e.params.factory.apply(S),Le.clear(),D=!1,p.isTopLevelInstance){if(e.construct&&"function"==typeof n[v]){let e=n[v];delete n[v],y.construct=((...t)=>{T.constructing(!0);try{e(...t)}finally{T.constructing(!1)}})}if(e.dispose&&"function"==typeof n[O]){let e=n[O];delete n[O],y.dispose=(()=>{for(let e of y.disposables)switch(e.type){case"session":F.removeItem(e.data);break;case"state":z.removeItem(e.data);break;case"prop":n[e.data]=null;break;case"event":e.data.clear();break;case"handler":it(e.data.name,e.data.handler,!0);break;case"timer":clearInterval(e.data);break}"function"==typeof e&&e(),y.disposables.length=0,I=null,j=null,T=null,S=null,M=null,d=null,n=null})}}if(e.static&&o.isStatic()&&u.staticConstructionCycle&&t.construct&&"function"==typeof t[v]){let e=t[v];delete t[v],o.construct=((...t)=>{u.constructing(!0);try{e(...t)}finally{u.constructing(!1)}})}return L(),!e.interfaces||u.staticConstructionCycle||Rt||U(),e.construct&&p.isTopLevelInstance&&!u.staticConstructionCycle&&!Rt&&"function"==typeof g.construct&&g.construct(...p.args),e.construct&&u.staticConstructionCycle&&"function"==typeof o.construct&&o.construct(),!p.isTopLevelInstance||u.staticConstructionCycle||Rt||e.singleton&&oe.type.probe("singleton").current()&&(o.singleInstance.value=d),!p.isTopLevelInstance||u.staticConstructionCycle||Rt||(g=Object.freeze(g),d=Object.seal(d)),d},Xe=()=>{let t=H("sessionStorage");t?t.clear():e?(!0).sessionStorage&&delete global.sessionStorage:sessionStorage.clear()},Ke=e=>{if(e.new=e.new||!1,e.mixins=e.mixins||!1,e.interfaces=e.interfaces||!1,e.inheritance=e.inheritance||!1,e.singleton=e.singleton||!1,e.static=e.static||!1,e.const=e.const||!1,e.func=e.func||!1,e.construct=e.construct||!1,e.dispose=e.dispose||!1,e.prop=e.prop||!1,e.propGetterSetter=e.propGetterSetter||!1,e.numOnlyProps=e.numOnlyProps||!1,e.event=e.event||!1,e.storage=e.storage||!1,e.aop=e.aop||!1,e.customAttrs=e.customAttrs||!1,e.types=e.types||{},e.types.instance=e.types.instance||"unknown",e.types.type=e.types.type||"unknown",e.params=e.params||{},e.params.typeName=e.params.typeName||"",e.params.inherits=e.params.inherits||null,e.params.mixinsAndInterfaces=e.params.mixinsAndInterfaces||null,e.params.factory=e.params.factory||null,e.mex=e.mex||{},e.mex.instance=e.mex&&e.mex.instance?e.mex.instance:{},e.mex.type=e.mex&&e.mex.type?e.mex.type:{},e.ex=e.ex||{},e.ex.instance=e.ex&&e.ex.instance?e.ex.instance:{},e.ex.type=e.ex&&e.ex.type?e.ex.type:{},e.params.ns="",e.params.mixins=[],e.params.interfaces=[],e.func||(e.construct=!1,e.dispose=!1),e.prop||(e.storage=!1),e.inheritance||(e.singleton=!1),e.func||e.prop||e.event||(e.aop=!1),e.new&&(e.const=!1),!e.params.typeName||-1!==e.params.typeName.indexOf("."))throw x.InvalidDefinition(`Type name is invalid. (${e.params.typeName})`,Ke);let t=Le.get("ns"),n=t?t.args[0]:"";if(n)switch(n){case"":throw x.InvalidDefinition(`Empty namespace should be used only when bundling the type in an assembly. (${n})`,Ke);case"(root)":break;default:if(n.startsWith(".")||n.endsWith(".")||/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g.test(n))throw`Namespace name is invalid. (${n})`;e.params.typeName=n+"."+e.params.typeName,e.params.ns=n;break}if(e.params.mixinsAndInterfaces)for(let t of e.params.mixinsAndInterfaces)if(t[s])switch(t[s].type){case"mixin":e.params.mixins.push(t);break;case"interface":e.params.interfaces.push(t);break}delete e.params.mixinsAndInterfaces,Ge(e);let r=ce.context.current(),i=null,a=null,o=!1;if(e.new)if(e.inheritance){if(e.params.inherits){if(Le.has("static"))throw x.InvalidDefinition(`Static class cannot inherit from a type. (${e.params.typeName})`,Ke);if(Ie(e.params.inherits)||Ae(e.params.inherits)||Oe(e.params.inherits))throw x.InvalidDefinition(`Cannot inherit from a sealed, static or singleton type. (${e.params.inherits[s].name})`,Ke)}i=function(t,n,...r){return Je(e,i,{},t,n,...r)}}else i=function(...t){return Je(e,i,{},null,null,...t)};else i=e.const?function(){return Je(e,i,{})}:function(...t){if(new.target)throw x.InvalidOperation(`Construction cannot be done for this type. (${e.params.typeName})`,i);e.params.factory.apply(this,...t)};let l={name:e.params.typeName,flatname:C(e.params.typeName,".","_"),type:e.types.type,Type:i,level:"type",attrs:{type:[]},modifiers:{type:[]},previous:()=>i[s].inherits?i[s].inherits[s].def():null,constructing:e=>{if("boolean"!=typeof e)return o;{o=e;let t=l.previous();for(;1&&null!==t;)t.constructing(e),t=t.previous()}}};const c=Be(!0,null,l),u=Be(!1,null,l);if(i[s]={},(a=i[s]).name=e.params.typeName,a.type=e.types.type,a.namespace=null,a.assembly=(()=>{let t=pe(e.params.typeName);return r.getAssembly(t)||null}),a.context=r,e.inheritance&&(a.inherits=e.params.inherits||null,a.isAbstract=(()=>!!c.type.probe("abstract").current()),a.isSealed=(()=>!!c.type.probe("sealed").current()),a.isDerivedFrom=(t=>{if(t[s]&&(t=t[s].name),"string"!=typeof t)throw x.InvalidArgument("name",a.isDerivedFrom);let n=!1,r=e.params.inherits;if(!n)for(;1&&null!==r;){if(r[s].name===t){n=!0;break}r=r[s].inherits}return n}),a.inherits)){let e=u.type.probe("deprecate").anywhere();if(e){let t=e.args[0]||`Type is marked as deprecated. (${a.name})`;console.log(t)}}if(e.static&&(a.isStatic=(()=>!!c.type.probe("static").current()),a.props={},a.overloads={}),e.singleton&&(a.isSingleton=(()=>!!u.type.probe("singleton").current()),a.singleInstance={value:null}),e.mixins&&(a.mixins=e.params.mixins,a.isMixed=(e=>{if(e[s]&&(e=e[s].name),"string"!=typeof e)throw x.InvalidArgument("name",a.isMixed);let t=!1,n=i;for(;1&&null!==n&&(n[s].mixins&&(t=-1!==j(n[s].mixins,"name",e)),!t);)n=n[s].inherits;return t})),e.interfaces&&(a.interfaces=e.params.interfaces,a.isImplements=(e=>{if(e[s]&&(e=e[s].name),"string"!=typeof e)throw x.InvalidArgument("name",a.isImplements);let t=!1,n=i;for(;1&&null!==n&&(n[s].interfaces&&(t=-1!==j(n[s].interfaces,"name",e)),!t);)n=n[s].inherits;return t})),a.isDeprecated=(()=>!!u.type.probe("deprecate").current()),a.def=(()=>l),a.modifiers=c,a.attrs=u,qe(null,l,null,!0,e.customAttrs),e.static&&c.type.probe("static").current()){if(e.params.interfaces.length>0)throw x.InvalidDefinition("Static types cannot implement interfaces.",Ke);if(e.params.mixins.length>0)throw x.InvalidDefinition("Static types cannot implement mixins.",Ke)}if(e.static){let t=e.params.factory?e.params.factory.toString():"";if(a.isStatic()||-1!==t.indexOf(`$$('static')`)||-1!==t.indexOf(`$$("static")`)){l.staticConstructionCycle=!0;let e=new i;Me(e),delete l.staticConstructionCycle}}Ve(e.ex.type,i,i,l,u,c,s),Ve(e.mex.type,i,a,l,u,c,s);let f=null,p=!1;return e.static&&a.isStatic()||e.const?(f=new i,e.const&&(p=!0)):(p=!0,f=i),n&&(a.namespace=ce.context.current().registerType(f)),i[s]=Object.freeze(a),p&&Object.freeze(f),f},Ye=(e,t,n,r)=>{let i=V("name: string, inherits: class, factory: cfunction","name: string, inherits: class, mixints: array, factory: cfunction","name: string, factory: cfunction","name: string, mixints: array, factory: cfunction")(e,t,n,r);i.throwOnError(Ye);let s={new:!0,mixins:!0,interfaces:!0,inheritance:!0,singleton:!0,static:!0,func:!0,construct:!0,dispose:!0,prop:!0,propGetterSetter:!0,event:!0,storage:!0,aop:!0,customAttrs:!0,types:{instance:"instance",type:"class"},params:{typeName:i.values.name,inherits:i.values.inherits,mixinsAndInterfaces:i.values.mixints,factory:i.values.factory},mex:{instance:{},type:{}},ex:{instance:{},type:{}}};return Ke(s)};g("Class",Ye);const He=(e,t)=>{let n=V("name: string, factory: cfunction")(e,t);n.throwOnError(He);let r={const:!0,func:!0,dispose:!0,prop:!0,propGetterSetter:!0,event:!0,types:{instance:"interface",type:"interface"},params:{typeName:n.values.name,factory:n.values.factory}};return Ke(r)};g("Interface",He);const Qe=(e,t)=>{let n=V("name: string, factory: cfunction")(e,t);n.throwOnError(Qe);let r={new:!0,func:!0,construct:!0,prop:!0,propGetterSetter:!0,types:{instance:"sinstance",type:"struct"},params:{typeName:n.values.name,factory:n.values.factory}};return Ke(r)};g("Struct",Qe);const et=(e,t)=>{let n=V("name: string, factory: cfunction")(e,t);n.throwOnError(et);let r={const:!0,prop:!0,numOnlyProps:!0,types:{instance:"enum",type:"enum"},params:{typeName:n.values.name,factory:n.values.factory},mex:{instance:{getName:function(e){let t=this.instance.obj,n=this.instance.def,r="";for(let i in n.members)if(n.members.hasOwnProperty(i)&&"prop"===n.members[i]&&t[i]===e){r=i;break}return r},getNames:function(){let e=this.instance.def,t=[];for(let n in e.members)e.members.hasOwnProperty(n)&&"prop"===e.members[n]&&t.push(n);return t},getValues:function(){let e=this.instance.def,t=this.instance.obj,n=[];for(let r in e.members)e.members.hasOwnProperty(r)&&"prop"===e.members[r]&&n.push(t[r]);return n}}}};return Ke(r)};et.getName=((e,t)=>{let n;return V("enumType: enum, enumValue: number")(e,t).throwOnError(et.getName),e[s].getName(t)}),et.getNames=(e=>{let t;return V("enumType: enum")(e).throwOnError(et.getNames),e[s].getNames()}),et.getValues=(e=>{let t;return V("enumType: enum")(e).throwOnError(et.getValues),e[s].getValues()}),et.isDefined=((e,t)=>{let n=V("enumType: enum, nameOrValue: number","enumType: enum, nameOrValue: string")(e,t);return n.throwOnError(et.isDefined),1===n.index?-1!==e[s].getNames().indexOf(t):""!==e[s].getName(t)}),g("Enum",et);const tt=(e,t)=>{let n=V("name: string, factory: cfunction")(e,t);n.throwOnError(tt);let r={func:!0,prop:!0,propGetterSetter:!0,event:!0,customAttrs:!0,types:{type:"mixin"},params:{typeName:n.values.name,factory:n.values.factory}};return Ke(r)};g("Mixin",tt);const nt=new X,rt=nt.dispatch,it=(e,t,n)=>{let r;V("event: string, handler: afunction")(e,t).throwOnError(it),n?nt.remove(e,t):nt.add(e,t)};g("on",it,()=>{nt.clear()});const st=(e,t)=>{if("string"!=typeof e)throw x.InvalidArgument("event",st);rt(e,t)};g("post",st);let at={};const ot=()=>{};ot.isRegistered=(e=>{if("string"!=typeof e)throw x.InvalidArgument("alias",ot.isRegistered);return void 0!==at[e]&&at[e].length>0}),ot.get=((e,t)=>{if("string"!=typeof e)throw x.InvalidArgument("alias",ot.get);return t?at[e]?at[e].slice():[]:at[e]?at[e][0]:null}),ot.register=((e,t)=>{if("string"!=typeof e)throw x.InvalidArgument("alias",ot.register);if(!t)throw x.InvalidArgument("item",ot.register);if(-1!==e.indexOf("."))throw x.InvalidArgument("alias",ot.register);"string"==typeof t&&(t=I(t)),at[e]||(at[e]=[]),at[e].push(t)}),ot.resolve=((e,t,...n)=>{if("string"!=typeof e)throw x.InvalidArgument("alias",ot.resolve);if("boolean"!=typeof t)throw x.InvalidArgument("isAll",ot.resolve);let r=null;const i=e=>{let t=e;if("string"==typeof e)if(e.endsWith(".js")||e.endsWith(".mjs"));else{let t=ye(e);t&&(e=t)}if(-1!==["class","struct"].indexOf(q(e)))try{t=n?new e(...n):new e}catch(t){throw x.OperationFailed(`Type could not be instantiated. (${e[s].name})`,ot.resolve)}return t};return at[e]&&at[e].length>0&&(t?(r=[],at[e].forEach(e=>{r.push(i(e))})):r=i(at[e][0])),r}),g("Container",ot,()=>{at={}});let lt=b,ct=[],ut=500;const ft={on:(e,...t)=>{lt===b&&("string"==typeof e?t.unshift(e):"function"==typeof e&&it("telemetry",e),lt=((e,n)=>{if(0===t.length||-1!==t.indexOf(e)){let t=Object.freeze({type:e,data:n});ct.push(t),ct.length>ut-25&&ct.splice(0,25),st("telemetry",t)}}))},collect:()=>{if(lt!==b){let e=ct.slice();return ct.length=0,e}return[]},off:e=>lt!==b?("function"==typeof e&&it("telemetry",e,!0),lt=b,ft.collect()):[],isOn:()=>lt!==b,types:Object.freeze({RAW:"raw",EXEC:"exec",INFO:"info",INCL:"incl"})};g("telemetry",ft,()=>{ct.length=0});let pt=x,dt=we,mt=je;const ht=[],yt=function(e,t,n){this.rex=e,this.modifiers=t||[],this.Aspect=n},gt=(e,t)=>{let n="",r="",i=t.trim();return e.includes(".")?(n=e.substr(0,e.lastIndexOf(".")).trim(),r=e.substr(e.lastIndexOf(".")+1).trim()):(n="",r=e.trim()),n+"/"+r+":"+i},bt=e=>{let t=e,n="",r="",i="",s=null,a="";if(!t.includes(":"))throw x.InvalidArgument("pointcut");if(t=(s=t.split(":"))[0].trim(),!(i=s[1].trim()||""))throw x.InvalidArgument("pointcut");if(t.includes(".")?(n=t.substr(0,t.lastIndexOf(".")).trim(),r=t.substr(t.lastIndexOf(".")+1).trim()):(n="",r=t),!r)throw x.InvalidArgument("pointcut");if("*"===n&&("*"===r||"*"===i))throw x.InvalidArgument("pointcut");if("*"===r&&("*"===n||"*"===i))throw x.InvalidArgument("pointcut");if("*"===i&&("*"===n||"*"===r))throw x.InvalidArgument("pointcut");return a=C(a=n+"/"+r+":"+i,".","[.]"),a=C(a,"?","."),a=C(a,"*",".*"),new RegExp(a)},wt=(e,t,n)=>{let r=[],i=!1,s=gt(e,t);return ht.forEach(e=>{if(i=e.rex.test(s)){if(e.modifiers.length>0)for(let t of e.modifiers)if(!(i=n(t)))break;i&&r.push(e.Aspect)}}),r},vt=(e,t,n,r,i)=>{let s=[],a=[],o=[],l=[],c=[],u=null;for(let e of n)(u=new e).before&&u.after?o.push(u):u.before?s.push(u):u.after&&a.push(u);s.length>0&&s.reverse();for(let e of s)l.push(e.before);for(let e of o)c.push(e.after);o.length>0&&o.reverse();for(let e of o)l.push(e.before);for(let e of a)c.push(e.after);s=null,a=null,o=null;const f=function(e,t,n,r,i,...s){let a=null,o=null,l=s,c=-1,u={typeName:()=>e,funcName:()=>t,error:e=>(e&&(a=e),a),result:e=>(c>=0&&void 0!==e&&(o=e),o),args:(...e)=>(c<0&&e&&(l=e),l),data:{}};this.runBeforeSq=(()=>{c=-1;for(let e of r)try{e(u)}catch(e){u.error(e)}}),this.runMainSync=(()=>{this.runBeforeSq();try{c=0,u.result(n(...u.args()))}catch(e){u.error(e)}return this.runAfterSq(),this.throwOrGiveResult()}),this.runMainAsync=(async()=>{this.runBeforeSq();try{c=0,u.result(await n(...u.args()))}catch(e){u.error(e)}return this.runAfterSq(),this.throwOrGiveResult()}),this.runAfterSq=(()=>{c=1;for(let e of i)try{e(u)}catch(e){u.error(e)}}),this.throwOrGiveResult=(()=>{if(u.error())throw u.error();return u.result()})};return i?async function(...n){let i=new f(e,t,r,l,c,...n);return await i.runMainAsync()}:function(...n){let i;return new f(e,t,r,l,c,...n).runMainSync()}},xt=()=>{ht.length=0},Ot={register:(e,t)=>{if("string"!=typeof e)throw pt.InvalidArgument("pointcut");const{IAspect:n}=dt();if(!mt(t,n))throw pt.InvalidArgument("aspectType");let r=[];if(e.includes("#")){let t=e.split("#");e=t[0].trim(),r=N(t[0],",")}let i=bt(e);ht.push(new yt(i,r,t))}};g("Aspects",Ot,xt);const It=(e,t)=>{let n=null,r=null,i=t?JSON.parse(e):e,a=t?null:e[s].Type,o=a[s];const l=(e,t)=>{let n=e[s],r=n.attrs,i=n.modifiers,a=[],o=!1;for(let n in e)e.hasOwnProperty(n)&&n!==s&&((o=i.members.isProperty(n))&&(o=t?!r.members.probe("noserialize",n).anywhere():r.members.probe("serialize",n).anywhere())&&(o=!(i.members.is("private",n)||i.members.is("protected",n)||i.members.is("static",n)||i.members.is("readonly",n)||r.members.probe("resource",n).anywhere()||r.members.probe("asset",n).anywhere()||r.members.probe("inject",n).anywhere())),o&&a.push(n));return a};if(t){if(!i.type&&!i.data)throw x.InvalidArgument("json");if(!(a=ye(i.type)))throw x.NotFound(i.type,At.deserialize);try{n=new a}catch(e){throw x.OperationFailed(`Object could not be deserialized. (${i.type})`,e,At.deserialize)}r=o.attrs.type.probe("serialize").anywhere()?l(n,!0):l(n,!1);for(let e of r)n[e]=i.data[e]}else{r=o.attrs.type.probe("serialize").anywhere()?l(i,!0):l(i,!1),n={type:i[s].Type[s].name,data:{}};for(let e of r)n.data[e]=i[e];try{n=JSON.stringify(n)}catch(e){throw x.OperationFailed(`Object could not be serialized. (${i[s].Type[s].name})`,e,At.serialize)}}return n},At={serialize:e=>{if(u.indexOf(-1===q(e)))throw x.InvalidArgument("instance",At.serialize);return It(e)},deserialize:e=>{if(!e||"string"!=typeof e)throw x.InvalidArgument("json",At.deserialize);return It(e,!0)}};g("Serializer",At);const $t=4*l.env.cores,kt=Math.round($t/4),jt=[],Nt=()=>{if(jt.length<=kt)return;let e=jt.slice(0),t=()=>{if(0!==e.length){let n=e.shift();n.context.isBusy()?t():n.context.hasActiveInstances().then(e=>{0===e?(n.unload(),jt.shift(),jt.length>kt&&t()):t()}).catch(()=>{t()})}};t()},Tt=async()=>{let e=null;if(0===!jt.length)for(let t of jt)if(!t.context.isBusy()&&0===await t.context.hasActiveInstances()){e=t;break}if(!e){if(jt.length>=$t)throw x.OperationFailed("AppDomain pool limit reached.");e=await ce.createDomain(O())}return e},Ct={TaskInfo:function(e,...t){if("string"!=typeof e)throw x.InvalidArgument("qualifiedName",Ct.TaskInfo);return Object.freeze({type:e,typeArgs:t})},getHandle:async(e,t)=>{let n=await Tt(),r;return{run:async(...r)=>await n.context.execute({type:e.type,typeArgs:e.typeArgs,func:"run",args:r,keepAlive:!0},t),close:async()=>{try{return n.context.execute({type:e.type,typeArgs:e.typeArgs,func:"",args:[],keepAlive:!1},t)}finally{Nt()}}}},invoke:async(e,t)=>{let n=await Tt();try{return await n.context.execute({type:e.type,typeArgs:e.typeArgs,func:"run",args:[],keepAlive:!1},t)}finally{Nt()}},parallel:Object.freeze({invokeMany:(...e)=>{let t=[];for(let n of e)t.push(Ct.invoke(n));return t},invoke:Object.freeze({any:(...e)=>Promise.race(Ct.parallel.invokeMany(...e)),all:(...e)=>Promise.all(Ct.parallel.invokeMany(...e)),each:(e,t,...n)=>new Promise((r,i)=>{let s=Ct.parallel.invokeMany(...n),a=0;for(let n of s)n.then(e).catch(t).finally(()=>{a++,s.length===a&&r()})})})}),sequence:Object.freeze({invoke:async(...e)=>{let t=[];for(let n of e)t.push(await Ct.invoke(n));return t}})};g("Tasks",Ct,()=>{jt.forEach(e=>{e.unload()}),jt.length=0});const St=function(){this.name="clientFile",this.load=(async e=>{if("string"!=typeof e)throw x.InvalidArgument("file");let t=e.substr(e.lastIndexOf(".")+1).toLowerCase(),n=await fetch(e);if(!n.ok)throw x.OperationFailed(e,n.status);let r=n.headers["content-type"];return"json"===t||/^application\/json/.test(r)?n.json():n.text()})},Pt=function(){this.name="clientModule",this.require=(async e=>{if("string"!=typeof e)throw x.InvalidArgument("module");let t=()=>new Promise((t,n)=>{require([e],t,n)}),n=()=>new Promise((t,n)=>{let r=e.substr(e.lastIndexOf(".")+1).toLowerCase(),i=(!0).document.createElement("script");i.type="mjs"===r?"module":"text/javascript",i.name=e,i.src=e,i.onload=(()=>{t()}),i.onerror=(e=>{n(new x(e))}),(!0).document.head.appendChild(i)});return"undefined"!=typeof require?await t():l.env.isWorker?void importScripts(e):await n()}),this.undef=(e=>{if("string"!=typeof e)throw x.InvalidArgument("module");let t=null;(t=(l.env.isWorker,(!0).requirejs||null))?t.undef(e):console.warn("No approach is available to undef a loaded module. Connect clientModule port to an external handler.")})},Dt=function(){this.name="serverFile",this.load=(async e=>{const t=()=>new Promise((t,n)=>{if("string"!=typeof e)return void n(x.InvalidArgument("file"));let r=e.substr(e.lastIndexOf(".")+1).toLowerCase();try{let i=null,s="";(i=e.startsWith("https")?require("https"):require("http")).get(e,e=>{e.on("data",e=>{s+=e}),e.on("end",()=>{let i=e.headers["content-type"];if("json"===r||/^application\/json/.test(i))try{let e=JSON.parse(s);t(e)}catch(e){n(new x(e))}else t(s)})}).on("error",e=>{n(new x(e))})}catch(e){n(new x(e))}});return await t()})},Mt=function(){this.name="serverModule",this.require=(async e=>{if("string"!=typeof e)throw x.InvalidArgument("module");return require(e)}),this.undef=(e=>{if("string"!=typeof e)throw x.InvalidArgument("module");delete require.cache[require.resolve(e)]})},Ft=function(){this.name="settingsReader",this.read=(e=>{if("string"!=typeof e)throw x.InvalidArgument("asmName");let t={},n=ce.config();return n&&n[e]&&(t=_([t,n[e]],!1)),l.env.isWorker&&n&&n[`worker:${e}`]&&(t=_([t,n[`worker:${e}`]],!1)),t})};H.define("clientModule",["require","undef"]),H.define("serverModule",["require","undef"]),H.define("clientFile",["load"]),H.define("serverFile",["load"]),H.define("settingsReader",["read"]);let zt=[];zt.push(l.env.isServer?Mt:Pt),zt.push(l.env.isServer?Dt:St),zt.push(Ft);for(let e of zt)H.connect(new e);let Rt=!1;const Et=[],Wt=function(e){if(!e||!e[s]&&-1!==c.indexOf(e[s].type))throw x.InvalidArgument("Type",Wt);let t=null,n=null,r=null,i=null,a=null,o=null,l=null;const u=function(e){this.getType=(()=>"modifier"),this.getName=(()=>e.name),this.getArgs=(()=>e.args.slice()),this.getConstraints=(()=>e.cfg.constraints)},f=function(e){this.getType=(()=>"attribute"),this.getName=(()=>e.name),this.getArgs=(()=>e.args.slice()),this.getConstraints=(()=>e.cfg.constraints),this.isCustom=(()=>e.isCustom)},p=function(){this.getTarget=(()=>r),this.getTargetType=(()=>t.type),this.getName=(()=>t.name||""),this.getType=(()=>t.type),this.getId=(()=>t.id),this.getNamespace=(()=>t.namespace),this.getAssembly=(()=>t.assembly()),this.getContext=(()=>t.context),this.isClass=(()=>"class"===t.type),this.isEnum=(()=>"enum"===t.type),this.isStruct=(()=>"struct"===t.type),this.isMixin=(()=>"mixin"===t.type),this.isInterface=(()=>"interface"===t.type),this.isDeprecated=(()=>t.isDeprecated()),this.getModifiers=(()=>{let e=[];for(let t of o.modifiers.type)e.push(u(t));return e}),this.getAttributes=(()=>{let e=[];for(let t of o.attrs.type)e.push(f(t));return e}),this.getAttribute=(e=>{if("string"!=typeof e)throw x.InvalidArgument("name",this.getAttribute);let t=j(o.attrs.type,"name",e);return t?f(t):null}),this.getModifier=(e=>{if("string"!=typeof e)throw x.InvalidArgument("name",this.getModifier);let t=j(o.modifiers.type,"name",e);return t?u(t):null})},d=function(e){e.getMixins=(()=>{let e=[];if(t.mixins)for(let n of t.mixins)e.push(Wt(n));return e}),e.isMixed=(n=>{if(!n)throw x.InvalidArgument("name",e.isMixed);return!!t.isMixed&&t.isMixed(n)})},m=function(e){e.getInterfaces=(()=>{let e=[];if(t.interfaces)for(let n of t.interfaces)e.push(Wt(n));return e}),e.isImplements=(n=>{if(!n)throw x.InvalidArgument("name",e.isImplements);return!!t.isImplements&&t.isImplements(n)})},h=function(e){e.getInstanceType=(()=>n.type),e.isInstanceOf=(t=>{if(!t)throw x.InvalidArgument("name",e.isInstanceOf);return!!n.isInstanceOf&&n.isInstanceOf(t)})},y=e=>{let t=n.def;for(;1&&null!==t&&!t.members[e];)t=t.previous();return t},g=()=>{let e=null,t=null;l={};for(let r in n.obj){switch((e=y(r)).members[r]){case"prop":t=new v(r,e);break;case"func":t=new O(r,e);break;case"event":t=new I(r,e);break;case"construct":t=new O(r,e);break;case"dispose":t=new O(r,e);break}l[r]=t}},b=()=>{l||g()},w=function(e,n){this.getType=(()=>"member"),this.getMemberType=(()=>n.members[e]),this.getName=(()=>e),this.getModifiers=(()=>{let t=[];for(let n of a.modifiers[e])t.push(u(n));return t}),this.getAttributes=(()=>{let t=[];for(let n of a.attrs[e])t.push(f(n));return t}),this.getAttribute=(t=>{if("string"!=typeof t)throw x.InvalidArgument("name",this.getAttribute);let n=j(a.attrs[e],"name",t);return n?f(n):null}),this.getModifier=(t=>{if("string"!=typeof t)throw x.InvalidArgument("name",this.getModifier);let n=j(a.modifiers[e],"name",t);return n?u(n):null}),this.isPrivate=(()=>null!==j(a.modifiers[e],"name","private")),this.isProtected=(()=>null!==j(a.modifiers[e],"name","protected")),this.isPublic=(()=>!this.isPrivate()&&!this.isProtected()),this.isStatic=(()=>null!==j(a.modifiers[e],"name","static")),this.isSealed=(()=>null!==j(a.modifiers[e],"name","sealed")),this.isAbstract=(()=>null!==j(a.modifiers[e],"name","abstract")),this.isVirtual=(()=>null!==j(a.modifiers[e],"name","virtual")),this.isOverride=(()=>null!==j(a.modifiers[e],"name","virtual")),this.isEnumerable=(()=>Object.getOwnPropertyDescriptor(i,e).enumerable),this.isDeprecated=(()=>null!==j(a.attrs[e],"name","deprecate")),this.isConditional=(()=>null!==j(a.attrs[e],"name","conditional")),this.isMixed=(()=>null!==j(a.attrs[e],"name","mixin")),this.isInterfaced=(()=>null!==j(a.attrs[e],"name","interface")),this.getMixin=(()=>{let n=null,r=j(a.attrs[e],"name","mixin");if(r&&t.mixins)for(let e of t.mixins)if(e===r.name){n=Wt(e);break}return n}),this.getInterface=(()=>{let n=null,r=j(a.attrs[e],"name","interface");if(r&&t.interfaces)for(let e of t.interfaces)if(e===r.name){n=Wt(e);break}return n})},v=function(e,t){let n=new w(e,t);return n.isReadOnly=(()=>null!==j(a.modifiers[e],"name","readonly")),n.isSerializable=(()=>null!==j(a.attrs[e],"name","serialize")||null===j(a.attrs[e],"name","noserialize")&&null!==j(o.attrs.type,"name","serialize")),n.getValueType=(()=>{let t=j(a.attrs[e],"name","type");if(t)return t.args[0]}),n.isDisposable=(()=>null!==j(a.attrs[e],"name","dispose")),n.isInjectable=(()=>null!==j(a.attrs[e],"name","inject")),n.isResource=(()=>null!==j(a.attrs[e],"name","resource")),n.isAsset=(()=>null!==j(a.attrs[e],"name","asset")),n.isSession=(()=>null!==j(a.attrs[e],"name","session")),n.isState=(()=>null!==j(a.attrs[e],"name","state")),n},O=function(e,t){let n=new w(e,t);return n.isASync=(()=>null!==j(a.modifiers[e],"name","async")),n.isConstructor=(()=>"_construct"===e),n.isDestructor=(()=>"_dispose"===e),n.isSub=(()=>null!==j(a.attrs[e],"name","on")),n.isTimered=(()=>null!==j(a.attrs[e],"name","timer")),n.isInjectable=(()=>null!==j(a.attrs[e],"name","inject")),n.getArgs=(()=>{let t=j(a.attrs[e],"name","args");return t?t.args.slice():null}),n.getAspects=(()=>{if(a.aspects&&a.aspects[e].length>0){let t=[];for(let n of a.aspects[e])t.push(Wt(n));return t}return null}),n.getAspect=(t=>{if("string"!=typeof t)throw x.InvalidArgument("name",n.getAspect);if(a.aspects&&a.aspects[e].length>0){let n=j(a.aspects[e],"name",t);if(n)return Wt(n)}return null}),n},I=function(e,t){let n=new w(e,t);return delete n.isStatic,n.isPub=(()=>null!==j(a.attrs[e],"name","post")),n},A=function(e){e.getMembers=(e=>{(e=e||{}).types=e.types||[],e.modifiers=e.modifiers||[],e.attrs=e.attrs||[],e.aspects=e.aspects||[],e.inherited=void 0===e.inherited||e.inherited,b();let t=null,n=!0,r=[];for(let i in l)if(n=!0,l.hasOwnProperty(i)){if(t=l[i],e.types.length>0&&-1===e.types.indexOf(t.getMemberType())&&(n=!1),!n||e.inherited||a.members[i]||(n=!1),n&&e.modifiers.length>0)for(let t of e.modifiers)if(-1===k(a.modifiers[i],"name",t)){n=!1;break}if(n&&e.attrs.length>0)for(let t of e.attrs)if(-1===k(a.attrs[i],"name",t)){n=!1;break}if(n&&e.aspects.length>0&&"func"===t.getMemberType())for(let t of e.aspects)if(-1===k(a.aspects[i],"name",t)){n=!1;break}n&&r.push(l[i])}return r}),e.getMember=(t=>{if("string"!=typeof t)throw x.InvalidArgument("memberName",e.getMember);return b(),l[t]||null})},$=function(){let e=new p;return e.getParent=(()=>null!==t.inherits?Wt(t.inherits):null),e.isDerivedFrom=(n=>{if(!n)throw x.InvalidArgument("name",e.isDerivedFrom);return!!t.isDerivedFrom&&t.isDerivedFrom(n)}),e.getFamily=(()=>{let e=[],n=t.inherits;for(null!==t.inherits&&e.push(Wt(t.inherits));1&&null!==n;)e.push(Wt(n)),n=n[s].inherits;return e}),e.isSealed=(()=>!!t.isSealed&&t.isSealed()),e.isAbstract=(()=>!!t.isAbstract&&t.isAbstract()),d(e),m(e),e.isSerializable=(()=>null!==j(o.attrs.type,"name","serialize")),e.isStatic=(()=>!!t.isStatic&&t.isStatic()),e.isSingleton=(()=>!!t.isSingleton&&t.isSingleton()),e.isSingleInstanceCreated=(()=>!!t.singleInstance.value),h(e),A(e),e},N=function(){let e=new p;return e.isSerializable=(()=>null!==j(o.attrs.type,"name","serialize")),h(e),A(e),e},T=function(){let e=new p;return A(e),e},C=function(){let e=new p;return A(e),e},S=function(){let e=new p;return e.getNames=(()=>{let e=[];for(let t of et.getNames(i))e.push(v(t,a));return e}),e.getName=(t=>{if(!t)throw x.InvalidArgument("enumValue",e.getName);let n=et.getName(i,t);return n?v(n,a):null}),e.getValues=(()=>et.getValues(i)),e.isDefined=(t=>{if(!t)throw x.InvalidArgument("nameOrValue",e.isDefined);return et.isDefined(i,t)}),e};let P=null,D=null,M=!1;switch(Rt=!0,e[s].type){case"class":r=e,i=new e,M=!0,P=new $;break;case"struct":r=e,i=new e,M=!0,P=new N;break;case"enum":r=e[s].Type,i=e,P=new S;break;case"mixin":D=Ye("temp",[r=e],function(){}),i=new D,M=!0,P=new T;break;case"interface":r=e[s].Type,i=e,P=new C;break}return Rt=!1,M&&Et.push(i),t=r[s],n=i[s],a=n.def,o=n.typeDef,P};Wt.dispose=(()=>{if(Et.length>0)for(let e of Et)Me(e);Et.length=0}),g("Reflector",Wt,()=>{Wt.dispose()});const Lt=()=>{};Lt.guid=O,Lt.stuff=S,Lt.replaceAll=C,Lt.splitAndTrim=N,Lt.findIndexByProp=k,Lt.findItemByProp=j,Lt.which=I,Lt.isArrowFunc=A,Lt.isASyncFunc=$,Lt.sieve=R,Lt.deepMerge=_,Lt.getLoadedScript=U,Lt.b64EncodeUnicode=E,Lt.b64DecodeUnicode=W,Lt.lens=F,Lt.globalSetting=z,g("utils",Lt),y.members=Object.freeze(y.members);let _t=e?__filename:t?self.location.href:U("flair.js","flair.min.js");y.info=Object.freeze({name:"flairjs",title:"Flair.js",desc:"True Object Oriented JavaScript",asm:"flair",file:_t,version:"0.63.97",copyright:"(c) 2017-2020 Vikas Burman",license:"MIT",lupdate:new Date("Thu, 27 Feb 2020 13:58:07 GMT")});let Ut=I("./flair{.min}.js");ce.context.current().loadBundledAssembly(Ut,_t,(e,t)=>{const{Class:n,Struct:r,Enum:i,Interface:s,Mixin:a,Aspects:o,AppDomain:l,$$:c,InjectedArg:u,bring:f,Container:p,include:d,Port:m,on:h,post:y,telemetry:g,Reflector:b,Serializer:w,Tasks:v,as:x,is:O,isDefined:I,isComplies:A,isDerivedFrom:$,isAbstract:k,isSealed:j,isStatic:N,isSingleton:T,isDeprecated:C,isImplements:S,isInstanceOf:P,isMixed:D,getAssembly:M,getAttr:F,getContext:z,getResource:R,getRoute:E,getType:W,ns:L,getTypeOf:_,getTypeName:U,typeOf:q,dispose:B,using:G,Args:V,Exception:Z,noop:J,nip:X,nim:K,nie:Y,event:H}=e,{TaskInfo:Q}=e.Tasks,{env:ee}=e.options,{guid:te,stuff:ne,replaceAll:re,splitAndTrim:ie,findIndexByProp:se,findItemByProp:ae,which:oe,isArrowFunc:le,isASyncFunc:ce,sieve:ue,deepMerge:fe,getLoadedScript:pe,b64EncodeUnicode:de,b64DecodeUnicode:me,lens:he,globalSetting:ye}=e.utils,ge=ee.isServer||ee.isWorker?null:(!0).document,be=l.context.current().name,we=t,ve=we.substr(0,we.lastIndexOf("/")+1);l.loadPathOf("flair",ve);let xe=JSON.parse("{}"),Oe=m("settingsReader");if("function"==typeof Oe){let e=Oe("flair");e&&(xe=fe([xe,e],!1))}xe=Object.freeze(xe);let Ie=JSON.parse('{"bootModule":"flairjs-fabric","bootEngine":"flair.app.BootEngine","config":"./appConfig.json | ./webConfig.json"}');Ie=Object.freeze(Ie);const Ae=e=>{const t=(t,n)=>{let r=e.getType(n);r&&p.register(t,r)}};return l.context.current().currentAssemblyBeingLoaded("./flair{.min}.js"),c("ns","(root)"),s("IAspect",function(){this.before_=K,this.after_=K}),c("ns","(root)"),s("IAttribute",function(){this.name=X,this.constraints=X,this.decorateProperty_=K,this.decorateFunction_=K,this.decorateEvent_=K}),c("ns","(root)"),s("IDisposable",function(){this.dispose=K}),c("ns","(root)"),s("IPortHandler",function(){this.name=X}),c("ns","(root)"),s("IProgressReporter",function(){this.progress=Y}),(()=>{const{IProgressReporter:e,IDisposable:t}=L();c("ns","(root)"),n("Task",[e,t],function(){let e=!1,t=!1,n=l.context.current().name;this.construct=((...e)=>{this.args=e,this.context=l.contexts(n),this.domain=this.context.domain}),c("abstract"),this.dispose=K,c("protected"),this.args=[],c("protected"),this.context=null,c("protected"),this.domain=null,this.run=(async(...n)=>{if(t)throw Z.InvalidOperation("Task is already running",this.run);if(t=!0,!e)try{await this.setup(),e=!0}catch(e){throw t=!1,e}try{let e;return await this.onRun(...n)}catch(e){throw e}finally{t=!1}}),this.progress=H(e=>({data:e})),c("virtual"),c("protected"),c("async"),this.setup=J,c("abstract"),c("protected"),c("async"),this.onRun=K})})(),l.context.current().registerResource(JSON.parse('{"name":"master","encodingType":"utf8;base64;","asmFile":"./flair{.min}.js","file":"./src/flair/(root)/master.res.layout.html","data":"PGh0bWw+PC9odG1sPg=="}')),l.context.current().registerResource(JSON.parse('{"name":"vikas","encodingType":"utf8;base64;","asmFile":"./flair{.min}.js","file":"./src/flair/(root)/vikas.res.md","data":"IyBGbGFpci5qcwo8c21hbGw+PGI+VHJ1ZSBPYmplY3QgT3JpZW50ZWQgSmF2YVNjcmlwdDwvYj48L2JyPjxpPkNvcHlyaWdodCAmY29weTsgMjAxNy0yMDE5IFZpa2FzIEJ1cm1hbi4gRGlzdHJpYnV0ZWQgdW5kZXIgTUlULjwvaT48L3NtYWxsPgoKIyMgQXNzZW1ibHk6IDx1PmZsYWlyPC91Pgo8c21hbGw+PGk+ClZlcnNpb24gMC42MC41Mgo8YnIvPlNhdCwgMjIgRmViIDIwMjAgMjI6MzU6MzMgR01UCjxici8+ZmxhaXIuanMgKDM2MmssIDk1ayBtaW5pZmllZCwgMjZrIGd6aXBwZWQpCjwvaT48L3NtYWxsPgoKIyMjIFR5cGVzCjw8dHlwZXNfaGVhZGVyPj4KPDx0eXBlc19saXN0Pj4KCiMjIyBSZXNvdXJjZXMKPDxyZXNvdXJjZXNfaGVhZGVyPj4KPDxyZXNvdXJjZXNfbGlzdD4+CgojIyMgQXNzZXRzCjxzbWFsbD4obm9uZSk8L3NtYWxsPgoKCiMjIyBSb3V0ZXMKPHNtYWxsPihub25lKTwvc21hbGw+CgoKIyMjIEFQSQo8PHR5cGVzX2FwaT4+Cgo8L2JyPgotLS0KPHNtYWxsPjxzbWFsbD5CdWlsdCB3aXRoIGZsYWlyQnVpbGQgKHYxKSB1c2luZyBmYXNtICh2MSkgZm9ybWF0Ljwvc21hbGw+PC9zbWFsbD4="}')),l.context.current().registerResource(JSON.parse('{"name":"ns1.ns2.master","encodingType":"utf8;base64;","asmFile":"./flair{.min}.js","file":"./src/flair/ns1.ns2/master.res.layout.html","data":"PGh0bWw+PC9odG1sPg=="}')),l.context.current().currentAssemblyBeingLoaded("","function"==typeof Ae?Ae:null),l.registerAdo('{"name":"flair","file":"./flair{.min}.js","package":"flairjs","desc":"True Object Oriented JavaScript","title":"Flair.js","version":"0.63.97","lupdate":"Thu, 27 Feb 2020 13:58:07 GMT","builder":{"name":"flairBuild","version":"1","format":"fasm","formatVersion":"1","contains":["init","func","type","vars","reso","asst","rout","docs","sreg"]},"copyright":"(c) 2017-2020 Vikas Burman","license":"MIT","ns":[{"name":"(root)","desc":""},{"name":"ns1.ns2","desc":"This is the namespace description."}],"types":[{"name":"IAspect","type":"interface","desc":"Aspect definition"},{"name":"IAttribute","type":"interface","desc":"Attribute definition"},{"name":"IDisposable","type":"interface","desc":"Disposable definition"},{"name":"IPortHandler","type":"interface","desc":"Port handler definition"},{"name":"IProgressReporter","type":"interface","desc":"Progress reporter definition"},{"name":"Task","type":"class","desc":"Task base class"}],"resources":[{"name":"master","size":"0k","type":"Layout","desc":""},{"name":"vikas","size":"1k","type":"Document","desc":"Test resource document"},{"name":"ns1.ns2.master","size":"0k","type":"Layout","desc":""}],"assets":[{"file":"burman.md","size":"1k","type":"md","desc":""},{"file":"ns1.ns2.hello.md","size":"1k","type":"md","desc":""},{"file":"abc/abc.txt","size":"0k","type":"txt","desc":"some information only"},{"file":"views/l2{.min}.html","size":"0k","type":"html","desc":""},{"file":"views/ns1.ns2.l1{.min}.html","size":"0k","type":"View","desc":""}],"routes":[{"name":"now","mount":"api_v1","index":0,"verbs":["get"],"mw":[],"path":"/now/:type?","handler":"myapp.api.v1.Now","desc":"some desc"}]}'),Object.freeze({name:"flair",settings:xe,config:Ie})});let qt=fe("[flair]");return f=qt.settings(),p=qt.config(),Object.freeze(y)});