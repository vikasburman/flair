/**
 * @preserve
 * FlairJS
 * True Object Oriented JavaScript
 * Version 0.15.27
 * Sat, 09 Feb 2019 04:09:02 GMT
 * (c) 2017-2019 Vikas Burman
 * MIT
 * https://flairjs.com
 */
(function(e){"use strict";let n=!0;n&&(e.build=require("./flair.build.js"));let t=Object.freeze(e);"function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof exports?(void 0!==module&&module.exports&&(exports=module.exports=t),module.exports=exports=t):n||((!0).Flair=t)}).call(new Function("try {return global;}catch(e){return window;}")(),e=>{"use strict";let n=new Function("try {return this===global;}catch(e){return false;}")(),t=!0,i={},r=[],s=!1,a=!1,u=!1,o=!1,c=()=>{},f={};if(t.flair){let n=null;for(let i of t.flair.members)n=t.flair[i]._?t.flair[i]._.reset:null,"function"==typeof n&&n(),delete t[i];if(delete t.flair,"string"==typeof e&&"END"===e)return}e?"string"==typeof e&&(e={symbols:e.split(",").map(e=>e.trim())}):e={},f.symbols=Object.freeze(e.symbols||[]),r=f.symbols,s=r.indexOf("TEST")!==-1,f.env=Object.freeze({type:n?"server":"client",global:t,isTesting:s,isServer:s?r.indexOf("SERVER")!==-1||n:n,isClient:s?r.indexOf("CLIENT")!==-1||!n:!n,isProd:r.indexOf("DEBUG")===-1&&r.indexOf("PROD")!==-1,isDebug:r.indexOf("DEBUG")!==-1,suppressGlobals:"undefined"!=typeof suppressGlobals?e.suppressGlobals:f.symbols.indexOf("SUPPRESS")!==-1,args:n?process.argv:new(!0).URLSearchParams((!0).location.search)}),n=f.env.isServer,a=f.env.isClient,u=f.env.isProd,o=f.env.isDebug,i.info=Object.freeze({name:"FlairJS",version:"0.15.27",copyright:"(c) 2017-2019 Vikas Burman",license:"MIT",link:"https://flairjs.com",lupdate:new Date("Sat, 09 Feb 2019 04:09:02 GMT")}),i.members=[],i.options=Object.freeze(f);const l=()=>{return"_xxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx".replace(/[xy]/g,e=>{var n=16*Math.random()|0,t="x"==e?n:3&n|8;return t.toString(16)})},p=(e,n)=>{if(n){if(e.indexOf("{.min}")!==-1)return i.options.env.isProd?e.replace("{.min}",".min"):e.replace("{.min}","")}else if(e.indexOf("|")!==-1){let n=e.split("|"),t="";return t=i.options.env.isServer?n[0].trim():n[1].trim(),"x"===t&&(t=""),t}return e},m=e=>{return!e.hasOwnProperty("prototype")},d=(e,n,t)=>{return e.findIndex(e=>{return e[n]===t})},y=(e,n,t)=>{let i=e.findIndex(e=>{return e[n]===t});return i!==-1?e[i]:null},h=e=>{let n=[];for(let t of e){if(!t._||!t._.name)throw new v("InvalidArgument",`Argument type is not valid. (${e})`);n.push(t._.name)}return n},g=e=>{return e.split(",").map(e=>{return e.trim()})},b=e=>{return e.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1")},w=(e,n,t)=>{return e.replace(new RegExp(b(n),"g"),t)},v=function(e,n,t){let i="",r="",s=null;e?"string"==typeof e?i=e:"object"==typeof e?(i=e.name||"UnknownException",s=e,r=s.message):i="UndefinedException":i="UndefinedException",n?"string"==typeof n?r=n:"object"==typeof n?s||(s=n,i=i||s.name,r=s.message):i="UndefinedException":s&&(i=i||s.name,r=s.message),t&&"object"==typeof t&&(s||(s=t)),i&&!i.endsWith("Exception")&&(i+="Exception");let a=new Error(r||"");return a.name=i||"UndefinedException",a.error=s||null,Object.freeze(a)};v.InvalidArgument=(e=>{return new v("InvalidArgument",`Argument type is invalid. (${e})`)}),i.Exception=v,i.members.push("Exception");const _=(...e)=>{if(0===e.length)throw new v("InvalidArgument","Argument must be defined. (patterns)");let n=(...n)=>{let t=null,i=null,r="",s="",a=-1,u=-1,o=!1,c=0,f={raw:n||[],index:-1,isInvalid:()=>{return f.index===-1}};if(e)for(let l of e){a++,u=-1,o=!1,c=0,t=l.split(",");for(let e of t){if(u++,i=e.split(":"),2!==i.length?(r=`_${a}_${u}`,s=e.trim()||""):(r=i[0].trim()||"",s=i[1].trim()||""),["raw","index","isInvalid"].indexOf(r)!==-1)throw new v("InvalidArgument",`Argument name cannot be a reserved name. (${r})`);if(u>f.raw.length){o=!1;break}if(!I(f.raw[u],s)){o=!1;break}f[r]=f.raw[u],o=!0,c++}if(o&&c===f.raw.length){f.index=a;break}}return f};return Object.freeze(n)};i.Args=_,i.members.push("Args");const A=e=>{let n="";return"undefined"==typeof e&&(n="undefined"),n||null!==e||(n="null"),!n&&Array.isArray(e)&&(n="array"),!n&&e instanceof Date&&(n="date"),!n&&e._&&e._.type&&(n=e._.type),n||(n=typeof e),n};i.typeOf=A,i.members.push("typeOf");const x=(e,n)=>{let t=A(e),i=A(n),r=!1;if(["instance","sinstance"].indexOf(t)===-1)throw new v("InvalidArgument","Argument type is invalid. (obj)");if(["string","class","interface","struct","mixin"].indexOf(i)===-1)throw new v("InvalidArgument","Argument type is invalid. (type)");switch(t){case"instance":switch(i){case"class":r=e._.isInstanceOf(n);break;case"interface":r=e._.isImplements(n);break;case"mixin":r=e._.isMixed(n);break;case"string":r=e._.isInstanceOf(n),r||(r=e._.isImplements(n)),r||(r=e._.isMixed(n))}break;case"sinstance":switch(i){case"string":case"struct":r=e._.isInstanceOf(n)}}return r};i.isInstanceOf=x,i.members.push("isInstanceOf");const I=(e,n)=>{if("string"!==A(n))throw new v("InvalidArgument","Argument type is invalid. (type)");let t=!1,i="";return e&&("array"!==n&&"Array"!==n||(t=Array.isArray(e)),t||"date"!==n&&"Date"!==n||(t=e instanceof Date),!t&&"flair"===n&&e._&&e._.type&&(t=!0),t||(t=typeof e===n),t||e._&&e._.type&&(i=e._.type,t=i===n),!t&&i&&["instance","sinstance"].indexOf(i)!==-1&&(t=x(e,n))),t};i.is=I,i.members.push("is");const O=(e,n)=>{if("class"!==A(e))throw new v("InvalidArgument","Argument type is invalid. (type)");if(["string","class"].indexOf(A(n))===-1)throw new v("InvalidArgument","Argument type is invalid. (parent)");return e._.isDerivedFrom(n)};i.isDerivedFrom=O,i.members.push("isDerivedFrom");const k=(e,n)=>{if(["instance","class","sinstance","struct"].indexOf(A(e))===-1)throw new v("InvalidArgument","Argument type is invalid. (obj)");if(["string","interface"].indexOf(A(n))===-1)throw new v("InvalidArgument","Argument type is invalid. (intf)");return e._.isImplements(n)};i.isImplements=k,i.members.push("isImplements");const T=(e,n)=>{if(!e)throw new v("InvalidArgument","Argument type is invalid. (obj)");if("interface"!==A(n))throw new v("InvalidArgument","Argument type is invalid. (intf)");let t=!0;for(let i in n)if(n.hasOwnProperty(i)&&"_"!==i&&typeof e[i]!=typeof n[i]){t=!1;break}return t};i.isComplies=T,i.members.push("isComplies");const N=(e,n)=>{if(["instance","class","sinstance","struct"].indexOf(A(e))===-1)throw new v("InvalidArgument","Argument type is invalid. (obj)");if(["string","mixin"].indexOf(A(n))===-1)throw new v("InvalidArgument","Argument type is invalid. (mixin)");return e._.isMixed(n)};i.isMixed=N,i.members.push("isMixed");const j=(e,n)=>{return I(e,n)?e:null};i.as=j,i.members.push("as");const S=(e,n)=>{if("instance"!==A(e))throw new v("InvalidArgument","Argument type is invalid. (obj)");if("function"!==A(n))throw new v("InvalidArgument","Argument type is invalid. (fn)");let t=null,i=!1,r=!1,s=()=>{i||"function"!=typeof e._.dispose||(i=!0,e._.dispose())};try{t=n(e),t&&"function"==typeof t.finally&&(r=!0,t=t.finally(e=>{return s(),e}))}finally{r||s()}return t};i.using=S,i.members.push("using");const C=(e,...n)=>{if(!e||["string","class"].indexOf(A(e)===-1))throw new v("InvalidArgument","Argument type is invalid. (name)");if(e&&"string"!=typeof e&&!O(e,"Attribute"))throw new v("InvalidArgument","Argument type is invalid. (name)");let t=null,i=null,r=null;if("string"==typeof e){if(r=C.inbuilt[e]||null,!r){if(t=Y.getType(e),!t)throw new v("NotFound",`Attribute is not found. (${e})`);e=t._.name}}else t=e,e=t._.name;if(d(C._.bucket,"name",e)!==-1)throw new v("Duplicate",`Duplicate attributes are not allowed. (${e})`);t&&(i=new t(...n),r=new E(i.constraints)),C._.bucket.push({name:e,cfg:r,isCustom:null!==i,attr:i,args:n})};C._=Object.freeze({bucket:[]}),C.collect=(()=>{let e=C._.bucket.slice();return C.clear(),e}),C.has=(e=>{return C._.bucket.findIndex(n=>n.name===e)!==-1}),C.clear=(()=>{C._.bucket.length=0});const E=function(e,n){if("string"==typeof e&&(n=e,e=!1),"string"!=typeof n)throw new v.InvalidArgument("constraints");let t={isModifier:e,constraints:n};return t};C.Config=E,C.inbuilt={static:new E(!0,"((class || struct || prop || func) && !$abstract && !$virtual && !$override)"),abstract:new E(!0,"((class || struct || prop || func || event) && !$virtual && !$override && !$sealed && !$static)"),virtual:new E(!0,"(prop || func || event) && !$abstract && !$override && !$sealed && !$static"),override:new E(!0,"((prop || func || event) && ((@virtual || @abstract) && !virtual && !abstract) && !$sealed, !$static)"),sealed:new E(!0,"(class || prop || func || event) && override)"),private:new E(!0,"(prop || func || event) && !$protected && !@private"),protected:new E(!0,"(prop || func || event) && !$private"),readonly:new E(!0,"(prop && !abstract"),async:new E(!0,"func"),enumerate:new E("prop || func || event"),singleton:new E("(class && !$abstract && !$static)"),serialize:new E("(class || struct || prop) && !$abstract, !$static"),deprecate:new E("(class || struct || enum || interface || mixin || resource || prop || func || event)"),session:new E("prop && !$static && !$state && !$readonly && !$abstract && !$virtual"),state:new E("prop && !$static && !$session && !$readonly && !$abstract && !$virtual"),conditional:new E("prop || func || event"),noserialize:new E("prop"),mixed:new E("prop || func || event"),event:new E("func")},i.attr=C,i.members.push("attr");let M={};const D=e=>{if("string"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (name)");return M[e]?M[e].handler:null};D.define=((e,n,t)=>{if("string"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (name)");if("string"!=typeof n)throw new v("InvalidArgument","Argument type is invalid. (type)");if(t&&["interface","array"].indexOf(A(t))===-1)throw new v("InvalidArgument","Argument type is invalid. (intf)");if(M[e])throw new v("Duplicate",`Port is already defined. (${e})`);M[e]={type:n,interface:t||null,handler:null}}),D.connect=((e,n)=>{if("string"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (name)");if(!n)throw new v("InvalidArgument","Argument type is invalid. (handler)");if(!M[e])throw new v("NotFound",`Port is not defined. (${e})`);if(A(n)!==M[e].type)throw new v("InvalidType",`Handler type is invalid. (${e})`);let t=M[e].intf;if(t)if(Array.isArray(t)){for(let i of t)if("undefined"==typeof n[i])throw new v("InvalidType",`Handler interface is invalid. (${e})`)}else if(!k(n,t)||!T(n,t))throw new v("InvalidType",`Handler interface is invalid. (${e})`);M[e].handler=n}),D.disconnect=(e=>{if("string"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (name)");M[e]&&(M[e].handler=null)}),D.disconnect.all=(()=>{for(let e in M)M.hasOnwProperty(e)&&(M[e].handler=null)}),D.isDefined=(e=>{if("string"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (name)");return!!M[e]}),D.isConnected=(e=>{return!M[e]||!M[e].handler}),D._={reset:()=>{M={}}},i._Port=D,i.members.push("Port");let P={},L=null,$=null,z=null,F,R=e=>{F=e,i.Channel=F,f.env.suppressGlobals||(t.Channel=F)};const W=(e,n)=>{if("string"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (name)");if(!P[e])throw new v("NotFound",`Channel is not defined. (${e})`);if(!n)throw new v("InvalidArgument","Argument type is invalid. (payload)");let t={id:l(),type:e,stamp:Date.now(),payload:n};P[e].buffer.push(t)};W.define=((e,n)=>{if("string"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (name)");if("string"!=typeof n)throw new v("InvalidArgument","Argument type is invalid. (path)");if(P[e])throw new v("Duplicate",`Channel is already defined. (${e})`);P[e]={path:n,buffer:[]}}),W.publish=(()=>{let e=D("pubsub");e||(e={publish:(e,n)=>{console.log(e);for(let t of n)console.log(`  [${t.id}, ${t.stamp}] ${t.payload}`)}});for(let n in P)P.hasOwnProperty(n)&&P[n].buffer.length>0&&((!z||z&&z.indexOf(n)!==-1)&&e.publish(P[n].path,P[n].buffer.slice()),P[n].buffer.length=0);F.isActive()&&(L=setTimeout(F.publish,1e3*$))}),W.activate=((e,n)=>{if(!L){if("number"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (freq)");R(W),$=e,z=n||[],L=setTimeout(F.publish,1e3*e)}}),W.deactivate=(()=>{if(L){clearTimeout(L),L=null,z=null,R(U);for(let e in P)P.hasOwnProperty(e)&&(P[e].buffer.length=0)}}),W.isDefined=(e=>{if("string"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (name)");return!!P[e]}),W.isActive=(()=>{return null!==L}),W._={reset:()=>{F.deactivate(),P={}}};const U=()=>{};U.define=W.define,U.publish=W.publish,U.activate=W.activate,U.deactivate=W.deactivate,U.isDefined=W.isDefined,U.isActive=W.isActive,U._=W._,F=U,i.Channel=F,i.members.push("Channel");const q=(e,n)=>{let t=C.collect(),i=null,r=null,s="type"===e.level,a=J(e),u=G(e);s?(i=e.typeDef().attrs.type,r=e.typeDef().modifiers.type):(i=e.attrs.members[n]=[],r=e.modifiers.members[n]=[]);const o=t=>{let i=!1,r=["class","struct","enum","interface","mixin","resource"],s=["prop","func","construct","dispose","event"],o=["static","abstract","sealed","virtual","override","private","protected","readonly","async"],c=[],f=[],l=t.constraints;const p=e=>{let n={withWhat:"",matchType:"",original:e,name:"",value:!1};switch(e.substr(0,1)){case"$":n.matchType="anywhere",n.name=e.substr(1);break;case"@":n.matchType="inherited",n.name=e.substr(1);break;default:n.matchType="current",n.name=e}e.endsWith("^")?(n.withWhat="typeName",n.name=n.name.replace("^","")):r.indexOf(n.name)!==-1?(n.withWhat="typeType",n.matchType="current"):s.indexOf(n.name)!==-1?(n.withWhat="memberType",n.matchType="current"):o.indexOf(n.name)!==-1?n.withWhat="modifier":n.withWhat="attribute",c.push(n)},m=()=>{let e=new RegExp("/[^!&!|()]/g"),n="";for(;;){n=e.exec(l);{if(null===n)break;f.push(n)}}n="";for(let t of f)" "!==t[0]?n+=t[0]:(""!==n&&p(n),n="")};m();for(let d of c){switch(d.withWhat){case"typeName":switch(d.matchType){case"anywhere":d.value=d.name===n||e.Type._.isDerivedFrom(d.name);break;case"inherited":d.value=e.Type._.isDerivedFrom(d.name);break;case"current":d.value=d.name===n}break;case"typeType":d.value=e.types.type===d.name;break;case"memberType":d.value=e.members[n]===d.name;break;case"modifier":d.value=!!u.members.probe(d.name,n)[d.matchType]();break;case"attribute":d.value=!!a.members.probe(d.name,n)[d.matchType]()}l=w(l,d.original,d.value.toString())}if(i=new Function("try {return constraintsLex;}catch(e){return false;}")(),!i)throw new v("InvalidOperation",`${t.cfg.isModifier?"Modifier":"Attribute"} ${t.name} could not be applied. (${n})`);return i};for(let c of t)o(c)&&(c.isCustom?i.push(c):c.cfg.isModifier?r.push(c):i.push(c))},G=e=>{const n=(e,n)=>{let i={anywhere:()=>{return t.get(e,n)||t.get(e,n,!0)},current:()=>{return t.get(e,n)},inherited:()=>{return t.get(e,n,!0)},only:{current:()=>{return t.get(e,n)&&!t.get(e,n,!0)},inherited:()=>{return!t.get(e,n)&&t.get(e,n,!0)}}};return i};let t={get:(n,t,i)=>{let r="type"===e.level,s=null;if(r)if(i){let t=e.previous();for(;;){if(null===t)break;if(s=y(t.modifiers.type,"name",n))break;t=t.previous()}}else s=y(e.typeDef().modifiers.type,"name",n);else if(i){let i=e.previous();for(;;){if(null===i)break;if(s=y(i.modifiers.members[t],"name",n))break;i=i.previous()}}else s=y(e.modifiers.members[t],"name",n);return s},has:(e,n,i)=>{return null!==t.get(e,n,i)},type:{get:(e,n)=>{return t.get(e,!0,n)},has:(e,n)=>{return t.has(e,!0,n)},all:n=>{return n?e.modifiers.type.map(e=>e.name):e.modifiers.type.slice()}},members:{get:t.get,has:t.has,all:(n,t)=>{return t?e.modifiers.members[n].map(e=>e.name):e.modifiers.members[n].slice()},probe:n,is:(e,t)=>{let i=n(e,t);switch(e){case"static":return i.anywhere();case"abstract":return i.anywhere()&&!(n.anywhere("virtual",t)||n.anywhere("override",t));case"virtual":return i.anywhere()&&!n.anywhere("override",t);case"override":return i.anywhere()&&!n.anywhere("sealed",t);case"sealed":return i.anywhere();case"private":return i.anywhere();case"protected":return i.anywhere();case"readonly":return i.anywhere();case"async":return i.anywhere()}}}};return t},J=e=>{const n=(e,n)=>{let i={anywhere:()=>{return t.get(e,n)||t.get(e,n,!0)},current:()=>{return t.get(e,n)},inherited:()=>{return t.get(e,n,!0)},only:{current:()=>{return t.get(e,n)&&!t.get(e,n,!0)},inherited:()=>{return!t.get(e,n)&&t.get(e,n,!0)}}};return i};let t={get:(n,t,i)=>{let r="type"===e.level,s=null;if(r)if(i){let t=e.previous();for(;;){if(null===t)break;if(s=y(t.attrs.type,"name",n))break;t=t.previous()}}else s=y(e.typeDef().attrs.type,"name",n);else if(i){let i=e.previous();for(;;){if(null===i)break;if(s=y(i.attrs.members[t],"name",n))break;i=i.previous()}}else s=y(e.attrs.members[t],"name",n);return s},has:(e,n,i)=>{return null!==t.get(e,n,i)},type:{get:(e,n)=>{return t.get(e,!0,n)},has:(e,n)=>{return t.has(e,!0,n)},all:n=>{return n?e.attrs.type.map(e=>e.name):e.attrs.type.slice()}},members:{get:t.get,has:t.has,all:(n,t)=>{return t?e.attrs.members[n].map(e=>e.name):e.attrs.members[n].slice()},probe:n}};return t},V=(e,t,i,r)=>{if(e.singleton&&i.isTopLevelInstance&&t._.singleInstance())return t._.singleInstance();let p=c,y={},b=null,w="_construct",_="_dispose",A={},x={name:e.params.typeName,type:e.types.type,Type:t,level:"object",position:0,types:{members:{}},attrs:{members:{}},modifiers:{members:{}},typeDef:()=>{return t._.def()},previous:()=>{return 0!==x.position?r._.hierarchy[x.position-1]:null}},I=null,O=!1,k=D("sessionStorage"),T=D("localStorage");const N=(e,n)=>{for(let t of R.members.all(e))if(t.isCustom){if("prop"===n){let i=Object.getOwnPropertyDescriptor(r,e),s=t.attr.decorate(e,n,i.get,i.set);if(!s.get||!s.set)throw new v("Unexpected",`${t.name} decoration result is unexpected. (${e})`);Object.defineProperty(r,e,{configurable:!0,enumerable:!0,get:s.get.bind(r),set:s.set.base(r)})}else{let i=t.attr.decorate(e,n,r[e]);if(!i)throw new v("Unexpected",`${t.name} decoration result is unexpected. (${e})`);Object.defineProperty(r,e,{configurable:!0,enumerable:!0,value:i.bind(r)})}t.attr=null}},j=()=>{if(["Aspect"].indexOf(e.params.typeName)===-1&&!r._.isInstanceOf("Aspect")){let n=null,t=[];for(let i in x.types.members)x.types.members.hasOwnProperty(i)&&"func"===x.types.members[i]&&!i.startsWith("_")&&(t=re.get(e.params.typeName,i,R.members.all(i,!0)),x.aspects.members[i]=t,t.length>0&&(n=re.attach(r[i],x.name,i,t),n&&Object.defineProperty(r,i,{configurable:!0,enumerable:!0,value:n.bind(r)})))}},S=()=>{let e=!1,n=e=>{Object.defineProperty(y,e,Object.getOwnPropertyDescriptor(r,e))};n("_");for(let t in r)if(e=!1,r.hasOwnProperty(t)){if(e=!0,x.members[t]?(F.members.probe("private",t).current()&&(e=!1),e&&F.members.probe("protected",t).current()&&!i.isNeedProtected&&(e=!1)):F.members.probe("protected",t).anywhere()&&!i.isNeedProtected&&(e=!1),e&&n(t),e&&F.members.is("abstract",t))throw new v("InvalidDefinition",`Abstract member is not implemented. (${t})`);if(e){let e=R.members.probe("enumerate",t).current();if(e&&e.args[0]===!1){let e=Object.getOwnPropertyDescriptor(y,t);e.enumerable=!1,Object.defineProperty(y,t,e)}}e&&!i.isNeedProtected&&"event"===r[t].type&&y[t].rewire(y)}},E=()=>{for(let e of x.interfaces.types){let n=new e,t=n._.hierarchy.Current();for(let i in n)if(n.hasOwnProperty(i)&&"_"!==i&&y[i]){let e=t.types.members[i],r=x.types.members[i];if(e!==r)throw new v("NotDefined",`Interface (${n._.name}) member is not defined as ${e}. (${i})`)}}},M=(t,i,c)=>{let l=!1,d=R.members.get("conditional",t);if(d){let e=g(d.args[0]||[]);for(let t of e){if("test"===t&&s){l=!0;break}if("server"===t&&n){l=!0;break}if("client"===t&&a){l=!0;break}if("debug"===t&&o){l=!0;break}if("prod"===t&&u){l=!0;break}if(f.symbols.indexOf(t)!==-1){l=!0;break}}if(!l)return l}if(e.inheritance&&R.members.probe("abstract",t).current()&&c!==p&&c.get&&c.get!==p)throw new v("InvalidDefinition",`Abstract member must point to noop function. (${t})`);if(e.inheritance&&R.members.probe("override",t).current()&&"undefined"==typeof r[t])throw new v("InvalidOperation",`Member not found to override. (${t})`);if((!e.inheritance||e.inheritance&&!R.members.probe("override",t).current())&&"undefined"!=typeof r[t])throw new v("InvalidOperation",`Member with this name is already defined. (${t})`);if(e.static&&R.members.probe("static",t).current())if("func"===i){if(m(c))throw new v("InvalidOperation",`Static functions cannot be defined as an arrow function. (${t})`)}else if("prop"===i&&c.get&&"function"==typeof c.get)throw new v("InvalidOperation",`Static properties cannot be defined with a custom getter/setter. (${t})`);if(e.storage&&R.members.probe("session",t).current()){if(c.get&&"function"==typeof c.get)throw new v("InvalidOperation",`Session properties cannot be defined with a custom getter/setter. (${t})`);if(!k)throw new v("NotConfigured","Port is not configured. (sessionStorage)")}if(e.storage&&R.members.probe("state",t).current()){if(c.get&&"function"==typeof c.get)throw new v("InvalidOperation",`State properties cannot be defined with a custom getter/setter. (${t})`);if(!T)throw new v("NotConfigured","Port is not configured. (localStorage)")}return l},P=(n,t)=>{let s={get:null,set:null},a=p,u=p,o=R.members.probe.anywhere("readonly",n),c=null,f=x.name+"_"+n,l=!1;return t.get||t.set?(t.get&&"function"==typeof t.get&&(a=t.get),t.set&&"function"==typeof t.set&&(u=t.set),s.get=function(){return m(a)?a():a.apply(r)}.bind(r),s.set=function(e){if(o&&!r._.constructing)throw new v("InvalidOperation",`Property is readonly. (${n})`);return m(u)?u(e):u.apply(r,[e])}.bind(r)):(e.static&&R.members.probe.anywhere("static",n)&&(c=i.staticInterface),!c&&e.storage&&R.probe.anywhere("session",n)&&(c=k,l=!0),!c&&e.storage&&R.probe.anywhere("state",n)&&(c=T,l=!0),c||(f=n,c=A),c&&(l?c.key(f)||c.setKey(f,JSON.stringify({value:t})):"undefined"==typeof c[f]&&(c[f]=t),s.get=function(){return l?JSON.parse(c.getKey(f)).value:c[f]}.bind(r),s.set=function(e){if(o&&!r._.constructing)throw new v("InvalidOperation",`Property is readonly. (${n})`);l?c.setKey(f,JSON.stringify({value:e})):c[f]=e}.bind(r))),s},L=(n,t)=>{let s=null,a=null,u=null,o=null,c=!1;return e.inheritance&&R.has("override",n)&&(a=r,u=r[n].bind(r)),!a&&e.static&&R.has("static",n)&&(a=i.staticInterface,c=!0),a||(a=r),s=F.has("async",n)?function(...e){return new Promise(function(n,i){return o=u?[u,n,i].concat(e):[n,i].concat(e),m(t)?t(...o):t.apply(a,o)}.bind(a))}.bind(a):function(...e){return o=u?[u].concat(e):e,m(t)?t(...o):t.apply(a,o)}.bind(a),e.static&&c&&!a[n]&&(a[n]=s),s},$=(n,t)=>{let s=null,a=null;if(e.inheritance&&R.has("override",n)){let e=r[n].bind(r);s=function(...n){let i=[e].concat(n);return m(t)?t(...i):t.apply(r,i)}.bind(r)}return s||(s=function(...e){return m(t)?t(...e):t.apply(r,e)}.bind(r)),i.isTopLevelInstance?(a=s,s={},s._=Object.freeze({subscribers:[]}),s.subscribe=(e=>{if("function"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (fn)");s._.subscribers.push(e)}),s.subscribe.all=(()=>{return s._.subscribers.slice()}),s.unsubscribe=(e=>{if("function"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (fn)");let n=s._.subscribers.indexOf(e);n!==-1&&s._.subscribers.splice(n,1)}),s.unsubscribe.all=(()=>{s._.subscribers.length=0}),s.raise=function(...e){let n={};"function"==typeof a&&(n=a(...e));let t={name:ae,args:Object.freeze(n),stop:!1};for(let i of s._.subscribers)if(i(t),t.stop)break}.bind(r),s.rewire=(e=>{let n=e[ae].raise;n._=e[ae]._,n.subscribe=e[ae].subscribe,n.unsubscribe=e[ae].unsubscribe,r[ae]=n,delete e[ae].raise,delete e[ae].rewire})):s.type="event",s},z=(n,t,i)=>{switch(["func","prop","event"].indexOf(t)!==-1&&n.startsWith("_")&&new v("InvalidName",`Name is not valid. (${n})`),t){case"func":if(!e.func)throw new v("InvalidOperation",`Function cannot be defined on this type. (${x.name})`);break;case"prop":if(!e.prop)throw new v("InvalidOperation",`Property cannot be defined on this type. (${x.name})`);break;case"event":if(!e.event)throw new v("InvalidOperation",`Event cannot be defined on this type. (${x.name})`);break;case"construct":if(!e.construct)throw new v("InvalidOperation",`Constructor cannot be defined on this type. (${x.name})`);t="func";break;case"dispose":if(!e.dispose)throw new v("InvalidOperation",`Dispose cannot be defined on this type. (${x.name})`);t="func"}if(x.types.members[n]=t,x.attrs.members[n]=[],x.modifiers.members[n]=[],e.aop&&(x.aspects={members:{}}),e.mixins&&null!==b&&C("mixed",b),q(x,n),M(n,t,i)){let s=null;switch(t){case"func":s=L(n,i),e.static&&R.has("static",n)||Object.defineProperty(r,n,{configurable:!0,enumerable:!0,value:s});break;case"prop":s=P(n,i),e.static&&R.has("static",n)||Object.defineProperty(r,n,{configurable:!0,enumerable:!0,get:s.get,set:s.set});break;case"event":s=$(n,i),Object.defineProperty(r,n,{configurable:!0,enumerable:!0,value:s})}e.customAttrs&&N(n),x.members[n]=s}},F=G(x),R=J(x);if(e.inheritance){if(i.isTopLevelInstance&&F.type.has("abstract"))throw new v("InvalidOperation",`Cannot create instance of an abstract type. (${x.name})`);let e=t._.inherits;if(e){if(e._.isSealed()||e._.isSingleton()||e._.isStatic())throw new v("InvalidOperation",`Cannot inherit from a sealed, static or singleton type. (${e._.name})`);if(e._.type!==t._.type)throw new v("InvalidOperation",`Cannot inherit from another type family. (${e._.type})`);r=new e(i._flagName,i.staticInterface,i.args)}}if("undefined"==typeof r._&&(r._={},r._.id=l(),r._.hierarchy=[],r._.isInstanceOf=(e=>{if(!e)throw new v("InvalidArgument","Argument type is invalid. (name)");return e._&&e._.name&&(e=e._.name),d(r._.hierarchy,"name",e)!==-1}),r._.def=(()=>{return r._.hierarchy[r._.hierarchy.length-1]}),r._.Type=(()=>{r._.def().Type}),e.serialize&&(r._.serialize=(()=>{return se.process(y,y,{})}),r._.deserialize=(e=>{return se.process(y,e,y,!0)})),e.mixins&&(x.mixins={types:e.params.mixins,names:h(e.params.mixins)},r._.isMixed=(e=>{if(!e)throw new v("InvalidArgument","Argument type is invalid. (name)");e._&&e._.name&&(e=e._.name);let n=!1;for(let t of r._.hierarchy)if(t.mixins.type.names.indexOf(e)!==-1){n=!0;break}return n})),e.interfaces&&(x.interfaces={types:e.params.interfaces,names:h(e.params.interfaces)},r._.isImplements=(e=>{if(!e)throw new v("InvalidArgument","Argument type is invalid. (name)");e._&&e._.name&&(e=e._.name);let n=!1;for(let t of r._.hierarchy)if(t.interfaces.type.names.indexOf(e)!==-1){n=!0;break}return n}))),r._.type=e.types.instance,r._.hierarchy.push(x),x.position=r._.hierarchy.length-1,i.isTopLevelInstance&&(r._.modifiers=F,r._.attrs=R),O=!0,I=new Proxy({},{get:(e,n)=>{return r[n]},set:(e,n,t)=>{if(O){let e="";e="construct"===n?"construct":"dispose"===n?"dispose":"function"==typeof t?C.has("event")?"event":"func":"prop",z(n,e,t)}else{if("function"==typeof t)throw new v("InvalidOperation",`Redefinition of members at runtime is not allowed. (${n})`);r[n]=t}return!0}}),i.factory.apply(I),e.mixins)for(let W of x.mixins.types)b=W,W.apply(I),b=null;return C.clear(),O=!1,e.aop&&j(),e.construct&&"function"==typeof r[w]&&(r._.construct=r[w],delete r[w]),e.dispose&&"function"==typeof r[_]&&(r._.dispose=r[_],delete r[_]),S(),e.interfaces&&E(),e.construct&&i.isTopLevelInstance&&"function"==typeof y._[w]&&(y._.constructing=!0,y._[w](...i.args),delete y._.constructing),i.isTopLevelInstance&&e.singleton&&R.type.has("singleton")&&(t._.singleInstance=(()=>{return y}),t._.singleInstance.clear=(()=>{t._.singleInstance=(()=>{return null})})),i.isTopLevelInstance&&(y=Object.seal(y)),y},K=e=>{e.mixins=e.mixins||!1,e.interfaces=e.interfaces||!1,e.inheritance=e.inheritance||!1,e.singleton=e.singleton||!1,e.static=e.static||!1,e.func=e.func||!1,e.construct=e.construct||!1,e.dispose=e.dispose||!1,e.prop=e.prop||!1,e.storage=e.storage||!1,e.event=e.event||!1,e.aop=e.aop||!1,e.customAttrs=e.customAttrs||!1,e.serialize=e.serialize||!1,e.types.instance=e.types.instance||"unknown",e.types.type=e.types.type||"unknown",e.params.typeName=e.params.typeName||"unknown",e.params.inherits=e.params.inherits||null,e.params.mixins=[],e.params.interfaces=[],e.params.factory=e.params.factory||null,e.func||(e.construct=!1,e.dispose=!1),e.prop||(e.storage=!1),e.inheritance||(e.singleton=!1),e.func||e.prop||e.event||(e.aop=!1,e.customAttrs=!1);for(let n of e.params.mixinsAndInterfaces)if(n._&&n._.type)switch(n._.type){case"mixin":e.params.mixins.push(n);break;case"interface":e.params.interfaces.push(n)}delete e.params.mixinsAndInterfaces;let t="___flag___",i=function(n,r,...s){let a={_flagName:t};"undefined"!=typeof n&&n===t?(a.isNeedProtected=!0,a.isTopLevelInstance=!1,a.staticInterface=r,a.args=s):(a.isNeedProtected=!1,a.isTopLevelInstance=!0,a.staticInterface=i,"undefined"!=typeof n?"undefined"!=typeof r?a.args=[n,r].concat(s):a.args=[n]:a.args=[]);let u={};return V(e,i,a,u)},r={name:e.params.typeName,type:e.types.type,Type:i,level:"type",position:0,types:{type:e.types.type},attrs:{type:[]},modifiers:{type:[]},typeDef:()=>{return r},previous:()=>{return i._.inherits?i._.inherits._.def():null}};const s=G(r),a=J(r);return q(r,e.params.typeName),i._.name=e.params.typeName,i._.type=e.types.type,i._.id=l(),i._.namespace=null,i._.assembly=(()=>{return X.get(i._.name)||null}),i._.inherits=e.params.inherits||null,e.inheritance&&(i._.isAbstract=(()=>{return s.type.has("abstract")}),i._.isSealed=(()=>{return s.type.has("sealed")}),i._.isDerivedFrom=(n=>{if("string"!=typeof n)throw new v("InvalidArgument","Argument type is invalid. (name)");n._&&n._.name&&(n=n._.name);let t=!1,i=e.params.inherits;if(!t)for(;;){if(null===i)break;if(i._.name===n){t=!0;break}i=i._.inherits}return t})),e.static&&(i._.isStatic=(()=>{return s.type.has("static")})),e.singleton&&(i._.isSingleton=(()=>{return a.type.has("singleton")}),i._.singleInstance=(()=>{return null}),i._.singleInstance.clear=c),e.mixins&&(r.mixins={types:e.params.mixins,names:h(e.params.mixins)},i._.isMixed=(e=>{if("string"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (name)");e._&&e._.name&&(e=e._.name);let n=!1,t=i._.def();for(;;){if(null===t)break;if(n=t.mixins.names.indexOf(e)!==-1)break;t=t.previous()}return n})),e.interfaces&&(r.interfaces={types:e.params.interfaces,names:h(e.params.interfaces)},i._.isImplements=(e=>{if("string"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (name)");e._&&e._.name&&(e=e._.name);let n=!1,t=i._.def();for(;;){if(null===t)break;if(n=t.interfaces.names.indexOf(e)!==-1)break;t=t.previous()}return n})),i._.isDeprecated=(()=>{return a.type.has("deprecate")}),i._.def=(()=>{return r}),i._.modifiers=s,i._.attrs=a,Y(i),i._.isStatic()?new i:i},B=(e,n,t)=>{if("string"!=typeof e)throw v.InvalidArgument("name");if("array"===A(n)){if("function"!=typeof t)throw new v("InvalidArgument","Argument type is invalid. (factory)")}else{if("function"!=typeof n)throw new v("InvalidArgument","Argument type is invalid. (factory)");t=n,n=[]}let i={mixins:!0,interfaces:!0,static:!0,func:!0,construct:!0,prop:!0,event:!0,customAttrs:!0,serialize:!0,types:{instance:"sinstance",type:"struct"},params:{typeName:e,inherits:null,mixinsAndInterfaces:n,factory:t}};return K(i)};i.Struct=B,i.members.push("Struct");let H={},Q={};i.Assembly=(e=>{if("object"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (ado)");if("array"!==A(e.types)||"array"!==A(e.assets)||"string"!=typeof e.name||"string"!=typeof e.file)throw new v("InvalidArgument","Argument type is invalid. (ado)");let n=i.Struct("Assembly<assembly>",function(){this.construct(e=>{this.ado=e,this.name=e.name,this.file=p(e.file,!0),this.desc=e.desc||"",this.version=e.version||"",this.copyright=e.copyright||"",this.license=e.license||"",this.types=e.types.slice()||[],this.settings=e.settings||{},this.assets=e.assets.slice()||[],this.hasAssets=e.assets.length>0}),this.props(["readonly"],["ado","name","file","desc","version","copyright","license","types","hasAssets"]),this.prop("isLoaded",!1),this.func("load",()=>{return i.Assembly.load(this.file)}),this.func("getType",e=>{if("string"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (name)");if(!this.isLoaded)throw new v("NotLoaded",`Assembly is not yet loaded. (${this.file})`);if(this.types.indexOf(e)===-1)throw new v("NotFound",`Type is not found in this assembly. (${e})`);let n=i.Namespace.getType(e);if(!n)throw new v("NotRegistered",`Type is not registered. (${e})`);
return n}),this.func("createInstance",(e,...n)=>{if("string"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (name)");let t=i.Assembly.get(e),r=null;return r=n?new t(...n):new t})});return new n(e)}),i.Assembly.register=((...e)=>{if(!e)throw new v("InvalidArgument","Argument type is invalid. (ados)");let n=!1;for(let t of e){let e=i.Assembly(t),r=e.file;if(H[r])throw new v("DuplicateName",`Assembly is already registered. (${r})`);H[r]=e;for(let s of e.types){if(Q[s])throw new v("DuplicateName",`Type is already registered. (${s})`);Q[s]=e}n=!0}return n}),i.Assembly.load=(e=>{return new Promise((t,r)=>{if("string"!=typeof e)return void r(new v("InvalidArgument","Argument type is invalid. (file)"));if(!i.Assembly.isRegistered(e))return void r(new v("NotFound",`Assembly is not registered. (${e})`));if(H[e].isLoaded)return void t();if(n)try{require(e),H[e].markLoaded(),t()}catch(n){r(new v("FileLoad",`File load operation failed. (${e})`,n))}else{const n=i.options.env.global.document.createElement("script");n.onload=(()=>{H[e].isLoaded=!0,t()}),n.onerror=(n=>{r(new v("FileLoad",`File load operation failed. (${e})`,n))}),n.async=!0,n.src=e,i.options.env.global.document.body.appendChild(n)}})}),i.Assembly.isRegistered=(e=>{if("string"!=typeof e)throw new v("InvalidArgument","Argument type if not valid. (file)");return"undefined"!=typeof H[e]}),i.Assembly.isLoaded=(e=>{if("string"!=typeof e)throw new v("InvalidArgument","Argument type if not valid. (file)");return"undefined"!=typeof H[e]&&H[e].isLoaded}),i.Assembly.get=(e=>{if("string"!=typeof e)throw new v("InvalidArgument","Argument type if not valid. (name)");return Q[e]||null}),i.Assembly.all=(()=>{return Object.values(H).slice()}),i.Assembly.allTypes=(()=>{return Object.keys(Q).slice()}),i.Assembly._={reset:()=>{H={},Q={}}},i.members.push("Assembly");const X=i.Assembly;i.Namespace=(e=>{if(["class","enum","interface","mixin","struct","resource"].indexOf(e._.type)===-1)throw`Type (${e._.type}) cannot be placed in a namespace.`;if(e._.namespace)throw`Type (${e._.name}) is already contained in a namespace.`;let n=!1;e._.name.startsWith(".")&&(e._.name=e._.name.substr(1),n=!0);let t=i.Namespace.root,r=e._.name,s="",a=r.substr(0,r.lastIndexOf("."));if(r=r.substr(r.lastIndexOf(".")+1),a){let n=a.split(".");for(let i of n)if(i){if("_"===i)throw`Special name "_" is used as namespace in ${e._.name}.`;if(t[i]=t[i]||{},s=i,t[i]._&&"namespace"!==t[i]._.type)throw`${e._.name} cannot be contained in another type (${t[i]._.name})`;t=t[i]}}else if(!n)return;if(t[r])throw`Type ${r} already contained at ${a}.`;t[r]=e,e._.namespace=t,t._=t._||{},t._.name=t._.name||s,t._.type=t._.type||"namespace",t._.types=t._.types||[],t._.types.push(e);let u=()=>{return t._.types.slice()},o=e=>{let n=null,i=t;if(e.indexOf(".")!==-1){let t=e.split(".");for(let r of t)if(r){if("_"===r)throw`Special name "_" is used as name in ${e}.`;if(i=i[r],!i)break}n=i}else n=i[e];return n&&n._&&["class","enum","interface","mixin","struct"].indexOf(n._.type)!==-1?n:null},c=(e,...n)=>{let i=t.getType(e);if(i&&"class"!=i._.type)throw`${ae} is not a class.`;return i?new i(...n):null};t.getTypes=t.getTypes||u,t.getType=t.getType||o,t.createInstance=t.createInstance||c}),i.Namespace.root={},i.Namespace.getType=(e=>{return i.Namespace.root.getType?i.Namespace.root.getType(e):null}),i.Namespace.getTypes=(()=>{return i.Namespace.root.getTypes?i.Namespace.root.getTypes():[]}),i.Namespace.createInstance=((e,...n)=>{return i.Namespace.root.createInstance?i.Namespace.root.createInstance(e,...n):null});const Y=i.Namespace;i.Namespace._={reset:()=>{}},i.members.push("Namespace"),i.Types=(e=>{if("string"!==A(e))throw new v("InvalidArgument","Argument type is invalid. (name)");return i.Namespace.getType(e)}),i.members.push("Types"),i.Class=((e,n,t,i)=>{if("string"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (name)");switch(A(n)){case"function":i=n,n=null,t=[];break;case"array":if("function"!=typeof t)throw new v("InvalidArgument","Argument type is invalid. (factory)");i=t,t=n,n=null;break;case"class":if(["array","function"].indexOf(A(t))===-1)throw new v("InvalidArgument","Argument type is invalid. (factory)");if("function"==typeof t)i=t,t=[];else if("function"!=typeof i)throw new v("InvalidArgument","Argument type is invalid. (factory)");break;default:throw new v("InvalidArgument","Argument type is invalid. (factory)")}let r={};return r.config={mixins:!0,interfaces:!0,inheritance:!0,singleton:!0,static:!0,func:!0,construct:!0,dispose:!0,prop:!0,event:!0,storage:!0,aop:!0,customAttrs:!0,serialize:!0},r.params={typeName:e,inherits:n,mixinsAndInterfaces:t,factory:i},r.instance={type:"instance"},r.type={type:"class"},r.instance.mex={},r.type.mex={},K(r)}),i.members.push("Class"),i.Mixin=((e,n)=>{return n._={name:e,type:"mixin",namespace:null},i.Namespace(n),n}),i.members.push("Mixin"),i.Interface=((e,n)=>{let t={},r={};const s=e=>{return["constructor","dispose","_constructor","_dispose","_"].indexOf(e)!==-1};return r.func=(n=>{if("undefined"!=typeof t[n])throw`${e}.${n} is already defined.`;if(s(n))throw`${e}.${n} can only be defined for a class.`;t[n]=[],t[n].type="func"}),r.prop=(n=>{if("undefined"!=typeof t[n])throw`${e}.${n} is already defined.`;if(s(n))throw`${e}.${n} can only be defined as a function for a class.`;t[n]=[],t[n].type="prop"}),r.event=(n=>{if("undefined"!=typeof t[n])throw`${e}.${n} is already defined.`;if(s(n))throw`${e}.${n} can only be defined as a function for a class.`;t[n]=[],t[n].type="event"}),t._={name:e,type:"interface",namespace:null},i.Namespace(t),n.apply(r),delete r.func,delete r.prop,delete r.event,t}),i.members.push("Interface"),i.Enum=((e,n)=>{if("object"!=typeof n&&!Array.isArray(n))throw i.Exception("ENUM01","Invalid enum data.")}),i.Enum.getKeys=(e=>{try{return e._.keys()}catch(e){throw i.Exception("ENUM02","Object is not an Enum.",e)}}),i.Enum.getValues=(e=>{try{return e._.values()}catch(e){throw i.Exception("ENUM02","Object is not an Enum.",e)}}),i.Enum.isDefined=((e,n)=>{return i.Enum.getKeys().indexOf(n)!==-1||i.Enum.getValues().indexOf(n)!==-1}),i.members.push("Enum"),i.Resource=((e,n,t)=>{const r=e=>{return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function e(n,t){return String.fromCharCode("0x"+t)}))},s=e=>{return decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))};let a=t,u=n.substr(n.lastIndexOf(".")+1).toLowerCase(),o=["txt","xml","js","json","md","css","html","svg"];if(o.indexOf(u)!==-1)if(i.options.env.isServer){let e=new Buffer(a).toString("base64");a=e.toString("utf8")}else a=s(a);else i.options.env.isServer&&(a=new Buffer(a).toString("base64"));let c={file:()=>{return n},type:()=>{return u},get:()=>{return a},load:(...e)=>{if(i.options.env.isClient&&!c._.isLoaded)if(c._.isLoaded=!0,["gif","jpeg","jpg","png"].indexOf(u)!==-1){let n=e[0];if(n){let e=new Image;e.src="data:image/png;base64,"+t,n.appendChild(e),c._.isLoaded=!0}}else{let t,r,s,o=null;switch(u){case"css":t=i.options.env.global.document.createElement("style"),t.type="text/css",t.name=n,t.innerHTML=a,i.options.env.global.document.head.appendChild(t);break;case"js":r=i.options.env.global.document.createElement("script"),r.type="text/javascript",r.name=n,r.src=a,"function"==typeof cb&&(r.onload=e[0],r.onerror=(()=>{c._.isLoaded=!1})),i.options.env.global.document.head.appendChild(r);break;case"html":s=e[0],o=e[1]||"",s&&(o?s.innerHTML=a:s.insertAdjacentHTML(o,a))}}return c._.isLoaded}};if(c._={name:e,type:"resource",namespace:null,file:n,isLoaded:!1,data:()=>{return a}},c.JSON=null,"json"===c.type())try{c.JSON=Object.freeze(JSON.parse(a))}catch(e){}return i.Namespace(c),Object.freeze(c)}),i.Resource.get=(e=>{let n=i.Namespace.getType(e);return n._&&"resource"===n._.type?n.get():null});let Z={};i.Container=((e,n)=>{if("string"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (alias)");return n?(Z[e]||[]).slice():Z[e]&&Z[e].length>0?Z[e][0]:null}),i.Container.isRegistered=(e=>{if("string"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (alias)");return"undefined"!=typeof Z[e]&&Z[e].length>0}),i.Container.register=((e,n)=>{if("string"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (alias)");if(!n)throw new v("InvalidArgument","Argument type is invalid. (type)");if(I(n,"flair"));else if("object"==typeof n);else{if("string"!=typeof n)throw new v("InvalidArgument",`Argument type is invalid. (${A(n)})`);n=p(n),n.endsWith(".js")||n.endsWith(".mjs")}return Z[e]||(Z[e]=[]),Z[e].push(n),!0}),i.Container.resolve=((e,n,...t)=>{if("string"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (alias)");if("boolean"!=typeof n)throw new v("InvalidArgument","Argument type is invalid. (isMultiResolve)");let r=null,s=e=>{let n=e;if("string"==typeof e)if(e.endsWith(".js")||e.endsWith(".mjs"));else{let n=i.Namespace.getType(e);n&&(e=n)}return["class","struct"].indexOf(A(e))!==-1&&(n=t?new e(...t):new e),n};if(Z[e]&&Z[e].length>0)if(n){r=[];for(let n of Z[e])r.push(s(n))}else{let n=Z[e][0];r=s(n)}return r}),i.Container._={reset:()=>{Z={}}},i.members.push("Container"),i.Attribute=i.Class("Attribute",function(e){let n=null;e("abstract"),this.construct((...e)=>{this.args=[];for(let n of e)if("string"==typeof n)if(n.startsWith("[")&&n.endsWith("]")){let e=n.replace("[","").replace("]",""),t=function(){let n=this[e];return"function"==typeof n?n():n};this.args.push(t)}else this.args.push(n);else this.args.push(n)}),this.func("constraints",""),this.prop("args",[]),this.func("decorate",e=>{return"function"==typeof e&&(n=e),n}),this.func("resetEventInterface",(e,n)=>{n.subscribe=e.subscribe,n.unsubscribe=e.unsubscribe,delete e.subscribe,delete e.unsubscribe})});let ee=[];i.include=((e,n)=>{let t=A(e),r=null;"string"!==t&&"array"!==t&&(r=new v("InvalidArgument","Argument type is invalid. (deps)")),r||"string"!==t||(e=[e]),r||"function"==typeof n||(r=new v("InvalidArgument","Argument type is invalid. (fn)"));let s={},a=r?null:e.slice(),u=(e,n,t)=>{let r=D("moduleLoader"),s=D("fileLoader");return u=null,new Promise((a,o)=>{let c=t.substr(t.lastIndexOf(".")+1).toLowerCase();if(e)if(n)if(u=r||null,"function"==typeof u)u(t).then(a).catch(o);else try{a(require(t))}catch(e){o(e)}else if(u=s||null,"function"==typeof u)u(t).then(a).catch(o);else try{let e=null,n="";e=t.startsWith("https")?require("https"):require("http"),e.get(t,e=>{e.on("data",e=>{n+=e}),e.on("end",()=>{a("json"===c?JSON.parse(n):n)})}).on("error",o)}catch(e){o(e)}else if(n)if(u=r||null,"function"==typeof u)u(t).then(a).catch(o);else try{if("undefined"!=typeof require)require([t],a,o);else{let e=i.options.env.global.document.createElement("script");e.type="text/javascript",e.name=t,e.src=t,e.onload=a,e.onerror=o,i.options.env.global.document.head.appendChild(e)}}catch(e){o(e)}else u=s||null,"function"==typeof u?u(t).then(a).catch(o):fetch(t).then(e=>{200!==e.status?o(e.status):"json"===c?e.json().then(a).catch(o):a(e.text())}).catch(o)})},o=(e,n)=>{if("string"!=typeof e)throw new v("InvalidArgument","Argument type is invalid. (name)");if(!s[e])throw new v("InvalidName",`Name is not valid. (${e})`);if(s[e].error&&n)throw s[e].error;return s[e].dep},c=()=>{"function"==typeof n&&n(o,r)},f=()=>{if(r||0===a.length)return void c();{let e=a.shift().trim(),n="",t=null,o=null;if(""===e)return r=new v("InvalidArgument",`Argument type is invalid. (deps)`),void c();let l=e.split(":");if(2!==l.length)return r=new v("InvalidArgument",`Argument type is invalid. (${e})`),void c();if(n=l[0].trim(),e=l[1].trim(),s[n])return r=new v("DuplicateName",`Duplicate names are not allowed. (${n})`),void c();s[n]={error:null,dep:null},e=p(e);let m=n=>{if(e.startsWith("[")&&e.endsWith("]")&&e.indexOf(".")===-1){let n=e.substr(1,e.length-2).trim();i.Container.isRegistered(n)&&(t=i.Container(n),"string"==typeof t&&(e=t,t=null))}n()},d=n=>{t=i.Namespace.getType(e),n()},y=n=>{let r=i.Assembly.get(e);r?r.isLoaded()?(t=i.Namespace.getType(e),n()):r.load().then(()=>{t=i.Namespace.getType(e),n()}).catch(e=>{o=new v("AssemblyLoad",`Assembly load operation failed with error: ${e}. (${r.file()})`),n()}):n()},h=n=>{let r=e.substr(e.lastIndexOf(".")+1).toLowerCase();r?"js"===r||"mjs"===r?(e=p(e,!0),n()):u(i.options.env.isServer,!1,e).then(e=>{t=e,n()}).catch(t=>{o=new v("FileLoad",`File load failed. (${e})`,t),n()}):n()},g=n=>{u(i.options.env.isServer,!0,e).then(e=>{t=e,n()}).catch(t=>{o=new v("ModuleLoad",`Module load operation failed with error: ${t}. (${e})`),n()})},b=e=>{s[n].error=o,s[n].dep=t,e||ee.pop(),f()};if(""===e)return void b(!0);if(ee.indexOf(e)!==-1)return o=new v("CircularDependency",`Circular dependency identified. (${e})`),void b(!0);ee.push(e),m(()=>{t?b():d(()=>{t?b():y(()=>{t?b():h(()=>{t?b():g(()=>{return t?void b():(o=new v("DependencyResolution",`Failed to resolve dependency. ${e}`),void b())})})})})})}};f()}),i.include._={reset:()=>{ee=[]}},i.members.push("include"),i.Container.register("inject",i.Class("inject",i.Attribute,function(){this.decorator((e,n,t,r)=>{if(["func","prop"].indexOf(n)===-1)throw`inject attribute cannot be applied on ${n} members.`;if(["_constructor","_dispose"].indexOf(t)!==-1)throw`inject attribute cannot be applied on special function.`;let s=this.args[0],a=this.args[1],u=null,o=null;switch(Array.isArray(a)||(a=[a]),"string"==typeof s?(s=p(s),u=i.Container.resolve(s,!1,...a)):u=new s(...a),n){case"func":o=r.value,r.value=function(...e){o(u,...e)}.bind(e);break;case"prop":e[t]=u}})})),i.Container.register("multiinject",i.Class("multiinject",i.Attribute,function(){this.decorator((e,n,t,r)=>{if(["func","prop"].indexOf(n)===-1)throw`multiinject attribute cannot be applied on ${n} members.`;if(["_constructor","_dispose"].indexOf(t)!==-1)throw`multiinject attribute cannot be applied on special function.`;let s=this.args[0],a=this.args[1],u=null,o=null;if(Array.isArray(a)||(a=[a]),"string"!=typeof s)throw`multiinject attribute does not support direct type injections.`;switch(s=p(s),u=i.Container.resolve(s,!0,...a),n){case"func":o=r.value,r.value=function(...e){o(u,...e)}.bind(e);break;case"prop":e[t]=u}})}));let ne=[],te=e=>{return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")},ie=e=>{return new RegExp("^"+e.split(/\*+/).map(te).join(".*")+"$")};i.Aspects={},i.Aspects.raw=(()=>{return ne}),i.Aspects.register=((e,n)=>{let t=e||"~",i="",r="",s="",a="~",u="";if(t.indexOf("/")!==-1){let e=t.split("/");t=e[0].trim(),a=e[1].trim()}if("~"===t)i="~",r="~",s="~";else if(""===t)i="^",r="~",s="~";else if(t.indexOf(".")===-1)if(i="^",t.indexOf(":")===-1)r=t,s="~";else{let e=t.split(":");r=e[0].trim(),s=e[1].trim()}else if(i=t.substr(0,t.lastIndexOf(".")),t=t.substr(t.lastIndexOf(".")+1),t.indexOf(":")===-1)r=t,s="~";else{let e=t.split(":");r=e[0].trim(),s=e[1].trim()}"*"!==i&&""!==i||(i="~"),"*"!==r&&""!==r||(r="~"),"*"!==s&&""!==s||(s="~"),"*"!==a&&""!==a||(a="~"),u=`${i}=${r}=${s}=${a}`,ne[u]=ne[u]||[],ne[u].push(n)}),i.Aspects.get=((e,n,t)=>{let i=[],r="",s="",a=n.trim();e.indexOf(".")!==-1?(r=e.substr(0,e.lastIndexOf(".")).trim(),s=e.substr(e.lastIndexOf(".")+1).trim()):(r="^",s=e.trim());for(let u in ne){let e=u.split("="),n=e[0],o=ie(n),c=e[1],f=ie(c),l=e[2],p=ie(l),m=e[3],d=ie(m),y="~"===m;if((r===n||o.test(r))&&(s===c||f.test(s))&&(a===l||p.test(a))){if(!y)for(let e of t)if(e.name===m||d.test(e.name)){y=!0;break}if(y)for(let n of ne[u])i.indexOf(n)===-1&&i.push(n)}}return i}),i.Aspects.attach=((e,n,t,i)=>{let r=[],s=[],a=[],u=null,o=null;for(let c of i)u=new c,o=u.before(),"function"==typeof o&&r.push(o),o=u.around(),"function"==typeof o&&a.push(o),o=u.after(),"function"==typeof o&&s.push(o);a.length>0&&a.reverse();let f=function(...i){let u=null,o=null,c={typeName:()=>{return n},funcName:()=>{return t},error:e=>{return e&&(u=e),u},result:e=>{return"undefined"!=typeof e&&(o=e),o},args:()=>{return i},data:{}};for(let f of r)try{f(c)}catch(e){u=e}const l=e=>{for(let n of s)try{n(e)}catch(e){c.error(e)}};let p=e,m=null;for(let d of a)p=d(c,p);try{m=p(...i),m&&"function"==typeof m.then?c.result(new Promise((e,n)=>{m.then(n=>{c.result(n),l(c),e(c.result())}).catch(e=>{c.error(e),l(c),n(c.error())})})):(c.result(m),l(c))}catch(e){c.error(e)}return c.result()};return f});const re=i.Aspects;i.Aspect=i.Class("Aspect",function(e){let n=null,t=null,i=null;e("abstract"),this.construct((...e)=>{this.args=e}),this.prop("args",[]),this.func("before",e=>{return"function"==typeof e&&(n=e),n}),this.func("after",e=>{return"function"==typeof e&&(t=e),t}),this.func("around",e=>{return"function"==typeof e&&(i=e),i})}),i.Serializer={},i.Serializer.serialize=(e=>{return"instance"===e._.type?e._.serialize():null}),i.Serializer.deserialize=((e,n)=>{let t=new e;return"instance"===t._.type?(t._.deserialize(n),t):null}),i.Serializer.process=((e,n,t,i)=>{for(let r in e)i?t[r]=n[r]||t[r]:t[r]=n[r]});const se=i.Serializer;if(i.Reflector=function(e){const n=function(e){this.getType=(()=>{return e._.type}),this.getName=(()=>{return e._.name||""}),this.getNamespace=(()=>{let n=e._.namespace;return n?new g(n):null}),this.getAssembly=(()=>{let n=i.Assembly.get(e._.name);return n?new b(n):null}),this.getTarget=(()=>{return e}),this.isInstance=(()=>{return"instance"===e._.type}),this.isClass=(()=>{return"class"===e._.type}),this.isEnum=(()=>{return"enum"===e._.type}),this.isStruct=(()=>{return"struct"===e._.type}),this.isStructInstance=(()=>{return"sinstance"===e._.type}),this.isNamespace=(()=>{return"namespace"===e._.type}),this.isResource=(()=>{return"resource"===e._.type}),this.isAssembly=(()=>{return"assembly"===e._.type}),this.isMixin=(()=>{return"mixin"===e._.type}),this.isInterface=(()=>{return"interface"===e._.type})},t=function(e,n,t){this.getType=(()=>{return"member"}),this.getMemberType=(()=>{return e}),this.getTarget=(()=>{return n}),this.getTargetType=(()=>{return n._.type}),this.getName=(()=>{return t})},r=function(e,n,t,i){this.getType=(()=>{return"attribute"}),this.getName=(()=>{return n}),this.getTarget=(()=>{return i}),this.getArgs=(()=>{return t.slice()}),this.getClass=(()=>{return e?new m(e):null})},s=function(e,n){this.getType=(()=>{return"aspect"}),this.getName=(()=>{return e._.name}),this.getTarget=(()=>{return n}),this.getClass=(()=>{return e?new m(e):null})},a=function(e,n,i,s){let a=new t(e,n,i);return a.getRef=(()=>{return s}),a.getAttributes=(()=>{let e=[],t=[];for(let s of n._.instanceOf)if(s.meta[i]){t=s.meta[i];for(let a of t)e.push(new r(a.Attr,a.name,a.args,n))}return e}),a.hasAttribute=(e=>{let t=!1,r=[];for(let s of n._.instanceOf){if(s.meta[i]){r=s.meta[i];for(let n of r)if(n.name==e){t=!0;break}}if(t)break}return t}),a.getAttribute=(e=>{let t=null;for(let s of n._.instanceOf){if(s.meta[i]){let a=s.meta[i];for(let u of a)if(u.name===e){t=new r(u.Attr,u.name,u.args,n);break}}if(null!==t)break}return t}),a.isEnumerable=(()=>{return!!n[i]&&Object.getOwnPropertyDescriptor(n,i).enumerable}),a.isDeprecated=(()=>{return n._._.hasAttrEx("deprecate",i)}),a.isConditional=(()=>{return n._._.hasAttrEx("conditional",i)}),a.isOverridden=(()=>{return n._._.hasAttrEx("override",i)}),a.isOwn=(()=>{return n._.isOwnMember(i)}),a.isDerived=(()=>{return n._._.isDerivedMember(i)}),a.isPrivate=(()=>{return n._._.hasAttrEx("private",i)}),a.isProtected=(()=>{return n._._.isProtectedMember(i)}),a.isPublic=(()=>{return!a.isPrivate&&!a.isProtected}),a.isSealed=(()=>{return n._._.isSealedMember(i)}),a.isMixed=(()=>{return n._._.hasAttrEx("mixed",i)}),a.getMixin=(()=>{if(a.isMixed()){let e=a.getAttribute("mixed").getArgs()[0];return new w(e)}return null}),a.isInterfaceEnforced=(()=>{return a.getInterfaces().length>0}),a.getInterfaces=(()=>{let e=[],t=[];for(let r of n._.instanceOf)if(r.meta[i]){t=r.meta[i].interfaces;for(let s of t)e.push(new v(s,n))}return e}),a.isProp=(()=>{return"prop"===e}),a.isFunc=(()=>{return"func"===e}),a.isEvent=(()=>{return"event"===e}),a},u=function(e,n,t){let i=new a("prop",e,n,t);return i.getValue=(()=>{return e[n]}),i.setValue=(t=>{return e[n]=t}),i.getRaw=(()=>{return t}),i.isReadOnly=(()=>{return e._._.hasAttrEx("readonly",n)}),i.isSetOnce=(()=>{return e._._.hasAttrEx("readonly",n)&&e._._.hasAttrEx("once",n)}),i.isStatic=(()=>{return e._._.hasAttrEx("static",n)}),i.isSerializable=(()=>{return e._._.isSerializableMember(n)}),i},o=function(e,n,t,i){let r=new a("func",e,n,t);return r.invoke=((...t)=>{return e[n](...t)}),r.getAspects=(()=>{let t=[],i=[];for(let r of e._.instanceOf)if(r.meta[n]){i=r.meta[n].aspects;for(let a of i)t.push(new s(a,e))}return t}),r.getRaw=(()=>{return i}),r.isASync=(()=>{return e._._.hasAttrEx("async",n)}),r.isConstructor=(()=>{return"_constructor"===n}),r.isDisposer=(()=>{return"_dispose"===n}),r},c=function(e,n,t){let i=new a("event",e,n,t);return i.raise=((...e)=>{return t(...e)}),i.isSubscribed=(()=>{return t.subscribe.all().length>0}),i},f=function(e,n){let i=new t("key",e,n);return i.getValue=(()=>{return e[n]}),i},l=function(e){let t=new n(e),i=(e,n,t)=>{if(""===n&&0===t.length)return e.slice();let i=[],r=!0;for(let s of e)if("member"===s.getType()&&(""===n||s.getMemberType()===n)){if(r=!0,0!==t.length)for(let e of t)if(!s.hasAttribute(e)){r=!1;break}r&&i.push(s)}return i},r=n=>{let t=[],r=[],s=null,a=null;for(let f of e._.instanceOf){for(let i in f.meta){if(f.meta.hasOwnProperty(i)){switch(r=f.meta[i],f.meta[i].type){case"func":s=new o(e,i,f.meta[i].ref,f.meta[i].raw),t.push(s);break;case"prop":s=new u(e,i,f.meta[i].ref),t.push(s);break;case"event":s=new c(e,i,f.meta[i].argNames,f.meta[i].ref),t.push(s);break;default:throw"Unknown member type"}"undefined"!=typeof n&&i===n&&(t=[],a=s)}if(null!==a)break}if(null!==a)break}return null!==a?a:{all:(...e)=>{return i(t,"",e)},func:(...e)=>{return i(t,"func",e)},prop:(...e)=>{return i(t,"prop",e)},event:(...e)=>{return i(t,"event",e)}}};return t.getClass=(()=>{return null!==e._.inherits?new m(e._.inherits):null}),t.getFamily=(()=>{let n=[],t=e._.inherits;for(;;){if(null===t)break;n.push(new m(t)),t=t._.inherits}return n}),t.getMixins=(()=>{let e=[],n=t.getFamily();for(let i of n)e=e.concat(i.getMixins());return e}),t.getInterfaces=(()=>{let e=[],n=t.getFamily();for(let i of n)e=e.concat(i.getInterfaces());return e}),t.getMembers=((...e)=>{let n=r();return 0!==e.length?n.all(...e):n}),t.getMember=(e=>{return r(e)}),t.isSingleton=(()=>{return t.getClass().isSingleton()}),t.isInstanceOf=(n=>{return e._.isInstanceOf(n)}),t.isMixed=(n=>{return e._.isMixed(n)}),t.isImplements=(n=>{return e._.isImplements(n)}),t},p=function(e){let t=new n(e);return t.getStruct=(()=>{return null!==e._.inherits?new h(e._.inherits):null}),t.getMembers=(()=>{let n=Object.keys(e),t=n.indexOf("_");return t!==-1&&n.splice(t,1),n}),t.getMember=(n=>{return e[n]}),t.invoke=((...n)=>{return e[ae](...n)}),t.isInstanceOf=(n=>{return e._.inherits._.name===n}),t},m=function(e){let t=new n(e);return t.getParent=(()=>{return null!==e._.inherits?new m(e._.inherits):null}),t.getFamily=(()=>{let n=[],t=e._.inherits;for(;;){if(null===t)break;n.push(new m(t)),t=t._.inherits}return n}),t.getMixins=(()=>{let n=[];for(let t of e._.mixins)n.push(new w(t));return n}),t.getInterfaces=(()=>{let n=[];for(let t of e._.interfaces)n.push(new v(t));return n}),t.isSingleton=(()=>{return e._.isSingleton()}),t.isSingleInstanceCreated=(()=>{return null!==e._.singleInstance()}),t.isSealed=(()=>{return e._.isSealed()}),t.isDerivedFrom=(n=>{return e._.isDerivedFrom(n)}),t.isMixed=(n=>{return e._.isMixed(n)}),t.isImplements=(n=>{return e._.isImplements(n)}),t},d=function(e){let t=new n(e);return t.getMembers=(()=>{let n=e._.keys(),t=[];for(let i of n)t.push(new f(e,i));return t}),t.getMember=(n=>{if("undefined"==typeof e[n])throw`${n} is not defined.`;return new f(e,n)}),t.getKeys=(()=>{return e._.keys()}),t.getValues=(()=>{return e._.values()}),t},y=function(e){let t=new n(e);return t.getFile=(()=>{return e.file()}),t.getResType=(()=>{return e.type()}),t.getContent=(()=>{return e.get()}),t},h=function(e){let t=new n(e);return t},g=function(e){let t=new n(e);return t.getMembers=(()=>{let n=e.getTypes(),t=[];if(n)for(let i of n)switch(i._.type){case"class":t.push(new m(i));break;case"enum":t.push(new d(i));break;case"struct":t.push(new h(i));break;case"mixin":t.push(new w(i));break;case"interface":t.push(new v(i))}return t}),t.getMember=(n=>{let t=e.getType(n),i=null;if(t)switch(t._.type){case"class":i=new m(t);break;case"enum":i=new d(t);break;case"struct":i=new h(t);break;case"mixin":i=new w(t);break;case"interface":i=new v(t)}return i}),t.createInstance=((n,...t)=>{return e.createInstance(n,...t)}),t},b=function(e){let t=new n(e);return t.getTypes=(()=>{return e.types}),t.getAssets=(()=>{return e.assets}),t.getADO=(()=>{return e._.ado}),t.load=(()=>{return e.load()}),t},w=function(e){let t=new n(e);return t},v=function(e){let i=new n(e),r=()=>{let n=[];for(let i in e)e.hasOwnProperty(i)&&"_"!==i&&n.push(new t(e[i].type,e,i));return n};return i.getMembers=(()=>{return r()}),i.getMember=(n=>{if("undefined"==typeof e[n])throw`${n} is not defined.`;return new t(e[n].type,e,n)}),i};let _=null;switch(e._.type){case"instance":_=new l(e);break;case"sinstance":_=new p(e);break;case"class":_=new m(e);break;case"enum":_=new d(e);break;case"resource":_=new y(e);break;case"struct":_=new h(e);break;case"namespace":_=new g(e);break;case"assembly":_=new b(e);break;case"mixin":_=new w(e);break;case"interface":_=new v(e);break;default:throw`Unknown type ${e._.type}.`}return _},i.members.push("Reflector"),D.define("moduleLoader","function"),D.define("fileLoader","function"),D.define("sessionStorage","object",["key","setItem","getItem"]),D.define("localStorage","object",["key","setItem","getItem"]),D.define("pubsub","object",["publish","subscribe"]),F.define("raw","flair.system.raw"),F.define("exec","flair.system.execute"),F.define("info","flair.system.info"),F.define("fetch","flair.system.fetch"),!f.env.suppressGlobals)for(let ae of i.members)t[ae]=Object.freeze(i[ae]);return i.members=Object.freeze(i.members),t.flair=i,t.flair});