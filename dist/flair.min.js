/**
 * @preserve
 * FlairJS
 * True Object Oriented JavaScript
 * 
 * Assembly: flair
 *     File: ./flair.js
 *  Version: 0.15.622
 *  Sat, 02 Mar 2019 03:27:31 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * Licensed under MIT
 */
!function(e,n){"use strict";"function"==typeof define&&define.amd?define(n):"object"==typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n()),module.exports=exports=n()):e.flair=n()}(this,function(){"use strict";let e=new Function("try {return this===global;}catch(e){return false;}")(),n=e?!require("worker_threads").isMainThread:"undefined"!=typeof WorkerGlobalScope,t=!!e||(!n||WorkerGlobalScope),r={},i=e?__filename:t.document.currentScript.src,o=[],s=[],a={},f=["class","enum","interface","mixin","struct"],u="";if(e){let e=process.argv;n&&(e=require("worker_threads").workerData.argv);let t=e.findIndex(e=>{return!!e.startsWith("--flairSymbols")});t!==-1&&(u=e[t].substr(2).split("=")[1])}else u="undefined"!=typeof t.flairSymbols?t.flairSymbols:"";u&&(o=u.split(",").map(e=>e.trim())),a.symbols=Object.freeze(o),a.env=Object.freeze({type:e?"server":"client",global:t,isTesting:o.indexOf("TEST")!==-1,isServer:e,isClient:!e,isWorker:n,isMain:!n,isCordova:!e&&!!t.cordova,isNodeWebkit:e&&process.versions["node-webkit"],isProd:o.indexOf("DEBUG")===-1&&o.indexOf("PROD")!==-1,isDebug:o.indexOf("DEBUG")!==-1}),r.info=Object.freeze({name:"flair",file:i,version:"0.15.622",copyright:"(c) 2017-2019 Vikas Burman",license:"MIT",lupdate:new Date("Sat, 02 Mar 2019 03:27:31 GMT")}),r.members=[],r.options=Object.freeze(a);const c=(e,n,t)=>{r[e]=Object.freeze(n),r.members.push(e),"function"==typeof t&&s.push(t)},l=()=>{};c("noop",l);const p=function(e,n,t){let r=Error();switch(typeof e){case"string":switch(r.name=e,typeof n){case"string":r.message=n,r.error="object"==typeof t?t:null;break;case"object":r.message=n.message||"",r.error=n}break;case"object":r.name=e.name||"Unknown",r.message=e.message||"",r.error=e}return r.name=r.name||"Undefined",r.name.endsWith("Exception")||(r.name+="Exception"),Object.freeze(r)};p.InvalidArgument=(e=>{return new p("InvalidArgument",`Argument type is invalid. (${e})`)}),c("Exception",p);const m=function(){let e={};this.add=((n,t)=>{if("string"!=typeof name)throw new p("InvalidArgument","Argument type is invalid. (event)");if("function"!=typeof t)throw new p("InvalidArgument","Argument type is invalid. (handler)");e[n]||(e[name]=[]),e[name].push(t)}),this.remove=((n,t)=>{if("string"!=typeof name)throw new p("InvalidArgument","Argument type is invalid. (event)");if("function"!=typeof t)throw new p("InvalidArgument","Argument type is invalid. (handler)");if(e[n]){let r=e[n].indexOf(t);r!==-1&&e[n].splice(r,1)}}),this.dispatch=((n,t)=>{e[n]&&e[n].forEach(e=>{setTimeout(()=>{e({name:n,args:t})},0)})}),this.count=(n=>{return e[n]?e[n].length:0}),this.clear=(()=>{e={}})};let d={};const h=e=>{if("string"!=typeof e)throw new p("InvalidArgument","Argument type is invalid. (name)");return d[e]?d[e].handler:d[e].inbuilt};h.define=((e,n,t)=>{if("string"!=typeof e)throw new p("InvalidArgument","Argument type is invalid. (name)");if(n&&!Array.isArray(n))throw new p("InvalidArgument","Argument type is invalid. (members)");if(d[e])throw new p("Duplicate",`Port is already defined. (${e})`);d[e]={type:n?"object":"function",members:n||null,handler:null,inbuilt:"undefined"!=typeof t?t(a.env):null}}),h.connect=((e,n)=>{if("string"!=typeof e)throw new p("InvalidArgument","Argument type is invalid. (name)");if("function"!=typeof n)throw new p("InvalidArgument","Argument type is invalid. (handler)");if(!d[e])throw new p("NotFound",`Port is not defined. (${e})`);let t=n(a.env);if(typeof t!==d[e].type)throw new p("InvalidType",`Handler type is invalid. (${e})`);let r=d[e].members;if(r)for(let i of r)if("undefined"==typeof t[i])throw new p("InvalidType",`Handler interface is invalid. (${e})`);d[e].handler=t}),h.disconnect=(e=>{if("string"!=typeof e)throw new p("InvalidArgument","Argument type is invalid. (name)");d[e]&&(d[e].handler=null)}),h.isDefined=(e=>{if("string"!=typeof e)throw new p("InvalidArgument","Argument type is invalid. (name)");return!!d[e]}),h.isConnected=(e=>{return!d[e]||!d[e].handler}),c("Port",h,()=>{for(let e in d)d.hasOnwProperty(e)&&(d[e].handler=null);d={}});const g=()=>{return"_xxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx".replace(/[xy]/g,e=>{var n=16*Math.random()|0,t="x"==e?n:3&n|8;return t.toString(16)})},y=(e,n)=>{if(n){if(e.indexOf("{.min}")!==-1)return r.options.env.isProd?e.replace("{.min}",".min"):e.replace("{.min}","")}else if(e.indexOf("|")!==-1){let n=e.split("|"),t="";return t=r.options.env.isServer?n[0].trim():n[1].trim(),"x"===t&&(t=""),t}return e},w=e=>{return!e.hasOwnProperty("prototype")},b=(e,n,t)=>{return e.findIndex(e=>{return e[n]===t})},v=(e,n,t)=>{let r=e.findIndex(e=>{return e[n]===t});return r!==-1?e[r]:null},_=e=>{return e.split(",").map(e=>{return e.trim()})},x=e=>{return e.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1")},A=(e,n,t)=>{return e.replace(new RegExp(x(n),"g"),t)},I=(e,n,t,r)=>{r||(r=[]);for(let i in n)if(n.hasOwnProperty(i)&&r.indexOf(i)===-1){if(!t&&i in e)continue;e[i]=n[i]}return e},O=n=>{return new Promise((t,r)=>{let i=null;i=h(e?"serverFile":"clientFile"),i(n).then(t).catch(r)})},k=n=>{return new Promise((t,r)=>{e?h("serverModule").require(n).then(t).catch(r):h("clientModule").require(n).then(t).catch(r)})},j=(e,n,t,r)=>{let i=n?_(n):Object.keys(e);const o=n=>{let o={};if(i.length>0)for(let s of i)o[s]=n[s];else for(let s in e)e.hasOwnProperty(s)&&(o[s]=e[s]);if(r)for(let s in r)o[s]=r[s];return t&&(o=Object.freeze(o)),o};if(Array.isArray(e)){let n=[];for(let t of e)n.push(o(t));return n}return o(e)},S=e=>{return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function e(n,t){return String.fromCharCode("0x"+t)}))},T=e=>{return decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))},N=n=>{e?h("serverModule").undef(n):h("clientModule").undef(n)},P=function(e,n,t,r,i){let o={},s={},a={},u=!1,c="";this.name=e,this.domain=n,this.isUnloaded=(()=>{return u||n.isUnloaded()}),this.unload=(()=>{u||(u=!0,delete i[e],o={},a={},s={})}),this.current=(()=>{if(this.isUnloaded())throw"Unloaded";return 0===r.length?t||this:r[r.length-1]}),this.registerType=(e=>{if(this.isUnloaded())throw"Unloaded";if(f.indexOf(V(e))===-1)throw new p("InvalidArgument",`Type is not valid.`);let n=e._.name,t=n.substr(0,n.lastIndexOf("."));if(o[n])throw`Type (${n}) is already registered.`;return o[n]=e,t}),this.getType=(e=>{if(this.isUnloaded())throw"Unloaded";if("string"!=typeof e)throw new p("InvalidArgument",`Argument type is not valid. (${e})`);return o[e]||null}),this.allTypes=(()=>{if(this.isUnloaded())throw"Unloaded";return Object.keys(o)}),this.execute=(e=>{return new Promise((n,t)=>{if(this.isUnloaded()&&t("Unloaded"),e.type=e.type||"",e.typeArgs=e.typeArgs||[],e.func=e.func||"",e.args=e.args||[],!e.type||!e.func)throw new p.InvalidArgument("info");let r=null;try{let n=this.getType(e.type);r=0===e.typeArgs.length?new n:new n(...e.typeArgs)}catch(e){t(e)}let i=ie(r,n=>{return 0===e.args.length?n[e.func]():n[e.func](...e.args)});return i&&"function"==typeof i.then?void i.then(n).catch(t):i})}),this.currentAssemblyBeingLoaded=(e=>{if(this.isUnloaded())throw"Unloaded";return"undefined"!=typeof e&&(c=y(e,!0)),c}),this.loadAssembly=(e=>{return new Promise((n,t)=>{this.isUnloaded()&&t("Unloaded"),a[e]||(r.push(this),N(e),k(e).then(()=>{r.pop(),a[e]=Object.freeze(new M(this.domain.getADO(e),this)),n()}).catch(e=>{r.pop(),t(e)}))})}),this.getAssembly=(e=>{if(this.isUnloaded())throw"Unloaded";if("string"!=typeof e)throw new p("InvalidArgument",`Argument type is not valid. (${e})`);return a[e]||null}),this.allAssemblies=(()=>{if(this.isUnloaded())throw"Unloaded";return Object.keys(a)}),this.registerResource=(n=>{if(this.isUnloaded())throw"Unloaded";if("string"!=typeof n.name||""===n.name||"string"!=typeof n.encodingType||""===n.encodingType||"string"!=typeof n.file||""===n.file||"string"!=typeof n.data||""===n.data)throw p.InvalidArgument("rdo");let t=n.name.substr(0,n.name.lastIndexOf("."));if(o[n.name])throw`Type (${e}) is already registered.`;return s[n.name]=Object.freeze(new U(n,t,this)),t}),this.getResource=(e=>{if(this.isUnloaded())throw"Unloaded";if("string"!=typeof e)throw new p("InvalidArgument",`Argument type is not valid. (${e})`);return s[e]||null}),this.allResources=(()=>{if(this.isUnloaded())throw"Unloaded";return Object.keys(s)})},M=function(e,n){this.context=n,this.name=e.name,this.file=e.file,this.desc=e.desc,this.version=e.version,this.copyright=e.copyright,this.license=e.license,this.lupdate=e.lupdate,this.builder=e.builder.name,this.flairVersion=e.builder.version,this.format=Object.freeze({name:e.builder.format,version:e.builder.formatVersion,contains:e.builder.contains.slice()}),this.types=(()=>{return e.types.slice()}),this.getType=(n=>{if("string"!=typeof n)throw new p("InvalidArgument",`Argument type is not valid. (${n})`);if(e.types.indexOf(n)===-1)throw new p("NotFound",`Type is not available in this assembly. (${n})`);return this.context.getType(n)}),this.resources=(()=>{return e.resources.slice()}),this.getResource=(n=>{if("string"!=typeof n)throw new p("InvalidArgument",`Argument type is not valid. (${n})`);if(e.resources.indexOf(n)===-1)throw new p("NotFound",`Resource is not available in this assembly. (${n})`);return this.context.getResource(n)}),this.assets=(()=>{return e.assets.slice()}),this.assetsRoot=this.file.replace(".js","/"),this.getAsset=(n=>{if("string"!=typeof n)throw new p("InvalidArgument",`Argument type is not valid. (${n})`);let t=n.replace("./",this.assetsRoot);if(e.assets.indexOf(n)===-1)throw new p("NotFound",`Asset is not available for this assembly. (${t})`);return t})},U=function(n,t,r){if(this.context=r,this.name=n.name,this.ns=t,this.assembly=(()=>{return r.getAssembly(y(n.asmFile,!0))||null}),this.encodingType=n.encodingType,this.file=n.file,this.type=n.file.substr(n.file.lastIndexOf(".")+1).toLowerCase(),this.data=n.data,n.encodingType.indexOf("utf8;")!==-1)if(e){let e=new Buffer(n.data).toString("base64");this.data=e.toString("utf8")}else this.data=T(n.data);else e&&(this.data=new Buffer(n.data).toString("base64"));"json"===this.type&&(this.data=Object.freeze(JSON.parse(this.data)))},z=function(n){let r={},o=null,s=null;const a=function(){let e="<<isServer>>"=="true",n=null,r=null,i=null;const o=e=>{let n=e.data.func,t=null;const o=n=>{r.postMessage({data:{id:e.data.id,isError:!1,error:null,result:n}})},s=n=>{r.postMessage({data:{id:e.data.id,isError:!0,error:n,result:null}})};switch(e.data.obj){case"ad":i[n];break;case"alc":i.context[n]}try{let n=t(...e.data.args);n&&"function"==typeof n.then?n.then(o).catch(s):o(n)}catch(e){s(e)}};if(e){n=require("./flair{.min}.js");let e=require("worker_threads").parentPort;r=e,e.once("message",e=>{r=e.privatePort,r.on("message",o)})}else t.importScripts("<<file>>"),n=t.flair,r=this,r.onmessage=o;i=n.AppDomain};let f=a.toString().replace("<<file>>",i);f=f.replace("<<isServer>>",e.toString()),f=`(${f})();`;const u=(e,n,...t)=>{return new Promise((i,o)=>{let a=g();r[a]={resolve:i,reject:o},s.postMessage({data:{id:a,obj:e,func:n,args:t}})})},c=e=>{if(r[e.data.id]){let n=r[e.data.id].promise;delete r[e.data.id],e.data.isError?n.reject(e.data.error):n.resolve(e.data.result)}else n(e.data)};if(e){const{Worker,MessageChannel}=require("worker_threads");s=new Worker(f,{eval:!0,workerData:{argv:process.argv}});const e=new MessageChannel;s.postMessage({privatePort:e.port1},[e.port1]),e.port2.on("error",n),e.port2.on("message",c)}else{let e=new Blob([f]),r=t.URL.createObjectURL(e,{type:"application/javascript; charset=utf-8"});s=new t.Worker(r),s.onmessage=c,s.onerror=n}this.remoteCall=u,this.close=(()=>{e&&(o.close(),s.unref()),s.terminate()})},$=function(e,n){let t=!1,r=new z(e=>{throw new p("RemoteError",e)});this.name=e,this.isRemote=!0,this.isUnloaded=(()=>{return t}),this.unload=(()=>{t||(t=!0,delete n[e],r.remoteCall("ad","unload").finally(()=>{r.close()}))}),this.context=Object.freeze(new D("default",this,r)),this.loadScripts=((...e)=>{if(this.isUnloaded())throw"Unloaded";return r.remoteCall("ad","loadScripts",...e)})},D=function(e,n,t){this.name=e,this.domain=n,this.isUnloaded=(()=>{return n.isUnloaded()}),this.execute=(e=>{if(this.isUnloaded())throw"Unloaded";return t.remoteCall("alc","execute",e)}),this.loadAssembly=(e=>{if(this.isUnloaded())throw"Unloaded";return t.remoteCall("alc","loadAssembly",e)})},C=function(e){let n={},t={},r={},i={},o=[],s=null,a=null,f=!1;s=new P("default",this,null,o,i),a=s.unload,delete s.unload,s=Object.freeze(s),i[s.name]=s,r[e]=this,this.name=e,this.isRemote=!1,this.isUnloaded=(()=>{return f}),this.unload=(()=>{if(!f){f=!0;for(let e in i)i.hasOwnProperty(e)&&"function"==typeof e.unload&&e.unload();a();for(let o in r)r.hasOwnProperty(o)&&o!==this&&o.unload();n={},t={},i={},r={}}}),this.createDomain=(e=>{if("string"!=typeof e||"default"===e||r[e])throw p.invalidArguments("name");let n=new $(e,r);return r[e]=n,n}),this.domains=(e=>{return r[e]||null}),this.context=s,this.contexts=(e=>{return i[e]||null}),this.createContext=(e=>{if("string"!=typeof e||"default"===e||i[e])throw p.invalidArguments("name");let n=Object.freeze(new P(e,this,s,o,i));return i[e]=n,n}),this.registerAdo=((...e)=>{let r=!0;if(1===e.length&&"string"==typeof e[0]){let n=JSON.parse(e[0]);e=[n],r=!1}e.forEach(e=>{if("array"!==V(e.types)||"array"!==V(e.resources)||"array"!==V(e.assets)||"string"!=typeof e.name||"string"!=typeof e.file||""===e.file)throw p.InvalidArgument("ado");if(e.file=y(e.file,!0),n[e.file]){if(r)throw new p("DuplicateName",`Assembly is already registered. (${e.file})`)}else n[e.file]=Object.freeze(e),e.types.forEach(n=>{if(t[n])throw new p("DuplicateName",`Type is already registered. (${n})`);t[n]=e.file})})}),this.getAdo=(e=>{if("string"!=typeof e)throw new p("InvalidArgument",`Argument type is not valid. (${e})`);return n[e]||null}),this.allAdos=(()=>{return Object.keys(n)}),this.resolve=(e=>{if("string"!=typeof e)throw new p("InvalidArgument","Argument type if not valid. (qualifiedName)");return t[e]||null}),this.allTypes=(()=>{return Object.keys(t)}),this.loadScripts=((...e)=>{return new Promise((n,t)=>{try{te(e,()=>{n()})}catch(e){t(e)}})})};let E=new C("default"),q=E.unload;delete E.unload;const F=E;c("AppDomain",F,()=>{q()});const W=(e,n,t)=>{if(!Q(e,"flair"))throw new p.InvalidArgument("obj");let r=f.indexOf(V(e)!==-1);r&&n&&(t=n,n=""),r||"construct"!==n||(n="_construct");let i=[],o=r?"type":"members";if(t){let r=e._.attrs[o].probe(t,n).anywhere();r&&i.push(j(r,"name, isCustom, args, type",!0))}else{let t=e._.attrs[o].all(n).anywhere();t&&i.push(...j(t,"name, isCustom, args, type",!0))}return i};c("getAttr",W);const R=e=>{if(!Q(e,"flair"))throw new p("InvalidArgument","Argument type is not valid. (Type)");return e._.assembly()};c("getAssembly",R);const L=e=>{if(!Q(e,"flair"))throw new p("InvalidArgument","Argument type is not valid. (Type)");return e._.context};c("getContext",L);const B=e=>{if("string"!=typeof e)throw new p("InvalidArgument","Argument type is invalid. (qualifiedName)");let n=F.context.getResource(e)||null;return n?n.data:null};c("getResource",B);const J=e=>{if("string"!=typeof e)throw new p("InvalidArgument","Argument type is invalid. (qualifiedName)");return F.context.getType(e)};c("getType",J);const V=e=>{let n="";return"undefined"==typeof e&&(n="undefined"),n||null!==e||(n="null"),n||"number"!=typeof e||isFinite(e)!==!1||(n="infinity"),!n&&Array.isArray(e)&&(n="array"),!n&&e instanceof Date&&(n="date"),!n&&e._&&e._.type&&(n=e._.type),n||(n=typeof e),n};c("typeOf",V);const G=e=>{return e._&&e._.Type?e._.Type:null};c("getTypeOf",G);const K=(e,n)=>{if("class"!==V(e))throw new p("InvalidArgument","Argument type is invalid. (type)");if(["string","class"].indexOf(V(n))===-1)throw new p("InvalidArgument","Argument type is invalid. (parent)");return e._.isDerivedFrom(n)};c("isDerivedFrom",K);const X=(e,n)=>{let t=V(e),r=V(n),i=!1;if(["instance","sinstance"].indexOf(t)===-1)throw new p("InvalidArgument","Argument type is invalid. (obj)");if(["string","class","interface","struct","mixin"].indexOf(r)===-1)throw new p("InvalidArgument","Argument type is invalid. (type)");switch(r){case"class":case"struct":i=e._.isInstanceOf(n);break;case"interface":i=e._.isImplements(n);break;case"mixin":i=e._.isMixed(n);break;case"string":i=e._.isInstanceOf(n),i||"function"!=typeof e._.isImplements||(i=e._.isImplements(n)),i||"function"!=typeof e._.isMixed||(i=e._.isMixed(n))}return i};c("isInstanceOf",X);const H=(e,n)=>{return Q(e,n)?e:null};c("as",H);const Q=(e,n)=>{if(n._&&n._.name&&(n=n._.name),"string"!==V(n))throw new p("InvalidArgument","Argument type is invalid. (type)");let t=!1,r="";return"undefined"===n&&(t="undefined"==typeof e),t||"null"!==n||(t=null===e),t||"NaN"!==n||(t=isNaN(e)),t||"infinity"!==n||(t="number"==typeof e&&isFinite(e)===!1),t||"array"!==n&&"Array"!==n||(t=Array.isArray(e)),t||"date"!==n&&"Date"!==n||(t=e instanceof Date),!t&&"flair"===n&&e._&&e._.type&&(t=!0),t||(t=typeof e===n),t||e._&&e._.type&&(r=e._.type,t=r===n),!t&&r&&["instance","sinstance"].indexOf(r)!==-1&&(t=X(e,n)),t};c("is",Q);const Y=(e,n)=>{if(!e)throw new p("InvalidArgument","Argument type is invalid. (obj)");if("interface"!==V(n))throw new p("InvalidArgument","Argument type is invalid. (intf)");let t=!0;for(let r in n)if(n.hasOwnProperty(r)&&"_"!==r&&typeof e[r]!=typeof n[r]){t=!1;break}return t};c("isComplies",Y);const Z=(e,n)=>{if(["instance","class","sinstance","struct"].indexOf(V(e))===-1)throw new p("InvalidArgument","Argument type is invalid. (obj)");if(["string","interface"].indexOf(V(n))===-1)throw new p("InvalidArgument","Argument type is invalid. (intf)");return e._.isImplements(n)};c("isImplements",Z);const ee=(e,n)=>{if(["instance","class","sinstance","struct"].indexOf(V(e))===-1)throw new p("InvalidArgument","Argument type is invalid. (obj)");if(["string","mixin"].indexOf(V(n))===-1)throw new p("InvalidArgument","Argument type is invalid. (mixin)");return e._.isMixed(n)};c("isMixed",ee);const ne=[],te=(e,n)=>{if(["string","array"].indexOf(V(e))===-1)throw new p("InvalidArgument","Argument type is invalid. (deps)");if("function"!=typeof n)throw new p("InvalidArgument","Argument type is invalid. (fn)");Array.isArray(e)||(e=[e]);let t=[],r=e.slice(),i=()=>{n(...t)},o=()=>{if(0===r.length)return void i();{let e=r.shift().trim(),n=null;e=y(e);let i=t=>{if(e.startsWith("[")&&e.endsWith("]")&&e.indexOf(".")===-1){let t=e.substr(1,e.length-2).trim();n=Ie.resolve(t,!1),"string"==typeof n&&(e=n,n=null)}t()},s=t=>{n=J(e),t()},a=t=>{let r=R(e);r?r.isLoaded()?(n=J(e),t()):r.load().then(()=>{n=J(e),t()}).catch(e=>{throw new p("AssemblyLoad",`Assembly load operation failed with error: ${e}. (${r.file})`)}):t()},f=t=>{let r=e.substr(e.lastIndexOf(".")+1).toLowerCase();r?"js"===r||"mjs"===r?(e=y(e,!0),t()):O(e).then(e=>{n=e,t()}).catch(n=>{throw new p("FileLoad",`File load failed. (${e})`,n)}):t()},u=t=>{k(e).then(e=>{n=e,t()}).catch(n=>{throw new p("ModuleLoad",`Module load operation failed. (${e})`,n)})},c=e=>{t.push(n),e||ne.pop(),o()};if(""===e)return void c(!0);if(ne.indexOf(e)!==-1)throw new p("CircularDependency",`Circular dependency identified. (${e})`);ne.push(e),i(()=>{n?c():s(()=>{n?c():a(()=>{n?c():f(()=>{n?c():u(()=>{if(!n)throw new p("DependencyResolution",`Failed to resolve dependency. ${e}`);c()})})})})})}};o()};c("include",te,()=>{ne.length=0});const re=e=>{if("boolean"==typeof e&&e===!0)me(),s.forEach(e=>{e()}),s.length=0;else{if("instance"!==V(e))throw new p("InvalidArgument","Argument type is invalid. (obj)");e._.dispose()}};c("dispose",re);const ie=(e,n)=>{if(["instance","string"].indexOf(V(e))===-1)throw new p("InvalidArgument","Argument type is invalid. (obj)");if("function"!==V(n))throw new p("InvalidArgument","Argument type is invalid. (fn)");if("string"==typeof e){let n=J(e);if(!n)throw new p("InvalidArgument","Argument type is invalid. (obj)");e=new n}let t=null,r=!1,i=!1,o=()=>{r||"function"!=typeof e._.dispose||(r=!0,e._.dispose())};try{t=n(e),t&&"function"==typeof t.finally&&(i=!0,t=t.finally(e=>{return o(),e}))}finally{i||o()}return t};c("using",ie);const oe=(...e)=>{if(0===e.length)throw new p("InvalidArgument","Argument must be defined. (patterns)");let n=(...n)=>{let t=null,r=null,i="",o="",s=-1,a=-1,f=!1,u=0,c={raw:n||[],index:-1,isInvalid:!1,error:null,values:{}};if(e)for(let l of e){s++,a=-1,f=!1,u=0,t=l.split(",");for(let e of t){if(a++,r=e.split(":"),2!==r.length?(i=`_${s}_${a}`,o=e.trim()||""):(i=r[0].trim()||"",o=r[1].trim()||""),a>c.raw.length){f=!1;break}if(!Q(c.raw[a],o)){f=!1;break}c.values[i]=c.raw[a],f=!0,u++}if(f&&u===t.length){c.index=s;break}}return c.isInvalid=c.index===-1,c.error=c.isInvalid?new p("InvalidArguments","One or more argument types are invalid."):null,c};return Object.freeze(n)};c("Args",oe);const se=(e,...n)=>{if(!e||["string","class"].indexOf(V(e))===-1)throw new p("InvalidArgument","Argument type is invalid. (name)");if(e&&"string"!=typeof e&&!K(e,"Attribute"))throw new p("InvalidArgument","Argument type is invalid. (name)");let t=null,r=null,i=null;if("string"==typeof e){if(i=fe._.inbuilt[e]||null,!i){if(t=J(e),!t)throw new p("NotFound",`Attribute is not found. (${e})`);e=t._.name}}else t=e,e=t._.name;if(b(fe._.bucket,"name",e)!==-1)throw new p("Duplicate",`Duplicate attributes are not allowed. (${e})`);t&&(r=new t(...n),i=new ae(r.constraints)),fe._.bucket.push({name:e,cfg:i,isCustom:null!==r,attr:r,args:n})},ae=function(e,n){if("string"==typeof e&&(n=e,e=!1),"string"!=typeof n)throw new p.InvalidArgument("constraints");let t={isModifier:e,constraints:n};return t},fe=(e,...n)=>{return se(e,...n)};fe._=Object.freeze({bucket:[],inbuilt:Object.freeze({static:new ae(!0,"((class || struct) && !$abstract) || (((class || struct) && (prop || func)) && !($abstract || $virtual || $override))"),abstract:new ae(!0,"((class || struct) && !$sealed && !$static) || (((class || struct) && (prop || func || event)) && !($override || $sealed || $static))"),virtual:new ae(!0,"(class || struct) && (prop || func || construct || dispose || event) && !($abstract || $override || $sealed || $static)"),override:new ae(!0,"(class || struct) && (prop || func || construct || dispose || event) && ((@virtual || @abstract) && !(virtual || abstract)) && !($sealed || $static))"),sealed:new ae(!0,"(class || ((class && (prop || func || event)) && override))"),private:new ae(!0,"(class || struct) && (prop || func || event) && !($protected || @private || $static)"),protected:new ae(!0,"(class || struct) && (prop || func || event) && !($private|| $static)"),readonly:new ae(!0,"(class || struct) && prop && !abstract"),async:new ae(!0,"(class || struct) && func"),enumerate:new ae("(class || struct) && prop || func || event"),dispose:new ae("class && prop"),post:new ae("(class || struct || mixin) && event"),on:new ae("class && func && !(event || $async || $args || $inject || $static)"),timer:new ae("class && func && !(event || $async || $args || $inject || @timer || $static)"),type:new ae("(class || struct || mixin) && prop"),args:new ae("(class || struct || mixin) && (func || construct) && !$on"),inject:new ae("class && (prop || func || construct) && !(static || session || state)"),singleton:new ae("(class && !(prop || func || event) && !($abstract || $static)"),serialize:new ae("((class || struct) || ((class || struct) && prop)) && !($abstract || $static)"),deprecate:new ae("!construct && !dispose"),session:new ae("(class && prop) && !($static || $state || $readonly || $abstract || $virtual)"),state:new ae("(class && prop) && !($static || $session || $readonly || $abstract || $virtual)"),conditional:new ae("(class || struct || mixin) && (prop || func || event)"),noserialize:new ae("(class || struct || mixin) && prop"),ns:new ae("(class || struct || mixin || interface || enum) && !(prop || func || event || construct || dispose)"),mixin:new ae("class && (prop || func || event)"),interface:new ae("class && (prop || func || event)")})}),fe.collect=(()=>{let e=fe._.bucket.slice();return fe.clear(),e}),fe.has=(e=>{return fe._.bucket.findIndex(n=>n.name===e)!==-1}),fe.get=(e=>{let n=fe._.bucket.findIndex(n=>n.name===e);return n!==-1?fe._.bucket[n]:null}),fe.clear=(()=>{fe._.bucket.length=0}),c("attr",se),c("$$",se);const ue=(e,n,t,r)=>{let i=fe.collect(),o=null,s=null,a=ce(!0,e,n),u=ce(!1,e,n);r?(o=n.attrs.type,s=n.modifiers.type):(o=e.attrs.members[t]=[],s=e.modifiers.members[t]=[]);const c=i=>{let o=!1,s=f,c=["prop","func","construct","dispose","event"],l=["static","abstract","sealed","virtual","override","private","protected","readonly","async"],m=[],d=[],h=[],g=i.cfg.constraints;const y=e=>{let n={withWhat:"",matchType:"",original:e,name:"",value:!1};switch(e.substr(0,1)){case"$":n.matchType="anywhere",n.name=e.substr(1);break;case"@":n.matchType="inherited",n.name=e.substr(1);break;default:n.matchType="current",n.name=e}e.endsWith("^")?(n.withWhat="typeName",n.name=n.name.replace("^","")):s.indexOf(n.name)!==-1?(n.withWhat="typeType",n.matchType="current"):c.indexOf(n.name)!==-1?(n.withWhat="memberType",n.matchType="current"):l.indexOf(n.name)!==0-1?n.withWhat="modifier":n.withWhat="attribute","struct"===n.name?d.push(n):m.push(n)},w=()=>{let e=new RegExp("[^!&!|()]","g"),n="",t=0;for(;!0;){n=e.exec(g);{if(null===n)break;h.push(n)}}n="",t=0;for(let r of h)t++," "!==r[0]?(n+=r[0],t===h.length&&(""!==n&&y(n),n="")):(""!==n&&y(n),n="");m=m.concat(d)};w();for(let b of m){switch(b.withWhat){case"typeName":switch(b.matchType){case"anywhere":b.value=b.name===n.name||n.Type._.isDerivedFrom(b.name);break;case"inherited":b.value=n.Type._.isDerivedFrom(b.name);break;case"current":b.value=b.name===n.name}break;case"typeType":b.value=n.type===b.name;break;case"memberType":r?b.value=!1:b.value=e.members[t]===b.name;break;case"modifier":r?b.value=!!a.type.probe(b.name)[b.matchType]():b.value=!!a.members.probe(b.name,t)[b.matchType]();break;case"attribute":r?b.value=!!u.type.probe(b.name)[b.matchType]():b.value=!!u.members.probe(b.name,t)[b.matchType]()}g=A(g,b.original,b.value.toString())}if(o=new Function("try {return ("+g+");}catch(e){return false;}")(),!o)throw new p("InvalidOperation",`${i.cfg.isModifier?"Modifier":"Attribute"} ${i.name} could not be applied. (${t})`);return o};for(let l of i)c(l)&&(l=j(l,null,!1,{type:r?n.name:e.name}),l.isCustom?o.push(l):l.cfg.isModifier?s.push(l):o.push(l))},ce=(e,n,t)=>{let r=e?"modifiers":"attrs",i=(e,i,o,s)=>{let a=null;if(s)if(o){let n=t.previous();for(;!0&&null!==n&&!(a=v(n[r].type,"name",e));)n=n.previous()}else a=v(t[r].type,"name",e);else if(o){let t=n.previous();for(;!0&&null!==t&&!(a=v(t[r].members[i],"name",e));)t=t.previous()}else a=v(n[r].members[i],"name",e);return a},o=(e,n,t,r)=>{return null!==i(e,n,t,r)};const s=(e,n)=>{let t=Object.freeze({anywhere:()=>{return i(e,n,!1,!1)||i(e,n,!0,!1)},current:()=>{return i(e,n,!1,!1)},inherited:()=>{return i(e,n,!0,!1)},only:Object.freeze({current:()=>{return i(e,n,!1,!1)&&!i(e,n,!0,!1)},inherited:()=>{return!i(e,n,!1,!1)&&i(e,n,!0,!1)}})});return t},a=e=>{let n=Object.freeze({anywhere:()=>{return i(e,null,!1,!0)||i(e,null,!0,!0)},current:()=>{return i(e,null,!1,!0)},inherited:()=>{return i(e,null,!0,!0)},only:Object.freeze({current:()=>{return i(e,null,!1,!0)&&!i(e,null,!0,!0)},inherited:()=>{return!i(e,null,!1,!0)&&i(e,null,!0,!0)}})});return n},f=e=>{let t=Object.freeze({current:()=>{return n[r].members[e].slice()},inherited:()=>{let t=[],i=null,o=n.previous();for(;!0&&null!==o;)i=v(o[r].members,"name",e),i&&t.push(...i),o=o.previous();return t},anywhere:()=>{return[...t.current(),...t.inherited()]}});return t},u=()=>{let e=Object.freeze({current:()=>{return t[r].type.slice()},inherited:()=>{let e=[],n=null,i=t.previous();for(;!0&&null!==i;)n=i[r].type.slice(),n&&e.push(...n),i=i.previous();return e},anywhere:()=>{return[...e.current(),...e.inherited()]}});return e},c={type:Object.freeze({get:(e,n)=>{return i(e,null,n,!0)},has:(e,n)=>{return o(e,null,n,!0)},all:u,probe:a}),members:{get:(e,n,t)=>{return i(e,n,t,!1)},has:(e,n,t)=>{return o(e,n,t,!1)},all:f,probe:s}};return e&&(c.members.is=((e,n)=>{let t=s(e,n);switch(e){case"static":return t.anywhere();case"abstract":return t.anywhere()&&!(s.anywhere("virtual",n)||s.anywhere("override",n));case"virtual":return t.anywhere()&&!s.anywhere("override",n);case"override":return t.anywhere()&&!s.anywhere("sealed",n);case"sealed":return t.anywhere();case"private":return t.anywhere();case"protected":return t.anywhere();case"readonly":return t.anywhere();case"async":return t.anywhere()}}),c.members.type=(e=>{let t="type"===n.level,r="";if(!t){let t=n;for(;!0&&null!==t&&!(r=t.members[e]);)t=t.previous()}return r}),c.members.isProperty=(e=>{return"prop"===c.members.type(e)}),c.members.isFunction=(e=>{return"func"===c.members.type(e)}),c.members.isEvent=(e=>{return"event"===c.members.type(e)})),c.members=Object.freeze(c.members),Object.freeze(c)},le=(e,n,t,r,i,...o)=>{let s="___flag___",f={_flagName:s};if("undefined"!=typeof r&&r===s?(f.isNeedProtected=!0,f.isTopLevelInstance=!1,f.staticInterface=i,f.args=o):(f.isNeedProtected=!1,f.isTopLevelInstance=!0,f.staticInterface=n,"undefined"!=typeof r?"undefined"!=typeof i?f.args=[r,i].concat(o):f.args=[r]:f.args=[]),e.singleton&&f.isTopLevelInstance&&n._.singleInstance())return n._.singleInstance();let u={},c=null,d=null,y="_construct",b="_dispose",v={},x=null,A={name:e.params.typeName,type:e.types.type,Type:n,level:"object",members:{},attrs:{members:{}},modifiers:{members:{}},previous:()=>{return x}},O=null,k=()=>{throw new p("NotImplemented","Method is not implemented.")},j={get:()=>{throw new p("NotImplemented","Property is not implemented.")},set:()=>{throw new p("NotImplemented","Property is not implemented.")}},S=!1,T=null,N=h("sessionStorage"),P=h("localStorage");e.dump.push(A);const M=(e,n,t,r)=>{for(let i of J.members.all(n).current())if(i.isCustom){if("prop"===t){let t=i.attr.decorateProperty(A.name,n,r);if(!t.get||!t.set)throw new p("Unexpected",`${i.name} decoration result is unexpected. (${n})`);t.get=t.get.bind(e),t.set=t.set.bind(e),r=t}else{let o=null;if(o="func"===t?i.attr.decorateFunction(A.name,n,r):i.attr.decorateEvent(A.name,n,r),!o)throw new p("Unexpected",`${i.name} decoration result is unexpected. (${n})`);r=o.bind(e)}i.attr=null}return r},U=(e,n)=>{let t=null,r=[];return r=Pe(A.name,e),A.aspects.members[e]=r,r.length>0&&(t=Me(n,A.name,e,r),t&&(n=t)),n},z=()=>{let n=!1,r=e=>{Object.defineProperty(u,e,Object.getOwnPropertyDescriptor(t,e))},i=Object.getOwnPropertyDescriptor(u,"_");i.enumerable=!1,Object.defineProperty(u,"_",i);for(let o in t)if(n=!1,t.hasOwnProperty(o)&&"_"!==o){if(n=!0,A.members[o]?(B.members.probe("private",o).current()&&(n=!1),n&&B.members.probe("protected",o).current()&&!f.isNeedProtected&&(n=!1)):B.members.probe("protected",o).anywhere()&&!f.isNeedProtected&&(n=!1),n&&r(o),n&&B.members.is("abstract",o))throw new p("InvalidDefinition",`Abstract member is not implemented. (${o})`);if(n){let e=J.members.probe("enumerate",o).current();if(e&&e.args[0]===!1){let e=Object.getOwnPropertyDescriptor(u,o);e.enumerable=!1,Object.defineProperty(u,o,e)}}n&&!f.isNeedProtected&&"function"==typeof t[o].subscribe&&u[o].strip(u)}f.isTopLevelInstance&&(u=I(u,e.ex.instance,!1)),f.isTopLevelInstance||(u._.def=A)},$=()=>{for(let e of A.interfaces)d=e,e.apply(O),d=null;delete A.interfaces},D=(n,t,r)=>{switch(["func","prop","event"].indexOf(t)!==-1&&n.startsWith("_")&&new p("InvalidName",`Name is not valid. (${n})`),t){case"func":if(!e.func)throw new p("InvalidOperation",`Function cannot be defined on this type. (${A.name})`);break;case"prop":if(!e.prop)throw new p("InvalidOperation",`Property cannot be defined on this type. (${A.name})`);break;case"event":if(!e.event)throw new p("InvalidOperation",`Event cannot be defined on this type. (${A.name})`);break;case"construct":if(!e.construct)throw new p("InvalidOperation",`Constructor cannot be defined on this type. (${A.name})`);t="func";break;case"dispose":if(!e.dispose)throw new p("InvalidOperation",`Dispose cannot be defined on this type. (${A.name})`);
t="func"}return t},C=(n,r,i)=>{let o=!0,s=J.members.probe("conditional",n).current();if(s){let e=_(s.args[0]||[]);for(let n of e){if(n=n.toLowerCase(),"test"!==n||!a.env.isTesting){o=!1;break}if("server"!==n||!a.env.isServer){o=!1;break}if("client"!==n||!a.env.isClient){o=!1;break}if("worker"!==n||!a.env.isWorker){o=!1;break}if("main"!==n||!a.env.isMain){o=!1;break}if("debug"!==n||!a.env.isDebug){o=!1;break}if("prod"!==n||!a.env.isProd){o=!1;break}if("cordova"!==n||!a.env.isCordova){o=!1;break}if("nodewebkit"!==n||!a.env.isNodeWebkit){o=!1;break}if(a.symbols.indexOf(n)===-1){o=!1;break}}if(!o)return o}if(e.inheritance&&J.members.probe("abstract",n).current()&&(i!==l||i!==k||i!==j)&&i.get&&i.get!==l)throw new p("InvalidDefinition",`Abstract member must point to this.noop, this.nip or this.nim calls. (${n})`);if(e.static&&e.construct&&n===y&&0!==i.length)throw new p("InvalidDefinition",`Static constructors cannot have arguments. (construct)`);if(e.dispose&&n===b&&0!==i.length)throw new p("InvalidDefinition",`Destructor method cannot have arguments. (dispose)`);if(null===c&&"undefined"!=typeof t[n]&&!J.members.probe("mixin",n).current()&&(!e.inheritance||e.inheritance&&!J.members.probe("override",n).current()))throw new p("InvalidOperation",`Member with this name is already defined. (${n})`);if(e.inheritance&&J.members.probe("override",n).current()){if("undefined"==typeof t[n])throw new p("InvalidOperation",`Member not found to override. (${n})`);if(B.members.type(n)!==r)throw new p("InvalidOperation",`Overriding member type is invalid. (${n})`)}if(e.static&&J.members.probe("static",n).current())if("func"===r){if(w(i))throw new p("InvalidOperation",`Static functions cannot be defined as an arrow function. (${n})`)}else if("prop"===r&&i.get&&"function"==typeof i.get)throw new p("InvalidOperation",`Static properties cannot be defined with a custom getter/setter. (${n})`);if(e.storage&&J.members.probe("session",n).current()&&i.get&&"function"==typeof i.get)throw new p("InvalidOperation",`Session properties cannot be defined with a custom getter/setter. (${n})`);if(e.storage&&J.members.probe("state",n).current()){if(i.get&&"function"==typeof i.get)throw new p("InvalidOperation",`State properties cannot be defined with a custom getter/setter. (${n})`);if(!P)throw new p("NotConfigured","Port is not configured. (localStorage)")}return o},E=(n,r,i)=>{let o={get:null,set:null},s=l,a=l,u=J.members.probe("readonly",n).anywhere(),c=J.members.probe("static",n).anywhere(),m=J.members.probe("session",n).anywhere(),d=J.members.probe("state",n).anywhere(),h=J.members.probe("deprecate",n).current(),g=J.members.probe("inject",n).current(),y=J.members.probe("type",n).current(),w=null!==h,b=w?h.args[0]||`Event is marked as deprecate. (${n})`:"",_=v,x=t,I=A.name+"_"+n,O=!1,k=[];if(i.get||i.set)i.get&&"function"==typeof i.get&&(s=i.get),i.set&&"function"==typeof i.set&&(a=i.set),o.get=function(){return w&&console.log(b),s.apply(x)}.bind(x),o.set=function(e){if(w&&console.log(b),u&&!t._.constructing)throw new p("InvalidOperation",`Property is readonly. (${n})`);if(y&&y.args[0]&&!Q(e,y.args[0]))throw new p("InvalidArgument","Argument type is invalid. (value)");return a.apply(x,[e])}.bind(x);else{if(e.static&&c){if(_=f.staticInterface._.props,x=f.staticInterface,y&&y.args[0]&&!Q(i,y.args[0]))throw new p("InvalidArgument","Argument type is invalid. (value)");_[I]=i}else if(e.storage&&(m||d)){if(_=m?N:P,O=!0,I=t._.id+"_"+I,L(m?"session":"state",I),!_.key(I)){if(y&&y.args[0]&&!Q(i,y.args[0]))throw new p("InvalidArgument","Argument type is invalid. (value)");_.setItem(I,JSON.stringify({value:i}))}}else{if(y&&y.args[0]&&!Q(i,y.args[0]))throw new p("InvalidArgument","Argument type is invalid. (value)");_[I]=i}o.get=function(){return w&&console.log(b),O?JSON.parse(_.getItem(I)).value:_[I]}.bind(x),o.set=function(e){if(w&&console.log(b),u&&!c&&!t._.constructing)throw new p("InvalidOperation",`Property is readonly. (${n})`);if(y&&y.args[0]&&!Q(e,y.args[0]))throw new p("InvalidArgument","Argument type is invalid. (value)");O?_.setItem(I,JSON.stringify({value:e})):_[I]=e}.bind(x)}if(g&&!c&&!O){let e=g.args[0],n=g.args.length>0?g.args[1]:[],t=g.args.length>1&&g.args[2];k=Ie.resolve(e,n,t),Array.isArray(k)||(k=[k]),o.set(k)}return(J.members.probe("dispose",n).anywhere()||g)&&L("prop",n),e.customAttrs&&(o=M(x,n,r,o)),o},q=(n,r,i)=>{let o=null,s=t,a=e.inheritance&&J.members.probe("override",n).current(),u=e.static&&J.members.probe("static",n).current(),c=B.members.probe("async",n).current(),l=J.members.probe("deprecate",n).current(),p=J.members.probe("inject",n).current(),m=J.members.probe("on",n).current(),d=J.members.probe("timer",n).current(),h=J.members.probe("args",n).current(),g=null!==l,y=g?l.args[0]||`Function is marked as deprecate. (${n})`:"",w=null,b=[];if(a?w=t[n].bind(s):u&&(s=f.staticInterface),p){let e=p.args[0],n=p.args.length>0?p.args[1]:[],t=p.args.length>1&&p.args[2];b=Ie.resolve(e,n,t),Array.isArray(b)||(b=[b])}if(o=c?function(...e){return new Promise(function(n,t){g&&console.log(y);let r=[];if(w&&r.push(w),b.length>0&&r.push(b),r.push(n),r.push(t),h&&e.attr.args.length>0){let n=oe(...e.attr.args)(...e);if(n.isInvalid)throw n.error;r.push(n)}else r.concat(e);return i.apply(s,r)}.bind(s))}.bind(s):function(...e){g&&console.log(y);let n=[];if(w&&n.push(w),b.length>0&&n.push(b),h&&e.attr.args.length>0){let t=oe(...e.attr.args)(...e);if(t.isInvalid)throw t.error;n.push(t)}else n.concat(e);return i.apply(s,n)}.bind(s),e.customAttrs&&(o=M(s,n,r,o)),e.aop&&(o=U(n,o)),m&&m.args.length>0&&(_e(m.args[0],o),L("handler",{name:m.args[0],handler:o})),d&&d.args.length>0){let e=!1,r=setInterval(()=>{t._.constructing||e||(e=!0,t[n](),e=!1)},1e3*d.args[0]);L("timer",r)}return o},F=(n,r,i)=>{let o=null,s=null,a=null,f=null,u=e.inheritance&&J.members.probe("override",n).current(),c=J.members.probe("deprecate",n).current(),l=J.members.probe("post",n).current(),p=null!==c,d=p?c.args[0]||`Event is marked as deprecate. (${n})`:"",h=t;return T||(T=new m,L("event",T)),u&&(a=t[n]._.processor),o=function(...e){return p&&console.log(d),f=a?[a].concat(e):e,i.apply(h,f)}.bind(h),e.customAttrs&&(o=M(h,n,r,o)),s=o,o=function(...e){let n=e;"function"==typeof s&&(n=s(...e)),T.dispatch(name,n),l&&l.args.length>0&&xe(l.args[0],n)}.bind(h),o._=Object.freeze({processor:s}),o.add=(e=>{T.add(name,e)}),o.remove=(e=>{T.remove(name,e)}),o.strip=(e=>{let n=Object.freeze(I({},o,!0,["strip"]));return delete o.strip,delete e.strip,n}),o},W=(r,i,o)=>{if(i=D(r,i,o),A.members[r]=i,A.attrs.members[r]=[],A.modifiers.members[r]=[],e.aop&&(A.aspects={members:{}}),e.mixins&&null!==c&&fe("mixin",c._.name),ue(A,n._.def(),r,!1),C(r,i,o)){let n=null,s=e.static&&J.members.probe("static",r).current(),a=s?f.staticInterface:t;switch(i){case"func":n=q(r,i,o),Object.defineProperty(a,r,{configurable:!0,enumerable:!0,value:n});break;case"prop":n=E(r,i,o),Object.defineProperty(a,r,{configurable:!0,enumerable:!0,get:n.get,set:n.set});break;case"event":n=F(r,i,o),Object.defineProperty(t,r,{configurable:!0,enumerable:!0,value:n})}A.members[r]=n}},R=(e,t)=>{if("undefined"==typeof u[e]||B.members.type(e)!==t)throw new p("NotImplemented",`Interface member is not implemented. (${e})`);fe("interface",d._.name),ue(A,n._.def(),e,!1)},L=(e,n)=>{t._.disposables.push({type:e,data:n})},B=ce(!0,A,n._.def()),J=ce(!1,A,n._.def());if(e.inheritance){if(f.isTopLevelInstance&&B.type.probe("abstract").current())throw new p("InvalidOperation",`Cannot create instance of an abstract type. (${A.name})`);let e=n._.inherits;if(e){if(e._.isSealed()||e._.isSingleton()||e._.isStatic())throw new p("InvalidOperation",`Cannot inherit from a sealed, static or singleton type. (${e._.name})`);if(e._.type!==n._.type)throw new p("InvalidOperation",`Cannot inherit from another type family. (${e._.type})`);if(e._.context&&e._.context.isUnloaded())throw new p("InvalidOperation",`Parent context is not active anymore. (${e._.name})`);t=new e(f._flagName,f.staticInterface,f.args),x=t._.def,delete t._.def}else if(n._.context&&n._.context.isUnloaded())throw new p("InvalidOperation",`Type context is not active anymore. (${n._.name})`)}if("undefined"==typeof t._&&(t._=I({},e.mex.instance,!1),e.mixins&&(A.mixins=e.params.mixins),e.interfaces&&(A.interfaces=e.params.interfaces),e.dispose&&(t._.disposables=[])),t._.id=t._.id||g(),t._.type=e.types.instance,f.isTopLevelInstance&&(t._.Type=n,t._.isInstanceOf=(e=>{if(e._&&e._.name&&(e=e._.name),!e)throw new p("InvalidArgument","Argument type is invalid. (name)");return t._.Type._.name===e||n._.isDerivedFrom(e)}),e.mixins&&(t._.isMixed=(e=>{return t._.Type._.isMixed(e)})),e.interfaces&&(t._.isImplements=(e=>{return t._.Type._.isImplements(e)})),t._.modifiers=B,t._.attrs=J),S=!0,O=new Proxy({},{get:(e,n)=>{if("noop"===n)return l;if("nim"===n)return k;if("nip"===n)return j;if("event"===n){let e=e=>{if("function"!=typeof e)throw new p.InvalidArgument("fn");return e.event=!0,e};return e}return t[n]},set:(e,n,r)=>{if(S){let e="";"construct"===n?e="construct":"dispose"===n?e="dispose":"function"==typeof r?r.event===!0?(delete r.event,e="event"):e="func":e="prop",d?R(n,e,r):W(n,e,r)}else{if("function"==typeof r||["noop","event","nim","nip"].indexOf(n)!==-1)throw new p("InvalidOperation",`Redefinition of members is not allowed. (${n})`);t[n]=r}return!0}}),e.mixins){for(let e of A.mixins)c=e,e.apply(O),c=null;delete A.mixins}if(f.factory.apply(O),fe.clear(),f.isTopLevelInstance&&(e.construct&&"function"==typeof t[y]&&(t._.construct=t[y],delete t[y]),e.dispose&&"function"==typeof t[b])){let e=t[b];delete t[b],t._.dispose=(()=>{for(let n of t._.disposables)switch(n.type){case"session":N.removeItem(n.data);break;case"state":P.removeItem(n.data);break;case"prop":t[n.data]=null;break;case"event":t[n.data].clear();break;case"handler":_e(n.data.name,n.data.handler,!0);break;case"timer":clearInterval(n.data)}"function"==typeof e&&e(),t._.disposables.length=0,t._.Type=null,t._.modifiers=null,t._.attrs=null,t._=null,v=null,x=null,A=null,O=null,T=null,u=null,t=null})}return z(),e.interfaces&&$(),e.construct&&f.isTopLevelInstance&&"function"==typeof u._[y]&&(u._.constructing=!0,u._[y](...f.args),delete u._.constructing),f.isTopLevelInstance&&e.singleton&&J.type.probe("singleton").current()&&(n._.singleInstance=(()=>{return u}),n._.singleInstance.clear=(()=>{n._.singleInstance=(()=>{return null})})),f.isTopLevelInstance&&(u._=Object.freeze(u._),u=Object.seal(u)),S=!1,u},pe=e=>{if(e.new=e.new||!1,e.mixins=e.mixins||!1,e.interfaces=e.interfaces||!1,e.inheritance=e.inheritance||!1,e.singleton=e.singleton||!1,e.static=e.static||!1,e.func=e.func||!1,e.construct=e.construct||!1,e.dispose=e.dispose||!1,e.prop=e.prop||!1,e.storage=e.storage||!1,e.event=e.event||!1,e.aop=e.aop||!1,e.customAttrs=e.customAttrs||!1,e.types.instance=e.types.instance||"unknown",e.types.type=e.types.type||"unknown",e.mex.instance=e.mex&&e.mex.instance?e.mex.instance:{},e.mex.type=e.mex&&e.mex.type?e.mex.type:{},e.ex.instance=e.ex&&e.ex.instance?e.ex.instance:{},e.ex.type=e.ex&&e.ex.type?e.ex.type:{},e.params.typeName=e.params.typeName||"",e.params.ns="",e.params.inherits=e.params.inherits||null,e.params.mixins=[],e.params.interfaces=[],e.params.factory=e.params.factory||null,e.func||(e.construct=!1,e.dispose=!1),e.prop||(e.storage=!1),e.inheritance||(e.singleton=!1),e.func||e.prop||e.event||(e.aop=!1,e.customAttrs=!1),!e.params.typeName||e.params.typeName.indexOf(".")!==-1)throw`Type name is invalid. (${e.params.typeName})`;let n=fe.get("ns"),t=n?n.args[0]:"";switch(t){case"(auto)":throw`Namespace '(auto)' should be used only when bundling the type in an assembly. (${t})`;case"(root)":break;default:if(t.startsWith(".")||t.endsWith(".")||/[~`!#$%\^&*+=\-\[\]\\';,\/{}|\\":<>\?]/g.test(t))throw`Namespace name is invalid. (${t})`;e.params.typeName=t+"."+e.params.typeName,e.params.ns=t}if(e.params.mixinsAndInterfaces)for(let r of e.params.mixinsAndInterfaces)if(r._&&r._.type)switch(r._.type){case"mixin":e.params.mixins.push(r);break;case"interface":e.params.interfaces.push(r)}delete e.params.mixinsAndInterfaces;let i={};e.ex.instance=I(e.ex.instance,i,!1),e.dump=[];let o=F.context.current(),s=o.currentAssemblyBeingLoaded()||"",a=null;a=e.new?function(n,t,...r){return le(e,a,{},n,t,...r)}:e.params.factory,a=I(a,e.ex.type,!1);let f={name:e.params.typeName,type:e.types.type,Type:a,level:"type",members:{},attrs:{type:[]},modifiers:{type:[]},previous:()=>{return a._.inherits?a._.inherits._.def():null}};const u=ce(!0,null,f),c=ce(!1,null,f);if(a._=I({},e.mex.type,!0),a._.name=e.params.typeName,a._.type=e.types.type,a._.id=g(),a._.namespace=null,a._.assembly=(()=>{return o.getAssembly(s)||null}),a._.context=o,a._.inherits=null,e.inheritance&&(a._.inherits=e.params.inherits||null,a._.isAbstract=(()=>{return!!u.type.probe("abstract").current()}),a._.isSealed=(()=>{return!!u.type.probe("sealed").current()}),a._.isDerivedFrom=(n=>{if(n._&&n._.name&&(n=n._.name),"string"!=typeof n)throw new p("InvalidArgument","Argument type is invalid. (name)");let t=!1,r=e.params.inherits;if(!t)for(;!0&&null!==r;){if(r._.name===n){t=!0;break}r=r._.inherits}return t}),a._.inherits)){let e=c.type.probe("deprecate").anywhere();if(e){let n=e.args[0]||`Type is marked as deprecated. (${a._.name})`;console.log(n)}}return e.static&&(a._.isStatic=(()=>{return!!u.type.probe("static").current()}),a._.props={}),e.singleton&&(a._.isSingleton=(()=>{return!!c.type.probe("singleton").current()}),a._.singleInstance=(()=>{return null}),a._.singleInstance.clear=l),e.mixins&&(a._.mixins=e.params.mixins,a._.isMixed=(e=>{if(e._&&e._.name&&(e=e._.name),"string"!=typeof e)throw new p("InvalidArgument","Argument type is invalid. (name)");let n=!1,t=a;for(;!0&&null!==t&&!(n=v(t._.mixins,"name",e)!==-1);)t=t._.inherits;return n})),e.interfaces&&(a._.interfaces=e.params.interfaces,a._.isImplements=(e=>{if(e._&&e._.name&&(e=e._.name),"string"!=typeof e)throw new p("InvalidArgument","Argument type is invalid. (name)");let n=!1,t=a;for(;!0&&null!==t&&!(n=v(t._.interfaces,"name",e)!==-1);)t=t._.inherits;return n})),a._.isDeprecated=(()=>{return!!c.type.probe("deprecate").current()}),a._.def=(()=>{return f}),a._.modifiers=u,a._.attrs=c,ue(null,f,null,!0),t&&(a._.namespace=F.context.current().registerType(a)),a._=Object.freeze(a._),a._.isStatic()?new a:Object.freeze(a)},me=()=>{let n=h("sessionStorage");n?n.clear():e?(!0).sessionStorage&&delete(!0).sessionStorage:sessionStorage.clear()},de=(e,n,t,r)=>{let i=oe("name: string, factory: function","name: string, inherits: class, factory: function","name: string, mixints: array, factory: function","name: string, inherits: class, mixints: array, factory: function")(e,n,t,r);if(i.isInvalid)throw i.error;let o={new:!0,mixins:!0,interfaces:!0,inheritance:!0,singleton:!0,static:!0,func:!0,construct:!0,dispose:!0,prop:!0,event:!0,storage:!0,aop:!0,customAttrs:!0,types:{instance:"instance",type:"class"},params:{typeName:i.values.name,inherits:i.values.inherits,mixinsAndInterfaces:i.values.mixints,factory:i.values.factory},mex:{instance:{},type:{}},ex:{instance:{},type:{}}};return pe(o)};c("Class",de);const he=(e,n)=>{let t=oe("name: string, factory: function")(e,n);if(t.isInvalid)throw t.error;let r={func:!0,prop:!0,event:!0,types:{type:"interface"},params:{typeName:t.values.name,factory:t.values.factory}};return pe(r)};c("Interface",he);const ge=(e,n,t)=>{let r=oe("name: string, factory: function","name: string, mixints: array, factory: function")(e,n,t);if(r.isInvalid)throw r.error;let i={new:!0,mixins:!0,interfaces:!0,static:!0,func:!0,construct:!0,prop:!0,event:!0,customAttrs:!0,types:{instance:"sinstance",type:"struct"},params:{typeName:r.values.name,mixinsAndInterfaces:r.values.mixints,factory:r.values.factory}};return pe(i)};c("Struct",ge);const ye=(e,n)=>{let t=oe("name: string, factory: function")(e,n);if(t.isInvalid)throw t.error;let r={prop:!0,types:{type:"enum"},params:{typeName:t.values.name,factory:t.values.factory}};return pe(r)};c("Enum",ye);const we=(e,n)=>{let t=oe("name: string, factory: function")(e,n);if(t.isInvalid)throw t.error;let r={func:!0,prop:!0,event:!0,customAttrs:!0,types:{type:"mixin"},params:{typeName:t.values.name,factory:t.values.factory}};return pe(r)};c("Mixin",we);const be=new m,ve=be.dispatch,_e=(e,n,t)=>{return t?void be.remove(e,n):void be.add(e,n)};c("on",_e,()=>{be.clear()});const xe=(e,n)=>{ve(e,n)};c("post",xe);let Ae={};const Ie={isRegistered:e=>{if("string"!=typeof e)throw new p("InvalidArgument","Argument type is invalid. (alias)");return"undefined"!=typeof Ae[e]&&Ae[e].length>0},get:(e,n)=>{if("string"!=typeof e)throw new p("InvalidArgument","Argument type is invalid. (alias)");if("boolean"!=typeof n)throw new p("InvalidArgument","Argument type is invalid. (isAll)");return n?Ae[e]?Ae[e].slice():[]:Ae[e]?Ae[e][0]:null},register:(e,n)=>{if("string"!=typeof e)throw new p("InvalidArgument","Argument type is invalid. (alias)");if(e.indexOf(".")!==-1)throw new p("InvalidArgument","Argument type is invalid. (alias)");if(!n)throw new p("InvalidArgument","Argument type is invalid. (item)");"string"==typeof n&&(n=y(n),(n.endsWith(".js")||n.endsWith(".mjs"))&&(n=y(n,!0))),Ae[e]||(Ae[e]=[]),Ae[e].push(n)},resolve:(e,n,...t)=>{if("string"!=typeof e)throw new p("InvalidArgument","Argument type is invalid. (alias)");if("boolean"!=typeof n)throw new p("InvalidArgument","Argument type is invalid. (isAll)");let r=null;const i=e=>{let n=e;if("string"==typeof e)if(e.endsWith(".js")||e.endsWith(".mjs"));else{let n=J(e);n&&(e=n)}return["class","struct"].indexOf(V(e))!==-1&&(n=t?new e(...t):new e),n};return Ae[e]&&Ae[e].length>0&&(n?(r=[],Ae[e].forEach(e=>{r.push(i(e))})):r=i(Ae[e][0])),r}};c("Container",Ie,()=>{Ae={}});let Oe=l,ke=[],je=500;const Se={on:(e,...n)=>{Oe===l&&("string"==typeof e?n.unshift(e):"function"==typeof e&&_e("telemetry",e),Oe=((e,t)=>{if(0===n.length||n.indexOf(e)!==-1){let n=Object.freeze({type:e,data:t});ke.push(n),ke.length>je-25&&ke.splice(0,25),xe("telemetry",n)}}))},collect:()=>{if(Oe!==l){let e=ke.slice();return ke.length=0,e}return[]},off:e=>{return Oe!==l?("function"==typeof e&&_e("telemetry",e,!0),Oe=l,Se.collect()):[]},isOn:()=>{return Oe!==l},types:Object.freeze({RAW:"raw",EXEC:"exec",INFO:"info",INCL:"incl"})};c("telemetry",Se,()=>{ke.length=0});const Te=[],Ne={register:(e,n)=>{if("string"!=typeof e)throw new p.InvalidArgument("pointcut");if(!Q(n,"Aspect"))throw new p.InvalidArgument("Aspect");let t=e,r="",i="",o="",s="",a=null;t.indexOf(":")!==-1&&(a=t.split(":"),t=a[0].trim(),o=a[1].trim()||"*"),t.indexOf(".")!==-1?(r=t.substr(0,t.lastIndexOf(".")),i=t.substr(t.lastIndexOf(".")+1)):(r="",i=t),s=r+"/"+i+":"+o,s=A(s,".","[.]"),s=A(s,"?","."),s=A(s,"*",".*"),Te.push({rex:new RegExp(s),Aspect:n})}},Pe=(e,n)=>{let t=[],r="",i="",o=n.trim(),s="";return e.indexOf(".")!==-1?(r=e.substr(0,e.lastIndexOf(".")).trim(),i=e.substr(e.lastIndexOf(".")+1).trim()):(r="",i=e.trim()),s=r+"/"+i+":"+o,Te.forEach(e=>{e.rex.test(s)&&t.indexOf(e.Aspect)===-1&&t.push(e.Aspect)}),t},Me=(e,n,t,r)=>{let i=[],o=[],s=[],a=null;for(let f of r)a=new f,a.before!==l&&i.push(a.before),a.around!==l&&s.push(a.around),a.after!==l&&o.push(a.after);s.length>0&&s.reverse();let u=function(...r){let a=null,f=null,u={typeName:()=>{return n},funcName:()=>{return t},error:e=>{return e&&(a=e),a},result:e=>{return"undefined"!=typeof e&&(f=e),f},args:()=>{return r},data:{}};for(let c of i)try{c(u)}catch(e){a=e}const l=e=>{for(let n of o)try{n(e)}catch(e){u.error(e)}};let p=e,m=null;for(let d of s)p=d(u,p);try{m=p(...r),m&&"function"==typeof m.then?u.result(new Promise((e,n)=>{m.then(n=>{u.result(n),l(u),e(u.result())}).catch(e=>{u.error(e),l(u),n(u.error())})})):(u.result(m),l(u))}catch(e){u.error(e)}return u.result()};return u};c("Aspects",Ne,()=>{Te.length=0});const Ue=(e,n)=>{let t=null,r=null,i=n?JSON.parse(e):e,o=n?null:e._.Type;const s=(e,n)=>{let t=e._.attrs,r=e._.modifiers,i=[],o=!1;for(let s in e)e.hasOwnProperty(s)&&"_"!==s&&(o=r.members.isProperty(s),o&&(o=n?!t.members.probe("noserialize",s).anywhere():t.members.probe("serialize",s).anywhere(),o&&(o=!(r.members.is("private",s)||r.members.is("protected",s)||r.members.is("static",s)||r.members.is("readonly",s)||t.members.probe("inject",s).anywhere()))),o&&i.push(s));return i};if(n){if(!i.type&&!i.data)throw p.InvalidArgument("json");if(o=J(i.type),!o)throw new p("NotRegistered",`Type is not registered. (${i.type})`);t=new o,r=o._.attrs.type.probe("serialize").anywhere()?s(t,!0):s(t,!1);for(let e of r)t[e]=i.data[e]}else{r=o._.attrs.type.probe("serialize").anywhere()?s(i,!0):s(i,!1),t={type:i._.Type._.name,data:{}};for(let e of r)t.data[e]=i[e];t=JSON.stringify(t)}return t},ze={serialize:e=>{if(!(e&&e._&&e._.type)||["instance","sinstance"].indexOf(e._.type)===-1)throw p.InvalidArgument("instance");return Ue(e)},deserialize:e=>{if(!e||"string"!=typeof e)throw p.InvalidArgument("json");return Ue(e,!0)}};c("Serializer",ze);const $e=function(e){if(!e||!e._||!e._.type)throw new p.InvalidArgument("forTarget");const n=function(e){this.getType=(()=>{return e._.type}),this.getId=(()=>{return e._.id}),this.getName=(()=>{return e._.name||""}),this.getNamespace=(()=>{return e._.namespace}),this.getAssembly=(()=>{let n=n.get(e._.name);return null}),this.getTarget=(()=>{return e}),this.isInstance=(()=>{return"instance"===e._.type}),this.isClass=(()=>{return"class"===e._.type}),this.isEnum=(()=>{return"enum"===e._.type}),this.isStruct=(()=>{return"struct"===e._.type}),this.isStructInstance=(()=>{return"sinstance"===e._.type}),this.isMixin=(()=>{return"mixin"===e._.type}),this.isInterface=(()=>{return"interface"===e._.type}),this.getModifiers=(()=>{return e._.modifiers.type}),this.getAttributes=(()=>{return e._.attrs.type})},t=function(e,n,t){this.getType=(()=>{return"member"}),this.getMemberType=(()=>{return e}),this.getTarget=(()=>{return n}),this.getTargetType=(()=>{return n._.type}),this.getName=(()=>{return t}),this.getModifiers=(()=>{return n._.modifiers.members}),this.getAttributes=(()=>{return n._.attrs.members})},r=function(e,n,t,r){this.getType=(()=>{return"attribute"}),this.getName=(()=>{return n}),this.getTarget=(()=>{return r}),this.getArgs=(()=>{return t.slice()}),this.getClass=(()=>{return e?new m(e):null})},i=function(e,n){this.getType=(()=>{return"aspect"}),this.getName=(()=>{return e._.name}),this.getTarget=(()=>{return n}),this.getClass=(()=>{return e?new m(e):null})},o=function(e,n,i,o){let s=new t(e,n,i);return s.getRef=(()=>{return o}),s.getAttributes=(()=>{let e=[],t=[];for(let o of n._.instanceOf)if(o.meta[i]){t=o.meta[i];for(let s of t)e.push(new r(s.Attr,s.name,s.args,n))}return e}),s.hasAttribute=(e=>{let t=!1,r=[];for(let o of n._.instanceOf){if(o.meta[i]){r=o.meta[i];for(let n of r)if(n.name==e){t=!0;break}}if(t)break}return t}),s.getAttribute=(e=>{let t=null;for(let o of n._.instanceOf){if(o.meta[i]){let s=o.meta[i];for(let a of s)if(a.name===e){t=new r(a.Attr,a.name,a.args,n);break}}if(null!==t)break}return t}),s.isEnumerable=(()=>{return!!n[i]&&Object.getOwnPropertyDescriptor(n,i).enumerable}),s.isDeprecated=(()=>{return n._._.hasAttrEx("deprecate",i)}),s.isConditional=(()=>{return n._._.hasAttrEx("conditional",i)}),s.isOverridden=(()=>{return n._._.hasAttrEx("override",i)}),s.isOwn=(()=>{return n._.isOwnMember(i)}),s.isDerived=(()=>{return n._._.isDerivedMember(i)}),s.isPrivate=(()=>{return n._._.hasAttrEx("private",i)}),s.isProtected=(()=>{return n._._.isProtectedMember(i)}),s.isPublic=(()=>{return!s.isPrivate&&!s.isProtected}),s.isSealed=(()=>{return n._._.isSealedMember(i)}),s.isMixed=(()=>{return n._._.hasAttrEx("mixed",i)}),s.getMixin=(()=>{if(s.isMixed()){let e=s.getAttribute("mixed").getArgs()[0];return new g(e)}return null}),s.isInterfaceEnforced=(()=>{return s.getInterfaces().length>0}),s.getInterfaces=(()=>{let e=[],t=[];for(let r of n._.instanceOf)if(r.meta[i]){t=r.meta[i].interfaces;for(let o of t)e.push(new y(o,n))}return e}),s.isProp=(()=>{return"prop"===e}),s.isFunc=(()=>{return"func"===e}),s.isEvent=(()=>{return"event"===e}),s},s=function(e,n,t){let r=new o("prop",e,n,t);return r.getValue=(()=>{return e[n]}),r.setValue=(t=>{return e[n]=t}),r.getRaw=(()=>{return t}),r.isReadOnly=(()=>{return e._._.hasAttrEx("readonly",n)}),r.isSetOnce=(()=>{return e._._.hasAttrEx("readonly",n)&&e._._.hasAttrEx("once",n)}),r.isStatic=(()=>{return e._._.hasAttrEx("static",n)}),r.isSerializable=(()=>{return e._._.isSerializableMember(n)}),r},a=function(e,n,t,r){let s=new o("func",e,n,t);return s.invoke=((...t)=>{return e[n](...t)}),s.getAspects=(()=>{let t=[],r=[];for(let o of e._.instanceOf)if(o.meta[n]){r=o.meta[n].aspects;for(let s of r)t.push(new i(s,e))}return t}),s.getRaw=(()=>{return r}),s.isASync=(()=>{return e._._.hasAttrEx("async",n)}),s.isConstructor=(()=>{return"_constructor"===n}),s.isDisposer=(()=>{return"_dispose"===n}),s},f=function(e,n,t){let r=new o("event",e,n,t);return r.raise=((...e)=>{return t(...e)}),r.isSubscribed=(()=>{return t.subscribe.all().length>0}),r},u=function(e,n){let r=new t("key",e,n);return r.getValue=(()=>{return e[n]}),r},c=function(e){let t=new n(e),r=(e,n,t)=>{if(""===n&&0===t.length)return e.slice();let r=[],i=!0;for(let o of e)if("member"===o.getType()&&(""===n||o.getMemberType()===n)){if(i=!0,0!==t.length)for(let e of t)if(!o.hasAttribute(e)){i=!1;break}i&&r.push(o)}return r},i=n=>{let t=[],i=[],o=null,u=null;for(let c of e._.instanceOf){for(let r in c.meta){if(c.meta.hasOwnProperty(r)){switch(i=c.meta[r],c.meta[r].type){case"func":o=new a(e,r,c.meta[r].ref,c.meta[r].raw),t.push(o);break;case"prop":o=new s(e,r,c.meta[r].ref),t.push(o);break;case"event":o=new f(e,r,c.meta[r].argNames,c.meta[r].ref),t.push(o);break;default:throw"Unknown member type"}"undefined"!=typeof n&&r===n&&(t=[],u=o)}if(null!==u)break}if(null!==u)break}return null!==u?u:{all:(...e)=>{return r(t,"",e)},func:(...e)=>{return r(t,"func",e)},prop:(...e)=>{return r(t,"prop",e)},event:(...e)=>{return r(t,"event",e)}}};return t.getClass=(()=>{return null!==e._.inherits?new m(e._.inherits):null}),t.getFamily=(()=>{let n=[],t=e._.inherits;for(;!0&&null!==t;)n.push(new m(t)),t=t._.inherits;return n}),t.getMixins=(()=>{let e=[],n=t.getFamily();for(let r of n)e=e.concat(r.getMixins());return e}),t.getInterfaces=(()=>{let e=[],n=t.getFamily();for(let r of n)e=e.concat(r.getInterfaces());return e}),t.getMembers=((...e)=>{let n=i();return 0!==e.length?n.all(...e):n}),t.getMember=(e=>{return i(e)}),t.isSingleton=(()=>{return t.getClass().isSingleton()}),t.isInstanceOf=(n=>{return e._.isInstanceOf(n)}),t.isMixed=(n=>{return e._.isMixed(n)}),t.isImplements=(n=>{return e._.isImplements(n)}),t},l=function(e){let t=new n(e);return t.getStruct=(()=>{return null!==e._.inherits?new h(e._.inherits):null}),t.getMembers=(()=>{let n=Object.keys(e),t=n.indexOf("_");return t!==-1&&n.splice(t,1),n}),t.getMember=(n=>{return e[n]}),t.invoke=((...n)=>{return e[name](...n)}),t.isInstanceOf=(n=>{return e._.inherits._.name===n}),t},m=function(e){let t=new n(e);return t.getParent=(()=>{return null!==e._.inherits?new m(e._.inherits):null}),t.getFamily=(()=>{let n=[],t=e._.inherits;for(;!0&&null!==t;)n.push(new m(t)),t=t._.inherits;return n}),t.getMixins=(()=>{let n=[];for(let t of e._.mixins)n.push(new g(t));return n}),t.getInterfaces=(()=>{let n=[];for(let t of e._.interfaces)n.push(new y(t));return n}),t.isSingleton=(()=>{return e._.isSingleton()}),t.isSingleInstanceCreated=(()=>{return null!==e._.singleInstance()}),t.isSealed=(()=>{return e._.isSealed()}),t.isAbstract=(()=>{return e._.isAbstract()}),t.isStatic=(()=>{return e._.isStatic()}),t.isDeprecated=(()=>{return e._.isDeprecated()}),t},d=function(e){let t=new n(e);return t.getMembers=(()=>{let n=e._.keys(),t=[];for(let r of n)t.push(new u(e,r));return t}),t.getMember=(n=>{if("undefined"==typeof e[n])throw`${n} is not defined.`;return new u(e,n)}),t.getKeys=(()=>{return e._.keys()}),t.getValues=(()=>{return e._.values()}),t},h=function(e){let r=new n(e);return r.getMembers=(()=>{let n=[];for(let r in e)e.hasOwnProperty(r)&&"_"!==r&&n.push(new t(e[r].type,e,r));return n}),r.getMember=(n=>{if("undefined"==typeof e[n])throw`${n} is not defined.`;return new t(e[n].type,e,n)}),r},g=function(e){let n=new h(e);return n},y=function(e){let n=new h(e);return n};let w=null;switch(e._.type){case"instance":w=new c(e);break;case"sinstance":w=new l(e);break;case"class":w=new m(e);break;case"enum":w=new d(e);break;case"struct":w=new h(e);break;case"mixin":w=new g(e);break;case"interface":w=new y(e);break;default:throw`Unknown type ${e._.type}.`}return w};c("Reflector",$e);const De=e=>{if(e.isServer){if(!e.global.sessionStorage){let n=function(){let e={};this.key=(n=>{if(!n)throw p.invalidArgument("key");return!!e.key}),this.getItem=(n=>{if(!n)throw p.invalidArgument("key");return e.key||null}),this.setItem=((n,t)=>{if(!n)throw p.invalidArgument("key");if("undefined"==typeof t)throw p.invalidArgument("value");e[n]=t}),this.removeItem=(n=>{if(!n)throw p.invalidArgument("key");delete e[n]}),this.clear=(()=>{e={}})};e.global.sessionStorage=new n}return e.global.sessionStorage}return e.global.sessionStorage};h.define("sessionStorage",["key","getItem","setItem","removeItem","clear"],De);const Ce=e=>{return e.isServer?(console.log("Use of 'state' is not support on server. Using 'session' instead."),De(e)):e.global.localStorage};h.define("localStorage",["key","getItem","setItem","removeItem","clear"],Ce);const Ee=e=>{return{require:e=>{return new Promise((n,t)=>{try{n(require(e))}catch(e){t(e)}})},undef:e=>{delete require.cache[require.resolve(e)]}}};h.define("serverModule",["require","undef"],Ee);const qe=e=>{return{require:n=>{return new Promise((t,r)=>{let i=n.substr(n.lastIndexOf(".")+1).toLowerCase();try{if("undefined"!=typeof e.global.require)e.global.require([n],t,r);else if(e.isWorker)try{e.global.importScripts(n),t()}catch(e){r(e)}else{let o=e.global.document.createElement("script");"mjs"===i?o.type="module":o.type="text/javascript",o.name=n,o.src=n,o.onload=(()=>{t()}),o.onerror=(e=>{r(e)}),e.global.document.head.appendChild(o)}}catch(e){r(e)}})},undef:n=>{"undefined"!=typeof e.global.requirejs&&e.global.requirejs.undef(n)}}};h.define("clientModule",["require","undef"],qe);const Fe=e=>{return e=>{return new Promise((n,t)=>{let r=e.substr(e.lastIndexOf(".")+1).toLowerCase();try{let i=null,o="";i=e.startsWith("https")?require("https"):require("http"),i.get(e,e=>{e.on("data",e=>{o+=e}),e.on("end",()=>{let i=e.headers["content-type"];if("json"===r||/^application\/json/.test(i))try{let e=JSON.parse(o);n(e)}catch(e){t(e)}else n(o)})}).on("error",t)}catch(e){t(e)}})}};h.define("serverFile",null,Fe);const We=e=>{return e=>{return new Promise((n,t)=>{let r=e.substr(e.lastIndexOf(".")+1).toLowerCase();fetch(e).then(e=>{if(200!==e.status)t(e.status);else{let i=e.headers["content-type"];"json"===r||/^application\/json/.test(i)?e.json().then(n).catch(t):e.text().then(n).catch(t)}}).catch(t)})}};return h.define("clientFile",null,We),r.members=Object.freeze(r.members),Object.freeze(r)}),(()=>{"use strict";const e="undefined"!=typeof!0?require("flair"):"undefined"!=typeof WorkerGlobalScope?WorkerGlobalScope.flair:(!0).flair,{Class,Struct,Enum,Interface,Mixin}=e,{Aspects}=e,{AppDomain}=e,{$$,attr}=e,{Container,include}=e,{Port}=e,{on,post,telemetry}=e,{Reflector}=e,{Serializer}=e,{as,is,isComplies,isDerivedFrom,isImplements,isInstanceOf,isMixed}=e,{getAssembly,getAttr,getContext,getResource,getType,getTypeOf,typeOf}=e,{dispose,using}=e,{args,Exception,noop}=e,{isServer,isWorker}=e.options.env,n=JSON.parse('{"js":{"parserOptions":{"ecmaVersion":6,"sourceType":"module","ecmaFeatures":{"impliedStrict":true}},"parser":"babel-eslint","envs":["browser","es6","node"],"globals":["global","window","flair","define"],"rules":{"accessor-pairs":"off","array-bracket-newline":"off","array-bracket-spacing":"off","array-callback-return":"off","array-element-newline":"off","arrow-body-style":"off","arrow-parens":"off","arrow-spacing":"off","block-scoped-var":"off","block-spacing":"off","brace-style":"off","callback-return":"off","camelcase":"off","capitalized-comments":"off","class-methods-use-this":"off","comma-dangle":"off","comma-spacing":"off","comma-style":"off","complexity":"off","computed-property-spacing":"off","consistent-return":"off","consistent-this":"off","constructor-super":"error","curly":"off","default-case":"off","dot-location":"off","dot-notation":"off","eol-last":"off","eqeqeq":"off","for-direction":"off","func-call-spacing":"off","func-name-matching":"off","func-names":"off","func-style":"off","function-paren-newline":"off","generator-star-spacing":"off","getter-return":"off","global-require":"off","guard-for-in":"off","handle-callback-err":"off","id-blacklist":"off","id-length":"off","id-match":"off","implicit-arrow-linebreak":"off","indent":"off","indent-legacy":"off","init-declarations":"off","jsx-quotes":"off","key-spacing":"off","keyword-spacing":"off","line-comment-position":"off","linebreak-style":"off","lines-around-comment":"off","lines-around-directive":"off","lines-between-class-members":"off","max-classes-per-file":"off","max-depth":"off","max-len":"off","max-lines":"off","max-lines-per-function":"off","max-nested-callbacks":"off","max-params":"off","max-statements":"off","max-statements-per-line":"off","multiline-comment-style":"off","multiline-ternary":"off","new-cap":"off","new-parens":"off","newline-after-var":"off","newline-before-return":"off","newline-per-chained-call":"off","no-alert":"off","no-array-constructor":"off","no-async-promise-executor":"off","no-await-in-loop":"off","no-bitwise":"off","no-buffer-constructor":"off","no-caller":"off","no-case-declarations":"error","no-catch-shadow":"off","no-class-assign":"error","no-compare-neg-zero":"error","no-cond-assign":"error","no-confusing-arrow":"off","no-console":"error","no-const-assign":"error","no-constant-condition":"error","no-continue":"off","no-control-regex":"error","no-debugger":"error","no-delete-var":"error","no-div-regex":"off","no-dupe-args":"error","no-dupe-class-members":"error","no-dupe-keys":"error","no-duplicate-case":"error","no-duplicate-imports":"off","no-else-return":"off","no-empty":"error","no-empty-character-class":"error","no-empty-function":"off","no-empty-pattern":"error","no-eq-null":"off","no-eval":"off","no-ex-assign":"error","no-extend-native":"off","no-extra-bind":"off","no-extra-boolean-cast":"error","no-extra-label":"off","no-extra-parens":"off","no-extra-semi":"error","no-fallthrough":"error","no-floating-decimal":"off","no-func-assign":"error","no-global-assign":"error","no-implicit-coercion":"off","no-implicit-globals":"off","no-implied-eval":"off","no-inline-comments":"off","no-inner-declarations":"error","no-invalid-regexp":"error","no-invalid-this":"off","no-irregular-whitespace":"error","no-iterator":"off","no-label-var":"off","no-labels":"off","no-lone-blocks":"off","no-lonely-if":"off","no-loop-func":"off","no-magic-numbers":"off","no-misleading-character-class":"off","no-mixed-operators":"off","no-mixed-requires":"off","no-mixed-spaces-and-tabs":"error","no-multi-assign":"off","no-multi-spaces":"off","no-multi-str":"off","no-multiple-empty-lines":"off","no-native-reassign":"off","no-negated-condition":"off","no-negated-in-lhs":"off","no-nested-ternary":"off","no-new":"off","no-new-func":"off","no-new-object":"off","no-new-require":"off","no-new-symbol":"error","no-new-wrappers":"off","no-obj-calls":"error","no-octal":"error","no-octal-escape":"off","no-param-reassign":"off","no-path-concat":"off","no-plusplus":"off","no-process-env":"off","no-process-exit":"off","no-proto":"off","no-prototype-builtins":"off","no-redeclare":"error","no-regex-spaces":"error","no-restricted-globals":"off","no-restricted-imports":"off","no-restricted-modules":"off","no-restricted-properties":"off","no-restricted-syntax":"off","no-return-assign":"off","no-return-await":"off","no-script-url":"off","no-self-assign":"error","no-self-compare":"off","no-sequences":"off","no-shadow":"off","no-shadow-restricted-names":"off","no-spaced-func":"off","no-sparse-arrays":"error","no-sync":"off","no-tabs":"off","no-template-curly-in-string":"off","no-ternary":"off","no-this-before-super":"error","no-throw-literal":"off","no-trailing-spaces":"off","no-undef":"error","no-undef-init":"off","no-undefined":"off","no-underscore-dangle":"off","no-unexpected-multiline":"error","no-unmodified-loop-condition":"off","no-unneeded-ternary":"off","no-unreachable":"error","no-unsafe-finally":"error","no-unsafe-negation":"error","no-unused-expressions":"off","no-unused-labels":"error","no-unused-vars":"error","no-use-before-define":"off","no-useless-call":"off","no-useless-catch":"off","no-useless-computed-key":"off","no-useless-concat":"off","no-useless-constructor":"off","no-useless-escape":"error","no-useless-rename":"off","no-useless-return":"off","no-var":"off","no-void":"off","no-warning-comments":"off","no-whitespace-before-property":"off","no-with":"off","nonblock-statement-body-position":"off","object-curly-newline":"off","object-curly-spacing":"off","object-property-newline":"off","object-shorthand":"off","one-var":"off","one-var-declaration-per-line":"off","operator-assignment":"off","operator-linebreak":"off","padded-blocks":"off","padding-line-between-statements":"off","prefer-arrow-callback":"off","prefer-const":"off","prefer-destructuring":"off","prefer-numeric-literals":"off","prefer-object-spread":"off","prefer-promise-reject-errors":"off","prefer-reflect":"off","prefer-rest-params":"off","prefer-spread":"off","prefer-template":"off","quote-props":"off","quotes":"off","radix":"off","require-atomic-updates":"off","require-await":"off","require-jsdoc":"off","require-unicode-regexp":"off","require-yield":"error","rest-spread-spacing":"off","semi":"off","semi-spacing":"off","semi-style":"off","sort-imports":"off","sort-keys":"off","sort-vars":"off","space-before-blocks":"off","space-before-function-paren":"off","space-in-parens":"off","space-infix-ops":"off","space-unary-ops":"off","spaced-comment":"off","strict":"off","switch-colon-spacing":"off","symbol-description":"off","template-curly-spacing":"off","template-tag-spacing":"off","unicode-bom":"off","use-isnan":"error","valid-jsdoc":"off","valid-typeof":"error","vars-on-top":"off","wrap-iife":"off","wrap-regex":"off","yield-star-spacing":"off","yoda":"off"}},"css":{}}');
e.AppDomain.context.current().currentAssemblyBeingLoaded("./flair{.min}.js"),$$("abstract"),$$("ns","(root)"),Class("Aspect",function(){$$("virtual"),this.before=this.noop,$$("virtual"),this.around=this.noop,$$("virtual"),this.after=this.noop}),$$("abstract"),$$("ns","(root)"),Class("Attribute",function(){this.construct=(e=>{this.args=e}),$$("readonly"),this.args=[],this.constraints="",$$("virtual"),this.decorateProperty=this.noop,$$("virtual"),this.decorateFunction=this.noop,$$("virtual"),this.decorateEvent=this.noop}),e.AppDomain.context.current().currentAssemblyBeingLoaded("")})();