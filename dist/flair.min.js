/**
 * @preserve
 * Flair.js
 * True Object Oriented JavaScript
 * 
 * Assembly: flair
 *     File: ./flair.js
 *  Version: 0.26.99
 *  Sun, 31 Mar 2019 12:35:45 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * Licensed under MIT
 */
!function(e,t){"use strict";"function"==typeof!0&&(!0).amd?(!0)(t):"object"==typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t()),module.exports=exports=t()):e.flair=t()}(this,function(){"use strict";let e=new Function("try {return this===global;}catch(e){return false;}")(),t=e?!require("worker_threads").isMainThread:void 0!==!0,n={},r=e?__filename:(!0).document.currentScript.src,i=[],s=Symbol("[meta]"),a="modules",o=[],l={},c=["class","enum","interface","mixin","struct"],u=["instance","sinstance"],p="";if(e){let e=process.argv;t&&(e=require("worker_threads").workerData.argv);let n=e.findIndex(e=>!!e.startsWith("--flairSymbols"));-1!==n&&(p=e[n].substr(2).split("=")[1])}else p=(!0).flairSymbols||"";p&&(i=p.split(",").map(e=>e.trim())),l.symbols=Object.freeze(i),l.env=Object.freeze({type:e?"server":"client",isTesting:-1!==i.indexOf("TEST"),isServer:e,isClient:!e,isWorker:t,isMain:!t,cores:(e?require("os").cpus().length:(!0).navigator.hardwareConcurrency)||4,isCordova:!e&&!!(!0).cordova,isNodeWebkit:e&&process.versions["node-webkit"],isProd:-1===i.indexOf("DEBUG")&&-1!==i.indexOf("PROD"),isDebug:-1!==i.indexOf("DEBUG")}),n.info=Object.freeze({name:"flair",title:"Flair.js",file:r,version:"0.26.99",copyright:"(c) 2017-2019 Vikas Burman",license:"MIT",lupdate:new Date("Sun, 31 Mar 2019 12:35:45 GMT")}),n.members=[],n.options=Object.freeze(l),n.env=n.options.env;const f=(e,t,r)=>{n[e]=Object.freeze(t),n.members.push(e),"function"==typeof r&&o.push(r)},m=()=>{};f("noop",m);const d={get:()=>{throw y.NotImplemented("prop",d.get)},set:()=>{throw y.NotImplemented("prop",d.set)},ni:!0};f("nip",d);const h=()=>{throw y.NotImplemented("func",h)};h.ni=!0,f("nim",h);const y=function(e,t,n,r){let i=new Error,s=y;switch(typeof e){case"string":switch(i.name=e,typeof t){case"string":switch(i.message=t,typeof n){case"object":i.error=n,"function"==typeof r&&(s=r);break;case"function":s=n;break}break;case"object":i.message=t.message||"",i.error=t,"function"==typeof n&&(s=n);break;case"function":s=t;break}break;case"object":i.name=e.name||"Unknown",i.message=e.message||"",i.error=e,"function"==typeof t&&(s=t);break}return i.name=i.name||"Undefined",i.name.endsWith("Exception")||(i.name+="Exception"),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(i,s),i.error&&(i.message+="["+this.error+"]"),Object.freeze(i)};y.InvalidArgument=((e,t=y.InvalidArgument)=>new y("InvalidArgument",`Argument type is invalid. (${e})`,t)),y.OperationFailed=((e,t,n=y.OperationFailed)=>new y("OperationFailed",`Operation failed with error. (${e})`,t,n)),y.Duplicate=((e,t=y.Duplicate)=>new y("Duplicate",`Item already exists.(${e})`,t)),y.NotFound=((e,t=y.NotFound)=>new y("NotFound",`Item not found. (${e})`,t)),y.InvalidDefinition=((e,t=y.InvalidDefinition)=>new y("InvalidDefinition",`Item definition is invalid. (${e})`,t)),y.InvalidOperation=((e,t=y.InvalidOperation)=>new y("InvalidOperation",`Operation is invalid in current context. (${e})`,t)),y.Circular=((e,t=y.Circular)=>new y("Circular",`Circular calls found. (${e})`,t)),y.NotImplemented=((e,t=y.NotImplemented)=>new y("NotImplemented",`Member is not implemented. (${e})`,t)),f("Exception",y);const g=()=>"_xxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx".replace(/[xy]/g,e=>{var t=16*Math.random()|0,n;return("x"==e?t:3&t|8).toString(16)}),b=(e,t)=>{if(t){if(-1!==e.indexOf("{.min}"))return n.options.env.isProd?e.replace("{.min}",".min"):e.replace("{.min}","")}else if(-1!==e.indexOf("|")){let t=e.split("|"),n="";return"x"===(n=l.env.isServer?t[0].trim():t[1].trim())&&(n=""),-1!==n.indexOf("~")&&(t=n.split("~"),"x"===(n=l.env.isWorker?t[1].trim():t[0].trim())&&(n="")),n}return e},v=e=>!e.hasOwnProperty("prototype")&&"Function"===e.constructor.name,w=e=>"AsyncFunction"===e.constructor.name,x=(e,t,n)=>e.findIndex(e=>e[t]===n),O=(e,t,n)=>{let r=e.findIndex(e=>e[t]===n);return-1!==r?e[r]:null},I=(e,t)=>(t||(t=","),e.split(t).map(e=>e.trim())),A=e=>e.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1"),$=(e,t,n)=>e.replace(new RegExp(A(t),"g"),n),k=(e,t,n,r)=>{r||(r=[]);for(let i in t)if(t.hasOwnProperty(i)&&-1===r.indexOf(i)){if(!n&&i in e)continue;e[i]=t[i]}return e},j=t=>new Promise((n,r)=>{let i=null;(i=W(e?"serverFile":"clientFile"))(t).then(n).catch(r)}),T=t=>new Promise((n,r)=>{e?W("serverModule").require(t).then(n).catch(r):W("clientModule").require(t).then(n).catch(r)}),S=(e,t,n,r)=>{let i=t?I(t):Object.keys(e);const s=t=>{let s={};if(i.length>0)for(let e of i)s[e]=t[e];else for(let t in e)e.hasOwnProperty(t)&&(s[t]=e[t]);if(r)for(let e in r)s[e]=r[e];return n&&(s=Object.freeze(s)),s};if(Array.isArray(e)){let t=[];for(let n of e)t.push(s(n));return t}return s(e)},P=e=>btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function e(t,n){return String.fromCharCode("0x"+n)})),N=e=>decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join("")),C=t=>{e?W("serverModule").undef(t):W("clientModule").undef(t)},D=(e,t)=>new Promise((n,r)=>{const i=e=>{e&&0!==e.length?Promise((n,r)=>{t(n,r,e.shift())}).then(()=>{i(e)}).catch(r):n()};i(e.slice())}),E=e=>{let t="";return void 0===e&&(t="undefined"),t||null!==e||(t="null"),t||"number"!=typeof e||!1!==isFinite(e)||(t="infinity"),!t&&Array.isArray(e)&&(t="array"),!t&&e instanceof Date&&(t="date"),!t&&e[s]&&(t=e[s].type),t||(t=typeof e),t};f("typeOf",E);const z=(e,t)=>{if(t[s]&&(t=t[s].name),"string"!==E(t))throw y.InvalidArgument("type",z);let n=!1,r="";return"undefined"===t&&(n=void 0===e),n||"null"!==t||(n=null===e),n||"NaN"!==t||(n=isNaN(e)),n||"infinity"!==t||(n="number"==typeof e&&!1===isFinite(e)),n||"array"!==t&&"Array"!==t||(n=Array.isArray(e)),n||"date"!==t&&"Date"!==t||(n=e instanceof Date),!n&&"flairtype"===t&&e[s]&&-1!==c.indexOf(e[s].type)&&(n=!0),!n&&"flairinstance"===t&&e[s]&&-1!==u.indexOf(e[s].type)&&(n=!0),!n&&"flair"===t&&e[s]&&(n=!0),n||"cfunction"!==t||(n="function"==typeof e&&!v(e)),n||"afunction"!==t||(n="function"==typeof e&&v(e)),n||(n=typeof e===t),n||e[s]&&(n=(r=e[s].type)===t),!n&&r&&-1!==u.indexOf(r)&&(n=he(e,t)),!n&&r&&"class"===r&&(n=ce(e,t)),!n&&r&&-1!==c.indexOf(r)&&(n=e[s].name===t),n};f("is",z);const F=(...e)=>{if(0===e.length)throw y.InvalidArgument("patterns",F);let t=(...n)=>{let r=null,i=null,s="",a="",o=-1,l=-1,c=!1,u=0,p="",f={raw:n||[],index:-1,isInvalid:!1,error:null,values:{}};if(e)for(let t of e){o++,l=-1,c=!1,u=0,r=t.split(",");for(let e of r){if(l++,2!==(i=e.split(":")).length?(s=`_${o}_${l}`,a=e.trim()||""):(s=i[0].trim()||"",a=i[1].trim()||""),l>f.raw.length){c=!1;break}if(!z(f.raw[l],a)){c=!1,p=s;break}f.values[s]=f.raw[l],c=!0,u++}if(c&&u===r.length){f.index=o;break}}return f.isInvalid=-1===f.index,f.error=f.isInvalid?y.InvalidArgument(p):null,f.throwOnError=(e=>{if(f.error)throw new y(f.error,e||t)}),Object.freeze(f)};return Object.freeze(t)};f("Args",F);const M=e=>{let t;return F("argsProcessor: undefined","argsProcessor: afunction")(e).throwOnError(M),(e=e||((...e)=>e)).event=!0,e};f("event",M);const R=M(()=>{throw y.NotImplemented("event",R)});R.ni=!0,f("nie",R);const U=function(e){let t={};e=e||"",this.add=((e,n)=>{let r;F("event: string, handler: afunction")(e,n).throwOnError(this.add),t[e]||(t[e]=[]),t[e].push(n)}),this.remove=((e,n)=>{let r;if(F("event: string, handler: afunction")(e,n).throwOnError(this.remove),t[e]){let r=t[e].indexOf(n);-1!==r&&t[e].splice(r,1)}}),this.dispatch=((n,r)=>{let i;F("event: string")(n).throwOnError(this.dispatch),t[n]&&t[n].forEach(t=>{setTimeout(()=>{t(Object.freeze({host:e,name:n,args:r||[]}))},0)})}),this.count=(e=>{let n;return F("event: string")(e).throwOnError(this.count),t[e]?t[e].length:0}),this.clear=(()=>{t={}})};let _={};const W=e=>{if("string"!=typeof e)throw y.InvalidArgument("name",W);return _[e]?_[e].handler?_[e].handler:_[e].inbuilt:null};W.define=((e,t,n)=>{let r=F("name: string, members: array, inbuilt: afunction","name: string, inbuilt: afunction","name: string, members: array","name: string")(e,t,n);if(r.throwOnError(W.define),_[e])throw y.Duplicate(e,W.define);_[e]={type:r.values.members?"object":"function",members:r.values.members||null,handler:null,inbuilt:r.values.inbuilt?r.values.inbuilt(l.env):null}}),W.connect=((e,t)=>{let n;if(F("name: string, handler: afunction")(e,t).throwOnError(W.connect),!_[e])throw y.NotFound(e,W.connect);let r=t(l.env);if(typeof r!==_[e].type)throw y.InvalidArgument("handler",W.connect);let i=_[e].members;if(i)for(let e of i)if(void 0===r[e])throw y.NotImplemented(e,W.connect);_[e].handler=r}),W.disconnect=(e=>{if("string"!=typeof e)throw y.InvalidArgument("name",W.disconnect);_[e]&&(_[e].handler=null)}),W.isDefined=(e=>{if("string"!=typeof e)throw y.InvalidArgument("name",W.isDefined);return!!_[e]}),W.isConnected=(e=>{if("string"!=typeof e)throw y.InvalidArgument("name",W.isConnected);return!_[e]||!_[e].handler}),f("Port",W,()=>{for(let e in _)_.hasOwnProperty(e)&&(_[e].handler=null);_={}});const q=function(e,t,n,r,i){let a={},o={},l={},u={},p={},f={},m=!1,d="";this.name=e,this.domain=t,this.isUnloaded=(()=>m||t.isUnloaded()),this.unload=(()=>{if(!m){m=!0,delete i[e];for(let e in u)e.hasOwnProperty(e)&&Ie(u[e]);a={},p={},o={},l={},u={},f={}}}),this.current=(()=>{if(this.isUnloaded())throw y.InvalidOperation(`Context is already unloaded. (${this.name})`,this.current);return 0===r.length?n||this:r[r.length-1]}),this.registerType=(e=>{if(this.isUnloaded())throw y.InvalidOperation(`Context is already unloaded. (${this.name})`,this.registerType);let t="",n="",r=e[s];if(r.Type?(t=r.Type[s].name,n=r.Type[s].type):(t=r.name,n=r.type),-1===c.indexOf(n))throw y.InvalidArgument("Type",this.registerType);let i=t.substr(0,t.lastIndexOf(".")),u=t.replace(i+".","");if(a[t])throw y.Duplicate(t,this.registerType);if(o[t])throw y.Duplicate(`Already registered as Resource. (${t})`,this.registerType);if(l[t])throw y.Duplicate(`Already registered as Route. (${t})`,this.registerType);return a[t]=e,i?(f[i]||(f[i]={}),f[i][u]=e):f[u]=e,i}),this.getType=(e=>{if(this.isUnloaded())throw y.InvalidOperation(`Context is already unloaded. (${this.name})`,this.getType);if("string"!=typeof e)throw y.InvalidArgument("qualifiedName",this.getType);return a[e]||null}),this.ensureType=(e=>new Promise((n,r)=>{if(this.isUnloaded())return void r(y.InvalidOperation(`Context is already unloaded. (${this.name})`));if("string"!=typeof e)return void r(y.InvalidArgument("qualifiedName"));let i=this.getType(e);if(i)n(i);else{let s=t.resolve(e);s?this.loadAssembly(s).then(()=>{(i=this.getType(e))?n(i):r(y.OperationFailed(`Assembly could not be loaded. (${s})`))}).catch(r):r(y.NotFound(e))}})),this.allTypes=(()=>{if(this.isUnloaded())throw y.InvalidOperation(`Context is already unloaded. (${this.name})`,this.allTypes);return Object.keys(a)}),this.execute=((e,t)=>new Promise((n,r)=>{if(this.isUnloaded())return void r(y.InvalidOperation(`Context is already unloaded. (${this.name})`));e.type=e.type||"",e.typeArgs=e.typeArgs||[],e.func=e.func||"",e.args=e.args||[],e.ctx=e.ctx||{},e.keepAlive=void 0!==e.keepAlive&&e.keepAlive;const i=()=>new Promise((n,r)=>{let i=null;this.ensureType(e.type).then(s=>{try{i=new s(...e.typeArgs),"function"==typeof t&&z(i,"IProgressReporter")&&i.progress.add(t),n(i)}catch(e){r(e)}}).catch(r)}),s=t=>new Promise((n,r)=>{let i=null;(i=t[e.func](...e.args))&&"function"==typeof i.then?i.then(n).catch(r):n(i)});let a=null;e.keepAlive?u[e.type]?(a=u[e.type],s(a).then(n).catch(r)):i().then(t=>{a=t,u[e.type]=a,s(a).then(n).catch(r)}).catch(r):u[e.type]?(a=u[e.type],e.func?s(a).then(n).catch(r).finally(()=>{Ie(a),delete u[e.type]}):(Ie(a),delete u[e.type],n())):i().then(e=>{s(e).then(n).catch(r).finally(()=>{Ie(e)})}).catch(r)})),this.namespace=(e=>{e&&"(root)"===e&&(e="");let t=null;return(t=e?f[e]||null:f)?Object.freeze(k({},t)):null}),this.currentAssemblyBeingLoaded=(e=>(void 0!==e&&(d=b(e,!0)),d)),this.loadAssembly=(e=>new Promise((t,n)=>{if(this.isUnloaded())n(y.InvalidOperation(`Context is already unloaded. (${this.name})`));else if(p[e])t();else{r.push(this),C(e);let i=this.domain.getAdo(e),s=e;i&&i.mainAssembly&&(s.startsWith("./")&&(s=s.substr(2)),s=this.domain.loadPathOf(i.mainAssembly)+s),T(s).then(()=>{r.pop(),p[e]=Object.freeze(new L(i,this)),t()}).catch(e=>{r.pop(),n(e)})}})),this.getAssembly=(e=>{if(this.isUnloaded())throw y.InvalidOperation(`Context is already unloaded. (${this.name})`,this.getAssembly);if("string"!=typeof e)throw y.InvalidArgument("file",this.getAssembly);return p[e]||null}),this.allAssemblies=(e=>{if(this.isUnloaded())throw y.InvalidOperation(`Context is already unloaded. (${this.name})`,this.allAssemblies);return e?Object.assign({},p):Object.keys(p)}),this.registerResource=(e=>{if(this.isUnloaded())throw y.InvalidOperation(`Context is already unloaded. (${this.name})`,this.registerResource);if("string"!=typeof e.name||""===e.name||"string"!=typeof e.encodingType||""===e.encodingType||"string"!=typeof e.file||""===e.file||"string"!=typeof e.data||""===e.data)throw y.InvalidArgument("rdo",this.registerResource);let t=e.name.substr(0,e.name.lastIndexOf(".")),n=e.name.replace(t+".","");if(o[e.name])throw y.Duplicate(e.name,this.registerResource);if(a[e.name])throw y.Duplicate(`Already registered as Type. (${e.name})`,this.registerResource);if(l[e.name])throw y.Duplicate(`Already registered as Route. (${e.name})`,this.registerResource);return o[e.name]=Object.freeze(new B(e,t,this)),t?(f[t]||(f[t]={}),f[t][n]=o[e.name]):f[n]=o[e.name],t}),this.getResource=(e=>{if(this.isUnloaded())throw y.InvalidOperation(`Context is already unloaded. (${this.name})`,this.getResource);if("string"!=typeof e)throw y.InvalidArgument("qualifiedName",this.getResource);return o[e]||null}),this.allResources=(e=>{if(this.isUnloaded())throw y.InvalidOperation(`Context is already unloaded. (${this.name})`,this.allResources);return e?Object.assign({},o):Object.keys(o)}),this.registerRoutes=(e=>{if(this.isUnloaded())throw y.InvalidOperation(`Context is already unloaded. (${this.name})`,this.registerRoutes);for(let t of e){if("string"!=typeof t.name||""===t.name||"number"!=typeof t.index||"string"!=typeof t.mount||""===t.mount||"string"!=typeof t.path||""===t.path||"string"!=typeof t.verb||""===t.verb||"string"!=typeof t.handler||""===t.handler)throw y.InvalidArgument("route: "+t.name,this.registerRoutes);let e=t.name.substr(0,t.name.lastIndexOf(".")),n=t.name.replace(e+".","");if(l[t.name])throw y.Duplicate(t.name,this.registerRoutes);if(a[t.name])throw y.Duplicate(`Already registered as Type. (${t.name})`,this.registerRoutes);if(o[t.name])throw y.Duplicate(`Already registered as Resource. (${t.name})`,this.registerRoutes);l[t.name]=Object.freeze(new V(t,e,this)),e?(f[e]||(f[e]={}),f[e][n]=l[t.name]):f[n]=l[t.name]}}),this.getRoute=(e=>{if(this.isUnloaded())throw y.InvalidOperation(`Context is already unloaded. (${this.name})`,this.getRoute);if("string"!=typeof e)throw y.InvalidArgument("qualifiedName",this.getRoute);return l[e]||null}),this.allRoutes=(e=>{if(this.isUnloaded())throw y.InvalidOperation(`Context is already unloaded. (${this.name})`,this.allRoutes);return e?Object.assign({},l):Object.keys(l)}),this.isBusy=(()=>!1),this.hasActiveInstances=(()=>Object.keys(u).length)},L=function(e,t){this.context=t,this.name=e.name,this.file=e.file,this.desc=e.desc,this.version=e.version,this.copyright=e.copyright,this.license=e.license,this.lupdate=e.lupdate,this.builder=e.builder.name,this.flairVersion=e.builder.version,this.format=Object.freeze({name:e.builder.format,version:e.builder.formatVersion,contains:e.builder.contains.slice()}),this.types=(()=>e.types.slice()),this.getType=(t=>{if("string"!=typeof t)throw y.InvalidArgument("qualifiedName",this.getType);if(-1===e.types.indexOf(t))throw y.NotFound(t,this.getType);return this.context.getType(t)}),this.getTypes=(t=>{if(["string","interface"]!==E(t))throw y.InvalidArgument("intf",this.getTypes);let n=[];for(let r of e.types)try{let e=this.context.getType(r);be(e,t)&&n.push(e)}catch(e){}return n}),this.resources=(()=>e.resources.slice()),this.getResource=(t=>{if("string"!=typeof t)throw y.InvalidArgument("qualifiedName",this.getResource);if(-1===e.resources.indexOf(t))throw y.NotFound(t,this.getResource);return this.context.getResource(t)}),this.routes=(()=>e.routes.slice()),this.getRoute=(t=>{if("string"!=typeof t)throw y.InvalidArgument("qualifiedName",this.getRoute);if(-1===e.routes.indexOf(t))throw y.NotFound(t,this.getRoute);return this.context.getRoute(t)}),this.assets=(()=>e.assets.slice()),this.assetsRoot=this.file.replace(".js","/"),this.getAsset=(t=>{if("string"!=typeof t)throw y.InvalidArgument("file",this.getAsset);let n=t.replace("./",this.assetsRoot);if(-1===e.assets.indexOf(t))throw y.NotFound(n,this.getAsset);return n})},B=function(t,n,r){this.context=r,this.name=t.name,this.ns=n,this.assembly=(()=>r.getAssembly(b(t.asmFile,!0))||null),this.encodingType=t.encodingType,this.file=t.file,this.type=t.file.substr(t.file.lastIndexOf(".")+1).toLowerCase(),this.data=t.data;try{if(-1!==t.encodingType.indexOf("utf8;"))if(e){let e=Buffer.from(t.data,"base64");this.data=e.toString("utf8")}else this.data=N(t.data);else e&&(this.data=Buffer.from(t.data,"base64"))}catch(e){throw y.OperationFailed(`Resource data could not be decoded. (${t.name})`,B)}"json"===this.type&&(this.data=Object.freeze(JSON.parse(this.data)))},V=function(e,t,n){if(this.context=n,this.name=e.name,this.ns=t,this.assembly=(()=>n.getAssembly(b(e.asmFile,!0))||null),this.index=e.index,this.mount=e.mount,this.verb=e.verb,this.path=e.path,this.flags=e.flags||[],this.Handler=se(e.handler),!this.Handler)throw y.InvalidDefinition(e.handler,V)},G=function(t,n){let r={},i=0,s=null,a=null;const o=function(){let e="<<isServer>>"=="true",t=JSON.parse("<<ados>>"),n=null,r=null,i=null;const s=e=>{let t=e.data.func,n=null;const s=t=>{r.postMessage({data:{id:e.data.id,isComplete:!0,isError:!1,error:null,ctx:e.data.ctx,result:e.data.returnsAsIs?t:!!t}})},a=t=>{r.postMessage({data:{id:e.data.id,isComplete:!1,isError:!1,error:null,ctx:e.data.ctx,result:t}})},o=t=>{r.postMessage({data:{id:e.data.id,isComplete:!0,isError:!0,error:t?t.toString():"UnknownError",ctx:e.data.ctx,result:null}})},l=()=>{try{"alc"===e.data.obj&&"execute"===t&&e.data.args.push(e=>{a(e.args)});let r=n(...e.data.args);r&&"function"==typeof r.then?r.then(s).catch(o):s(r)}catch(e){o(e)}};switch(e.data.obj){case"ad":n=i[t],l();break;case"alc":n=i.contexts(e.data.name)[t],l();break}};if(e){require("<<entryPoint>>"),n=require("flairjs");let e=require("worker_threads").parentPort;r=e,e.once("message",e=>{(r=e.privatePort).on("message",s)})}else importScripts("<<entryPoint>>"),n=(!0).flair,(r=this).onmessage=s;i=n.AppDomain,0!==t.length&&i.registerAdo(...t)};let l=o.toString().replace("<<entryPoint>>",X.entryPoint());l=`(${l=(l=l.replace("<<isServer>>",e.toString())).replace("<<ados>>",JSON.stringify(t))})();`;const c=(e,t,n,s,o,l,c)=>new Promise((u,p)=>{let f=g();r[f]={resolve:u,reject:p,progressListener:c},i++,a.postMessage({data:{id:f,obj:e,name:t,returnsAsIs:n,ctx:l||{},func:s,args:o&&Array.isArray(o)?o:[]}})}),u=e=>{if(r[e.data.id]){let t=r[e.data.id];e.data.isComplete?(delete r[e.data.id],i--,e.data.isError?t.reject(e.data.error):t.resolve(Object.freeze({ctx:e.data.ctx,result:e.data.result}))):"function"==typeof progressListener&&t.progressListener&&setTimeout(()=>{t.progressListener(Object.freeze({host:e.data.ctx._?e.data.ctx._.host:"",name:"progress",args:e.data.result}))},0)}else n(`Unknown operation is not supported. (${e.data.id})`)};if(e){const{Worker:e,MessageChannel:t}=require("worker_threads");a=new e(l,{eval:!0,workerData:{argv:process.argv}});const r=new t;a.postMessage({privatePort:r.port1},[r.port1]),r.port2.on("error",n),r.port2.on("message",u)}else{let e=new Blob([l]),t=(!0).URL.createObjectURL(e,{type:"application/javascript; charset=utf-8"});(a=new(!0).Worker(t)).onmessage=u,a.onerror=n}this.remoteCall=c,this.close=(()=>{e&&(s.close(),a.unref()),a.terminate()}),this.isBusy=(()=>i)},J=function(e,t,n){let r=!1,i={},s=new G(n,e=>{throw y.OperationFailed("Remote operation failed.",e)});this.name=e,this.isRemote=!0,this.isUnloaded=(()=>r),this.unload=(()=>{r||(r=!0,delete t[e],i={},s.remoteCall("ad","",!1,"unload").finally(()=>{s.close()}))}),this.context=Object.freeze(new H("default",this,s)),this.contexts=(e=>i[e]||null),this.createContext=(e=>new Promise((t,n)=>{"string"!=typeof e||e&&"default"===e||i[e]?n(y.InvalidArguments("name")):s.remoteCall("ad","",!1,"createContext",[e]).then(r=>{if(r){let n=Object.freeze(new H(e,this,s));i[e]=n,t(n)}else n(y.OperationFailed("Context could not be created."))}).catch(n)})),this.loadScripts=((...e)=>{if(this.isUnloaded())throw y.InvalidOperation(`AppDomain is already unloaded. (${this.name})`,this.loadScripts);return s.remoteCall("ad","",!1,"loadScripts",e)})},H=function(e,t,n){let r=!1;this.name=e,this.domain=t,this.isUnloaded=(()=>r||t.isUnloaded()),this.unload=(()=>{r||(r=!0,n.remoteCall("alc",e,!1,"unload"))}),this.execute=((t,r)=>{if(this.isUnloaded())throw y.InvalidOperation(`Context is already unloaded. (${this.name})`,this.execute);let i=t.ctx||{};return i._={host:t.type},n.remoteCall("alc",e,!0,"execute",[t],i,r)}),this.loadAssembly=(t=>{if(this.isUnloaded())throw y.InvalidOperation(`Context is already unloaded. (${this.name})`,this.loadAssembly);return n.remoteCall("alc",e,!1,"loadAssembly",[t])}),this.isBusy=(()=>{if(this.isUnloaded())throw y.InvalidOperation(`Context is already unloaded. (${this.name})`,this.isBusy);return n.isBusy()}),this.hasActiveInstances=(()=>{n.remoteCall("alc",e,!1,"hasActiveInstances")})},X=function(e){let n={},r={},i={},s={},a=[],o=[],l={},c="",u=null,p=null,f=null,m=null,d=null,h=!1;m=new q("default",this,null,a,s),d=m.unload,delete m.unload,m=Object.freeze(m),s[m.name]=m,i[e]=this,this.name=e,this.isRemote=!1,this.isUnloaded=(()=>h),this.unload=(async()=>{if(!h){h=!0,p&&"function"==typeof p.stop&&(await p.stop(),Ie(p)),f&&"function"==typeof f.stop&&(await f.stop(),Ie(f));for(let e in s)s.hasOwnProperty(e)&&"function"==typeof s[e].unload&&s[e].unload();d();for(let e in i)i.hasOwnProperty(e)&&i[e]!==this&&i[e].unload();n={},r={},s={},i={},l={},o=[]}}),this.createDomain=(e=>new Promise((t,n)=>{if("string"!=typeof e||e&&"default"===e||i[e])return void n(y.InvalidArguments("name"));let r=Object.freeze(new J(e,i,o));i[e]=r,t(r)})),this.domains=(e=>i[e]||null),this.context=m,this.contexts=(e=>s[e]||null),this.createContext=(e=>new Promise((t,n)=>{if("string"!=typeof e||e&&"default"===e||s[e])return void n(y.InvalidArguments("name"));let r=Object.freeze(new q(e,this,m,a,s));s[e]=r,t(r)})),this.registerAdo=((...e)=>{let i=!0;if(1===e.length&&"string"==typeof e[0]){let t=JSON.parse(e[0]);e=Array.isArray(t)?t:[t],i=!1}e.forEach(e=>{if("array"!==E(e.types)||"array"!==E(e.resources)||"array"!==E(e.assets)||"string"!=typeof e.name||"string"!=typeof e.file||""===e.file)throw y.InvalidArgument("ado",this.registerAdo);if(e.file=b(e.file,!0),n[e.file]){if(i||t)throw y.Duplicate(e.file,this.registerAdo)}else n[e.file]=Object.freeze(e),e.types.forEach(t=>{if(r[t])throw y.Duplicate(t,this.registerAdo);r[t]=e.file}),e.resources.forEach(t=>{if(r[t])throw y.Duplicate(t,this.registerAdo);r[t]=e.file})}),o.push(...e)}),this.getAdo=(e=>{if("string"!=typeof e)throw y.InvalidArgument("file",this.getAdo);return n[e]||null}),this.allAdos=(()=>Object.keys(n)),this.resolve=(e=>{if("string"!=typeof e)throw y.InvalidArgument("qualifiedName",this.resolve);return r[e]||null}),this.allTypes=(()=>Object.keys(r)),this.config=(e=>!u&&e?new Promise((t,n)=>{j(e).then(e=>{u=e,t(Object.assign({},u))}).catch(n)}):u?Object.assign({},u):null),this.entryPoint=(e=>{if(!c){if("string"!=typeof e)throw y.InvalidArgument("file",this.entryPoint);t||(c=b(e||""))}return c}),this.app=(e=>(e&&!p&&(p=e),p)),this.host=(e=>(e&&(f=e),f)),this.loadPathOf=((e,t)=>{if("string"!=typeof e)throw y.InvalidArgument("file",this.loadPath);return t&&(l[e]||(l[e]=t)),l[e]||""}),this.loadScripts=((...e)=>new Promise((t,n)=>{try{xe(e,()=>{t()})}catch(e){n(e)}}))};let K=new X("default"),Q=K.unload;delete K.unload;const Y=K;f("AppDomain",Y,()=>{Q()});const Z=(e,t,n)=>{let r=F("obj: flairinstance, memberName: string","obj: flairinstance, memberName: string, attrName: string","obj: flairtype","obj: flairtype, attrName: string")(e,t,n);r.throwOnError(Z);let i=[],a=e[s],o=null,l=null;return r.values.attrName?(l=r.index>1?a.attrs.type.probe(r.values.attrName).current():a.attrs.members.probe(r.values.attrName,r.values.memberName).current())&&i.push(S(l,"name, isCustom, args, type",!0)):(o=r.index>1?a.attrs.type.all().current():a.attrs.members.all(r.values.memberName).current())&&i.push(...S(o,"name, isCustom, args, type",!0)),i};f("getAttr",Z);const ee=e=>{let t=F("Type: flairtype","Type: flairinstance","Type: string")(e);t.throwOnError(ee);let n=null,r="";switch(t.index){case 0:n=e[s].assembly();break;case 1:n=e[s].Type[s].assembly();break;case 2:(r=Y.resolve(e))&&(n=Y.context.getAssembly(r));break}return n};f("getAssembly",ee);const te=e=>{let t;return F("Type: string")(e).throwOnError(te),Y.resolve(e)};f("getAssemblyOf",te);const ne=e=>{let t;return F("Type: flairtype")(e).throwOnError(ne),e[s].context};f("getContext",ne);const re=e=>{let t;F("qualifiedName: string")(e).throwOnError(re);let n=Y.context.getResource(e)||null;return n?n.data:null};f("getResource",re);const ie=e=>{let t;F("qualifiedName: string")(e).throwOnError(ie),Y.context.getRoute(e)};f("getRoute",ie);const se=e=>{let t;return F("qualifiedName: string")(e).throwOnError(se),Y.context.getType(e)};f("getType",se);const ae=e=>{let t;F("obj: flair")(e).throwOnError(ae);let n=e[s];return n&&n.Type||null};f("getTypeOf",ae);const oe=e=>{let t;F("obj: flair")(e).throwOnError(oe);let n=e[s].Type?e[s].Type[s]:e[s];return n&&n.name||""};f("getTypeName",oe);const le=e=>{let t;return F("name: undefined","name: string")(e).throwOnError(le),Y.context.namespace(e)};f("ns",le);const ce=(e,t)=>{if("class"!==E(e))throw y.InvalidArgument("Type",ce);if(-1===["string","class"].indexOf(E(t)))throw y.InvalidArgument("Parent",ce);return e[s].isDerivedFrom(t)};f("isDerivedFrom",ce);const ue=e=>{if("class"!==E(e))throw y.InvalidArgument("Type",ue);return e[s].isAbstract()};f("isAbstract",ue);const pe=e=>{if("class"!==E(e))throw y.InvalidArgument("Type",pe);return e[s].isSealed()};f("isSealed",pe);const fe=e=>{if("class"!==E(e))throw y.InvalidArgument("Type",fe);return e[s].isStatic()};f("isStatic",fe);const me=e=>{if("class"!==E(e))throw y.InvalidArgument("Type",me);return e[s].isSingleton()};f("isSingleton",me);const de=e=>{if("class"!==E(e))throw y.InvalidArgument("Type",de);return e[s].isDeprecated()};f("isDeprecated",de);const he=(e,t)=>{let n=E(e),r=E(t),i=!1;if(-1===u.indexOf(n))throw y.InvalidArgument("obj",he);if(-1===c.indexOf(r)&&"string"!==r)throw y.InvalidArgument("Type",he);let a=e[s];switch(r){case"class":(i=a.isInstanceOf(t))||(i=a.Type[s].isDerivedFrom(t));break;case"struct":i=a.isInstanceOf(t);break;case"interface":i=a.isImplements(t);break;case"mixin":i=a.isMixed(t);break;case"string":(i=a.isInstanceOf(t))||"function"!=typeof a.isImplements||(i=a.isImplements(t)),i||"function"!=typeof a.isMixed||(i=a.isMixed(t));break}return i};f("isInstanceOf",he);const ye=(e,t)=>{if(t[s]&&(t=t[s].name),"string"!==E(t))throw y.InvalidArgument("type",ye);return z(e,t)?e:null};f("as",ye);const ge=(e,t)=>{if(!e)throw y.InvalidArgument("obj",ge);if("interface"!==E(t))throw y.InvalidArgument("intf",ge);let n=!0;for(let r in t)if(t.hasOwnProperty(r)&&r!==s){if(!e[r]){n=!1;break}if("function"==typeof t[r]&&"function"!=typeof e[r]){n=!1;break}}return n};f("isComplies",ge);const be=(e,t)=>{if(-1===["class","instance"].indexOf(E(e)))throw y.InvalidArgument("obj",be);if(-1===["string","interface"].indexOf(E(t)))throw y.InvalidArgument("intf",be);return e[s].isImplements(t)};f("isImplements",be);const ve=(e,t)=>{if(-1===["class","instance"].indexOf(E(e)))throw y.InvalidArgument("obj",ve);if(-1===["string","mixin"].indexOf(E(t)))throw y.InvalidArgument("mixin",ve);return e[s].isMixed(t)};f("isMixed",ve);const we=[],xe=(t,n)=>{let r=F("deps: string, fn: afunction","deps: array, fn: afunction")(t,n);r.throwOnError(xe),0===r.index&&(t=[t]);let i=[],s=t.slice(),o=()=>{n(...i)},l=()=>{if(0!==s.length){let t=s.shift().trim(),n=null,r=e=>{if(t.startsWith("[")&&t.endsWith("]")&&-1===t.indexOf(".")){let e=t.substr(1,t.length-2).trim();"string"==typeof(n=Je.resolve(e,!1))&&(t=n,n=null)}e()},o=e=>{-1===t.indexOf("/")&&((n=se(t))||(n=re(t))),e()},c=e=>{if(-1===t.indexOf("/")){let r=te(t);r?Y.context.loadAssembly(r).then(()=>{(n=se(t))||(n=re(t))}).catch(e=>{throw y.OperationFailed(`Assembly could not be loaded. (${r})`,e,xe)}):e()}else e()},u=e=>{if(t.startsWith("./")){let r=t.substr(t.lastIndexOf(".")+1).toLowerCase();r?"js"===r||"mjs"===r?(t=b(t,!0),T(t).then(t=>{n=t||!0,e()}).catch(e=>{throw y.OperationFailed(`Module could not be loaded. (${t})`,e,xe)})):j(t).then(t=>{n=t,e()}).catch(e=>{throw y.OperationFailed(`File could not be loaded. (${t})`,e,xe)}):e()}else e()},p=r=>{t.startsWith("./")?r():(e||(t=`./${a}/${t}`),T(t).then(e=>{n=e||!0,r()}).catch(e=>{throw y.OperationFailed(`Module could not be loaded. (${t})`,e,xe)}))},f=e=>{i.push(n),e||we.pop(),l()};if(""===(t=b(t)))return n=!0,void f(!0);if(-1!==we.indexOf(t))throw y.Circular(t,xe);we.push(t),r(()=>{n?f():o(()=>{n?f():c(()=>{n?f():u(()=>{n?f():p(()=>{if(!n)throw y.OperationFailed(`Dependency could not be resolved. (${t})`,xe);f()})})})})})}else o()};l()};f("bring",xe,()=>{we.length=0});const Oe=(e,t)=>new Promise((n,r)=>{if("string"==typeof e)try{xe([e],i=>{i?"boolean"!=typeof i||"string"!=typeof t||(i=(!0)[t])?n(i):r(y.OperationFailed(`Dependency object could not be located. (${e})`)):r(y.OperationFailed(`Dependency could not be resolved. (${e})`))})}catch(e){r(e)}else r(y.InvalidArgument("dep"))});f("include",Oe);const Ie=e=>{let t=F("obj: instance","obj: boolean")(e);t.throwOnError(Ie),1===t.index&&!0===e?(ze(),o.forEach(e=>{e()}),o.length=0):"function"==typeof e[s].dispose&&e[s].dispose()};f("dispose",Ie);const Ae=(e,t)=>{let n=F("obj: instance, fn: afunction","obj: string, fn: afunction")(e,t);if(n.throwOnError(Ae),1===n.index){let t=se(e);if(!t)throw y.NotFound(e,Ae);e=new t}let r=null,i=!1,a=!1,o=()=>{i||"function"!=typeof e[s].dispose||(i=!0,e[s].dispose())};try{(r=t(e))&&"function"==typeof r.finally&&(a=!0,r=r.finally(()=>{o()}))}finally{a||o()}return r};f("using",Ae);const $e=(e,...t)=>{let n=F("name: string","name: Attribute")(e);n.throwOnError($e);let r=null,i=null,a=null;if(0===n.index){if(!(a=Te.inbuilt[e]||null)){if(!(r=se(e)))throw y.NotFound(e,$e);e=r[s].name}}else e=(r=e)[s].name;if(-1!==x(Te.bucket,"name",e))throw y.Duplicate(e,$e);if(r){try{i=new r(...t)}catch(e){throw new y(e,$e)}a=new ke(i.constraints)}Te.bucket.push({name:e,cfg:a,isCustom:null!==i,attr:i,args:t})},ke=function(e,t){let n=F("isModifier: boolean, constraints: string","constraints: string","isModifier: boolean,")(e,t),r;return n.throwOnError(ke),{isModifier:n.values.isModifier||!1,constraints:n.values.constraints}},je=(e,...t)=>$e(e,...t),Te=je[s]=Object.freeze({bucket:[],inbuilt:Object.freeze({static:new ke(!0,"(class && !$abstract) || ((class && (prop || func)) && !($abstract || $virtual || $override))"),abstract:new ke(!0,"(class && !$sealed && !$static) || ((class && (prop || func || event)) && !($override || $sealed || $static))"),virtual:new ke(!0,"class && (prop || func || construct || dispose || event) && !($abstract || $override || $sealed || $static)"),override:new ke(!0,"(class && (prop || func || construct || dispose || event) && ((@virtual || @abstract) && !(virtual || abstract)) && !($sealed || $static))"),sealed:new ke(!0,"(class || ((class && (prop || func || event)) && override))"),private:new ke(!0,"(class || struct) && (prop || func || event) && !($protected || @private || $static)"),protected:new ke(!0,"(class) && (prop || func || event) && !($private || $static)"),readonly:new ke(!0,"(class || struct) && prop && !abstract"),async:new ke(!0,"(class || struct) && func"),privateSet:new ke(!0,"(class || struct) && prop && !($private || $static)"),protectedSet:new ke(!0,"(class) && prop && !($protected || $private || $static)"),overload:new ke("((class || struct) && (func || construct) && !($virtual || $abstract || $override || $args))"),enumerate:new ke("(class || struct) && prop || func || event"),dispose:new ke("class && prop"),post:new ke("(class || struct) && event"),on:new ke("class && func && !(event || $async || $args || $overload || $inject || $static)"),timer:new ke("class && func && !(event || $async || $args || $inject || @timer || $static)"),type:new ke("(class || struct) && prop"),args:new ke("(class || struct) && (func || construct) && !$on && !$overload"),inject:new ke("class && (prop || func || construct) && !(static || session || state)"),resource:new ke("class && prop && !(session || state || inject || asset)"),asset:new ke("class && prop && !(session || state || inject || resource)"),singleton:new ke("(class && !(prop || func || event) && !($abstract || $static)"),serialize:new ke("((class || struct) || ((class || struct) && prop)) && !($abstract || $static || noserialize)"),deprecate:new ke("!construct && !dispose"),session:new ke("(class && prop) && !($static || $state || $readonly || $abstract || $virtual)"),state:new ke("(class && prop) && !($static || $session || $readonly || $abstract || $virtual)"),conditional:new ke("(class || struct) && (prop || func || event)"),noserialize:new ke("(class || struct) && prop"),ns:new ke("(class || struct || mixin || interface || enum) && !(prop || func || event || construct || dispose)"),mixin:new ke("class && (prop || func || event)"),interface:new ke("class && (prop || func || event)")})});for(let e in Te.inbuilt)Te.inbuilt.hasOwnProperty(e)&&($e[`$$${e}`]=((...t)=>{$e(e,...t)}));je.collect=(()=>{let e=Te.bucket.slice();return je.clear(),e}),je.has=(e=>{if("string"!=typeof e)throw y.InvalidArgument("name");return-1!==Te.bucket.findIndex(t=>t.name===e)}),je.get=(e=>{if("string"!=typeof e)throw y.InvalidArgument("name");let t=Te.bucket.findIndex(t=>t.name===e);return-1!==t?Te.bucket[t]:null}),je.count=(()=>Te.bucket.length),je.clear=(()=>{Te.bucket.length=0}),f("$$",$e);const Se=(e,t,n,r,i)=>{let a=je.collect(),o=null,l=null,u=Pe(!0,e,t),p=Pe(!1,e,t);if(r?(o=t.attrs.type,l=t.modifiers.type):(o=e.attrs.members[n],l=e.modifiers.members[n]),!i)for(let e of a)if(e.isCustom)throw y.InvalidOperation(`Custom attribute cannot be applied. (${e.name})`,Fe);const f=i=>{let a=!1,o=c,l=["prop","func","construct","dispose","event"],f=["static","abstract","sealed","virtual","override","private","privateSet","protected","protectedSet","readonly","async"],m=[],d=[],h=i.cfg.constraints;const g=e=>{let t={withWhat:"",matchType:"",original:e,name:"",value:!1};switch(e.substr(0,1)){case"$":t.matchType="anywhere",t.name=e.substr(1);break;case"@":t.matchType="inherited",t.name=e.substr(1);break;default:t.matchType="current",t.name=e;break}e.endsWith("^")?(t.withWhat="typeName",t.name=t.name.replace("^","")):-1!==o.indexOf(t.name)?(t.withWhat="typeType",t.matchType="current"):-1!==l.indexOf(t.name)?(t.withWhat="memberType",t.matchType="current"):f.indexOf(t.name)!==0-1?t.withWhat="modifier":t.withWhat="attribute","struct"===t.name?d.push(t):m.push(t)},b=()=>{let e=new RegExp("[^!&!|()]","g"),t="",n=[],r=0;for(;1&&null!==(t=e.exec(h));)n.push(t);t="",r=0;for(let e of n)r++," "!==e[0]?(t+=e[0],r===n.length&&(""!==t&&g(t),t="")):(""!==t&&g(t),t="");m=m.concat(d)};b();for(let i of m){switch(i.withWhat){case"typeName":switch(i.matchType){case"anywhere":i.value=i.name===t.name||t.Type[s].isDerivedFrom(i.name);break;case"inherited":i.value=t.Type[s].isDerivedFrom(i.name);break;case"current":i.value=i.name===t.name;break}break;case"typeType":i.value=t.type===i.name;break;case"memberType":i.value=!r&&e.members[n]===i.name;break;case"modifier":i.value=r?!!u.type.probe(i.name)[i.matchType]():!!u.members.probe(i.name,n)[i.matchType]();break;case"attribute":i.value=r?!!p.type.probe(i.name)[i.matchType]():!!p.members.probe(i.name,n)[i.matchType]();break}h=$(h,i.original,i.value.toString())}if(!(a=new Function("try {return ("+h+");}catch(e){return false;}")()))throw y.InvalidOperation(`${i.cfg.isModifier?"Modifier":"Attribute"} ${i.name} could not be applied. (${e.name}::${n})`,Fe);return a};for(let n of a)f(n)&&((n=S(n,null,!1,{type:r?t.name:e.name})).isCustom?o.push(n):n.cfg.isModifier?l.push(n):o.push(n))},Pe=(e,t,n)=>{let r=e?"modifiers":"attrs",i=(e,i,s,a)=>{let o=null;if(i&&"construct"===i&&(i="_construct"),i&&"dispose"===i&&(i="_dispose"),a)if(s){let t=n.previous();for(;1&&null!==t&&(t[r]&&t[r].type&&(o=O(t[r].type,"name",e)),!o);)t=t.previous()}else n[r]&&n[r].type&&(o=O(n[r].type,"name",e));else if(s){let n=t.previous();for(;1&&null!==n&&(n[r]&&n[r].members[i]&&(o=O(n[r].members[i],"name",e)),!o);)n=n.previous()}else t[r]&&t[r].members[i]&&(o=O(t[r].members[i],"name",e));return o},s=(e,t,n,r)=>null!==i(e,t,n,r);const a=(e,t)=>{let n;return Object.freeze({anywhere:()=>i(e,t,!1,!1)||i(e,t,!0,!1),current:()=>i(e,t,!1,!1),inherited:()=>i(e,t,!0,!1),only:Object.freeze({current:()=>i(e,t,!1,!1)&&!i(e,t,!0,!1),inherited:()=>!i(e,t,!1,!1)&&i(e,t,!0,!1)})})},o=e=>{let t;return Object.freeze({anywhere:()=>i(e,null,!1,!0)||i(e,null,!0,!0),current:()=>i(e,null,!1,!0),inherited:()=>i(e,null,!0,!0),only:Object.freeze({current:()=>i(e,null,!1,!0)&&!i(e,null,!0,!0),inherited:()=>!i(e,null,!1,!0)&&i(e,null,!0,!0)})})},l=e=>{let n=Object.freeze({current:()=>t[r].members[e].slice(),inherited:()=>{let n=[],i=null,s=t.previous();for(;1&&null!==s;)s[r]&&s[r].members&&(i=O(s[r].members,"name",e)),i&&n.push(...i),s=s.previous();return n},anywhere:()=>[...n.current(),...n.inherited()]});return n},c=()=>{let e=Object.freeze({current:()=>n[r].type.slice(),inherited:()=>{let e=[],t=null,i=n.previous();for(;1&&null!==i;)i[r]&&i[r].type&&(t=i[r].type.slice()),t&&e.push(...t),i=i.previous();return e},anywhere:()=>[...e.current(),...e.inherited()]});return e},u={type:Object.freeze({get:(e,t)=>i(e,null,t,!0),has:(e,t)=>s(e,null,t,!0),all:c,probe:o}),members:{get:(e,t,n)=>i(e,t,n,!1),has:(e,t,n)=>s(e,t,n,!1),all:l,probe:a}};return e&&(u.members.is=((e,t)=>{let n=a(e,t);switch(e){case"static":return n.anywhere();case"abstract":return n.anywhere()&&!(a("virtual",t).anywhere()||a("override",t).anywhere());case"virtual":return n.anywhere()&&!a("override",t).anywhere();case"override":return n.anywhere()&&!a("sealed",t).anywhere();case"sealed":return n.anywhere();case"private":return n.anywhere();case"protected":return n.anywhere();case"readonly":return n.anywhere();case"async":return n.anywhere()}}),u.members.type=(e=>{let n,r="";if(!("type"===t.level)){let n=t;for(;1&&null!==n&&(n.members[e]&&(r=n.members[e]),!r);)n=n.previous()}return r}),u.members.isProperty=(e=>"prop"===u.members.type(e)),u.members.isFunction=(e=>"func"===u.members.type(e)),u.members.isEvent=(e=>"event"===u.members.type(e))),u.members=Object.freeze(u.members),Object.freeze(u)},Ne=e=>{let t={getType:function(){let e;return this.instance.def.Type}},n={id:g()};e.ex.instance=k(e.ex.instance,t,!1),e.mex.instance=k(e.mex.instance,n,!1);let r={getName:function(){let e;return this.type.def.name}},i={id:g()};e.ex.type=k(e.ex.type,r,!1),e.mex.type=k(e.mex.type,i,!1)},Ce=(e,t,n,r,i,s)=>{let a={type:{Type:t,def:r,attrs:i,modifiers:s}};for(let t in e)e.hasOwnProperty(t)&&("function"==typeof e[t]?Object.defineProperty(n,t,{configurable:!0,enumerable:!1,value:e[t].bind(a)}):Object.defineProperty(n,t,{configurable:!0,enumerable:!1,value:e[t]}))},De=(e,t,n,r,i,s,a,o,l,c)=>{let u={instance:{obj:t,def:i,attrs:a,modifiers:o},type:{Type:r,typeDef:s,attrs:l,modifiers:c}};for(let t in e)"function"==typeof e[t]?Object.defineProperty(n,t,{configurable:!0,enumerable:!1,value:e[t].bind(u)}):Object.defineProperty(n,t,{configurable:!0,enumerable:!1,value:e[t]})},Ee=(e,t,n,r,i,...a)=>{let o=t[s],c=o.def(),u="___flag___",p={_flagName:u};if(void 0!==r&&r===u?(p.isNeedProtected=!0,p.isTopLevelInstance=!1,p.staticInterface=e.static?i:null,p.args=a):(p.isNeedProtected=!1,p.isTopLevelInstance=!0,p.staticInterface=e.static?t:null,p.args=void 0!==r?void 0!==i?[r,i].concat(a):[r]:[]),e.singleton&&!c.staticConstructionCycle&&!gt&&p.isTopLevelInstance&&o.singleInstance())return o.singleInstance();let f={},d=null,h=null,g=null,b="_construct",x="_dispose",O={},A={},$=null,j={name:e.params.typeName,type:e.types.type,Type:t,level:"object",members:{},attrs:{members:{}},modifiers:{members:{}},previous:()=>$},T=null,S=!1,P=null,N=e.storage?W("sessionStorage"):null,C=e.storage?W("localStorage"):null;const D=(e,t,n,r)=>{for(let i of ne.members.all(t).current())if(i.isCustom){if("prop"===n){let n=i.attr.decorateProperty(j.name,t,r);if(!n.get||!n.set)throw y.OperationFailed(`${i.name} decoration result is unexpected. (${j.name}::${t})`,Fe);n.get=n.get.bind(e),n.set=n.set.bind(e),r=n}else{let s=null;if("func"===n){if(s=i.attr.decorateFunction(j.name,t,r),w(r)!==w(s))throw y.OperationFailed(`${i.name} decoration result is unexpected. (${j.name}::${t})`,Fe)}else s=i.attr.decorateEvent(j.name,t,r);if(!s)throw y.OperationFailed(`${i.name} decoration result is unexpected. (${j.name}::${t})`,Fe);r=s.bind(e)}i.attr=null}return r},M=(e,t)=>{let n=null,r=[];return r=et(j.name,e),j.aspects.members[e]=r,r.length>0&&(n=tt(t,j.name,e,r))&&(t=n),t},_=()=>{let r=!1,i=e=>{Object.defineProperty(f,e,Object.getOwnPropertyDescriptor(n,e))},a=Object.getOwnPropertyDescriptor(n,s);a.enumerable=!1,Object.defineProperty(f,s,a),h=f[s];for(let e in n)if(r=!1,n.hasOwnProperty(e)&&e!==s){if(r=!0,j.members[e]?(ee.members.probe("private",e).current()&&(r=!1),r&&ee.members.probe("protected",e).current()&&!p.isNeedProtected&&(r=!1)):ee.members.probe("protected",e).anywhere()&&!p.isNeedProtected&&(r=!1),r&&i(e),r&&ee.members.isProperty(e))if(ee.members.probe("privateSet",e).current()){let t=Object.getOwnPropertyDescriptor(f,e);t.set=m,Object.defineProperty(f,e,t)}else if(ee.members.probe("protectedSet",e).current()&&!p.isNeedProtected){let t=Object.getOwnPropertyDescriptor(f,e);t.set=m,Object.defineProperty(f,e,t)}if(r&&ee.members.is("abstract",e)){if(!p.isNeedProtected)throw y.NotImplemented(`Abstract member is not implemented. (${j.name}::${e})`,Fe);if(!ee.type.probe("abstract").current())throw y.InvalidDefinition(`Abstract member can exists only in abstract type. (${j.name}::${e})`,Fe)}if(r){let t=ne.members.probe("enumerate",e).current();if(t&&!1===t.args[0]){let t=Object.getOwnPropertyDescriptor(f,e);t.enumerable=!1,Object.defineProperty(f,e,t)}}r&&!p.isNeedProtected&&ee.members.isEvent(e)&&f[e].strip(f)}p.isTopLevelInstance&&(De(e.ex.instance,f,f,t,j,c,ne,ee,o.attrs,o.modifiers),De(e.mex.instance,f,h,t,j,c,ne,ee,o.attrs,o.modifiers)),p.isTopLevelInstance||(h.def=j)},q=(t,n)=>{if((-1===Object.keys(f).indexOf(t)||ee.members.type(t)!==n[s].modifiers.members.type(t))&&("dispose"!==t||"function"!=typeof f[x]&&"function"!=typeof h.dispose))throw y.NotImplemented(`Interface member is not implemented. (${n[s].name+":"+t})`,Fe);je("interface",n[s].name),Se(j,c,t,!1,e.customAttrs)},L=()=>{if(j.interfaces){for(let e of j.interfaces)for(let t in e)e.hasOwnProperty(t)&&q(t,e);delete j.interfaces}},B=(t,n,r)=>{switch(-1!==["func","prop","event"].indexOf(n)&&t.startsWith("_")&&new y("InvalidName",`Name is not valid. (${j.name}::${t})`),n){case"func":if(!e.func)throw y.InvalidOperation(`Function cannot be defined on this type. (${j.name})`,Fe);break;case"prop":if(!e.prop)throw y.InvalidOperation(`Property cannot be defined on this type. (${j.name})`,Fe);break;case"event":if(!e.event)throw y.InvalidOperation(`Event cannot be defined on this type. (${j.name})`,Fe);break;case"construct":if(!e.construct)throw y.InvalidOperation(`Constructor cannot be defined on this type. (${j.name})`,Fe);n="func";break;case"dispose":if(!e.dispose)throw y.InvalidOperation(`Dispose cannot be defined on this type. (${j.name})`,Fe);n="func";break}return n},V=(t,r,i)=>{let s=!0,a=ne.members.probe("conditional",t).current();if(a){let e=I(a.args[0]||[]);for(let t of e){if("test"!==(t=t.toLowerCase())||!l.env.isTesting){s=!1;break}if("server"!==t||!l.env.isServer){s=!1;break}if("client"!==t||!l.env.isClient){s=!1;break}if("worker"!==t||!l.env.isWorker){s=!1;break}if("main"!==t||!l.env.isMain){s=!1;break}if("debug"!==t||!l.env.isDebug){s=!1;break}if("prod"!==t||!l.env.isProd){s=!1;break}if("cordova"!==t||!l.env.isCordova){s=!1;break}if("nodewebkit"!==t||!l.env.isNodeWebkit){s=!1;break}if(-1===l.symbols.indexOf(t)){s=!1;break}}if(!s)return s}if(e.inheritance&&ee.members.probe("abstract",t).current()&&!0!==i.ni)throw y.InvalidDefinition(`Abstract member must not be implemented. (${j.name}::${t})`,Fe);if((a=ee.type.probe("static").current())&&e.static)if(o.isStatic()){if(e.construct&&t===b&&0!==i.length)throw y.InvalidDefinition(`Static constructors cannot have arguments. (${j.name}::construct)`,Fe);if(e.dispose&&t===x)throw y.InvalidDefinition(`Static types cannot have destructors. (${j.name}::dispose)`,Fe)}else{if(e.construct&&t===b)throw y.InvalidDefinition(`Non-static types cannot have static constructors. (${j.name}::construct)`,Fe);if(e.dispose&&t===x)throw y.InvalidDefinition(`Static destructors cannot be defined. (${j.name}::dispose)`,Fe)}if(e.dispose&&t===x&&0!==i.length)throw y.InvalidDefinition(`Destructor method cannot have arguments. (${j.name}::dispose)`,Fe);if(-1!==Object.keys(n).indexOf(t)&&(!e.inheritance||e.inheritance&&!ee.members.probe("override",t).current()))throw y.Duplicate(j.name+"::"+t,Fe);if(e.inheritance&&ee.members.probe("override",t).current()){if(-1===Object.keys(n).indexOf(t))throw y.InvalidDefinition(`Member not found to override. (${j.name}::${t})`,Fe);if(ee.members.type(t)!==r)throw y.InvalidDefinition(`Overriding member type is invalid. (${j.name}::${t})`,Fe)}if(e.static&&(ee.members.probe("static",t).current()||o.isStatic()))if("func"===r){if(v(i))throw y.InvalidDefinition(`Static functions cannot be defined as an arrow function. (${j.name}::${t})`,Fe)}else if("prop"===r){if(i.get&&"function"==typeof i.get&&v(i))throw y.InvalidDefinition(`Static property getters cannot be defined as an arrow function. (${j.name}::${t})`,Fe);if(i.set&&"function"==typeof i.set&&v(i))throw y.InvalidDefinition(`Static property setters cannot be defined as an arrow function. (${j.name}::${t})`,Fe)}if(e.storage&&ne.members.probe("session",t).current()&&i.get&&"function"==typeof i.get)throw y.InvalidDefinition(`Session properties cannot be defined with a custom getter/setter. (${j.name}::${t})`,Fe);if(e.storage&&ne.members.probe("state",t).current()){if(i.get&&"function"==typeof i.get)throw y.InvalidDefinition(`State properties cannot be defined with a custom getter/setter. (${j.name}::${t})`,Fe);if(!C)throw y.InvalidOperation("Port is not configured. (localStorage)",Fe)}return s},G=(t,r,i)=>{let a={get:null,set:null},o=m,l=m,c=ee.members.probe("readonly",t).anywhere(),u=ee.members.probe("static",t).anywhere(),f=ne.members.probe("session",t).anywhere(),d=ne.members.probe("state",t).anywhere(),h=ne.members.probe("deprecate",t).current(),g=ne.members.probe("inject",t).current(),b=ne.members.probe("asset",t).current(),v=ne.members.probe("resource",t).current(),w=ne.members.probe("type",t).current(),x=null!==h,I=x?h.args[0]||`Event is marked as deprecate. (${j.name}::${t})`:"",A=O,$=n,k=j.name+"_"+t,T=!1,S=null;if(i&&(i.get||i.set)){if(!e.propGetterSetter)throw y.InvalidDefinition(`Getter/Setter are not allowed. (${j.name}::${t})`,Fe);i.get&&"function"==typeof i.get&&(o=i.get),i.set&&"function"==typeof i.set&&(l=i.set),e.static&&u&&($=p.staticInterface),a.get=function(){return x&&console.log(I),o.apply($)}.bind($),a.set=function(e){if(x&&console.log(I),c&&!$[s].constructing)throw y.InvalidOperation(`Property is readonly. (${j.name}::${t})`,Fe);if(w&&w.args[0]&&!z(e,w.args[0]))throw y.InvalidArgument("value",Fe);return l.apply($,[e])}.bind($)}else{if(e.static&&u){if(A=p.staticInterface[s].props,$=p.staticInterface,w&&w.args[0]&&!z(i,w.args[0]))throw y.InvalidArgument("value",Fe);A[k]=i}else if(e.storage&&(f||d)){if(T=!0,f?(A=N,k=n[s].id+"_"+k):A=C,Z(f?"session":"state",k),!A.key(k)){if(w&&w.args[0]&&!z(i,w.args[0]))throw y.InvalidArgument("value",Fe);A.setItem(k,JSON.stringify({value:i}))}}else{if(w&&w.args[0]&&!z(i,w.args[0]))throw y.InvalidArgument("value",Fe);if(e.numOnlyProps&&"number"!=typeof i)throw y.InvalidArgument("value",Fe);A[k]=i}a.get=function(){return x&&console.log(I),T?JSON.parse(A.getItem(k)).value:A[k]}.bind($),a.set=function(e){if(x&&console.log(I),c&&!$[s].constructing)throw y.InvalidOperation(`Property is readonly. (${j.name}::${t})`,Fe);if(w&&w.args[0]&&!z(e,w.args[0]))throw y.InvalidArgument("value",Fe);T?A.setItem(k,JSON.stringify({value:e})):A[k]=e}.bind($)}if(g&&!u&&!T){let e=g.args[0],t=g.args.length>0?g.args[1]:[],n=g.args.length>1&&g.args[2],r=null;try{switch(E(e)){case"class":case"struct":r=t;break;case"string":if(r=se(e)){if(-1===["class","struct"].indexOf(E(r)))throw y.InvalidArgument("inject",Fe)}else S=Je.resolve(e,t,n),Array.isArray(S)||(S=[S]);break;default:throw y.InvalidArgument("inject",Fe)}!S&&r&&(S=[],t.length>0?S.push(new r(...t)):S.push(new r))}catch(e){throw new y(e,Fe)}a.set(S)}if((ne.members.probe("dispose",t).anywhere()||g)&&Z("prop",t),(v||b)&&!T){let e=null;if(v)v.args[0]&&(e=re(v.args[0]));else if(b.args[0]){let t=b.args[0];t.startsWith("../")&&(t=t.substr(3)),t.startsWith("./")&&(t=t.substr(2)),t.startsWith("/")&&(t=t.substr(1)),e=te(j.name)+"/"+t}e&&a.set(e)}return e.customAttrs&&(a=D($,t,r,a)),a},J=(t,r,i)=>{if("func"===r){let r=je.get("overload");if(r){let s,a=e.static&&ee.members.probe("static",t).current()?p.staticInterface:n;if(H(t,i,r),a[t]){if(je.count()>1)throw y.InvalidDefinition(`Overloaded function cannot define additional modifiers or attributes. (${j.name}::${t})`,Fe);return!0}}}return!1},H=(t,r,i)=>{let a=e.static&&ee.members.probe("static",t).current(),o=a?p.staticInterface:n,l,c,u;(a?o[s].overloads:A)[t+"_"+I(i.args[0]).join("_")]=r},X=(t,...r)=>{let i=e.static&&ee.members.probe("static",t).current(),a=i?p.staticInterface:n,o=i?a[s].overloads:A,l="",c="";for(let e of r)l+="_"+typeof e;return l.startsWith("_")&&(l=l.substr(1)),o[c=t+"_"+l]||null},K=(t,r,i)=>{let a=null,o=n,l=e.inheritance&&ee.members.probe("override",t).current(),c=e.static&&ee.members.probe("static",t).current(),u=ee.members.probe("async",t).current(),f=ne.members.probe("deprecate",t).current(),d=ne.members.probe("inject",t).current(),h=ne.members.probe("on",t).current(),y=ne.members.probe("timer",t).current(),g=ne.members.probe("args",t).current(),b=ne.members.probe("overload",t).current(),v=null!==f,x=v?f.args[0]||`Function is marked as deprecate. (${j.name}::${t})`:"",O=null,I=[];if(l?!0!==(O=n[t].bind(o)).ni&&O!==m||(O=null):c&&(o=p.staticInterface),d){let e=d.args[0],t=d.args.length>0?d.args[1]:[],n=d.args.length>1&&d.args[2];I=Je.resolve(e,t,n),Array.isArray(I)||(I=[I])}if(a=(u=u||w(i))?async function(...e){return new Promise(function(n,r){v&&console.log(x);let s=[];if(O&&s.push(O),I.length>0&&s.push(I),g&&g.args.length>0){let t=F(...g.args)(...e);t.error&&r(t.error,i),s.push(t)}else s=s.concat(e);b&&(i=X(t,...s));try{let e=i.apply(o,s);"function"==typeof e.then?e.then(n).catch(e=>{r(e,i)}):n(e)}catch(e){r(e,i)}}.bind(o))}.bind(o):function(...e){v&&console.log(x);let n=[];if(O&&n.push(O),I.length>0&&n.push(I),g&&g.args.length>0){let t=F(...g.args)(...e);t.throwOnError(Fe),n.push(t)}else n=n.concat(e);return b&&(i=X(t,...n)),i.apply(o,n)}.bind(o),e.customAttrs&&(a=D(o,t,r,a)),e.aop&&(a=M(t,a)),h&&h.args.length>0&&(Be(h.args[0],a),Z("handler",{name:h.args[0],handler:a})),y&&y.args.length>0){let e=!1,r=setInterval(()=>{o[s].constructing||e||(e=!0,n[t](),e=!1)},1e3*y.args[0]);Z("timer",r)}return a},Q=(t,r,i)=>{let a=null,o=null,l=null,c=null,u=e.inheritance&&ee.members.probe("override",t).current(),p=ne.members.probe("deprecate",t).current(),m=ne.members.probe("post",t).current(),d=null!==p,h=d?p.args[0]||`Event is marked as deprecate. (${j.name}::${t})`:"",y=n;return P||(P=new U(j.name),Z("event",P)),u&&!0===(l=n[t][s].processor).ni&&(l=null),a=function(...e){return d&&console.log(h),c=l?[l].concat(e):e,i.apply(y,c)}.bind(y),e.customAttrs&&(a=D(y,t,r,a)),o=a,(a=function(...e){let n=e;"function"==typeof o&&(n=o(...e)),P.dispatch(t,n),m&&m.args.length>0&&Ve(m.args[0],n)}.bind(y))[s]=Object.freeze({processor:o}),a.add=(e=>{P.add(t,e)}),a.remove=(e=>{P.remove(t,e)}),a.strip=(e=>{let n=k({},a,!0,["strip"]);delete a.strip,delete e.strip,Object.defineProperty(f,t,{configurable:!0,enumerable:!0,value:Object.freeze(n)})}),a},Y=(t,r,i)=>{if(r=B(t,r,i),J(t,r,i))return;j.members[t]=r,j.attrs.members[t]=[],j.modifiers.members[t]=[],e.aop&&(j.aspects={members:{}}),e.mixins&&null!==g&&je("mixin",g[s].name),Se(j,c,t,!1,e.customAttrs);let a=null,o=e.static&&ee.members.probe("static",t).current(),l=o?p.staticInterface:n;if(o){if(!c.staticConstructionCycle)return}else if(c.staticConstructionCycle)return;if(V(t,r,i))switch(r){case"func":a=K(t,r,i),Object.defineProperty(l,t,{configurable:!0,enumerable:!0,value:a});break;case"prop":a=G(t,r,i),Object.defineProperty(l,t,{configurable:!0,enumerable:!0,get:a.get,set:a.set});break;case"event":a=Q(t,r,i),Object.defineProperty(l,t,{configurable:!0,enumerable:!0,value:a});break}},Z=(e,t)=>{d.disposables.push({type:e,data:t})},ee=Pe(!0,j,c),ne=Pe(!1,j,c);if(e.inheritance){if(p.isTopLevelInstance&&!c.staticConstructionCycle&&!gt&&ee.type.probe("abstract").current())throw y.InvalidOperation(`Cannot create instance of an abstract type. (${j.name})`,Fe);let e=o.inherits,t=null;if(e){if((t=e[s]).isSealed()||t.isSingleton()||t.isStatic())throw y.InvalidDefinition(`Cannot inherit from a sealed, static or singleton type. (${t.name})`,Fe);if(t.type!==o.type)throw y.InvalidDefinition(`Cannot inherit from another type family. (${t.type})`,Fe);if(t.context&&t.context.isUnloaded())throw y.InvalidOperation(`Parent context is not active anymore. (${t.name})`,Fe);n=new e(p._flagName,p.staticInterface,p.args),d=n[s],$=d.def,delete d.def}else if(o.context&&o.context.isUnloaded())throw y.InvalidOperation(`Type context is not active anymore. (${o.name})`,Fe)}if(void 0===n[s]&&(n[s]={},d=n[s],e.dispose&&(d.disposables=[])),e.mixins&&(j.mixins=e.params.mixins),e.interfaces&&(j.interfaces=e.params.interfaces),d.type=e.types.instance,p.isTopLevelInstance&&(d.Type=t,e.new&&(d.isInstanceOf=(e=>{if(e[s]&&(e=e[s].name),!e)throw y.InvalidArgument("name",Fe);return o.name===e||o.isDerivedFrom(e)})),e.mixins&&(d.isMixed=(e=>o.isMixed(e))),e.interfaces&&(d.isImplements=(e=>o.isImplements(e))),d.modifiers=ee,d.attrs=ne,gt&&(d.def=j,d.typeDef=c,d.obj=n)),T=new Proxy({},{get:(e,t)=>n[t],set:(e,t,r)=>{if(S){let e="";"construct"===t?(e="construct",t=b):"dispose"===t?(e="dispose",t=x):"function"==typeof r?!0===r.event?(r!==R&&delete r.event,e="event"):e="func":e="prop",Y(t,e,r)}else{if("function"==typeof r)throw y.InvalidOperation(`Redefinition of members is not allowed. (${t})`,Fe);n[t]=r}return!0}}),S=!0,e.mixins&&j.mixins&&!c.staticConstructionCycle){for(let e of j.mixins)g=e,e.apply(T),g=null;delete j.mixins}if(e.params.factory.apply(T),je.clear(),S=!1,p.isTopLevelInstance&&(e.construct&&"function"==typeof n[b]&&(d.construct=n[b],delete n[b]),e.dispose&&"function"==typeof n[x])){let e=n[x];delete n[x],d.dispose=(()=>{for(let e of d.disposables)switch(e.type){case"session":N.removeItem(e.data);break;case"state":C.removeItem(e.data);break;case"prop":n[e.data]=null;break;case"event":e.data.clear();break;case"handler":Be(e.data.name,e.data.handler,!0);break;case"timer":clearInterval(e.data);break}"function"==typeof e&&e(),d.disposables.length=0,O=null,$=null,j=null,T=null,P=null,f=null,n=null})}return e.static&&o.isStatic()&&c.staticConstructionCycle&&t.construct&&"function"==typeof t[b]&&(o.construct=t[b],delete t[b]),_(),!e.interfaces||c.staticConstructionCycle||gt||L(),e.construct&&p.isTopLevelInstance&&!c.staticConstructionCycle&&!gt&&"function"==typeof h.construct&&(h.constructing=!0,h.construct(...p.args),delete h.constructing),e.construct&&c.staticConstructionCycle&&"function"==typeof o.construct&&(o.constructing=!0,o.construct(),delete o.constructing),!p.isTopLevelInstance||c.staticConstructionCycle||gt||e.singleton&&ne.type.probe("singleton").current()&&(o.singleInstance=(()=>f),o.singleInstance.clear=(()=>{o.singleInstance=(()=>null)})),!p.isTopLevelInstance||c.staticConstructionCycle||gt||(h=Object.freeze(h),f=Object.seal(f)),f},ze=()=>{let t=W("sessionStorage");t?t.clear():e?(!0).sessionStorage&&delete global.sessionStorage:sessionStorage.clear()},Fe=e=>{if(e.new=e.new||!1,e.mixins=e.mixins||!1,e.interfaces=e.interfaces||!1,e.inheritance=e.inheritance||!1,e.singleton=e.singleton||!1,e.static=e.static||!1,e.const=e.const||!1,e.func=e.func||!1,e.construct=e.construct||!1,e.dispose=e.dispose||!1,e.prop=e.prop||!1,e.propGetterSetter=e.propGetterSetter||!1,e.numOnlyProps=e.numOnlyProps||!1,e.event=e.event||!1,e.storage=e.storage||!1,e.aop=e.aop||!1,e.customAttrs=e.customAttrs||!1,e.types=e.types||{},e.types.instance=e.types.instance||"unknown",e.types.type=e.types.type||"unknown",e.params=e.params||{},e.params.typeName=e.params.typeName||"",e.params.inherits=e.params.inherits||null,e.params.mixinsAndInterfaces=e.params.mixinsAndInterfaces||null,e.params.factory=e.params.factory||null,e.mex=e.mex||{},e.mex.instance=e.mex&&e.mex.instance?e.mex.instance:{},e.mex.type=e.mex&&e.mex.type?e.mex.type:{},e.ex=e.ex||{},e.ex.instance=e.ex&&e.ex.instance?e.ex.instance:{},e.ex.type=e.ex&&e.ex.type?e.ex.type:{},e.params.ns="",e.params.mixins=[],e.params.interfaces=[],e.func||(e.construct=!1,e.dispose=!1),e.prop||(e.storage=!1),e.inheritance||(e.singleton=!1),e.func||e.prop||e.event||(e.aop=!1),e.new&&(e.const=!1),!e.params.typeName||-1!==e.params.typeName.indexOf("."))throw y.InvalidDefinition(`Type name is invalid. (${e.params.typeName})`,Fe);let t=je.get("ns"),n=t?t.args[0]:"";if(n)switch(n){case"(auto)":throw y.InvalidDefinition(`Namespace '(auto)' should be used only when bundling the type in an assembly. (${n})`,Fe);case"(root)":break;default:if(n.startsWith(".")||n.endsWith(".")||/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g.test(n))throw`Namespace name is invalid. (${n})`;e.params.typeName=n+"."+e.params.typeName,e.params.ns=n;break}if(e.params.mixinsAndInterfaces)for(let t of e.params.mixinsAndInterfaces)if(t[s])switch(t[s].type){case"mixin":e.params.mixins.push(t);break;case"interface":e.params.interfaces.push(t);break}delete e.params.mixinsAndInterfaces,Ne(e);let r=Y.context.current(),i=r.currentAssemblyBeingLoaded()||"",a=null,o=null;if(e.new)if(e.inheritance){if(e.params.inherits&&(fe(e.params.inherits)||me(e.params.inherits)||pe(e.params.inherits)))throw y.InvalidDefinition(`Cannot inherit from a sealed, static or singleton type. (${e.params.inherits[s].name})`,Fe);a=function(t,n,...r){return Ee(e,a,{},t,n,...r)}}else a=function(...t){return Ee(e,a,{},null,null,...t)};else a=e.const?function(){return Ee(e,a,{})}:function(...t){if(new.target)throw y.InvalidOperation(`Construction cannot be done for this type. (${e.params.typeName})`,a);e.params.factory.apply(this,...t)};let l={name:e.params.typeName,type:e.types.type,Type:a,level:"type",attrs:{type:[]},modifiers:{type:[]},previous:()=>a[s].inherits?a[s].inherits[s].def():null};const c=Pe(!0,null,l),u=Pe(!1,null,l);if(a[s]={},(o=a[s]).name=e.params.typeName,o.type=e.types.type,o.namespace=null,o.assembly=(()=>r.getAssembly(i)||null),o.context=r,e.inheritance&&(o.inherits=e.params.inherits||null,o.isAbstract=(()=>!!c.type.probe("abstract").current()),o.isSealed=(()=>!!c.type.probe("sealed").current()),o.isDerivedFrom=(t=>{if(t[s]&&(t=t[s].name),"string"!=typeof t)throw y.InvalidArgument("name",o.isDerivedFrom);let n=!1,r=e.params.inherits;if(!n)for(;1&&null!==r;){if(r[s].name===t){n=!0;break}r=r[s].inherits}return n}),o.inherits)){let e=u.type.probe("deprecate").anywhere();if(e){let t=e.args[0]||`Type is marked as deprecated. (${o.name})`;console.log(t)}}if(e.static&&(o.isStatic=(()=>!!c.type.probe("static").current()),o.props={},o.overloads={}),e.singleton&&(o.isSingleton=(()=>!!u.type.probe("singleton").current()),o.singleInstance=(()=>null),o.singleInstance.clear=m),e.mixins&&(o.mixins=e.params.mixins,o.isMixed=(e=>{if(e[s]&&(e=e[s].name),"string"!=typeof e)throw y.InvalidArgument("name",o.isMixed);let t=!1,n=a;for(;1&&null!==n&&(n[s].mixins&&(t=-1!==O(n[s].mixins,"name",e)),!t);)n=n[s].inherits;return t})),e.interfaces&&(o.interfaces=e.params.interfaces,o.isImplements=(e=>{if(e[s]&&(e=e[s].name),"string"!=typeof e)throw y.InvalidArgument("name",o.isImplements);let t=!1,n=a;for(;1&&null!==n&&(n[s].interfaces&&(t=-1!==O(n[s].interfaces,"name",e)),!t);)n=n[s].inherits;return t})),o.isDeprecated=(()=>!!u.type.probe("deprecate").current()),o.def=(()=>l),o.modifiers=c,o.attrs=u,Se(null,l,null,!0,e.customAttrs),e.static&&c.type.probe("static").current()){if(e.params.interfaces.length>0)throw y.InvalidDefinition("Static types cannot implement interfaces.",Fe);if(e.params.mixins.length>0)throw y.InvalidDefinition("Static types cannot implement mixins.",Fe)}if(e.static){let t=e.params.factory?e.params.factory.toString():"";if(o.isStatic()||-1!==t.indexOf(`$$('static')`)||-1!==t.indexOf(`$$("static")`)){l.staticConstructionCycle=!0;let e=new a;Ie(e),delete l.staticConstructionCycle}}Ce(e.ex.type,a,a,l,u,c),Ce(e.mex.type,a,o,l,u,c);let p=null,f=!1;return e.static&&o.isStatic()||e.const?(p=new a,e.const&&(f=!0)):(f=!0,p=a),n&&(o.namespace=Y.context.current().registerType(p)),a[s]=Object.freeze(o),f&&Object.freeze(p),p},Me=(e,t,n,r)=>{let i=F("name: string, inherits: class, factory: cfunction","name: string, inherits: class, mixints: array, factory: cfunction","name: string, factory: cfunction","name: string, mixints: array, factory: cfunction")(e,t,n,r);i.throwOnError(Me);let s={new:!0,mixins:!0,interfaces:!0,inheritance:!0,singleton:!0,static:!0,func:!0,construct:!0,dispose:!0,prop:!0,propGetterSetter:!0,event:!0,storage:!0,aop:!0,customAttrs:!0,types:{instance:"instance",type:"class"},params:{typeName:i.values.name,inherits:i.values.inherits,mixinsAndInterfaces:i.values.mixints,factory:i.values.factory},mex:{instance:{},type:{}},ex:{instance:{},type:{}}};return Fe(s)};f("Class",Me);const Re=(e,t)=>{let n=F("name: string, factory: cfunction")(e,t);n.throwOnError(Re);let r={const:!0,func:!0,dispose:!0,prop:!0,propGetterSetter:!0,event:!0,types:{instance:"interface",type:"interface"},params:{typeName:n.values.name,factory:n.values.factory}};return Fe(r)};f("Interface",Re);const Ue=(e,t)=>{let n=F("name: string, factory: cfunction")(e,t);n.throwOnError(Ue);let r={new:!0,func:!0,construct:!0,prop:!0,propGetterSetter:!0,types:{instance:"sinstance",type:"struct"},params:{typeName:n.values.name,factory:n.values.factory}};return Fe(r)};f("Struct",Ue);const _e=(e,t)=>{let n=F("name: string, factory: cfunction")(e,t);n.throwOnError(_e);let r={const:!0,prop:!0,numOnlyProps:!0,types:{instance:"enum",type:"enum"},params:{typeName:n.values.name,factory:n.values.factory},mex:{instance:{getName:function(e){let t=this.instance.obj,n=this.instance.def,r="";for(let i in n.members)if(n.members.hasOwnProperty(i)&&"prop"===n.members[i]&&t[i]===e){r=i;break}return r},getNames:function(){let e=this.instance.def,t=[];for(let n in e.members)e.members.hasOwnProperty(n)&&"prop"===e.members[n]&&t.push(n);return t},getValues:function(){let e=this.instance.def,t=this.instance.obj,n=[];for(let r in e.members)e.members.hasOwnProperty(r)&&"prop"===e.members[r]&&n.push(t[r]);return n}}}};return Fe(r)};_e.getName=((e,t)=>{let n;return F("enumType: enum, enumValue: number")(e,t).throwOnError(_e.getName),e[s].getName(t)}),_e.getNames=(e=>{let t;return F("enumType: enum")(e).throwOnError(_e.getNames),e[s].getNames()}),_e.getValues=(e=>{let t;return F("enumType: enum")(e).throwOnError(_e.getValues),e[s].getValues()}),_e.isDefined=((e,t)=>{let n=F("enumType: enum, nameOrValue: number","enumType: enum, nameOrValue: string")(e,t);return n.throwOnError(_e.isDefined),1===n.index?-1!==e[s].getNames().indexOf(t):""!==e[s].getName(t)}),f("Enum",_e);const We=(e,t)=>{let n=F("name: string, factory: cfunction")(e,t);n.throwOnError(We);let r={func:!0,prop:!0,propGetterSetter:!0,event:!0,customAttrs:!0,types:{type:"mixin"},params:{typeName:n.values.name,factory:n.values.factory}};return Fe(r)};f("Mixin",We);const qe=new U,Le=qe.dispatch,Be=(e,t,n)=>{let r;F("event: string, handler: afunction")(e,t).throwOnError(Be),n?qe.remove(e,t):qe.add(e,t)};f("on",Be,()=>{qe.clear()});const Ve=(e,t)=>{if("string"!=typeof e)throw y.InvalidArgument("event",Ve);Le(e,t)};f("post",Ve);let Ge={};const Je={isRegistered:e=>{if("string"!=typeof e)throw y.InvalidArgument("alias",Je.isRegistered);return void 0!==Ge[e]&&Ge[e].length>0},get:(e,t)=>{if("string"!=typeof e)throw y.InvalidArgument("alias",Je.get);return t?Ge[e]?Ge[e].slice():[]:Ge[e]?Ge[e][0]:null},register:(e,t)=>{if("string"!=typeof e)throw y.InvalidArgument("alias",Je.register);if(!t)throw y.InvalidArgument("item",Je.register);if(-1!==e.indexOf("."))throw y.InvalidArgument("alias",Je.register);"string"==typeof t&&((t=b(t)).endsWith(".js")||t.endsWith(".mjs"))&&(t=b(t,!0)),Ge[e]||(Ge[e]=[]),Ge[e].push(t)},resolve:(e,t,...n)=>{if("string"!=typeof e)throw y.InvalidArgument("alias",Je.resolve);if("boolean"!=typeof t)throw y.InvalidArgument("isAll",Je.resolve);let r=null;const i=e=>{let t=e;if("string"==typeof e)if(e.endsWith(".js")||e.endsWith(".mjs"));else{let t=se(e);t&&(e=t)}if(-1!==["class","struct"].indexOf(E(e)))try{t=n?new e(...n):new e}catch(t){throw y.OperationFailed(`Type could not be instantiated. (${e[s].name})`,Je.resolve)}return t};return Ge[e]&&Ge[e].length>0&&(t?(r=[],Ge[e].forEach(e=>{r.push(i(e))})):r=i(Ge[e][0])),r}};f("Container",Je,()=>{Ge={}});let He=m,Xe=[],Ke=500;const Qe={on:(e,...t)=>{He===m&&("string"==typeof e?t.unshift(e):"function"==typeof e&&Be("telemetry",e),He=((e,n)=>{if(0===t.length||-1!==t.indexOf(e)){let t=Object.freeze({type:e,data:n});Xe.push(t),Xe.length>Ke-25&&Xe.splice(0,25),Ve("telemetry",t)}}))},collect:()=>{if(He!==m){let e=Xe.slice();return Xe.length=0,e}return[]},off:e=>He!==m?("function"==typeof e&&Be("telemetry",e,!0),He=m,Qe.collect()):[],isOn:()=>He!==m,types:Object.freeze({RAW:"raw",EXEC:"exec",INFO:"info",INCL:"incl"})};f("telemetry",Qe,()=>{Xe.length=0});const Ye=[],Ze={register:(e,t)=>{let n;F("pointcut: string, aspect: Aspect")(e,t).throwOnError(Ze.register);let r=e,i="",s="",a="",o="",l=null;-1!==r.indexOf(":")&&(r=(l=r.split(":"))[0].trim(),a=l[1].trim()||"*"),-1!==r.indexOf(".")?(i=r.substr(0,r.lastIndexOf(".")),s=r.substr(r.lastIndexOf(".")+1)):(i="",s=r),o=$(o=i+"/"+s+":"+a,".","[.]"),o=$(o,"?","."),o=$(o,"*",".*"),Ye.push({rex:new RegExp(o),Aspect:t})}},et=(e,t)=>{let n=[],r="",i="",a=t.trim(),o="";return-1!==e.indexOf(".")?(r=e.substr(0,e.lastIndexOf(".")).trim(),i=e.substr(e.lastIndexOf(".")+1).trim()):(r="",i=e.trim()),o=r+"/"+i+":"+a,Ye.forEach(e=>{e.rex.test(o)&&-1===x(n,"name",e.Aspect[s].name)&&n.push({name:e.Aspect[s].name,Aspect:e.Aspect})}),n},tt=(e,t,n,r)=>{let i=[],s=[],a=[],o=null,l;for(let e of r)(o=new e.Aspect).before!==m&&i.push(o.before),o.around!==m&&a.push(o.around),o.after!==m&&s.push(o.after);return a.length>0&&a.reverse(),function(...r){let o=null,l=null,c={typeName:()=>t,funcName:()=>n,error:e=>(e&&(o=e),o),result:e=>(void 0!==e&&(l=e),l),args:()=>r,data:{}};for(let e of i)try{e(c)}catch(e){o=e}const u=e=>{for(let t of s)try{t(e)}catch(e){c.error(e)}};let p=e,f=null;for(let e of a)p=e(c,p);try{(f=p(...r))&&"function"==typeof f.then?c.result(new Promise((e,t)=>{f.then(t=>{c.result(t),u(c),e(c.result())}).catch(e=>{c.error(e),u(c),t(c.error())})})):(c.result(f),u(c))}catch(e){c.error(e)}return c.result()}};f("Aspects",Ze,()=>{Ye.length=0});const nt=(e,t)=>{let n=null,r=null,i=t?JSON.parse(e):e,a=t?null:e[s].Type,o=a[s];const l=(e,t)=>{let n=e[s],r=n.attrs,i=n.modifiers,a=[],o=!1;for(let n in e)e.hasOwnProperty(n)&&n!==s&&((o=i.members.isProperty(n))&&(o=t?!r.members.probe("noserialize",n).anywhere():r.members.probe("serialize",n).anywhere())&&(o=!(i.members.is("private",n)||i.members.is("protected",n)||i.members.is("static",n)||i.members.is("readonly",n)||r.members.probe("resource",n).anywhere()||r.members.probe("asset",n).anywhere()||r.members.probe("inject",n).anywhere())),o&&a.push(n));return a};if(t){if(!i.type&&!i.data)throw y.InvalidArgument("json");if(!(a=se(i.type)))throw y.NotFound(i.type,rt.deserialize);try{n=new a}catch(e){throw y.OperationFailed(`Object could not be deserialized. (${i.type})`,e,rt.deserialize)}r=o.attrs.type.probe("serialize").anywhere()?l(n,!0):l(n,!1);for(let e of r)n[e]=i.data[e]}else{r=o.attrs.type.probe("serialize").anywhere()?l(i,!0):l(i,!1),n={type:i[s].Type[s].name,data:{}};for(let e of r)n.data[e]=i[e];try{n=JSON.stringify(n)}catch(e){throw y.OperationFailed(`Object could not be serialized. (${i[s].Type[s].name})`,e,rt.serialize)}}return n},rt={serialize:e=>{if(u.indexOf(-1===E(e)))throw y.InvalidArgument("instance",rt.serialize);return nt(e)},deserialize:e=>{if(!e||"string"!=typeof e)throw y.InvalidArgument("json",rt.deserialize);return nt(e,!0)}};f("Serializer",rt);const it=4*l.env.cores,st=Math.round(it/4),at=[],ot=()=>{if(at.length<=st)return;let e=at.slice(0),t=()=>{if(0!==e.length){let n=e.shift();n.context.isBusy()?t():n.context.hasActiveInstances().then(e=>{0===e?(n.unload(),at.shift(),at.length>st&&t()):t()}).catch(()=>{t()})}};t()},lt=()=>new Promise((e,t)=>{let n=at.slice(0),r=()=>{if(0!==n.length){let i=n.shift();i.context.isBusy()?r():i.context.hasActiveInstances().then(t=>{0===t?e(i):r()}).catch(t)}else at.length<it?Y.createDomain(g()).then(t=>{e(t)}).catch(t):t(y.OperationFailed("AppDomain pool limit reached."))};r()}),ct={TaskInfo:function(e,...t){if("string"!=typeof e)throw y.InvalidArgument("qualifiedName",ct.TaskInfo);return Object.freeze({type:e,typeArgs:t})},getHandle:(e,t)=>new Promise((n,r)=>{lt().then(r=>{let i;n({run:(...n)=>new Promise((i,s)=>{r.context.execute({type:e.type,typeArgs:e.typeArgs,func:"run",args:n,keepAlive:!0},t).then(i).catch(s)}),close:()=>new Promise((n,i)=>{r.context.execute({type:e.type,typeArgs:e.typeArgs,func:"",args:[],keepAlive:!1},t).then(n).catch(i).finally(ot)})})}).catch(r)}),invoke:(e,t)=>new Promise((n,r)=>{lt().then(i=>{i.context.execute({type:e.type,typeArgs:e.typeArgs,func:"run",args:[],keepAlive:!1},t).then(n).catch(r).finally(ot)}).catch(r)}),parallel:Object.freeze({invokeMany:(...e)=>{let t=[];for(let n of e)t.push(ct.invoke(n));return t},invoke:Object.freeze({any:(...e)=>Promise.race(ct.parallel.invokeMany(...e)),all:(...e)=>Promise.all(ct.parallel.invokeMany(...e)),each:(e,t,...n)=>new Promise((r,i)=>{let s=ct.parallel.invokeMany(...n),a=0;for(let n of s)n.then(e).catch(t).finally(()=>{a++,s.length===a&&r()})})})}),sequence:Object.freeze({invoke:(...e)=>new Promise((t,n)=>{let r=e.slice(0),i=[],s=()=>{if(0===r.length)return void t(...i);let e=r.shift();ct.invoke(e).then(e=>{i.push(e),s()}).catch(n)};r.length>0?s():t(...i)})})};f("Tasks",ct,()=>{at.forEach(e=>{e.unload()}),at.length=0});const ut=e=>{if(e.isServer){if(!(!0).sessionStorage){const e=function(){let e={};this.key=(t=>{if(!t)throw y.InvalidArgument("key",this.key);return!!e.key}),this.getItem=(t=>{if(!t)throw y.InvalidArgument("key",this.getItem);return e.key||null}),this.setItem=((t,n)=>{if(!t)throw y.InvalidArgument("key",this.setItem);if(void 0===n)throw y.InvalidArgument("value",this.setItem);e[t]=n}),this.removeItem=(t=>{if(!t)throw y.InvalidArgument("key",this.removeItem);delete e[t]}),this.clear=(()=>{e={}})};global.sessionStorage=new e}return(!0).sessionStorage}return(!0).sessionStorage};W.define("sessionStorage",["key","getItem","setItem","removeItem","clear"],ut);const pt=e=>e.isServer?(console.warn("Use of 'state' is not support on server. Using 'session' instead."),ut(e)):(!0).localStorage;W.define("localStorage",["key","getItem","setItem","removeItem","clear"],pt);const ft=e=>{let t={require:e=>new Promise((t,n)=>{if("string"==typeof e)try{t(require(e))}catch(e){n(new y(e))}else n(y.InvalidArgument("module"))}),undef:e=>{if("string"!=typeof e)throw y.InvalidArgument("module",t.undef);try{delete require.cache[require.resolve(e)]}catch(e){throw new y(e,t.undef)}}};return t};W.define("serverModule",["require","undef"],ft);const mt=e=>{let t={require:t=>new Promise((n,r)=>{if("string"!=typeof t)return void r(y.InvalidArgument("module"));let i=t.substr(t.lastIndexOf(".")+1).toLowerCase();try{if("undefined"!=typeof require)require([t],n,r);else if(e.isWorker)try{importScripts(t),n()}catch(e){r(new y(e))}else{let e=(!0).document.createElement("script");e.type="mjs"===i?"module":"text/javascript",e.name=t,e.src=t,e.onload=(()=>{n()}),e.onerror=(e=>{r(new y(e))}),(!0).document.head.appendChild(e)}}catch(e){r(new y(e))}}),undef:e=>{if("string"!=typeof e)throw y.InvalidArgument("module",t.undef);let n=null;(n=(!0).requirejs||null)?n.undef(e):console.warn("No approach is available to undef a loaded module. Connect clientModule port to an external handler.")}};return t};W.define("clientModule",["require","undef"],mt);const dt=e=>e=>new Promise((t,n)=>{if("string"!=typeof e)return void n(y.InvalidArgument("file"));let r=e.substr(e.lastIndexOf(".")+1).toLowerCase();try{let i=null,s="";(i=e.startsWith("https")?require("https"):require("http")).get(e,e=>{e.on("data",e=>{s+=e}),e.on("end",()=>{let i=e.headers["content-type"];if("json"===r||/^application\/json/.test(i))try{let e=JSON.parse(s);t(e)}catch(e){n(new y(e))}else t(s)})}).on("error",e=>{n(new y(e))})}catch(e){n(new y(e))}});W.define("serverFile",dt);const ht=e=>e=>new Promise((t,n)=>{if("string"!=typeof e)return void n(y.InvalidArgument("file"));let r=e.substr(e.lastIndexOf(".")+1).toLowerCase();fetch(e).then(i=>{if(200!==i.status)n(y.OperationFailed(e,i.status));else{let e=i.headers["content-type"];"json"===r||/^application\/json/.test(e)?i.json().then(t).catch(e=>{n(new y(e))}):i.text().then(t).catch(e=>{n(new y(e))})}}).catch(e=>{n(new y(e))})});W.define("clientFile",ht);const yt=e=>t=>{let n={},r=Y.config();return r&&r[t]&&(n=Object.assign(n,r[t])),e.isWorker&&r&&r[`worker:${t}`]&&(n=Object.assign(n,r[`worker:${t}`])),n};W.define("settingsReader",yt);let gt=!1;const bt=[],vt=function(e){if(!e||!e[s]&&-1!==c.indexOf(e[s].type))throw y.InvalidArgument("Type",vt);let t=null,n=null,r=null,i=null,a=null,o=null,l=null;const u=function(e){this.getType=(()=>"modifier"),this.getName=(()=>e.name),this.getArgs=(()=>e.args.slice()),this.getConstraints=(()=>e.cfg.constraints)},p=function(e){this.getType=(()=>"attribute"),this.getName=(()=>e.name),this.getArgs=(()=>e.args.slice()),this.getConstraints=(()=>e.cfg.constraints),this.isCustom=(()=>e.isCustom)},f=function(){this.getTarget=(()=>r),this.getTargetType=(()=>t.type),this.getName=(()=>t.name||""),this.getType=(()=>t.type),this.getId=(()=>t.id),this.getNamespace=(()=>t.namespace),this.getAssembly=(()=>t.assembly()),this.getContext=(()=>t.context),this.isClass=(()=>"class"===t.type),this.isEnum=(()=>"enum"===t.type),this.isStruct=(()=>"struct"===t.type),this.isMixin=(()=>"mixin"===t.type),this.isInterface=(()=>"interface"===t.type),this.isDeprecated=(()=>t.isDeprecated()),this.getModifiers=(()=>{let e=[];for(let t of o.modifiers.type)e.push(u(t));return e}),this.getAttributes=(()=>{let e=[];for(let t of o.attrs.type)e.push(p(t));return e}),this.getAttribute=(e=>{if("string"!=typeof e)throw y.InvalidArgument("name",this.getAttribute);let t=O(o.attrs.type,"name",e);return t?p(t):null}),this.getModifier=(e=>{if("string"!=typeof e)throw y.InvalidArgument("name",this.getModifier);let t=O(o.modifiers.type,"name",e);return t?u(t):null})},m=function(e){e.getMixins=(()=>{let e=[];if(t.mixins)for(let n of t.mixins)e.push(vt(n));return e}),e.isMixed=(n=>{if(!n)throw y.InvalidArgument("name",e.isMixed);return!!t.isMixed&&t.isMixed(n)})},d=function(e){e.getInterfaces=(()=>{let e=[];if(t.interfaces)for(let n of t.interfaces)e.push(vt(n));return e}),e.isImplements=(n=>{if(!n)throw y.InvalidArgument("name",e.isImplements);return!!t.isImplements&&t.isImplements(n)})},h=function(e){e.getInstanceType=(()=>n.type),e.isInstanceOf=(t=>{if(!t)throw y.InvalidArgument("name",e.isInstanceOf);return!!n.isInstanceOf&&n.isInstanceOf(t)})},g=e=>{let t=n.def;for(;1&&null!==t&&!t.members[e];)t=t.previous();return t},b=()=>{let e=null,t=null;l={};for(let r in n.obj){switch((e=g(r)).members[r]){case"prop":t=new I(r,e);break;case"func":t=new A(r,e);break;case"event":t=new $(r,e);break;case"construct":t=new A(r,e);break;case"dispose":t=new A(r,e);break}l[r]=t}},v=()=>{l||b()},w=function(e,n){this.getType=(()=>"member"),this.getMemberType=(()=>n.members[e]),this.getName=(()=>e),this.getModifiers=(()=>{let t=[];for(let n of a.modifiers[e])t.push(u(n));return t}),this.getAttributes=(()=>{let t=[];for(let n of a.attrs[e])t.push(p(n));return t}),this.getAttribute=(t=>{if("string"!=typeof t)throw y.InvalidArgument("name",this.getAttribute);let n=O(a.attrs[e],"name",t);return n?p(n):null}),this.getModifier=(t=>{if("string"!=typeof t)throw y.InvalidArgument("name",this.getModifier);let n=O(a.modifiers[e],"name",t);return n?u(n):null}),this.isPrivate=(()=>null!==O(a.modifiers[e],"name","private")),this.isProtected=(()=>null!==O(a.modifiers[e],"name","protected")),this.isPublic=(()=>!this.isPrivate()&&!this.isProtected()),this.isStatic=(()=>null!==O(a.modifiers[e],"name","static")),this.isSealed=(()=>null!==O(a.modifiers[e],"name","sealed")),this.isAbstract=(()=>null!==O(a.modifiers[e],"name","abstract")),this.isVirtual=(()=>null!==O(a.modifiers[e],"name","virtual")),this.isOverride=(()=>null!==O(a.modifiers[e],"name","virtual")),this.isEnumerable=(()=>Object.getOwnPropertyDescriptor(i,e).enumerable),this.isDeprecated=(()=>null!==O(a.attrs[e],"name","deprecate")),this.isConditional=(()=>null!==O(a.attrs[e],"name","conditional")),this.isMixed=(()=>null!==O(a.attrs[e],"name","mixin")),this.isInterfaced=(()=>null!==O(a.attrs[e],"name","interface")),this.getMixin=(()=>{let n=null,r=O(a.attrs[e],"name","mixin");if(r&&t.mixins)for(let e of t.mixins)if(e===r.name){n=vt(e);break}return n}),this.getInterface=(()=>{let n=null,r=O(a.attrs[e],"name","interface");if(r&&t.interfaces)for(let e of t.interfaces)if(e===r.name){n=vt(e);break}return n})},I=function(e,t){let n=new w(e,t);return n.isReadOnly=(()=>null!==O(a.modifiers[e],"name","readonly")),n.isSerializable=(()=>null!==O(a.attrs[e],"name","serialize")||null===O(a.attrs[e],"name","noserialize")&&null!==O(o.attrs.type,"name","serialize")),n.getValueType=(()=>{let t=O(a.attrs[e],"name","type");if(t)return t.args[0]}),n.isDisposable=(()=>null!==O(a.attrs[e],"name","dispose")),n.isInjectable=(()=>null!==O(a.attrs[e],"name","inject")),n.isResource=(()=>null!==O(a.attrs[e],"name","resource")),n.isAsset=(()=>null!==O(a.attrs[e],"name","asset")),n.isSession=(()=>null!==O(a.attrs[e],"name","session")),n.isState=(()=>null!==O(a.attrs[e],"name","state")),n},A=function(e,t){let n=new w(e,t);return n.isASync=(()=>null!==O(a.modifiers[e],"name","async")),n.isConstructor=(()=>"_construct"===e),n.isDestructor=(()=>"_dispose"===e),n.isSub=(()=>null!==O(a.attrs[e],"name","on")),n.isTimered=(()=>null!==O(a.attrs[e],"name","timer")),n.isInjectable=(()=>null!==O(a.attrs[e],"name","inject")),n.getArgs=(()=>{let t=O(a.attrs[e],"name","args");return t?t.args.slice():null}),n.getAspects=(()=>{if(a.aspects&&a.aspects[e].length>0){let t=[];for(let n of a.aspects[e])t.push(vt(n));return t}return null}),n.getAspect=(t=>{if("string"!=typeof t)throw y.InvalidArgument("name",n.getAspect);if(a.aspects&&a.aspects[e].length>0){let n=O(a.aspects[e],"name",t);if(n)return vt(n)}return null}),n},$=function(e,t){let n=new w(e,t);return delete n.isStatic,n.isPub=(()=>null!==O(a.attrs[e],"name","post")),n},k=function(e){e.getMembers=(e=>{(e=e||{}).types=e.types||[],e.modifiers=e.modifiers||[],e.attrs=e.attrs||[],e.aspects=e.aspects||[],e.inherited=void 0===e.inherited||e.inherited,v();let t=null,n=!0,r=[];for(let i in l)if(n=!0,l.hasOwnProperty(i)){if(t=l[i],e.types.length>0&&-1===e.types.indexOf(t.getMemberType())&&(n=!1),!n||e.inherited||a.members[i]||(n=!1),n&&e.modifiers.length>0)for(let t of e.modifiers)if(-1===x(a.modifiers[i],"name",t)){n=!1;break}if(n&&e.attrs.length>0)for(let t of e.attrs)if(-1===x(a.attrs[i],"name",t)){n=!1;break}if(n&&e.aspects.length>0&&"func"===t.getMemberType())for(let t of e.aspects)if(-1===x(a.aspects[i],"name",t)){n=!1;break}n&&r.push(l[i])}return r}),e.getMember=(t=>{if("string"!=typeof t)throw y.InvalidArgument("memberName",e.getMember);return v(),l[t]||null})},j=function(){let e=new f;return e.getParent=(()=>null!==t.inherits?vt(t.inherits):null),e.isDerivedFrom=(n=>{if(!n)throw y.InvalidArgument("name",e.isDerivedFrom);return!!t.isDerivedFrom&&t.isDerivedFrom(n)}),e.getFamily=(()=>{let e=[],n=t.inherits;for(null!==t.inherits&&e.push(vt(t.inherits));1&&null!==n;)e.push(vt(n)),n=n[s].inherits;return e}),e.isSealed=(()=>!!t.isSealed&&t.isSealed()),e.isAbstract=(()=>!!t.isAbstract&&t.isAbstract()),m(e),d(e),e.isSerializable=(()=>null!==O(o.attrs.type,"name","serialize")),e.isStatic=(()=>!!t.isStatic&&t.isStatic()),e.isSingleton=(()=>!!t.isSingleton&&t.isSingleton()),e.isSingleInstanceCreated=(()=>!!t.singleInstance&&null!==t.singleInstance()),h(e),k(e),e},T=function(){let e=new f;return e.isSerializable=(()=>null!==O(o.attrs.type,"name","serialize")),h(e),k(e),e},S=function(){let e=new f;return k(e),e},P=function(){let e=new f;return k(e),e},N=function(){let e=new f;return e.getNames=(()=>{let e=[];for(let t of _e.getNames(i))e.push(I(t,a));return e}),e.getName=(t=>{if(!t)throw y.InvalidArgument("enumValue",e.getName);let n=_e.getName(i,t);return n?I(n,a):null}),e.getValues=(()=>_e.getValues(i)),e.isDefined=(t=>{if(!t)throw y.InvalidArgument("nameOrValue",e.isDefined);return _e.isDefined(i,t)}),e};let C=null,D=null,E=!1;switch(gt=!0,e[s].type){case"class":r=e,i=new e,E=!0,C=new j;break;case"struct":r=e,i=new e,E=!0,C=new T;break;case"enum":r=e[s].Type,i=e,C=new N;break;case"mixin":D=Me("temp",[r=e],function(){}),i=new D,E=!0,C=new S;break;case"interface":r=e[s].Type,i=e,C=new P;break}return gt=!1,E&&bt.push(i),t=r[s],n=i[s],a=n.def,o=n.typeDef,C};vt.dispose=(()=>{if(bt.length>0)for(let e of bt)Ie(e);bt.length=0}),f("Reflector",vt,()=>{vt.dispose()});const wt=()=>{};return wt.forEachAsync=D,wt.replaceAll=$,wt.splitAndTrim=I,wt.findIndexByProp=x,wt.findItemByProp=O,wt.isArrowFunc=v,wt.isASyncFunc=w,wt.sieve=S,wt.b64EncodeUnicode=P,wt.b64DecodeUnicode=N,f("utils",wt),n.members=Object.freeze(n.members),Object.freeze(n)}),(()=>{"use strict";const e=void 0!==!0?require("flairjs"):(!0).flair,{Class:t,Struct:n,Enum:r,Interface:i,Mixin:s}=e,{Aspects:a}=e,{AppDomain:o}=e,l=e.AppDomain.context.current().name,{$$:c,attr:u}=e,{bring:p,Container:f,include:m}=e,{Port:d}=e,{on:h,post:y,telemetry:g}=e,{Reflector:b}=e,{Serializer:v}=e,{Tasks:w}=e,{TaskInfo:x}=e.Tasks,{as:O,is:I,isComplies:A,isDerivedFrom:$,isAbstract:k,isSealed:j,isStatic:T,isSingleton:S,isDeprecated:P,isImplements:N,isInstanceOf:C,isMixed:D}=e,{getAssembly:E,getAttr:z,getContext:F,getResource:M,getRoute:R,getType:U,ns:_,getTypeOf:W,getTypeName:q,typeOf:L}=e,{dispose:B,using:V}=e,{Args:G,Exception:J,noop:H,nip:X,nim:K,nie:Q,event:Y}=e,{env:Z}=e.options,{forEachAsync:ee,replaceAll:te,splitAndTrim:ne,findIndexByProp:re,findItemByProp:ie,which:se,isArrowFunc:ae,isASyncFunc:oe,sieve:le,b64EncodeUnicode:ce,b64DecodeUnicode:ue}=e.utils,{$$static:pe,$$abstract:fe,$$virtual:me,$$override:de,$$sealed:he,$$private:ye,$$privateSet:ge,$$protected:be,$$protectedSet:ve,$$readonly:we,$$async:xe}=c,{$$overload:Oe,$$enumerate:Ie,$$dispose:Ae,$$post:$e,$$on:ke,$$timer:je,$$type:Te,$$args:Se,$$inject:Pe,$$resource:Ne,$$asset:Ce,$$singleton:De,$$serialize:Ee,$$deprecate:ze,$$session:Fe,$$state:Me,$$conditional:Re,$$noserialize:Ue,$$ns:_e}=c;let We=Z.isServer?__filename:(!0).document.currentScript.src.replace((!0).document.location.href,"./"),qe=We.substr(0,We.lastIndexOf("/")+1);o.loadPathOf("flair",qe);let Le={},Be=e.Port("settingsReader");if("function"==typeof Be){let e=Be("flair");e&&(Le=Object.assign(Le,e))}Le=Object.freeze(Le),e.AppDomain.context.current().currentAssemblyBeingLoaded("./flair{.min}.js"),(async()=>{c("ns","(root)"),i("IDisposable",function(){this.dispose=K})})(),(async()=>{c("abstract"),c("ns","(root)"),t("Aspect",function(){c("virtual"),this.before=K,c("virtual"),this.around=K,c("virtual"),this.after=K})})(),(async()=>{c("abstract"),c("ns","(root)"),t("Attribute",function(){c("virtual"),this.construct=(e=>{this.args=e}),c("readonly"),this.args=[],c("readonly"),this.constraints="",c("virtual"),this.decorateProperty=K,c("virtual"),this.decorateFunction=K,c("virtual"),this.decorateEvent=K})})(),(async()=>{c("ns","(root)"),i("IProgressReporter",function(){this.progress=Q})})(),(async()=>{const{IProgressReporter:e,IDisposable:n}=_();c("ns","(root)"),t("Task",[e,n],function(){let e=!1,t=!1;this.construct=((...e)=>{this.args=e,this.context=o.contexts(l),this.domain=this.context.domain}),c("abstract"),this.dispose=K,c("protected"),this.args=[],c("protected"),this.context=null,c("protected"),this.domain=null,this.run=(async(...n)=>{if(t)throw J.InvalidOperation("Task is already running",this.run);if(t=!0,!e)try{await this.setup(),e=!0}catch(e){throw t=!1,e}try{let e;return await this.onRun(...n)}catch(e){throw e}finally{t=!1}}),this.progress=Y(e=>({data:e})),c("virtual"),c("protected"),c("async"),this.setup=H,c("abstract"),c("protected"),c("async"),this.onRun=K})})(),e.AppDomain.context.current().currentAssemblyBeingLoaded(""),e.AppDomain.registerAdo('{"name":"flair","file":"./flair{.min}.js","mainAssembly":"flair","desc":"True Object Oriented JavaScript","title":"Flair.js","version":"0.26.99","lupdate":"Sun, 31 Mar 2019 12:35:45 GMT","builder":{"name":"<<name>>","version":"<<version>>","format":"fasm","formatVersion":"1","contains":["initializer","types","enclosureVars","enclosedTypes","resources","assets","routes","selfreg"]},"copyright":"(c) 2017-2019 Vikas Burman","license":"MIT","types":["IDisposable","Aspect","Attribute","IProgressReporter","Task"],"resources":[],"assets":[],"routes":[]}')})();