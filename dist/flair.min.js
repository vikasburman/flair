/**
 * @preserve
 * Flair.js
 * True Object Oriented JavaScript
 * 
 * Assembly: flair
 *     File: ./flair.js
 *  Version: 0.15.950
 *  Sun, 10 Mar 2019 04:13:54 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * Licensed under MIT
 */
!function(e,t){"use strict";"function"==typeof define&&define.amd?define(t):"object"==typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t()),module.exports=exports=t()):e.flair=t()}(this,function(){"use strict";let e=new Function("try {return this===global;}catch(e){return false;}")(),t=e?!require("worker_threads").isMainThread:"undefined"!=typeof WorkerGlobalScope,n=!!e||(!t||WorkerGlobalScope),r={},i=e?__filename:n.document.currentScript.src,s=[],a=Symbol("[meta]"),o=[],l={},c=["class","enum","interface","mixin","struct"],u="";if(e){let e=process.argv;t&&(e=require("worker_threads").workerData.argv);let n=e.findIndex(e=>!!e.startsWith("--flairSymbols"));-1!==n&&(u=e[n].substr(2).split("=")[1])}else u=void 0!==n.flairSymbols?n.flairSymbols:"";u&&(s=u.split(",").map(e=>e.trim())),l.symbols=Object.freeze(s),l.env=Object.freeze({type:e?"server":"client",global:n,isTesting:-1!==s.indexOf("TEST"),isServer:e,isClient:!e,isWorker:t,isMain:!t,cores:(e?require("os").cpus().length:n.navigator.hardwareConcurrency)||4,isCordova:!e&&!!n.cordova,isNodeWebkit:e&&process.versions["node-webkit"],isProd:-1===s.indexOf("DEBUG")&&-1!==s.indexOf("PROD"),isDebug:-1!==s.indexOf("DEBUG")}),r.info=Object.freeze({name:"flair",file:i,version:"0.15.950",copyright:"(c) 2017-2019 Vikas Burman",license:"MIT",lupdate:new Date("Sun, 10 Mar 2019 04:13:54 GMT")}),r.members=[],r.options=Object.freeze(l);const p=(e,t,n)=>{r[e]=Object.freeze(t),r.members.push(e),"function"==typeof n&&o.push(n)},f=()=>{};p("noop",f);const m={get:()=>{throw new g("NotImplemented","Property is not implemented.")},set:()=>{throw new g("NotImplemented","Property is not implemented.")},ni:!0};p("nip",m);const d=()=>{throw new g("NotImplemented","Method is not implemented.")};d.ni=!0,p("nim",d);const h=e=>{if(e&&"function"!=typeof e)throw g.InvalidArgument("argsProcessor");return(e="function"==typeof e?e:f)===f&&(e=(()=>{})),e.event=!0,e};p("event",h);const y=h(()=>{throw new g("NotImplemented","Event is not implemented.")});y.ni=!0,p("nie",y);const g=function(e,t,n,r){let i=new Error,s=g;switch(typeof e){case"string":switch(i.name=e,typeof t){case"string":switch(i.message=t,typeof n){case"object":i.error=n,"function"==typeof r&&(s=r);break;case"function":s=n;break}break;case"object":i.message=t.message||"",i.error=t,"function"==typeof n&&(s=n);break;case"function":s=t;break}break;case"object":i.name=e.name||"Unknown",i.message=e.message||"",i.error=e,"function"==typeof t&&(s=t);break}return i.name=i.name||"Undefined",i.name.endsWith("Exception")||(i.name+="Exception"),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(i,s),Object.freeze(i)};g.InvalidArgument=(e=>new g("InvalidArgument",`Argument type is invalid. (${e})`)),p("Exception",g);const b=function(){let e={};this.add=((t,n)=>{if("string"!=typeof name)throw new g("InvalidArgument","Argument type is invalid. (event)");if("function"!=typeof n)throw new g("InvalidArgument","Argument type is invalid. (handler)");e[t]||(e[name]=[]),e[name].push(n)}),this.remove=((t,n)=>{if("string"!=typeof name)throw new g("InvalidArgument","Argument type is invalid. (event)");if("function"!=typeof n)throw new g("InvalidArgument","Argument type is invalid. (handler)");if(e[t]){let r=e[t].indexOf(n);-1!==r&&e[t].splice(r,1)}}),this.dispatch=((t,n)=>{e[t]&&e[t].forEach(e=>{setTimeout(()=>{e({name:t,args:n})},0)})}),this.count=(t=>e[t]?e[t].length:0),this.clear=(()=>{e={}})};let w={};const v=e=>{if("string"!=typeof e)throw new g("InvalidArgument","Argument type is invalid. (name)");return w[e]?w[e].handler?w[e].handler:w[e].inbuilt:null};v.define=((e,t,n)=>{if("string"!=typeof e)throw new g("InvalidArgument","Argument type is invalid. (name)");if(t&&!Array.isArray(t))throw new g("InvalidArgument","Argument type is invalid. (members)");if(w[e])throw new g("Duplicate",`Port is already defined. (${e})`);w[e]={type:t?"object":"function",members:t||null,handler:null,inbuilt:void 0!==n?n(l.env):null}}),v.connect=((e,t)=>{if("string"!=typeof e)throw new g("InvalidArgument","Argument type is invalid. (name)");if("function"!=typeof t)throw new g("InvalidArgument","Argument type is invalid. (handler)");if(!w[e])throw new g("NotFound",`Port is not defined. (${e})`);let n=t(l.env);if(typeof n!==w[e].type)throw new g("InvalidType",`Handler type is invalid. (${e})`);let r=w[e].members;if(r)for(let t of r)if(void 0===n[t])throw new g("InvalidType",`Handler interface is invalid. (${e})`);w[e].handler=n}),v.disconnect=(e=>{if("string"!=typeof e)throw new g("InvalidArgument","Argument type is invalid. (name)");w[e]&&(w[e].handler=null)}),v.isDefined=(e=>{if("string"!=typeof e)throw new g("InvalidArgument","Argument type is invalid. (name)");return!!w[e]}),v.isConnected=(e=>!w[e]||!w[e].handler),p("Port",v,()=>{for(let e in w)w.hasOwnProperty(e)&&(w[e].handler=null);w={}});const A=()=>"_xxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx".replace(/[xy]/g,e=>{var t=16*Math.random()|0,n;return("x"==e?t:3&t|8).toString(16)}),x=(e,t)=>{if(t){if(-1!==e.indexOf("{.min}"))return r.options.env.isProd?e.replace("{.min}",".min"):e.replace("{.min}","")}else if(-1!==e.indexOf("|")){let t=e.split("|"),n="";return"x"===(n=r.options.env.isServer?t[0].trim():t[1].trim())&&(n=""),n}return e},I=e=>!e.hasOwnProperty("prototype"),O=(e,t,n)=>e.findIndex(e=>e[t]===n),k=(e,t,n)=>{let r=e.findIndex(e=>e[t]===n);return-1!==r?e[r]:null},$=e=>e.split(",").map(e=>e.trim()),j=e=>e.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1"),T=(e,t,n)=>e.replace(new RegExp(j(t),"g"),n),S=(e,t,n,r)=>{r||(r=[]);for(let i in t)if(t.hasOwnProperty(i)&&-1===r.indexOf(i)){if(!n&&i in e)continue;e[i]=t[i]}return e},P=t=>new Promise((n,r)=>{let i=null;(i=v(e?"serverFile":"clientFile"))(t).then(n).catch(r)}),C=t=>new Promise((n,r)=>{e?v("serverModule").require(t).then(n).catch(r):v("clientModule").require(t).then(n).catch(r)}),N=(e,t,n,r)=>{let i=t?$(t):Object.keys(e);const s=t=>{let s={};if(i.length>0)for(let e of i)s[e]=t[e];else for(let t in e)e.hasOwnProperty(t)&&(s[t]=e[t]);if(r)for(let e in r)s[e]=r[e];return n&&(s=Object.freeze(s)),s};if(Array.isArray(e)){let t=[];for(let n of e)t.push(s(n));return t}return s(e)},D=e=>btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function e(t,n){return String.fromCharCode("0x"+n)})),z=e=>decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join("")),M=t=>{e?v("serverModule").undef(t):v("clientModule").undef(t)},U=function(e,t,n,r,i){let s={},o={},l={},u={},p={},f=!1,m="";this.name=e,this.domain=t,this.isUnloaded=(()=>f||t.isUnloaded()),this.unload=(()=>{if(!f){f=!0,delete i[e];for(let e in l)e.hasOwnProperty(e)&&ue(l[e]);s={},u={},o={},l={},p={}}}),this.current=(()=>{if(this.isUnloaded())throw"Unloaded";return 0===r.length?n||this:r[r.length-1]}),this.registerType=(e=>{if(this.isUnloaded())throw"Unloaded";let t="",n="",r=e[a];if(r.Type?(t=r.Type[a].name,n=r.Type[a].type):(t=r.name,n=r.type),-1===c.indexOf(n))throw new g("InvalidArgument",`Type is not valid.`);let i=t.substr(0,t.lastIndexOf(".")),l=t.replace(i+".","");if(s[t])throw`Type (${t}) is already registered.`;if(o[t])throw`Already registered as resource. (${t})`;return s[t]=e,i?(p[i]||(p[i]={}),p[i][l]=e):p[l]=e,i}),this.getType=(e=>{if(this.isUnloaded())throw"Unloaded";if("string"!=typeof e)throw new g("InvalidArgument",`Argument type is not valid. (${e})`);return s[e]||null}),this.ensureType=(e=>new Promise((n,r)=>{let i=this.getType(e);if(i)n(i);else{let s=t.resolve(e);s?this.loadAssembly(s).then(()=>{(i=this.getType(e))?n(i):r()}).catch(r):r()}})),this.allTypes=(()=>{if(this.isUnloaded())throw"Unloaded";return Object.keys(s)}),this.execute=((e,t)=>new Promise((n,r)=>{this.isUnloaded()&&r("Unloaded"),e.type=e.type||"",e.typeArgs=e.typeArgs||[],e.func=e.func||"",e.args=e.args||[],e.keepAlive=void 0!==e.keepAlive&&e.keepAlive;const i=()=>new Promise((n,r)=>{let i=null;this.ensureType(e.type).then(s=>{try{i=new s(...e.typeArgs),"function"==typeof t&&re(i,"IProgressReporter")&&i.progress.add(t),n(i)}catch(e){r(e)}}).catch(r)}),s=t=>new Promise((n,r)=>{let i=null;(i=t[e.func](...e.args))&&"function"==typeof i.then?i.then(n).catch(r):n(i)});let a=null;e.keepAlive?l[e.type]?(a=l[e.type],s(a).then(n).catch(r)):i().then(t=>{a=t,l[e.type]=a,s(a).then(n).catch(r)}).catch(r):l[e.type]?(a=l[e.type],e.func?s(a).then(n).catch(r).finally(()=>{ue(a),delete l[e.type]}):(ue(a),delete l[e.type],n())):i().then(e=>{s(e).then(n).catch(r).finally(()=>{ue(e)})}).catch(r)})),this.namespace=(e=>{e&&"(root)"===e&&(e="");let t=null;return(t=e?p[e]||null:p)?Object.freeze(S({},t)):null}),this.currentAssemblyBeingLoaded=(e=>{if(this.isUnloaded())throw"Unloaded";return void 0!==e&&(m=x(e,!0)),m}),this.loadAssembly=(e=>new Promise((t,n)=>{this.isUnloaded()&&n("Unloaded"),u[e]?t():(r.push(this),M(e),C(e).then(()=>{r.pop(),u[e]=Object.freeze(new E(this.domain.getADO(e),this)),t()}).catch(e=>{r.pop(),n(e)}))})),this.getAssembly=(e=>{if(this.isUnloaded())throw"Unloaded";if("string"!=typeof e)throw new g("InvalidArgument",`Argument type is not valid. (${e})`);return u[e]||null}),this.allAssemblies=(()=>{if(this.isUnloaded())throw"Unloaded";return Object.keys(u)}),this.registerResource=(e=>{if(this.isUnloaded())throw"Unloaded";if("string"!=typeof e.name||""===e.name||"string"!=typeof e.encodingType||""===e.encodingType||"string"!=typeof e.file||""===e.file||"string"!=typeof e.data||""===e.data)throw g.InvalidArgument("rdo");let t=e.name.substr(0,e.name.lastIndexOf(".")),n=e.name.replace(t+".","");if(o[e.name])throw`Resource (${e.name}) is already registered.`;if(s[e.name])throw`Already registered as Type. (${e.name})`;return o[e.name]=Object.freeze(new R(e,t,this)),t?(p[t]||(p[t]={}),p[t][n]=o[e.name]):p[n]=o[e.name],t}),this.getResource=(e=>{if(this.isUnloaded())throw"Unloaded";if("string"!=typeof e)throw new g("InvalidArgument",`Argument type is not valid. (${e})`);return o[e]||null}),this.allResources=(()=>{if(this.isUnloaded())throw"Unloaded";return Object.keys(o)}),this.isBusy=(()=>!1),this.hasActiveInstances=(()=>Object.keys(l).length)},E=function(e,t){this.context=t,this.name=e.name,this.file=e.file,this.desc=e.desc,this.version=e.version,this.copyright=e.copyright,this.license=e.license,this.lupdate=e.lupdate,this.builder=e.builder.name,this.flairVersion=e.builder.version,this.format=Object.freeze({name:e.builder.format,version:e.builder.formatVersion,contains:e.builder.contains.slice()}),this.types=(()=>e.types.slice()),this.getType=(t=>{if("string"!=typeof t)throw new g("InvalidArgument",`Argument type is not valid. (${t})`);if(-1===e.types.indexOf(t))throw new g("NotFound",`Type is not available in this assembly. (${t})`);return this.context.getType(t)}),this.getTypes=(t=>{if(["string","interface"]!==K(t))throw new g("InvalidArgument",`Argument type is not valid. (${t})`);let n=[];for(let r of e.types)try{let e=this.context.getType(r);se(e,t)&&n.push(e)}catch(e){}return n}),this.resources=(()=>e.resources.slice()),this.getResource=(t=>{if("string"!=typeof t)throw new g("InvalidArgument",`Argument type is not valid. (${t})`);if(-1===e.resources.indexOf(t))throw new g("NotFound",`Resource is not available in this assembly. (${t})`);return this.context.getResource(t)}),this.assets=(()=>e.assets.slice()),this.assetsRoot=this.file.replace(".js","/"),this.getAsset=(t=>{if("string"!=typeof t)throw new g("InvalidArgument",`Argument type is not valid. (${t})`);let n=t.replace("./",this.assetsRoot);if(-1===e.assets.indexOf(t))throw new g("NotFound",`Asset is not available for this assembly. (${n})`);return n})},R=function(t,n,r){if(this.context=r,this.name=t.name,this.ns=n,this.assembly=(()=>r.getAssembly(x(t.asmFile,!0))||null),this.encodingType=t.encodingType,this.file=t.file,this.type=t.file.substr(t.file.lastIndexOf(".")+1).toLowerCase(),this.data=t.data,-1!==t.encodingType.indexOf("utf8;"))if(e){let e=Buffer.from(t.data,"base64");this.data=e.toString("utf8")}else this.data=z(t.data);else e&&(this.data=Buffer.from(t.data,"base64"));"json"===this.type&&(this.data=Object.freeze(JSON.parse(this.data)))},F=function(t,r){let s={},a=0,o=null,l=null;const c=function(){let e="<<isServer>>"=="true",t=JSON.parse("<<ados>>"),r=null,i=null,s=null;const a=e=>{let t=e.data.func,n=null;const r=t=>{i.postMessage({data:{id:e.data.id,isComplete:!0,isError:!1,error:null,result:e.data.returnsAsIs?t:!!t}})},a=t=>{i.postMessage({data:{id:e.data.id,isComplete:!1,isError:!1,error:null,result:t}})},o=t=>{i.postMessage({data:{id:e.data.id,isComplete:!0,isError:!0,error:t?t.toString():"UnknownError",result:null}})},l=()=>{try{"alc"===e.data.obj&&"execute"===t&&e.data.args.push(e=>{a(e.args)});let i=n(...e.data.args);i&&"function"==typeof i.then?i.then(r).catch(o):r(i)}catch(e){o(e)}};switch(e.data.obj){case"ad":n=s[t],l();break;case"alc":n=s.contexts(e.data.name)[t],l();break}};if(e){r=require("./flair{.min}.js");let e=require("worker_threads").parentPort;i=e,e.once("message",e=>{(i=e.privatePort).on("message",a)})}else n.importScripts("<<file>>"),r=n.flair,(i=this).onmessage=a;s=r.AppDomain,0!==t.length&&s.registerAdo(...t)};let u=c.toString().replace("<<file>>",i);u=`(${u=(u=u.replace("<<isServer>>",e.toString())).replace("<<ados>>",JSON.stringify(t))})();`;const p=(e,t,n,r,i,o)=>new Promise((c,u)=>{let p=A();s[p]={resolve:c,reject:u,progressListener:o},a++,l.postMessage({data:{id:p,obj:e,name:t,returnsAsIs:n,func:r,args:i&&Array.isArray(i)?i:[]}})}),f=e=>{if(s[e.data.id]){let t=s[e.data.id];e.data.isComplete?(delete s[e.data.id],a--,e.data.isError?t.reject(e.data.error):t.resolve(e.data.result)):"function"==typeof progressListener&&t.progressListener&&setTimeout(()=>{t.progressListener({name:"progress",args:e.data.result})},0)}else r(e.data)};if(e){const{Worker:e,MessageChannel:t}=require("worker_threads");l=new e(u,{eval:!0,workerData:{argv:process.argv}});const n=new t;l.postMessage({privatePort:n.port1},[n.port1]),n.port2.on("error",r),n.port2.on("message",f)}else{let e=new Blob([u]),t=n.URL.createObjectURL(e,{type:"application/javascript; charset=utf-8"});(l=new n.Worker(t)).onmessage=f,l.onerror=r}this.remoteCall=p,this.close=(()=>{e&&(o.close(),l.unref()),l.terminate()}),this.isBusy=(()=>a)},W=function(e,t,n){let r=!1,i={},s=new F(n,e=>{throw new g("RemoteError",e)});this.name=e,this.isRemote=!0,this.isUnloaded=(()=>r),this.unload=(()=>{r||(r=!0,delete t[e],i={},s.remoteCall("ad","",!1,"unload").finally(()=>{s.close()}))}),this.context=Object.freeze(new L("default",this,s)),this.contexts=(e=>i[e]||null),this.createContext=(e=>new Promise((t,n)=>{("string"!=typeof e||"default"===e||i[e])&&n(g.invalidArguments("name")),s.remoteCall("ad","",!1,"createContext",[e]).then(r=>{if(r){let n=Object.freeze(new L(e,this,s));i[e]=n,t(n)}else n()}).catch(n)})),this.loadScripts=((...e)=>{if(this.isUnloaded())throw"Unloaded";return s.remoteCall("ad","",!1,"loadScripts",e)})},L=function(e,t,n){let r=!1;this.name=e,this.domain=t,this.isUnloaded=(()=>r||t.isUnloaded()),this.unload=(()=>{r||(r=!0,n.remoteCall("alc",e,!1,"unload"))}),this.execute=((t,r)=>{if(this.isUnloaded())throw"Unloaded";return n.remoteCall("alc",e,!0,"execute",[t],r)}),this.loadAssembly=(t=>{if(this.isUnloaded())throw"Unloaded";return n.remoteCall("alc",e,!1,"loadAssembly",[t])}),this.isBusy=(()=>{if(this.isUnloaded())throw"Unloaded";return n.isBusy()}),this.hasActiveInstances=(()=>{n.remoteCall("alc",e,!1,"hasActiveInstances")})},_=function(e){let t={},n={},r={},i={},s=[],a=[],o=null,l=null,c=!1;o=new U("default",this,null,s,i),l=o.unload,delete o.unload,o=Object.freeze(o),i[o.name]=o,r[e]=this,this.name=e,this.isRemote=!1,this.isUnloaded=(()=>c),this.unload=(()=>{if(!c){c=!0;for(let e in i)i.hasOwnProperty(e)&&"function"==typeof i[e].unload&&i[e].unload();l();for(let e in r)r.hasOwnProperty(e)&&r[e]!==this&&r[e].unload();t={},n={},i={},r={},a=[]}}),this.createDomain=(e=>new Promise((t,n)=>{("string"!=typeof e||"default"===e||r[e])&&n(g.invalidArguments("name"));let i=Object.freeze(new W(e,r,a));r[e]=i,t(i)})),this.domains=(e=>r[e]||null),this.context=o,this.contexts=(e=>i[e]||null),this.createContext=(e=>new Promise((t,n)=>{("string"!=typeof e||"default"===e||i[e])&&n(g.invalidArguments("name"));let r=Object.freeze(new U(e,this,o,s,i));i[e]=r,t(r)})),this.registerAdo=((...e)=>{let r=!0;if(1===e.length&&"string"==typeof e[0]){let t;e=[JSON.parse(e[0])],r=!1}e.forEach(e=>{if("array"!==K(e.types)||"array"!==K(e.resources)||"array"!==K(e.assets)||"string"!=typeof e.name||"string"!=typeof e.file||""===e.file)throw g.InvalidArgument("ado");if(e.file=x(e.file,!0),t[e.file]){if(r)throw new g("DuplicateName",`Assembly is already registered. (${e.file})`)}else t[e.file]=Object.freeze(e),e.types.forEach(t=>{if(n[t])throw new g("DuplicateName",`Type is already registered. (${t})`);n[t]=e.file}),e.resources.forEach(t=>{if(n[t])throw new g("DuplicateName",`Resource is already registered. (${t})`);n[t]=e.file})}),a.push(...e)}),this.getAdo=(e=>{if("string"!=typeof e)throw new g("InvalidArgument",`Argument type is not valid. (${e})`);return t[e]||null}),this.allAdos=(()=>Object.keys(t)),this.resolve=(e=>{if("string"!=typeof e)throw new g("InvalidArgument","Argument type if not valid. (qualifiedName)");return n[e]||null}),this.allTypes=(()=>Object.keys(n)),this.loadScripts=((...e)=>new Promise((t,n)=>{try{le(e,()=>{t()})}catch(e){n(e)}}))};let q=new _("default"),B=q.unload;delete q.unload;const G=q;p("AppDomain",G,()=>{B()});const V=(e,t,n)=>{if(!re(e,"flair"))throw new g.InvalidArgument("obj");let r=c.indexOf(-1!==K(e));r&&t&&(n=t,t=""),r||"construct"!==t||(t="_construct");let i=[],s=r?"type":"members";if(n){let r=e[a].attrs[s].probe(n,t).anywhere();r&&i.push(N(r,"name, isCustom, args, type",!0))}else{let n=e[a].attrs[s].all(t).anywhere();n&&i.push(...N(n,"name, isCustom, args, type",!0))}return i};p("getAttr",V);const J=e=>{if(-1===["string","flair"].indexOf(K(e)))throw new g("InvalidArgument","Argument type is not valid. (Type)");return"string"==typeof e?G.resolve(e):e[a].assembly()};p("getAssembly",J);const H=e=>{if(!re(e,"flair"))throw new g("InvalidArgument","Argument type is not valid. (Type)");return e[a].context};p("getContext",H);const Q=e=>{if("string"!=typeof e)throw new g("InvalidArgument","Argument type is invalid. (qualifiedName)");let t=G.context.getResource(e)||null;return t?t.data:null};p("getResource",Q);const X=e=>{if("string"!=typeof e)throw new g("InvalidArgument","Argument type is invalid. (qualifiedName)");return G.context.getType(e)};p("getType",X);const K=e=>{let t="";return void 0===e&&(t="undefined"),t||null!==e||(t="null"),t||"number"!=typeof e||!1!==isFinite(e)||(t="infinity"),!t&&Array.isArray(e)&&(t="array"),!t&&e instanceof Date&&(t="date"),!t&&e[a]&&(t=e[a].type),t||(t=typeof e),t};p("typeOf",K);const Y=e=>{let t=e[a];return t&&t.Type||null};p("getTypeOf",Y);const Z=e=>G.context.namespace(e);p("ns",Z);const ee=(e,t)=>{if("class"!==K(e))throw new g("InvalidArgument","Argument type is invalid. (type)");if(-1===["string","class"].indexOf(K(t)))throw new g("InvalidArgument","Argument type is invalid. (parent)");return e[a].isDerivedFrom(t)};p("isDerivedFrom",ee);const te=(e,t)=>{let n=K(e),r=K(t),i=!1;if(-1===["instance","sinstance"].indexOf(n))throw new g("InvalidArgument","Argument type is invalid. (obj)");if(-1===["string","class","interface","struct","mixin"].indexOf(r))throw new g("InvalidArgument","Argument type is invalid. (type)");let s=e[a];switch(r){case"class":case"struct":i=s.isInstanceOf(t);break;case"interface":i=s.isImplements(t);break;case"mixin":i=s.isMixed(t);break;case"string":(i=s.isInstanceOf(t))||"function"!=typeof s.isImplements||(i=s.isImplements(t)),i||"function"!=typeof s.isMixed||(i=s.isMixed(t));break}return i};p("isInstanceOf",te);const ne=(e,t)=>re(e,t)?e:null;p("as",ne);const re=(e,t)=>{if(t[a]&&(t=t[a].name),"string"!==K(t))throw new g("InvalidArgument","Argument type is invalid. (type)");let n=!1,r="";return"undefined"===t&&(n=void 0===e),n||"null"!==t||(n=null===e),n||"NaN"!==t||(n=isNaN(e)),n||"infinity"!==t||(n="number"==typeof e&&!1===isFinite(e)),n||"array"!==t&&"Array"!==t||(n=Array.isArray(e)),n||"date"!==t&&"Date"!==t||(n=e instanceof Date),!n&&"flair"===t&&e[a]&&(n=!0),n||"cfunction"!==t||(n="function"==typeof e&&!I(e)),n||"afunction"!==t||(n="function"==typeof e&&I(e)),n||(n=typeof e===t),n||e[a]&&(n=(r=e[a].type)===t),!n&&r&&-1!==["instance","sinstance"].indexOf(r)&&(n=te(e,t)),n};p("is",re);const ie=(e,t)=>{if(!e)throw new g("InvalidArgument","Argument type is invalid. (obj)");if("interface"!==K(t))throw new g("InvalidArgument","Argument type is invalid. (intf)");let n=!0;for(let r in t)if(t.hasOwnProperty(r)&&r!==a&&typeof e[r]!=typeof t[r]){n=!1;break}return n};p("isComplies",ie);const se=(e,t)=>{if(-1===["instance","class","sinstance","struct"].indexOf(K(e)))throw new g("InvalidArgument","Argument type is invalid. (obj)");if(-1===["string","interface"].indexOf(K(t)))throw new g("InvalidArgument","Argument type is invalid. (intf)");return e[a].isImplements(t)};p("isImplements",se);const ae=(e,t)=>{if(-1===["instance","class","sinstance","struct"].indexOf(K(e)))throw new g("InvalidArgument","Argument type is invalid. (obj)");if(-1===["string","mixin"].indexOf(K(t)))throw new g("InvalidArgument","Argument type is invalid. (mixin)");return e[a].isMixed(t)};p("isMixed",ae);const oe=[],le=(e,t)=>{if(-1===["string","array"].indexOf(K(e)))throw new g("InvalidArgument","Argument type is invalid. (deps)");if("function"!=typeof t)throw new g("InvalidArgument","Argument type is invalid. (fn)");Array.isArray(e)||(e=[e]);let n=[],r=e.slice(),i=()=>{t(...n)},s=()=>{if(0!==r.length){let e=r.shift().trim(),t=null,i=n=>{if(e.startsWith("[")&&e.endsWith("]")&&-1===e.indexOf(".")){let n=e.substr(1,e.length-2).trim();"string"==typeof(t=Me.resolve(n,!1))&&(e=t,t=null)}n()},a=n=>{(t=X(e))||(t=Q(e)),n()},o=n=>{let r=J(e);r?G.context.loadAssembly(r).then(()=>{(t=X(e))||(t=Q(e))}).catch(e=>{throw new g("AssemblyLoad",`Assembly load operation failed with error: ${e}. (${r})`)}):n()},l=n=>{let r=e.substr(e.lastIndexOf(".")+1).toLowerCase();r?"js"===r||"mjs"===r?(e=x(e,!0),n()):P(e).then(e=>{t=e,n()}).catch(t=>{throw new g("FileLoad",`File load failed. (${e})`,t)}):n()},c=n=>{C(e).then(e=>{t=e,n()}).catch(t=>{throw new g("ModuleLoad",`Module load operation failed. (${e})`,t)})},u=e=>{n.push(t),e||oe.pop(),s()};if(""===(e=x(e)))return void u(!0);if(-1!==oe.indexOf(e))throw new g("CircularDependency",`Circular dependency identified. (${e})`);oe.push(e),i(()=>{t?u():a(()=>{t?u():o(()=>{t?u():l(()=>{t?u():c(()=>{if(!t)throw new g("DependencyResolution",`Failed to resolve dependency. ${e}`);u()})})})})})}else i()};s()};p("bring",le,()=>{oe.length=0});const ce=e=>new Promise((t,n)=>{if("string"==typeof e)try{le([e],e=>{e?t(e):n()})}catch(e){n(e)}else n(new g("InvalidArgument","Argument type is invalid. (dep)"))});p("include",ce);const ue=e=>{if("boolean"==typeof e&&!0===e)Ie(),o.forEach(e=>{e()}),o.length=0;else{if("instance"!==K(e))throw new g("InvalidArgument","Argument type is invalid. (obj)");"function"==typeof e[a].dispose&&e[a].dispose()}};p("dispose",ue);const pe=(e,t)=>{if(-1===["instance","string"].indexOf(K(e)))throw new g("InvalidArgument","Argument type is invalid. (obj)");if("function"!==K(t))throw new g("InvalidArgument","Argument type is invalid. (fn)");if("string"==typeof e){let t=X(e);if(!t)throw new g("InvalidArgument","Argument type is invalid. (obj)");e=new t}let n=null,r=!1,i=!1,s=()=>{r||"function"!=typeof e[a].dispose||(r=!0,e[a].dispose())};try{(n=t(e))&&"function"==typeof n.finally&&(i=!0,n=n.finally(e=>(s(),e)))}finally{i||s()}return n};p("using",pe);const fe=(...e)=>{if(0===e.length)throw new g("InvalidArgument","Argument must be defined. (patterns)");let t=(...n)=>{let r=null,i=null,s="",a="",o=-1,l=-1,c=!1,u=0,p="",f={raw:n||[],index:-1,isInvalid:!1,error:null,values:{}};if(e)for(let t of e){o++,l=-1,c=!1,u=0,r=t.split(",");for(let e of r){if(l++,2!==(i=e.split(":")).length?(s=`_${o}_${l}`,a=e.trim()||""):(s=i[0].trim()||"",a=i[1].trim()||""),l>f.raw.length){c=!1;break}if(!re(f.raw[l],a)){c=!1,p=s;break}f.values[s]=f.raw[l],c=!0,u++}if(c&&u===r.length){f.index=o;break}}return f.isInvalid=-1===f.index,f.error=f.isInvalid?new g("InvalidArguments",`Argument type is invalid. (${p})`,t):null,f};return Object.freeze(t)};p("Args",fe);const me=(e,...t)=>{if(!e||-1===["string","class"].indexOf(K(e)))throw new g("InvalidArgument","Argument type is invalid. (name)");if(e&&"string"!=typeof e&&!ee(e,"Attribute"))throw new g("InvalidArgument","Argument type is invalid. (name)");let n=null,r=null,i=null;if("string"==typeof e){if(!(i=ye.inbuilt[e]||null)){if(!(n=X(e)))throw new g("NotFound",`Attribute is not found. (${e})`);e=n[a].name}}else e=(n=e)[a].name;if(-1!==O(ye.bucket,"name",e))throw new g("Duplicate",`Duplicate attributes are not allowed. (${e})`);n&&(r=new n(...t),i=new de(r.constraints)),ye.bucket.push({name:e,cfg:i,isCustom:null!==r,attr:r,args:t})},de=function(e,t){if("string"==typeof e&&(t=e,e=!1),"string"!=typeof t)throw new g.InvalidArgument("constraints");let n;return{isModifier:e,constraints:t}},he=(e,...t)=>me(e,...t),ye=he[a]=Object.freeze({bucket:[],inbuilt:Object.freeze({static:new de(!0,"(class && !$abstract) || ((class && (prop || func)) && !($abstract || $virtual || $override))"),abstract:new de(!0,"(class && !$sealed && !$static) || ((class && (prop || func || event)) && !($override || $sealed || $static))"),virtual:new de(!0,"class && (prop || func || construct || dispose || event) && !($abstract || $override || $sealed || $static)"),override:new de(!0,"(class && (prop || func || construct || dispose || event) && ((@virtual || @abstract) && !(virtual || abstract)) && !($sealed || $static))"),sealed:new de(!0,"(class || ((class && (prop || func || event)) && override))"),private:new de(!0,"(class || struct) && (prop || func || event) && !($protected || @private || $static)"),protected:new de(!0,"(class || struct) && (prop || func || event) && !($private|| $static)"),readonly:new de(!0,"(class || struct) && prop && !abstract"),async:new de(!0,"(class || struct) && func"),enumerate:new de("(class || struct) && prop || func || event"),dispose:new de("class && prop"),post:new de("(class || struct) && event"),on:new de("class && func && !(event || $async || $args || $inject || $static)"),timer:new de("class && func && !(event || $async || $args || $inject || @timer || $static)"),type:new de("(class || struct) && prop"),args:new de("(class || struct) && (func || construct) && !$on"),inject:new de("class && (prop || func || construct) && !(static || session || state)"),resource:new de("class && prop && !(session || state || inject || asset)"),asset:new de("class && prop && !(session || state || inject || resource)"),singleton:new de("(class && !(prop || func || event) && !($abstract || $static)"),serialize:new de("((class || struct) || ((class || struct) && prop)) && !($abstract || $static || noserialize)"),deprecate:new de("!construct && !dispose"),session:new de("(class && prop) && !($static || $state || $readonly || $abstract || $virtual)"),state:new de("(class && prop) && !($static || $session || $readonly || $abstract || $virtual)"),conditional:new de("(class || struct) && (prop || func || event)"),noserialize:new de("(class || struct) && prop"),ns:new de("(class || struct || mixin || interface || enum) && !(prop || func || event || construct || dispose)"),mixin:new de("class && (prop || func || event)"),interface:new de("class && (prop || func || event)")})});he.collect=(()=>{let e=ye.bucket.slice();return he.clear(),e}),he.has=(e=>-1!==ye.bucket.findIndex(t=>t.name===e)),he.get=(e=>{let t=ye.bucket.findIndex(t=>t.name===e);return-1!==t?ye.bucket[t]:null}),he.clear=(()=>{ye.bucket.length=0}),p("attr",me),p("$$",me);const ge=(e,t,n,r,i)=>{let s=he.collect(),o=null,l=null,u=be(!0,e,t),p=be(!1,e,t);if(r?(o=t.attrs.type,l=t.modifiers.type):(o=e.attrs.members[n],l=e.modifiers.members[n]),!i)for(let e of s)if(e.isCustom)throw g("CustomAttributesNotAllowed",`Custom attribute cannot be applied. (${e.name})`,ge);const f=i=>{let s=!1,o=c,l=["prop","func","construct","dispose","event"],f=["static","abstract","sealed","virtual","override","private","protected","readonly","async"],m=[],d=[],h=i.cfg.constraints;const y=e=>{let t={withWhat:"",matchType:"",original:e,name:"",value:!1};switch(e.substr(0,1)){case"$":t.matchType="anywhere",t.name=e.substr(1);break;case"@":t.matchType="inherited",t.name=e.substr(1);break;default:t.matchType="current",t.name=e;break}e.endsWith("^")?(t.withWhat="typeName",t.name=t.name.replace("^","")):-1!==o.indexOf(t.name)?(t.withWhat="typeType",t.matchType="current"):-1!==l.indexOf(t.name)?(t.withWhat="memberType",t.matchType="current"):f.indexOf(t.name)!==0-1?t.withWhat="modifier":t.withWhat="attribute","struct"===t.name?d.push(t):m.push(t)},b=()=>{let e=new RegExp("[^!&!|()]","g"),t="",n=[],r=0;for(;1&&null!==(t=e.exec(h));)n.push(t);t="",r=0;for(let e of n)r++," "!==e[0]?(t+=e[0],r===n.length&&(""!==t&&y(t),t="")):(""!==t&&y(t),t="");m=m.concat(d)};b();for(let i of m){switch(i.withWhat){case"typeName":switch(i.matchType){case"anywhere":i.value=i.name===t.name||t.Type[a].isDerivedFrom(i.name);break;case"inherited":i.value=t.Type[a].isDerivedFrom(i.name);break;case"current":i.value=i.name===t.name;break}break;case"typeType":i.value=t.type===i.name;break;case"memberType":i.value=!r&&e.members[n]===i.name;break;case"modifier":i.value=r?!!u.type.probe(i.name)[i.matchType]():!!u.members.probe(i.name,n)[i.matchType]();break;case"attribute":i.value=r?!!p.type.probe(i.name)[i.matchType]():!!p.members.probe(i.name,n)[i.matchType]();break}h=T(h,i.original,i.value.toString())}if(!(s=new Function("try {return ("+h+");}catch(e){return false;}")()))throw new g("InvalidOperation",`${i.cfg.isModifier?"Modifier":"Attribute"} ${i.name} could not be applied. (${n})`);return s};for(let n of s)f(n)&&((n=N(n,null,!1,{type:r?t.name:e.name})).isCustom?o.push(n):n.cfg.isModifier?l.push(n):o.push(n))},be=(e,t,n)=>{let r=e?"modifiers":"attrs",i=(e,i,s,a)=>{let o=null;if(a)if(s){let t=n.previous();for(;1&&null!==t&&(t[r]&&t[r].type&&(o=k(t[r].type,"name",e)),!o);)t=t.previous()}else n[r]&&n[r].type&&(o=k(n[r].type,"name",e));else if(s){let n=t.previous();for(;1&&null!==n&&(n[r]&&n[r].members[i]&&(o=k(n[r].members[i],"name",e)),!o);)n=n.previous()}else t[r]&&t[r].members[i]&&(o=k(t[r].members[i],"name",e));return o},s=(e,t,n,r)=>null!==i(e,t,n,r);const a=(e,t)=>{let n;return Object.freeze({anywhere:()=>i(e,t,!1,!1)||i(e,t,!0,!1),current:()=>i(e,t,!1,!1),inherited:()=>i(e,t,!0,!1),only:Object.freeze({current:()=>i(e,t,!1,!1)&&!i(e,t,!0,!1),inherited:()=>!i(e,t,!1,!1)&&i(e,t,!0,!1)})})},o=e=>{let t;return Object.freeze({anywhere:()=>i(e,null,!1,!0)||i(e,null,!0,!0),current:()=>i(e,null,!1,!0),inherited:()=>i(e,null,!0,!0),only:Object.freeze({current:()=>i(e,null,!1,!0)&&!i(e,null,!0,!0),inherited:()=>!i(e,null,!1,!0)&&i(e,null,!0,!0)})})},l=e=>{let n=Object.freeze({current:()=>t[r].members[e].slice(),inherited:()=>{let n=[],i=null,s=t.previous();for(;1&&null!==s;)s[r]&&s[r].members&&(i=k(s[r].members,"name",e)),i&&n.push(...i),s=s.previous();return n},anywhere:()=>[...n.current(),...n.inherited()]});return n},c=()=>{let e=Object.freeze({current:()=>n[r].type.slice(),inherited:()=>{let e=[],t=null,i=n.previous();for(;1&&null!==i;)i[r]&&i[r].type&&(t=i[r].type.slice()),t&&e.push(...t),i=i.previous();return e},anywhere:()=>[...e.current(),...e.inherited()]});return e},u={type:Object.freeze({get:(e,t)=>i(e,null,t,!0),has:(e,t)=>s(e,null,t,!0),all:c,probe:o}),members:{get:(e,t,n)=>i(e,t,n,!1),has:(e,t,n)=>s(e,t,n,!1),all:l,probe:a}};return e&&(u.members.is=((e,t)=>{let n=a(e,t);switch(e){case"static":return n.anywhere();case"abstract":return n.anywhere()&&!(a.anywhere("virtual",t)||a.anywhere("override",t));case"virtual":return n.anywhere()&&!a.anywhere("override",t);case"override":return n.anywhere()&&!a.anywhere("sealed",t);case"sealed":return n.anywhere();case"private":return n.anywhere();case"protected":return n.anywhere();case"readonly":return n.anywhere();case"async":return n.anywhere()}}),u.members.type=(e=>{let n,r="";if(!("type"===t.level)){let n=t;for(;1&&null!==n&&(n.members[e]&&(r=n.members[e]),!r);)n=n.previous()}return r}),u.members.isProperty=(e=>"prop"===u.members.type(e)),u.members.isFunction=(e=>"func"===u.members.type(e)),u.members.isEvent=(e=>"event"===u.members.type(e))),u.members=Object.freeze(u.members),Object.freeze(u)},we=e=>{let t={getType:function(){let e;return this.instance.def.Type}},n={id:A()};e.ex.instance=S(e.ex.instance,t,!1),e.mex.instance=S(e.mex.instance,n,!1);let r={getName:function(){let e;return this.type.def.name}},i={id:A()};e.ex.type=S(e.ex.type,r,!1),e.mex.type=S(e.mex.type,i,!1)},ve=(e,t,n,r,i,s)=>{let a={type:{Type:t,def:r,attrs:i,modifiers:s}};for(let t in e)e.hasOwnProperty(t)&&("function"==typeof e[t]?Object.defineProperty(n,t,{configurable:!0,enumerable:!1,value:e[t].bind(a)}):Object.defineProperty(n,t,{configurable:!0,enumerable:!1,value:e[t]}))},Ae=(e,t,n,r,i,s,a,o,l,c)=>{let u={instance:{obj:t,def:i,attrs:a,modifiers:o},type:{Type:r,typeDef:s,attrs:l,modifiers:c}};for(let t in e)"function"==typeof e[t]?Object.defineProperty(n,t,{configurable:!0,enumerable:!1,value:e[t].bind(u)}):Object.defineProperty(n,t,{configurable:!0,enumerable:!1,value:e[t]})},xe=(e,t,n,r,i,...s)=>{let o=t[a],c=o.def(),u="___flag___",p={_flagName:u};if(void 0!==r&&r===u?(p.isNeedProtected=!0,p.isTopLevelInstance=!1,p.staticInterface=i,p.args=s):(p.isNeedProtected=!1,p.isTopLevelInstance=!0,p.staticInterface=t,p.args=void 0!==r?void 0!==i?[r,i].concat(s):[r]:[]),e.singleton&&!c.staticConstructionCycle&&!it&&p.isTopLevelInstance&&o.singleInstance())return o.singleInstance();let m={},d=null,h=null,w=null,A="_construct",x="_dispose",O={},k=null,j={name:e.params.typeName,type:e.types.type,Type:t,level:"object",members:{},attrs:{members:{}},modifiers:{members:{}},previous:()=>k},T=null,P=!1,C=null,N=e.storage?v("sessionStorage"):null,D=e.storage?v("localStorage"):null;const z=(e,t,n,r)=>{for(let i of H.members.all(t).current())if(i.isCustom){if("prop"===n){let n=i.attr.decorateProperty(j.name,t,r);if(!n.get||!n.set)throw new g("Unexpected",`${i.name} decoration result is unexpected. (${t})`);n.get=n.get.bind(e),n.set=n.set.bind(e),r=n}else{let s=null;if(!(s="func"===n?i.attr.decorateFunction(j.name,t,r):i.attr.decorateEvent(j.name,t,r)))throw new g("Unexpected",`${i.name} decoration result is unexpected. (${t})`);r=s.bind(e)}i.attr=null}return r},M=(e,t)=>{let n=null,r=[];return r=_e(j.name,e),j.aspects.members[e]=r,r.length>0&&(n=qe(t,j.name,e,r))&&(t=n),t},U=()=>{let r=!1,i=e=>{Object.defineProperty(m,e,Object.getOwnPropertyDescriptor(n,e))},s=Object.getOwnPropertyDescriptor(n,a);s.enumerable=!1,Object.defineProperty(m,a,s),h=m[a];for(let e in n)if(r=!1,n.hasOwnProperty(e)&&e!==a){if(r=!0,j.members[e]?(V.members.probe("private",e).current()&&(r=!1),r&&V.members.probe("protected",e).current()&&!p.isNeedProtected&&(r=!1)):V.members.probe("protected",e).anywhere()&&!p.isNeedProtected&&(r=!1),r&&i(e),r&&V.members.is("abstract",e))throw new g("InvalidDefinition",`Abstract member is not implemented. (${e})`);if(r){let t=H.members.probe("enumerate",e).current();if(t&&!1===t.args[0]){let t=Object.getOwnPropertyDescriptor(m,e);t.enumerable=!1,Object.defineProperty(m,e,t)}}r&&!p.isNeedProtected&&V.members.isEvent(e)&&m[e].strip(m)}p.isTopLevelInstance&&(Ae(e.ex.instance,m,m,t,j,c,H,V,o.attrs,o.modifiers),Ae(e.mex.instance,m,h,t,j,c,H,V,o.attrs,o.modifiers)),p.isTopLevelInstance||(h.def=j)},E=(t,n)=>{if((void 0===m[t]||V.members.type(t)!==n[a].modifiers.members.type(t))&&("dispose"!==t||"function"!=typeof m[x]&&"function"!=typeof h.dispose))throw new g("NotImplemented",`Interface member is not implemented. (${t})`);he("interface",n[a].name),ge(j,c,t,!1,e.customAttrs)},R=()=>{if(j.interfaces){for(let e of j.interfaces)for(let t in e)e.hasOwnProperty(t)&&E(t,e);delete j.interfaces}},F=(t,n,r)=>{switch(-1!==["func","prop","event"].indexOf(n)&&t.startsWith("_")&&new g("InvalidName",`Name is not valid. (${t})`),n){case"func":if(!e.func)throw new g("InvalidOperation",`Function cannot be defined on this type. (${j.name})`);break;case"prop":if(!e.prop)throw new g("InvalidOperation",`Property cannot be defined on this type. (${j.name})`);break;case"event":if(!e.event)throw new g("InvalidOperation",`Event cannot be defined on this type. (${j.name})`);break;case"construct":if(!e.construct)throw new g("InvalidOperation",`Constructor cannot be defined on this type. (${j.name})`);n="func";break;case"dispose":if(!e.dispose)throw new g("InvalidOperation",`Dispose cannot be defined on this type. (${j.name})`);n="func";break}return n},W=(t,r,i)=>{let s=!0,a=H.members.probe("conditional",t).current();if(a){let e=$(a.args[0]||[]);for(let t of e){if("test"!==(t=t.toLowerCase())||!l.env.isTesting){s=!1;break}if("server"!==t||!l.env.isServer){s=!1;break}if("client"!==t||!l.env.isClient){s=!1;break}if("worker"!==t||!l.env.isWorker){s=!1;break}if("main"!==t||!l.env.isMain){s=!1;break}if("debug"!==t||!l.env.isDebug){s=!1;break}if("prod"!==t||!l.env.isProd){s=!1;break}if("cordova"!==t||!l.env.isCordova){s=!1;break}if("nodewebkit"!==t||!l.env.isNodeWebkit){s=!1;break}if(-1===l.symbols.indexOf(t)){s=!1;break}}if(!s)return s}if(e.inheritance&&V.members.probe("abstract",t).current()&&!0!==i.ni)throw new g("InvalidDefinition",`Abstract member must point to nip, nim or nie values. (${t})`);if((a=V.type.probe("static").current())&&e.static)if(o.isStatic()){if(e.construct&&t===A&&0!==i.length)throw new g("InvalidDefinition",`Static constructors cannot have arguments. (construct)`);if(e.dispose&&t===x)throw new g("InvalidDefinition",`Static types cannot have destructors. (dispose)`)}else{if(e.construct&&t===A)throw new g("InvalidDefinition",`Non-static types cannot have static constructors. (construct)`);if(e.dispose&&t===x)throw new g("InvalidDefinition",`Static destructors cannot be defined. (dispose)`)}if(e.dispose&&t===x&&0!==i.length)throw new g("InvalidDefinition",`Destructor method cannot have arguments. (dispose)`);if(void 0!==n[t]&&(!e.inheritance||e.inheritance&&!V.members.probe("override",t).current()))throw new g("InvalidOperation",`Member with this name is already defined. (${t})`);if(e.inheritance&&V.members.probe("override",t).current()){if(void 0===n[t])throw new g("InvalidOperation",`Member not found to override. (${t})`);if(V.members.type(t)!==r)throw new g("InvalidOperation",`Overriding member type is invalid. (${t})`)}if(e.static&&(V.members.probe("static",t).current()||o.isStatic()))if("func"===r){if(I(i))throw new g("InvalidOperation",`Static functions cannot be defined as an arrow function. (${t})`)}else if("prop"===r){if(i.get&&"function"==typeof i.get&&I(i))throw new g("InvalidOperation",`Static property getters cannot be defined as an arrow function. (${t})`);if(i.set&&"function"==typeof i.set&&I(i))throw new g("InvalidOperation",`Static property setters cannot be defined as an arrow function. (${t})`)}if(e.storage&&H.members.probe("session",t).current()&&i.get&&"function"==typeof i.get)throw new g("InvalidOperation",`Session properties cannot be defined with a custom getter/setter. (${t})`);if(e.storage&&H.members.probe("state",t).current()){if(i.get&&"function"==typeof i.get)throw new g("InvalidOperation",`State properties cannot be defined with a custom getter/setter. (${t})`);if(!D)throw new g("NotConfigured","Port is not configured. (localStorage)")}return s},L=(t,r,i)=>{let s={get:null,set:null},o=f,l=f,c=V.members.probe("readonly",t).anywhere(),u=V.members.probe("static",t).anywhere(),m=H.members.probe("session",t).anywhere(),d=H.members.probe("state",t).anywhere(),h=H.members.probe("deprecate",t).current(),y=H.members.probe("inject",t).current(),b=H.members.probe("asset",t).current(),w=H.members.probe("resource",t).current(),v=H.members.probe("type",t).current(),A=null!==h,x=A?h.args[0]||`Event is marked as deprecate. (${t})`:"",I=O,k=n,$=j.name+"_"+t,T=!1,S=[];if(i&&(i.get||i.set)){if(!e.propGetterSetter)throw new g("InvalidOperation",`Getter/Setter are not allowed. (${t})`);i.get&&"function"==typeof i.get&&(o=i.get),i.set&&"function"==typeof i.set&&(l=i.set),e.static&&u&&(k=p.staticInterface),s.get=function(){return A&&console.log(x),o.apply(k)}.bind(k),s.set=function(e){if(A&&console.log(x),c&&!k[a].constructing)throw new g("InvalidOperation",`Property is readonly. (${t})`);if(v&&v.args[0]&&!re(e,v.args[0]))throw new g("InvalidArgument","Argument type is invalid. (value)");return l.apply(k,[e])}.bind(k)}else{if(e.static&&u){if(I=p.staticInterface[a].props,k=p.staticInterface,v&&v.args[0]&&!re(i,v.args[0]))throw new g("InvalidArgument","Argument type is invalid. (value)");I[$]=i}else if(e.storage&&(m||d)){if(T=!0,m?(I=N,$=n[a].id+"_"+$):I=D,G(m?"session":"state",$),!I.key($)){if(v&&v.args[0]&&!re(i,v.args[0]))throw new g("InvalidArgument","Argument type is invalid. (value)");I.setItem($,JSON.stringify({value:i}))}}else{if(v&&v.args[0]&&!re(i,v.args[0]))throw new g("InvalidArgument","Argument type is invalid. (value)");if(e.numOnlyProps&&"number"!=typeof i)throw new g("InvalidArgument","Value type is invalid.");I[$]=i}s.get=function(){return A&&console.log(x),T?JSON.parse(I.getItem($)).value:I[$]}.bind(k),s.set=function(e){if(A&&console.log(x),c&&!k[a].constructing)throw new g("InvalidOperation",`Property is readonly. (${t})`);if(v&&v.args[0]&&!re(e,v.args[0]))throw new g("InvalidArgument","Argument type is invalid. (value)");T?I.setItem($,JSON.stringify({value:e})):I[$]=e}.bind(k)}if(y&&!u&&!T){let e=y.args[0],t=y.args.length>0?y.args[1]:[],n=y.args.length>1&&y.args[2];S=Me.resolve(e,t,n),Array.isArray(S)||(S=[S]),s.set(S)}if((H.members.probe("dispose",t).anywhere()||y)&&G("prop",t),(w||b)&&!T){let e=null;if(w)w.args[0]&&(e=Q(w.args[0]));else if(b.args[0]){let t=b.args[0];t.startsWith("../")&&(t=t.substr(3)),t.startsWith("./")&&(t=t.substr(2)),t.startsWith("/")&&(t=t.substr(1)),e=J(j.name)+"/"+t}e&&s.set(e)}return e.customAttrs&&(s=z(k,t,r,s)),s},_=(t,r,i)=>{let s=null,o=n,l=e.inheritance&&V.members.probe("override",t).current(),c=e.static&&V.members.probe("static",t).current(),u=V.members.probe("async",t).current(),f=H.members.probe("deprecate",t).current(),m=H.members.probe("inject",t).current(),d=H.members.probe("on",t).current(),h=H.members.probe("timer",t).current(),y=H.members.probe("args",t).current(),g=null!==f,b=g?f.args[0]||`Function is marked as deprecate. (${t})`:"",w=null,v=[];if(l?!0===(w=n[t].bind(o)).ni&&(w=null):c&&(o=p.staticInterface),m){let e=m.args[0],t=m.args.length>0?m.args[1]:[],n=m.args.length>1&&m.args[2];v=Me.resolve(e,t,n),Array.isArray(v)||(v=[v])}if(s=u?function(...e){return new Promise(function(t,n){g&&console.log(b);let r=[];if(w&&r.push(w),v.length>0&&r.push(v),r.push(t),r.push(n),y&&e.attr.args.length>0){let t=fe(...e.attr.args)(...e);if(t.isInvalid)return void n(t.error);r.push(t)}else r.concat(e);return i.apply(o,r)}.bind(o))}.bind(o):function(...e){g&&console.log(b);let t=[];if(w&&t.push(w),v.length>0&&t.push(v),y&&e.attr.args.length>0){let n=fe(...e.attr.args)(...e);if(n.isInvalid)throw n.error;t.push(n)}else t.concat(e);return i.apply(o,t)}.bind(o),e.customAttrs&&(s=z(o,t,r,s)),e.aop&&(s=M(t,s)),d&&d.args.length>0&&(Ne(d.args[0],s),G("handler",{name:d.args[0],handler:s})),h&&h.args.length>0){let e=!1,r=setInterval(()=>{o[a].constructing||e||(e=!0,n[t](),e=!1)},1e3*h.args[0]);G("timer",r)}return s},q=(t,r,i)=>{let s=null,o=null,l=null,c=null,u=e.inheritance&&V.members.probe("override",t).current(),p=H.members.probe("deprecate",t).current(),f=H.members.probe("post",t).current(),d=null!==p,h=d?p.args[0]||`Event is marked as deprecate. (${t})`:"",y=n;return C||(C=new b,G("event",C)),u&&!0===(l=n[t][a].processor).ni&&(l=null),s=function(...e){return d&&console.log(h),c=l?[l].concat(e):e,i.apply(y,c)}.bind(y),e.customAttrs&&(s=z(y,t,r,s)),o=s,(s=function(...e){let t=e;"function"==typeof o&&(t=o(...e)),C.dispatch(name,t),f&&f.args.length>0&&De(f.args[0],t)}.bind(y))[a]=Object.freeze({processor:o}),s.add=(e=>{C.add(name,e)}),s.remove=(e=>{C.remove(name,e)}),s.strip=(e=>{let n=S({},s,!0,["strip"]);delete s.strip,delete e.strip,Object.defineProperty(m,t,{configurable:!0,enumerable:!0,value:Object.freeze(n)})}),s},B=(t,r,i)=>{r=F(t,r,i),j.members[t]=r,j.attrs.members[t]=[],j.modifiers.members[t]=[],e.aop&&(j.aspects={members:{}}),e.mixins&&null!==w&&he("mixin",w[a].name),ge(j,c,t,!1,e.customAttrs);let s=null,o=e.static&&V.members.probe("static",t).current(),l=o?p.staticInterface:n;if(o){if(!c.staticConstructionCycle)return}else if(c.staticConstructionCycle)return;if(W(t,r,i))switch(r){case"func":s=_(t,r,i),Object.defineProperty(l,t,{configurable:!0,enumerable:!0,value:s});break;case"prop":s=L(t,r,i),Object.defineProperty(l,t,{configurable:!0,enumerable:!0,get:s.get,set:s.set});break;case"event":s=q(t,r,i),Object.defineProperty(l,t,{configurable:!0,enumerable:!0,value:s});break}},G=(e,t)=>{d.disposables.push({type:e,data:t})},V=be(!0,j,c),H=be(!1,j,c);if(e.inheritance){if(p.isTopLevelInstance&&!c.staticConstructionCycle&&!it&&V.type.probe("abstract").current())throw new g("InvalidOperation",`Cannot create instance of an abstract type. (${j.name})`);let e=o.inherits,t=null;if(e){if((t=e[a]).isSealed()||t.isSingleton()||t.isStatic())throw new g("InvalidOperation",`Cannot inherit from a sealed, static or singleton type. (${t.name})`);if(t.type!==o.type)throw new g("InvalidOperation",`Cannot inherit from another type family. (${t.type})`);if(t.context&&t.context.isUnloaded())throw new g("InvalidOperation",`Parent context is not active anymore. (${t.name})`);n=new e(p._flagName,p.staticInterface,p.args),d=n[a],k=d.def,delete d.def}else if(o.context&&o.context.isUnloaded())throw new g("InvalidOperation",`Type context is not active anymore. (${o.name})`)}if(void 0===n[a]&&(n[a]={},d=n[a],e.dispose&&(d.disposables=[])),e.mixins&&(j.mixins=e.params.mixins),e.interfaces&&(j.interfaces=e.params.interfaces),d.type=e.types.instance,p.isTopLevelInstance&&(d.Type=t,e.new&&(d.isInstanceOf=(e=>{if(e[a]&&(e=e[a].name),!e)throw new g("InvalidArgument","Argument type is invalid. (name)");return o.name===e||o.isDerivedFrom(e)})),e.mixins&&(d.isMixed=(e=>o.isMixed(e))),e.interfaces&&(d.isImplements=(e=>o.isImplements(e))),d.modifiers=V,d.attrs=H,it&&(d.def=j,d.typeDef=c,d.obj=n)),P=!0,T=new Proxy({},{get:(e,t)=>n[t],set:(e,t,r)=>{if(P){let e="";"construct"===t?(e="construct",t=A):"dispose"===t?(e="dispose",t=x):"function"==typeof r?!0===r.event?(r!==y&&delete r.event,e="event"):e="func":e="prop",B(t,e,r)}else{if("function"==typeof r)throw new g("InvalidOperation",`Redefinition of members is not allowed. (${t})`);n[t]=r}return!0}}),e.mixins&&j.mixins&&!c.staticConstructionCycle){for(let e of j.mixins)w=e,e.apply(T),w=null;delete j.mixins}if(e.params.factory.apply(T),he.clear(),p.isTopLevelInstance&&(e.construct&&"function"==typeof n[A]&&(d.construct=n[A],delete n[A]),e.dispose&&"function"==typeof n[x])){let e=n[x];delete n[x],d.dispose=(()=>{for(let e of d.disposables)switch(e.type){case"session":N.removeItem(e.data);break;case"state":D.removeItem(e.data);break;case"prop":n[e.data]=null;break;case"event":e.data.clear();break;case"handler":Ne(e.data.name,e.data.handler,!0);break;case"timer":clearInterval(e.data);break}"function"==typeof e&&e(),d.disposables.length=0,O=null,k=null,j=null,T=null,C=null,m=null,n=null})}return e.static&&o.isStatic()&&c.staticConstructionCycle&&t.construct&&"function"==typeof t[A]&&(o.construct=t[A],delete t[A]),U(),!e.interfaces||c.staticConstructionCycle||it||R(),e.construct&&p.isTopLevelInstance&&!c.staticConstructionCycle&&!it&&"function"==typeof h.construct&&(h.constructing=!0,h.construct(...p.args),delete h.constructing),e.construct&&c.staticConstructionCycle&&"function"==typeof o.construct&&(o.constructing=!0,o.construct(),delete o.constructing),!p.isTopLevelInstance||c.staticConstructionCycle||it||e.singleton&&H.type.probe("singleton").current()&&(o.singleInstance=(()=>m),o.singleInstance.clear=(()=>{o.singleInstance=(()=>null)})),!p.isTopLevelInstance||c.staticConstructionCycle||it||(h=Object.freeze(h),m=Object.seal(m)),P=!1,m},Ie=()=>{let t=v("sessionStorage");t?t.clear():e?(!0).sessionStorage&&delete global.sessionStorage:sessionStorage.clear()},Oe=e=>{if(e.new=e.new||!1,e.mixins=e.mixins||!1,e.interfaces=e.interfaces||!1,e.inheritance=e.inheritance||!1,e.singleton=e.singleton||!1,e.static=e.static||!1,e.const=e.const||!1,e.func=e.func||!1,e.construct=e.construct||!1,e.dispose=e.dispose||!1,e.prop=e.prop||!1,e.propGetterSetter=e.propGetterSetter||!1,e.numOnlyProps=e.numOnlyProps||!1,e.event=e.event||!1,e.storage=e.storage||!1,e.aop=e.aop||!1,e.customAttrs=e.customAttrs||!1,e.types=e.types||{},e.types.instance=e.types.instance||"unknown",e.types.type=e.types.type||"unknown",e.params=e.params||{},e.params.typeName=e.params.typeName||"",e.params.inherits=e.params.inherits||null,e.params.mixinsAndInterfaces=e.params.mixinsAndInterfaces||null,e.params.factory=e.params.factory||null,e.mex=e.mex||{},e.mex.instance=e.mex&&e.mex.instance?e.mex.instance:{},e.mex.type=e.mex&&e.mex.type?e.mex.type:{},e.ex=e.ex||{},e.ex.instance=e.ex&&e.ex.instance?e.ex.instance:{},e.ex.type=e.ex&&e.ex.type?e.ex.type:{},e.params.ns="",e.params.mixins=[],e.params.interfaces=[],e.func||(e.construct=!1,e.dispose=!1),e.prop||(e.storage=!1),e.inheritance||(e.singleton=!1),e.func||e.prop||e.event||(e.aop=!1),e.new&&(e.const=!1),!e.params.typeName||-1!==e.params.typeName.indexOf("."))throw`Type name is invalid. (${e.params.typeName})`;let t=he.get("ns"),n=t?t.args[0]:"";if(n)switch(n){case"(auto)":throw`Namespace '(auto)' should be used only when bundling the type in an assembly. (${n})`;case"(root)":break;default:if(n.startsWith(".")||n.endsWith(".")||/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g.test(n))throw`Namespace name is invalid. (${n})`;e.params.typeName=n+"."+e.params.typeName,e.params.ns=n;break}if(e.params.mixinsAndInterfaces)for(let t of e.params.mixinsAndInterfaces)if(t[a])switch(t[a].type){case"mixin":e.params.mixins.push(t);break;case"interface":e.params.interfaces.push(t);break}delete e.params.mixinsAndInterfaces,we(e);let r=G.context.current(),i=r.currentAssemblyBeingLoaded()||"",s=null,o=null;s=e.new?function(t,n,...r){return xe(e,s,{},t,n,...r)}:e.const?function(){return xe(e,s,{})}:function(){if(new.target)throw g("NewNotAllowed",`Cannot construct. (${e.params.typeName})`,s);e.params.factory.apply(this)};let l={name:e.params.typeName,type:e.types.type,Type:s,level:"type",attrs:{type:[]},modifiers:{type:[]},previous:()=>s[a].inherits?s[a].inherits[a].def():null};const c=be(!0,null,l),u=be(!1,null,l);if(s[a]={},(o=s[a]).name=e.params.typeName,o.type=e.types.type,o.namespace=null,o.assembly=(()=>r.getAssembly(i)||null),o.context=r,e.inheritance&&(o.inherits=e.params.inherits||null,o.isAbstract=(()=>!!c.type.probe("abstract").current()),o.isSealed=(()=>!!c.type.probe("sealed").current()),o.isDerivedFrom=(t=>{if(t[a]&&(t=t[a].name),"string"!=typeof t)throw new g("InvalidArgument","Argument type is invalid. (name)");let n=!1,r=e.params.inherits;if(!n)for(;1&&null!==r;){if(r[a].name===t){n=!0;break}r=r[a].inherits}return n}),o.inherits)){let e=u.type.probe("deprecate").anywhere();if(e){let t=e.args[0]||`Type is marked as deprecated. (${o.name})`;console.log(t)}}if(e.static&&(o.isStatic=(()=>!!c.type.probe("static").current()),o.props={}),e.singleton&&(o.isSingleton=(()=>!!u.type.probe("singleton").current()),o.singleInstance=(()=>null),o.singleInstance.clear=f),e.mixins&&(o.mixins=e.params.mixins,o.isMixed=(e=>{if(e[a]&&(e=e[a].name),"string"!=typeof e)throw new g("InvalidArgument","Argument type is invalid. (name)");let t=!1,n=s;for(;1&&null!==n&&(n[a].mixins&&(t=-1!==k(n[a].mixins,"name",e)),!t);)n=n[a].inherits;return t})),e.interfaces&&(o.interfaces=e.params.interfaces,o.isImplements=(e=>{if(e[a]&&(e=e[a].name),"string"!=typeof e)throw new g("InvalidArgument","Argument type is invalid. (name)");let t=!1,n=s;for(;1&&null!==n&&(n[a].interfaces&&(t=-1!==k(n[a].interfaces,"name",e)),!t);)n=n[a].inherits;return t})),o.isDeprecated=(()=>!!u.type.probe("deprecate").current()),o.def=(()=>l),o.modifiers=c,o.attrs=u,ge(null,l,null,!0,e.customAttrs),e.static&&c.type.probe("static").current()){if(e.params.interfaces.length>0)throw g("InvalidOperation","Static types cannot implement interfaces.");if(e.params.mixins.length>0)throw g("InvalidOperation","Static types cannot implement mixins.")}if(e.static){let t=e.params.factory?e.params.factory.toString():"";if(o.isStatic()||-1!==t.indexOf(`$$('static')`)||-1!==t.indexOf(`$$("static")`)){l.staticConstructionCycle=!0;let e=new s;ue(e),delete l.staticConstructionCycle}}ve(e.ex.type,s,s,l,u,c),ve(e.mex.type,s,o,l,u,c);let p=null,m=!1;return e.static&&o.isStatic()||e.const?(p=new s,e.const&&(m=!0)):(m=!0,p=s),n&&(o.namespace=G.context.current().registerType(p)),s[a]=Object.freeze(o),m&&Object.freeze(p),p},ke=(e,t,n,r)=>{let i=fe("name: string, inherits: class, factory: cfunction","name: string, inherits: class, mixints: array, factory: cfunction","name: string, factory: cfunction","name: string, mixints: array, factory: cfunction")(e,t,n,r);if(i.isInvalid)throw i.error;let s={new:!0,mixins:!0,interfaces:!0,inheritance:!0,singleton:!0,static:!0,func:!0,construct:!0,dispose:!0,prop:!0,propGetterSetter:!0,event:!0,storage:!0,aop:!0,customAttrs:!0,types:{instance:"instance",type:"class"},params:{typeName:i.values.name,inherits:i.values.inherits,mixinsAndInterfaces:i.values.mixints,factory:i.values.factory},mex:{instance:{},type:{}},ex:{instance:{},type:{}}};return Oe(s)};p("Class",ke);const $e=(e,t)=>{let n=fe("name: string, factory: cfunction")(e,t);if(n.isInvalid)throw n.error;let r={const:!0,func:!0,dispose:!0,prop:!0,propGetterSetter:!0,event:!0,types:{instance:"interface",type:"interface"},params:{typeName:n.values.name,factory:n.values.factory}};return Oe(r)};p("Interface",$e);const je=(e,t,n)=>{let r=fe("name: string, factory: cfunction","name: string, mixints: array, factory: cfunction")(e,t,n);if(r.isInvalid)throw r.error;let i={new:!0,mixins:!0,interfaces:!0,func:!0,construct:!0,prop:!0,propGetterSetter:!0,types:{instance:"sinstance",type:"struct"},params:{typeName:r.values.name,mixinsAndInterfaces:r.values.mixints,factory:r.values.factory}};return Oe(i)};p("Struct",je);const Te=(e,t)=>{let n=fe("name: string, factory: cfunction")(e,t);if(n.isInvalid)throw n.error;let r={const:!0,prop:!0,numOnlyProps:!0,types:{instance:"enum",type:"enum"},params:{typeName:n.values.name,factory:n.values.factory},mex:{instance:{getName:function(e){let t=this.instance.obj,n=this.instance.def,r="";for(let i in n.members)if(n.members.hasOwnProperty(i)&&"prop"===n.members[i]&&t[i]===e){r=i;break}return r},getNames:function(){let e=this.instance.def,t=[];for(let n in e.members)e.members.hasOwnProperty(n)&&"prop"===e.members[n]&&t.push(n);return t},getValues:function(){let e=this.instance.def,t=this.instance.obj,n=[];for(let r in e.members)e.members.hasOwnProperty(r)&&"prop"===e.members[r]&&n.push(t[r]);return n}}}};return Oe(r)};Te.getName=((e,t)=>{if("enum"!==K(e))throw g("InvalidArgument","Argument type is invalid. (enumType)");if("number"!=typeof t)throw g("InvalidArgument","Argument type is invalid. (enumValue)");return e[a].getName(t)}),Te.getNames=(e=>{if("enum"!==K(e))throw g("InvalidArgument","Argument type is invalid. (enumType)");return e[a].getNames()}),Te.getValues=(e=>{if("enum"!==K(e))throw g("InvalidArgument","Argument type is invalid. (enumType)");return e[a].getValues()}),Te.isDefined=((e,t)=>{if("enum"!==K(e))throw g("InvalidArgument","Argument type is invalid. (enumType)");if("string"==typeof t)return-1!==e[a].getNames().indexOf(t);if("number"==typeof t)return""!==e[a].getName(t);throw g("InvalidArgument","Argument type is invalid. (nameOrValue)")}),p("Enum",Te);const Se=(e,t)=>{let n=fe("name: string, factory: function")(e,t);if(n.isInvalid)throw n.error;let r={func:!0,prop:!0,propGetterSetter:!0,event:!0,customAttrs:!0,types:{type:"mixin"},params:{typeName:n.values.name,factory:n.values.factory}};return Oe(r)};p("Mixin",Se);const Pe=new b,Ce=Pe.dispatch,Ne=(e,t,n)=>{n?Pe.remove(e,t):Pe.add(e,t)};p("on",Ne,()=>{Pe.clear()});const De=(e,t)=>{Ce(e,t)};p("post",De);let ze={};const Me={isRegistered:e=>{if("string"!=typeof e)throw new g("InvalidArgument","Argument type is invalid. (alias)");return void 0!==ze[e]&&ze[e].length>0},get:(e,t)=>{if("string"!=typeof e)throw new g("InvalidArgument","Argument type is invalid. (alias)");if("boolean"!=typeof t)throw new g("InvalidArgument","Argument type is invalid. (isAll)");return t?ze[e]?ze[e].slice():[]:ze[e]?ze[e][0]:null},register:(e,t)=>{if("string"!=typeof e)throw new g("InvalidArgument","Argument type is invalid. (alias)");if(-1!==e.indexOf("."))throw new g("InvalidArgument","Argument type is invalid. (alias)");if(!t)throw new g("InvalidArgument","Argument type is invalid. (item)");"string"==typeof t&&((t=x(t)).endsWith(".js")||t.endsWith(".mjs"))&&(t=x(t,!0)),ze[e]||(ze[e]=[]),ze[e].push(t)},resolve:(e,t,...n)=>{if("string"!=typeof e)throw new g("InvalidArgument","Argument type is invalid. (alias)");if("boolean"!=typeof t)throw new g("InvalidArgument","Argument type is invalid. (isAll)");let r=null;const i=e=>{let t=e;if("string"==typeof e)if(e.endsWith(".js")||e.endsWith(".mjs"));else{let t=X(e);t&&(e=t)}return-1!==["class","struct"].indexOf(K(e))&&(t=n?new e(...n):new e),t};return ze[e]&&ze[e].length>0&&(t?(r=[],ze[e].forEach(e=>{r.push(i(e))})):r=i(ze[e][0])),r}};p("Container",Me,()=>{ze={}});let Ue=f,Ee=[],Re=500;const Fe={on:(e,...t)=>{Ue===f&&("string"==typeof e?t.unshift(e):"function"==typeof e&&Ne("telemetry",e),Ue=((e,n)=>{if(0===t.length||-1!==t.indexOf(e)){let t=Object.freeze({type:e,data:n});Ee.push(t),Ee.length>Re-25&&Ee.splice(0,25),De("telemetry",t)}}))},collect:()=>{if(Ue!==f){let e=Ee.slice();return Ee.length=0,e}return[]},off:e=>Ue!==f?("function"==typeof e&&Ne("telemetry",e,!0),Ue=f,Fe.collect()):[],isOn:()=>Ue!==f,types:Object.freeze({RAW:"raw",EXEC:"exec",INFO:"info",INCL:"incl"})};p("telemetry",Fe,()=>{Ee.length=0});const We=[],Le={register:(e,t)=>{if("string"!=typeof e)throw new g.InvalidArgument("pointcut");if(!re(t,"Aspect"))throw new g.InvalidArgument("Aspect");let n=e,r="",i="",s="",a="",o=null;-1!==n.indexOf(":")&&(n=(o=n.split(":"))[0].trim(),s=o[1].trim()||"*"),-1!==n.indexOf(".")?(r=n.substr(0,n.lastIndexOf(".")),i=n.substr(n.lastIndexOf(".")+1)):(r="",i=n),a=T(a=r+"/"+i+":"+s,".","[.]"),a=T(a,"?","."),a=T(a,"*",".*"),We.push({rex:new RegExp(a),Aspect:t})}},_e=(e,t)=>{let n=[],r="",i="",s=t.trim(),o="";return-1!==e.indexOf(".")?(r=e.substr(0,e.lastIndexOf(".")).trim(),i=e.substr(e.lastIndexOf(".")+1).trim()):(r="",i=e.trim()),o=r+"/"+i+":"+s,We.forEach(e=>{e.rex.test(o)&&-1===O(n,"name",e.Aspect[a].name)&&n.push({name:e.Aspect[a].name,Aspect:e.Aspect})}),n},qe=(e,t,n,r)=>{let i=[],s=[],a=[],o=null,l;for(let e of r)(o=new e.Aspect).before!==f&&i.push(o.before),o.around!==f&&a.push(o.around),o.after!==f&&s.push(o.after);return a.length>0&&a.reverse(),function(...r){let o=null,l=null,c={typeName:()=>t,funcName:()=>n,error:e=>(e&&(o=e),o),result:e=>(void 0!==e&&(l=e),l),args:()=>r,data:{}};for(let e of i)try{e(c)}catch(e){o=e}const u=e=>{for(let t of s)try{t(e)}catch(e){c.error(e)}};let p=e,f=null;for(let e of a)p=e(c,p);try{(f=p(...r))&&"function"==typeof f.then?c.result(new Promise((e,t)=>{f.then(t=>{c.result(t),u(c),e(c.result())}).catch(e=>{c.error(e),u(c),t(c.error())})})):(c.result(f),u(c))}catch(e){c.error(e)}return c.result()}};p("Aspects",Le,()=>{We.length=0});const Be=(e,t)=>{let n=null,r=null,i=t?JSON.parse(e):e,s=t?null:e[a].Type,o=s[a];const l=(e,t)=>{let n=e[a],r=n.attrs,i=n.modifiers,s=[],o=!1;for(let n in e)e.hasOwnProperty(n)&&n!==a&&((o=i.members.isProperty(n))&&(o=t?!r.members.probe("noserialize",n).anywhere():r.members.probe("serialize",n).anywhere())&&(o=!(i.members.is("private",n)||i.members.is("protected",n)||i.members.is("static",n)||i.members.is("readonly",n)||r.members.probe("inject",n).anywhere())),o&&s.push(n));return s};if(t){if(!i.type&&!i.data)throw g.InvalidArgument("json");if(!(s=X(i.type)))throw new g("NotRegistered",`Type is not registered. (${i.type})`);n=new s,r=o.attrs.type.probe("serialize").anywhere()?l(n,!0):l(n,!1);for(let e of r)n[e]=i.data[e]}else{r=o.attrs.type.probe("serialize").anywhere()?l(i,!0):l(i,!1),n={type:i[a].Type[a].name,data:{}};for(let e of r)n.data[e]=i[e];n=JSON.stringify(n)}return n},Ge={serialize:e=>{if(["instance","sinstance"].indexOf(-1===K(e)))throw g.InvalidArgument("instance");return Be(e)},deserialize:e=>{if(!e||"string"!=typeof e)throw g.InvalidArgument("json");return Be(e,!0)}};p("Serializer",Ge);const Ve=4*l.env.cores,Je=Math.round(Ve/4),He=[],Qe=()=>{if(He.length<=Je)return;let e=He.slice(0),t=()=>{if(0!==e.length){let n=e.shift();n.context.isBusy()?t():n.context.hasActiveInstances().then(e=>{0===e?(n.unload(),He.shift(),He.length>Je&&t()):t()}).catch(()=>{t()})}};t()},Xe=()=>new Promise((e,t)=>{let n=He.slice(0),r=()=>{if(0!==n.length){let i=n.shift();i.context.isBusy()?r():i.context.hasActiveInstances().then(t=>{0===t?e(i):r()}).catch(t)}else He.length<Ve?G.createDomain(A()).then(t=>{e(t)}).catch(t):t("AD POOL FULL")};r()}),Ke={TaskInfo:function(e,...t){return Object.freeze({type:e,typeArgs:t})},getHandle:(e,t)=>new Promise((n,r)=>{Xe().then(r=>{let i;n({run:(...n)=>new Promise((i,s)=>{r.context.execute({type:e.type,typeArgs:e.typeArgs,func:"run",args:n,keepAlive:!0},t).then(i).catch(s)}),close:()=>new Promise((n,i)=>{r.context.execute({type:e.type,typeArgs:e.typeArgs,func:"",args:[],keepAlive:!1},t).then(n).catch(i).finally(Qe)})})}).catch(r)}),invoke:(e,t)=>new Promise((n,r)=>{Xe().then(i=>{i.context.execute({type:e.type,typeArgs:e.typeArgs,func:"run",args:[],keepAlive:!1},t).then(n).catch(r).finally(Qe)}).catch(r)}),parallel:Object.freeze({invokeMany:(...e)=>{let t=[];for(let n of e)t.push(Ke.invoke(n));return t},invoke:Object.freeze({any:(...e)=>Promise.race(Ke.parallel.invokeMany(...e)),all:(...e)=>Promise.all(Ke.parallel.invokeMany(...e)),each:(e,t,...n)=>new Promise((r,i)=>{let s=Ke.parallel.invokeMany(...n),a=0;for(let n of s)n.then(e).catch(t).finally(()=>{a++,s.length===a&&r()})})})}),sequence:Object.freeze({invoke:(...e)=>new Promise((t,n)=>{let r=e.slice(0),i=[],s=()=>{if(0===r.length)return void t(...i);let e=r.shift();Ke.invoke(e).then(e=>{i.push(e),s()}).catch(n)};r.length>0?s():t(...i)})})};p("Tasks",Ke,()=>{He.forEach(e=>{e.unload()}),He.length=0});const Ye=e=>{if(e.isServer){if(!e.global.sessionStorage){let t=function(){let e={};this.key=(t=>{if(!t)throw g.invalidArgument("key");return!!e.key}),this.getItem=(t=>{if(!t)throw g.invalidArgument("key");return e.key||null}),this.setItem=((t,n)=>{if(!t)throw g.invalidArgument("key");if(void 0===n)throw g.invalidArgument("value");e[t]=n}),this.removeItem=(t=>{if(!t)throw g.invalidArgument("key");delete e[t]}),this.clear=(()=>{e={}})};e.global.sessionStorage=new t}return e.global.sessionStorage}return e.global.sessionStorage};v.define("sessionStorage",["key","getItem","setItem","removeItem","clear"],Ye);const Ze=e=>e.isServer?(console.log("Use of 'state' is not support on server. Using 'session' instead."),Ye(e)):e.global.localStorage;v.define("localStorage",["key","getItem","setItem","removeItem","clear"],Ze);const et=e=>({require:e=>new Promise((t,n)=>{try{t(require(e))}catch(e){n(e)}}),undef:e=>{delete require.cache[require.resolve(e)]}});v.define("serverModule",["require","undef"],et);const tt=e=>({require:t=>new Promise((n,r)=>{let i=t.substr(t.lastIndexOf(".")+1).toLowerCase();try{if(void 0!==e.global.require)e.global.require([t],n,r);else if(e.isWorker)try{e.global.importScripts(t),n()}catch(e){r(e)}else{let s=e.global.document.createElement("script");s.type="mjs"===i?"module":"text/javascript",s.name=t,s.src=t,s.onload=(()=>{n()}),s.onerror=(e=>{r(e)}),e.global.document.head.appendChild(s)}}catch(e){r(e)}}),undef:t=>{void 0!==e.global.requirejs&&e.global.requirejs.undef(t)}});v.define("clientModule",["require","undef"],tt);const nt=e=>e=>new Promise((t,n)=>{let r=e.substr(e.lastIndexOf(".")+1).toLowerCase();try{let i=null,s="";(i=e.startsWith("https")?require("https"):require("http")).get(e,e=>{e.on("data",e=>{s+=e}),e.on("end",()=>{let i=e.headers["content-type"];if("json"===r||/^application\/json/.test(i))try{let e=JSON.parse(s);t(e)}catch(e){n(e)}else t(s)})}).on("error",n)}catch(e){n(e)}});v.define("serverFile",null,nt);const rt=e=>e=>new Promise((t,n)=>{let r=e.substr(e.lastIndexOf(".")+1).toLowerCase();fetch(e).then(e=>{if(200!==e.status)n(e.status);else{let i=e.headers["content-type"];"json"===r||/^application\/json/.test(i)?e.json().then(t).catch(n):e.text().then(t).catch(n)}}).catch(n)});v.define("clientFile",null,rt);let it=!1;const st=[],at=function(e){if(!e||!e[a]&&-1!==c.indexOf(e[a].type))throw new g.InvalidArgument("Type");let t=null,n=null,r=null,i=null,s=null,o=null,l=null;const u=function(e){this.getType=(()=>"modifier"),this.getName=(()=>e.name),this.getArgs=(()=>e.args.slice()),this.getConstraints=(()=>e.cfg.constraints)},p=function(e){this.getType=(()=>"attribute"),this.getName=(()=>e.name),this.getArgs=(()=>e.args.slice()),this.getConstraints=(()=>e.cfg.constraints),this.isCustom=(()=>e.isCustom)},f=function(){this.getTarget=(()=>r),this.getTargetType=(()=>t.type),this.getName=(()=>t.name||""),this.getType=(()=>t.type),this.getId=(()=>t.id),this.getNamespace=(()=>t.namespace),this.getAssembly=(()=>t.assembly()),this.getContext=(()=>t.context),this.isClass=(()=>"class"===t.type),this.isEnum=(()=>"enum"===t.type),this.isStruct=(()=>"struct"===t.type),this.isMixin=(()=>"mixin"===t.type),this.isInterface=(()=>"interface"===t.type),this.isDeprecated=(()=>t.isDeprecated()),this.getModifiers=(()=>{let e=[];for(let t of o.modifiers.type)e.push(u(t));return e}),this.getAttributes=(()=>{let e=[];for(let t of o.attrs.type)e.push(p(t));return e}),this.getAttribute=(e=>{let t=k(o.attrs.type,"name",e);return t?p(t):null}),this.getModifier=(e=>{let t=k(o.modifiers.type,"name",e);return t?u(t):null})},m=function(e){e.getMixins=(()=>{let e=[];if(t.mixins)for(let n of t.mixins)e.push(at(n));return e}),e.isMixed=(e=>!!t.isMixed&&t.isMixed(e))},d=function(e){e.getInterfaces=(()=>{let e=[];if(t.interfaces)for(let n of t.interfaces)e.push(at(n));return e}),e.isImplements=(e=>!!t.isImplements&&t.isImplements(e))},h=function(e){e.getInstanceType=(()=>n.type),e.isInstanceOf=(e=>!!n.isInstanceOf&&n.isInstanceOf(e))},y=e=>{let t=n.def;for(;1&&null!==t&&!t.members[e];)t=t.previous();return t},b=()=>{let e=null,t=null;l={};for(let r in n.obj){switch((e=y(r)).members[r]){case"prop":t=new A(r,e);break;case"func":t=new x(r,e);break;case"event":t=new I(r,e);break;case"construct":t=new x(r,e);break;case"dispose":t=new x(r,e);break}l[r]=t}},w=()=>{l||b()},v=function(e,n){this.getType=(()=>"member"),this.getMemberType=(()=>n.members[e]),this.getName=(()=>e),this.getModifiers=(()=>{let t=[];for(let n of s.modifiers[e])t.push(u(n));return t}),this.getAttributes=(()=>{let t=[];for(let n of s.attrs[e])t.push(p(n));return t}),this.getAttribute=(t=>{let n=k(s.attrs[e],"name",t);return n?p(n):null}),this.getModifier=(t=>{let n=k(s.modifiers[e],"name",t);return n?u(n):null}),this.isPrivate=(()=>null!==k(s.modifiers[e],"name","private")),this.isProtected=(()=>null!==k(s.modifiers[e],"name","protected")),this.isPublic=(()=>!this.isPrivate()&&!this.isProtected()),this.isStatic=(()=>null!==k(s.modifiers[e],"name","static")),this.isSealed=(()=>null!==k(s.modifiers[e],"name","sealed")),this.isAbstract=(()=>null!==k(s.modifiers[e],"name","abstract")),this.isVirtual=(()=>null!==k(s.modifiers[e],"name","virtual")),this.isOverride=(()=>null!==k(s.modifiers[e],"name","virtual")),this.isEnumerable=(()=>Object.getOwnPropertyDescriptor(i,e).enumerable),this.isDeprecated=(()=>null!==k(s.attrs[e],"name","deprecate")),this.isConditional=(()=>null!==k(s.attrs[e],"name","conditional")),this.isMixed=(()=>null!==k(s.attrs[e],"name","mixin")),this.isInterfaced=(()=>null!==k(s.attrs[e],"name","interface")),this.getMixin=(()=>{let n=null,r=k(s.attrs[e],"name","mixin");if(r&&t.mixins)for(let e of t.mixins)if(e===r.name){n=at(e);break}return n}),this.getInterface=(()=>{let n=null,r=k(s.attrs[e],"name","interface");if(r&&t.interfaces)for(let e of t.interfaces)if(e===r.name){n=at(e);break}return n})},A=function(e,t){let n=new v(e,t);return n.isReadOnly=(()=>null!==k(s.modifiers[e],"name","readonly")),n.isSerializable=(()=>null!==k(s.attrs[e],"name","serialize")||null===k(s.attrs[e],"name","noserialize")&&null!==k(o.attrs.type,"name","serialize")),n.getValueType=(()=>{let t=k(s.attrs[e],"name","type");if(t)return t.args[0]}),n.isDisposable=(()=>null!==k(s.attrs[e],"name","dispose")),n.isInjectable=(()=>null!==k(s.attrs[e],"name","inject")),n.isResource=(()=>null!==k(s.attrs[e],"name","resource")),n.isAsset=(()=>null!==k(s.attrs[e],"name","asset")),n.isSession=(()=>null!==k(s.attrs[e],"name","session")),n.isState=(()=>null!==k(s.attrs[e],"name","state")),n},x=function(e,t){let n=new v(e,t);return n.isASync=(()=>null!==k(s.modifiers[e],"name","async")),n.isConstructor=(()=>"_construct"===e),n.isDestructor=(()=>"_dispose"===e),n.isSub=(()=>null!==k(s.attrs[e],"name","on")),n.isTimered=(()=>null!==k(s.attrs[e],"name","timer")),n.isInjectable=(()=>null!==k(s.attrs[e],"name","inject")),n.getArgs=(()=>{let t=k(s.attrs[e],"name","args");return t?t.args.slice():null}),n.getAspects=(()=>{if(s.aspects&&s.aspects[e].length>0){let t=[];for(let n of s.aspects[e])t.push(at(n));return t}return null}),n.getAspect=(t=>{if(s.aspects&&s.aspects[e].length>0){let n=k(s.aspects[e],"name",t);if(n)return at(n)}return null}),n},I=function(e,t){let n=new v(e,t);return delete n.isStatic,n.isPub=(()=>null!==k(s.attrs[e],"name","post")),n},$=function(e){e.getMembers=(e=>{(e=e||{}).types=e.types||[],e.modifiers=e.modifiers||[],e.attrs=e.attrs||[],e.aspects=e.aspects||[],e.inherited=void 0===e.inherited||e.inherited,w();let t=null,n=!0,r=[];for(let i in l)if(n=!0,l.hasOwnProperty(i)){if(t=l[i],e.types.length>0&&-1===e.types.indexOf(t.getMemberType())&&(n=!1),!n||e.inherited||s.members[i]||(n=!1),n&&e.modifiers.length>0)for(let t of e.modifiers)if(-1===O(s.modifiers[i],"name",t)){n=!1;break}if(n&&e.attrs.length>0)for(let t of e.attrs)if(-1===O(s.attrs[i],"name",t)){n=!1;break}if(n&&e.aspects.length>0&&"func"===t.getMemberType())for(let t of e.aspects)if(-1===O(s.aspects[i],"name",t)){n=!1;break}n&&r.push(l[i])}return r}),e.getMember=(e=>(w(),l[e]||null))},j=function(){let e=new f;return e.getParent=(()=>null!==t.inherits?at(t.inherits):null),e.isDerivedFrom=(e=>!!t.isDerivedFrom&&t.isDerivedFrom(e)),e.getFamily=(()=>{let e=[],n=t.inherits;for(null!==t.inherits&&e.push(at(t.inherits));1&&null!==n;)e.push(at(n)),n=n[a].inherits;return e}),e.isSealed=(()=>!!t.isSealed&&t.isSealed()),e.isAbstract=(()=>!!t.isAbstract&&t.isAbstract()),m(e),d(e),e.isSerializable=(()=>null!==k(o.attrs.type,"name","serialize")),e.isStatic=(()=>!!t.isStatic&&t.isStatic()),e.isSingleton=(()=>!!t.isSingleton&&t.isSingleton()),e.isSingleInstanceCreated=(()=>!!t.singleInstance&&null!==t.singleInstance()),h(e),$(e),e},T=function(){let e=new f;return m(e),d(e),e.isSerializable=(()=>null!==k(o.attrs.type,"name","serialize")),h(e),$(e),e},S=function(){let e=new f;return $(e),e},P=function(){let e=new f;return $(e),e},C=function(){let e=new f;return e.getNames=(()=>{let e=[];for(let t of Te.getNames(i))e.push(A(t,s));return e}),e.getName=(e=>{let t=Te.getName(i,e);return t?A(t,s):null}),e.getValues=(()=>Te.getValues(i)),e.isDefined=(e=>Te.isDefined(i,e)),e};let N=null,D=null,z=!1;switch(it=!0,e[a].type){case"class":r=e,i=new e,z=!0,N=new j;break;case"struct":r=e,i=new e,z=!0,N=new T;break;case"enum":r=e[a].Type,i=e,N=new C;break;case"mixin":D=ke("temp",[r=e],function(){}),i=new D,z=!0,N=new S;break;case"interface":r=e[a].Type,i=e,N=new P;break}return it=!1,z&&st.push(i),t=r[a],n=i[a],s=n.def,o=n.typeDef,N};return at.dispose=(()=>{if(st.length>0)for(let e of st)ue(e);st.length=0}),p("Reflector",at,()=>{at.dispose()}),r.members=Object.freeze(r.members),Object.freeze(r)}),(()=>{"use strict";const e=void 0!==!0?require("flair"):"undefined"!=typeof WorkerGlobalScope?WorkerGlobalScope.flair:(!0).flair,{Class:t,Struct:n,Enum:r,Interface:i,Mixin:s}=e,{Aspects:a}=e,{AppDomain:o}=e,l=e.AppDomain.context.current().name,{$$:c,attr:u}=e,{bring:p,Container:f,include:m}=e,{Port:d}=e,{on:h,post:y,telemetry:g}=e,{Reflector:b}=e,{Serializer:w}=e,{Tasks:v}=e,{TaskInfo:A}=e.Tasks,{as:x,is:I,isComplies:O,isDerivedFrom:k,isImplements:$,isInstanceOf:j,isMixed:T}=e,{getAssembly:S,getAttr:P,getContext:C,getResource:N,getType:D,ns:z,getTypeOf:M,typeOf:U}=e,{dispose:E,using:R}=e,{args:F,Exception:W,noop:L,nip:_,nim:q,nie:B,event:G}=e,{env:V}=e.options;e.AppDomain.context.current().currentAssemblyBeingLoaded("./flair{.min}.js"),(async()=>{c("abstract"),c("ns","(root)"),t("Aspect",function(){c("virtual"),this.before=q,c("virtual"),this.around=q,c("virtual"),this.after=q})})(),(async()=>{c("abstract"),c("ns","(root)"),t("Attribute",function(){this.construct=(e=>{this.args=e}),c("readonly"),this.args=[],this.constraints="",c("virtual"),this.decorateProperty=q,c("virtual"),this.decorateFunction=q,c("virtual"),this.decorateEvent=q})})(),(async()=>{c("ns","(root)"),i("IDisposable",function(){this.dispose=q})})(),(async()=>{c("ns","(root)"),i("IProgressReporter",function(){this.progress=B})})(),(async()=>{const{IProgressReporter:e,IDisposable:n}=z("(root)");c("ns","(root)"),t("Task",[e,n],function(){let e=!1,t=!1;this.construct=((...e)=>{this.args=e,this.context=o.contexts(l),this.domain=this.context.domain}),c("abstract"),this.dispose=q,c("protected"),this.args=[],c("protected"),this.context=null,c("protected"),this.domain=null,this.run=((...n)=>new Promise((r,i)=>{if(t)i("Already running");else{t=!0;const s=()=>{e=!0;let s=this.onRun(...n);s&&"function"==typeof s.then?s.then(r).catch(i).finally(()=>{t=!1}):(t=!1,r(s))};e?s():this.setup().then(s).catch(e=>{t=!1,i(e)})}})),this.progress=G(e=>({data:e})),c("virtual"),c("protected"),this.setup=L,c("abstract"),c("protected"),this.onRun=q})})(),(async()=>{c("ns","(root)"),t("Test",function(){c("resource","hello"),this.resProp=null,c("asset","./ab/index.html"),this.astProp=null})})(),e.AppDomain.context.current().currentAssemblyBeingLoaded("")})(),(()=>{let e=JSON.parse('{"name":"hello","encodingType":"utf8;base64;","asmFile":"./flair{.min}.js","file":"./src/flair/(root)/hello.res.json","data":"ewogICAgInRlc3QiOiAxCn0="}');flair.AppDomain.context.current().registerResource(e)})(),flair.AppDomain.registerAdo('{"name":"flair","file":"./flair{.min}.js","desc":"True Object Oriented JavaScript","version":"0.15.950","lupdate":"Sun, 10 Mar 2019 04:13:54 GMT","builder":{"name":"<<name>>","version":"<<version>>","format":"fasm","formatVersion":"1","contains":["initializer","types","enclosureVars","enclosedTypes","resources","assets","selfreg"]},"copyright":"(c) 2017-2019 Vikas Burman","license":"MIT","types":["Aspect","Attribute","IDisposable","IProgressReporter","Task","Test"],"resources":["hello"],"assets":["./flair/ab/index.html"]}');
//# sourceMappingURL=./flair.min.js.map