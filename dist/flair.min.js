/**
 * @preserve
 * Flair.js
 * True Object Oriented JavaScript
 * 
 * Assembly: flair
 *     File: ./flair.js
 *  Version: 0.8.47
 *  Tue, 21 May 2019 02:01:06 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * MIT
 */
!function(e,t){"use strict";"function"==typeof!0&&(!0).amd?(!0)(t):"object"==typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t()),module.exports=exports=t()):e.flair=t()}(this,function(){"use strict";let e=new Function("try {return this===global;}catch(e){return false;}")(),t=e?!require("worker_threads").isMainThread:void 0!==!0,r=[],n=Symbol("[meta]"),i="modules",s=[],a={},o=["class","enum","interface","mixin","struct"],l=["instance","sinstance"],c="",u={},f={},p=!1,m=async(e,t)=>(p||(p=await m.AppDomain.boot(e,t)),m.AppDomain.app());if(e){let e=process.argv;t&&(e=require("worker_threads").workerData.argv);let r=e.findIndex(e=>!!e.startsWith("--flairSymbols"));-1!==r&&(c=e[r].substr(2).split("=")[1])}else c=(!0).flairSymbols||"";c&&(r=c.split(",").map(e=>e.trim())),a.symbols=Object.freeze(r),a.env=Object.freeze({type:e?"server":"client",isTesting:-1!==r.indexOf("TEST"),isServer:e,isClient:!e,isWorker:t,isMain:!t,cores:(e?require("os").cpus().length:(!0).navigator.hardwareConcurrency)||4,isCordova:!e&&!!(!0).cordova,isNodeWebkit:e&&process.versions["node-webkit"],isProd:-1===r.indexOf("DEBUG")&&-1!==r.indexOf("PROD"),isDebug:-1!==r.indexOf("DEBUG"),isAppMode:()=>p}),m.members=[],m.options=Object.freeze(a),m.env=m.options.env;const d=(e,t,r)=>{m[e]=Object.freeze(t),m.members.push(e),"function"==typeof r&&s.push(r)},h=()=>{};d("noop",h);const y={get:()=>{throw b.NotImplemented("prop",y.get)},set:()=>{throw b.NotImplemented("prop",y.set)},ni:!0};d("nip",y);const g=()=>{throw b.NotImplemented("func",g)};g.ni=!0,d("nim",g);const b=function(e,t,r,n){let i=new Error,s=b;switch(typeof e){case"string":switch(i.name=e,typeof t){case"string":switch(i.message=t,typeof r){case"object":i.error=r,"function"==typeof n&&(s=n);break;case"function":s=r;break}break;case"object":i.message=t.message||"",i.error=t,"function"==typeof r&&(s=r);break;case"function":s=t;break}break;case"object":i.name=e.name||"Unknown",i.message=e.message||"",i.error=e,"function"==typeof t&&(s=t);break}return i.name=i.name||"Undefined",i.name.endsWith("Exception")||(i.name+="Exception"),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(i,s),i.error&&(i.message+="["+i.error+"]"),Object.freeze(i)};b.InvalidArgument=((e,t=b.InvalidArgument)=>new b("InvalidArgument",`Argument type is invalid. (${e})`,t)),b.OperationFailed=((e,t,r=b.OperationFailed)=>new b("OperationFailed",`Operation failed with error. (${e})`,t,r)),b.Duplicate=((e,t=b.Duplicate)=>new b("Duplicate",`Item already exists.(${e})`,t)),b.NotFound=((e,t=b.NotFound)=>new b("NotFound",`Item not found. (${e})`,t)),b.InvalidDefinition=((e,t=b.InvalidDefinition)=>new b("InvalidDefinition",`Item definition is invalid. (${e})`,t)),b.InvalidOperation=((e,t=b.InvalidOperation)=>new b("InvalidOperation",`Operation is invalid in current context. (${e})`,t)),b.Circular=((e,t=b.Circular)=>new b("Circular",`Circular calls found. (${e})`,t)),b.NotImplemented=((e,t=b.NotImplemented)=>new b("NotImplemented",`Member is not implemented. (${e})`,t)),b.NotDefined=((e,t=b.NotDefined)=>new b("NotFound",`Member is not defined or is not accessible. (${e})`,t)),d("Exception",b);const v=()=>"_xxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx".replace(/[xy]/g,e=>{var t=16*Math.random()|0,r;return("x"==e?t:3&t|8).toString(16)}),w=(e,t)=>{if(t){if(-1!==e.indexOf("{.min}"))return a.env.isProd?e.replace("{.min}",".min"):e.replace("{.min}","")}else if(-1!==e.indexOf("|")){let t=e.split("|"),r="";return"x"===(r=a.env.isServer?t[0].trim():t[1].trim())&&(r=""),-1!==r.indexOf("~")&&(t=r.split("~"),"x"===(r=a.env.isWorker?t[1].trim():t[0].trim())&&(r="")),r}return e},x=e=>!e.hasOwnProperty("prototype")&&"Function"===e.constructor.name,O=e=>"AsyncFunction"===e.constructor.name,I=(e,t,r)=>e.findIndex(e=>e[t]===r),A=(e,t,r)=>{let n=e.findIndex(e=>e[t]===r);return-1!==n?e[n]:null},$=(e,t)=>(t||(t=","),e.split(t).map(e=>e.trim())),k=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),j=(e,t,r)=>e.replace(new RegExp(k(t),"g"),r),T=(e,t,r,n)=>{n||(n=[]);for(let i in t)if(t.hasOwnProperty(i)&&-1===n.indexOf(i)){if(!r&&i in e)continue;e[i]=t[i]}return e},N=t=>new Promise((r,n)=>{let i=null;(i=G(e?"serverFile":"clientFile"))(t).then(r).catch(n)}),P=(r,n,i)=>new Promise((s,a)=>{e?G("serverModule").require(r).then(s).catch(a):G("clientModule").require(r).then(e=>{e||"string"!=typeof n||(t?(e=(!0)[n]||null,i&&delete WorkerGlobalScope[n]):(e=(!0)[n]||null,i&&delete window[n])),e?s(e):s()}).catch(a)}),S=(t,r,n)=>new Promise((i,s)=>{let a=null;(a=G(e?"serverFetch":"clientFetch"))(t,r,n).then(i).catch(s)}),C=(e,t,r,n)=>{let i=t?$(t):Object.keys(e);const s=t=>{let s={};if(i.length>0)for(let e of i)s[e]=t[e];else for(let t in e)e.hasOwnProperty(t)&&(s[t]=e[t]);if(n)for(let e in n)s[e]=n[e];return r&&(s=Object.freeze(s)),s};if(Array.isArray(e)){let t=[];for(let r of e)t.push(s(r));return t}return s(e)},D=e=>btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function e(t,r){return String.fromCharCode("0x"+r)})),E=e=>decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join("")),F=t=>{e?G("serverModule").undef(t):G("clientModule").undef(t)},z=(e,t)=>new Promise((r,n)=>{const i=e=>{e&&0!==e.length?Promise((r,n)=>{t(r,n,e.shift())}).then(()=>{i(e)}).catch(n):r()};i(e.slice())}),M=(e,t=!0)=>{const r=e=>e&&"object"==typeof e;return e.reduce((e,n)=>(Object.keys(n).forEach(i=>{const s=e[i],a=n[i];Array.isArray(s)&&Array.isArray(a)?e[i]=t?s.concat(...a):[].concat(...a):r(s)&&r(a)?e[i]=M([s,a],t):e[i]=a}),e),{})},R=(...r)=>{if(e||t)return"";let n="",i="",s=null;for(let e of r){for(let t of(!0).document.scripts)if(t.src.endsWith(e)){(s=(!0).document.createElement("a")).href=t.src,i=s.protocol+"//"+s.host+"/",s=null,n="./"+t.src.replace(i,"");break}if(n)break}return n},U=e=>{let t="";return void 0===e&&(t="undefined"),t||null!==e||(t="null"),t||"number"!=typeof e||!1!==isFinite(e)||(t="infinity"),!t&&Array.isArray(e)&&(t="array"),!t&&e instanceof Date&&(t="date"),!t&&e[n]&&(t=e[n].type),t||(t=typeof e),t};d("typeOf",U);const W=(e,t)=>{if(t[n]&&(t=t[n].name),"string"!==U(t))throw b.InvalidArgument("type",W);let r=!1;if(e)switch(t){case"NaN":r=isNaN(e);break;case"infinity":r="number"==typeof e&&!1===isFinite(e);break;case"array":case"Array":r=Array.isArray(e);break;case"date":case"Date":r=e instanceof Date;break;case"flairtype":r=e[n]&&-1!==o.indexOf(e[n].type);break;case"flairinstance":r=e[n]&&-1!==l.indexOf(e[n].type);break;case"flair":r=void 0!==e[n];break;case"cfunction":r="function"==typeof e&&!x(e);break;case"afunction":r="function"==typeof e&&x(e);break;default:r||(r=typeof e===t),!r&&e[n]&&(r||(r=t===e[n].type),r||-1===l.indexOf(e[n].type)||(r=we(e,t)),r||"class"!==e[n].type||(r=de(e,t)),r||-1===o.indexOf(e[n].type)||(r=e[n].name===t))}else switch(t){case"undefined":r=void 0===e;break;case"null":r=null===e;break;case"NaN":r=isNaN(e);break}return r};d("is",W);const q=(...e)=>{if(0===e.length)throw b.InvalidArgument("patterns",q);let t=(...r)=>{let n=null,i=null,s="",a="",o=-1,l=-1,c=!1,u=0,f="",p={raw:r||[],index:-1,isInvalid:!1,error:null,values:{}};if(e)for(let t of e){o++,l=-1,c=!1,u=0,n=t.split(",");for(let e of n){if(l++,2!==(i=e.split(":")).length?(s=`_${o}_${l}`,a=e.trim()||""):(s=i[0].trim()||"",a=i[1].trim()||""),l>p.raw.length){c=!1;break}if(!W(p.raw[l],a)){c=!1,f=s;break}p.values[s]=p.raw[l],c=!0,u++}if(c&&u===n.length){p.index=o;break}}return p.isInvalid=-1===p.index,p.error=p.isInvalid?b.InvalidArgument(f):null,p.throwOnError=(e=>{if(p.error)throw new b(p.error,e||t)}),Object.freeze(p)};return Object.freeze(t)};d("Args",q);const _=e=>{let t;return q("argsProcessor: undefined","argsProcessor: afunction")(e).throwOnError(_),(e=e||((...e)=>e)).event=!0,e};d("event",_);const L=_(()=>{throw b.NotImplemented("event",L)});L.ni=!0,d("nie",L);const B=function(e){let t={};e=e||"",this.add=((e,r)=>{let n;q("event: string, handler: afunction")(e,r).throwOnError(this.add),t[e]||(t[e]=[]),t[e].push(r)}),this.remove=((e,r)=>{let n;if(q("event: string, handler: afunction")(e,r).throwOnError(this.remove),t[e]){let n=t[e].indexOf(r);-1!==n&&t[e].splice(n,1)}}),this.dispatch=((r,n)=>{let i;q("event: string")(r).throwOnError(this.dispatch),t[r]&&t[r].forEach(t=>{setTimeout(()=>{t(Object.freeze({host:e,name:r,args:n||[]}))},0)})}),this.count=(e=>{let r;return q("event: string")(e).throwOnError(this.count),t[e]?t[e].length:0}),this.clear=(()=>{t={}})};let V={};const G=e=>{if("string"!=typeof e)throw b.InvalidArgument("name",G);return V[e]?V[e].handler?V[e].handler:V[e].inbuilt:null};G.define=((e,t,r)=>{let n=q("name: string, members: array, inbuilt: afunction","name: string, inbuilt: afunction","name: string, members: array","name: string")(e,t,r);if(n.throwOnError(G.define),V[e])throw b.Duplicate(e,G.define);V[e]={type:n.values.members?"object":"function",members:n.values.members||null,handler:null,inbuilt:n.values.inbuilt?n.values.inbuilt(a.env):null}}),G.connect=((e,t)=>{let r;if(q("name: string, handler: afunction")(e,t).throwOnError(G.connect),!V[e])throw b.NotFound(e,G.connect);let n=t(a.env);if(typeof n!==V[e].type)throw b.InvalidArgument("handler",G.connect);let i=V[e].members;if(i)for(let e of i)if(void 0===n[e])throw b.NotImplemented(e,G.connect);V[e].handler=n}),G.disconnect=(e=>{if("string"!=typeof e)throw b.InvalidArgument("name",G.disconnect);V[e]&&(V[e].handler=null)}),G.isDefined=(e=>{if("string"!=typeof e)throw b.InvalidArgument("name",G.isDefined);return!!V[e]}),G.isConnected=(e=>{if("string"!=typeof e)throw b.InvalidArgument("name",G.isConnected);return!V[e]||!V[e].handler}),d("Port",G,()=>{for(let e in V)V.hasOwnProperty(e)&&(V[e].handler=null);V={}});const J=function(e,t,r,i,s){let a={},l={},c={},u={},f={},p={},d={},h=!1,y="";this.name=e,this.domain=t,this.isUnloaded=(()=>h||t.isUnloaded()),this.unload=(()=>{if(!h){h=!0,delete s[e];for(let e in u)e.hasOwnProperty(e)&&Te(u[e]);a={},f={},p={},l={},c={},u={},d={}}}),this.current=(()=>{if(this.isUnloaded())throw b.InvalidOperation(`Context is already unloaded. (${this.name})`,this.current);return 0===i.length?r||this:i[i.length-1]}),this.registerType=(e=>{if(this.isUnloaded())throw b.InvalidOperation(`Context is already unloaded. (${this.name})`,this.registerType);let t="",r="",i=e[n];if(i.Type?(t=i.Type[n].name,r=i.Type[n].type):(t=i.name,r=i.type),-1===o.indexOf(r))throw b.InvalidArgument("Type",this.registerType);let s=t.substr(0,t.lastIndexOf(".")),u=t.replace(s+".","");if(a[t])throw b.Duplicate(t,this.registerType);if(l[t])throw b.Duplicate(`Already registered as Resource. (${t})`,this.registerType);if(c[t])throw b.Duplicate(`Already registered as Route. (${t})`,this.registerType);return a[t]=e,s?(d[s]||(d[s]={}),d[s][u]=e):d[u]=e,s}),this.getType=(e=>{if(this.isUnloaded())throw b.InvalidOperation(`Context is already unloaded. (${this.name})`,this.getType);if("string"!=typeof e)throw b.InvalidArgument("qualifiedName",this.getType);return a[e]||null}),this.ensureType=(e=>new Promise((r,n)=>{if(this.isUnloaded())return void n(b.InvalidOperation(`Context is already unloaded. (${this.name})`));if("string"!=typeof e)return void n(b.InvalidArgument("qualifiedName"));let i=this.getType(e);if(i)r(i);else{let s=t.resolve(e);s?this.loadAssembly(s).then(()=>{(i=this.getType(e))?r(i):n(b.OperationFailed(`Assembly could not be loaded. (${s})`))}).catch(n):n(b.NotFound(e))}})),this.allTypes=(()=>{if(this.isUnloaded())throw b.InvalidOperation(`Context is already unloaded. (${this.name})`,this.allTypes);return Object.keys(a)}),this.execute=((e,t)=>new Promise((r,n)=>{if(this.isUnloaded())return void n(b.InvalidOperation(`Context is already unloaded. (${this.name})`));e.type=e.type||"",e.typeArgs=e.typeArgs||[],e.func=e.func||"",e.args=e.args||[],e.ctx=e.ctx||{},e.keepAlive=void 0!==e.keepAlive&&e.keepAlive;const i=()=>new Promise((r,n)=>{let i=null;this.ensureType(e.type).then(s=>{try{i=new s(...e.typeArgs),"function"==typeof t&&W(i,"IProgressReporter")&&i.progress.add(t),r(i)}catch(e){n(e)}}).catch(n)}),s=t=>new Promise((r,n)=>{let i=null;(i=t[e.func](...e.args))&&"function"==typeof i.then?i.then(r).catch(n):r(i)});let a=null;e.keepAlive?u[e.type]?(a=u[e.type],s(a).then(r).catch(n)):i().then(t=>{a=t,u[e.type]=a,s(a).then(r).catch(n)}).catch(n):u[e.type]?(a=u[e.type],e.func?s(a).then(r).catch(n).finally(()=>{Te(a),delete u[e.type]}):(Te(a),delete u[e.type],r())):i().then(e=>{s(e).then(r).catch(n).finally(()=>{Te(e)})}).catch(n)})),this.namespace=(e=>{e&&"(root)"===e&&(e="");let t=null;return(t=e?d[e]||null:d)?Object.freeze(T({},t)):null}),this.currentAssemblyBeingLoaded=(e=>(void 0!==e&&(y=w(e,!0)),y));const g=(e,t,r,n)=>{"string"==typeof e&&!f[e]&&t&&r&&n&&(f[e]=Object.freeze(new H(t,r,n)),p[n.name]=f[e])};this.loadAssembly=(e=>new Promise((t,r)=>{if(this.isUnloaded())r(b.InvalidOperation(`Context is already unloaded. (${this.name})`));else if(f[e]||this.currentAssemblyBeingLoaded()===e)t();else{i.push(this);let n=this.domain.getAdo(e),s=e;s.startsWith("./")&&(s=s.substr(2)),s=n&&n.mainAssembly?this.domain.loadPathOf(n.mainAssembly)+s:this.domain.root()+s,F(s),P(s,n.name,!0).then(a=>{a(m,s).then(r=>{let s=this.current();i.pop(),g(e,n,s,r),t()}).catch(e=>{i.pop(),r(e)})}).catch(e=>{i.pop(),r(e)})}})),this.loadBundledAssembly=((e,t,r)=>{if(this.isUnloaded())throw b.InvalidOperation(`Context is already unloaded. (${this.name})`);let n={};i.push(this);let s=t;try{n=r(m,s);let t=this.current();i.pop();let a=this.domain.getAdo(e);g(e,a,t,n)}finally{i.pop()}return n}),this.getAssembly=(e=>{if(this.isUnloaded())throw b.InvalidOperation(`Context is already unloaded. (${this.name})`,this.getAssembly);if("string"!=typeof e)throw b.InvalidArgument("file",this.getAssembly);return f[e]||null}),this.getAssemblyByName=(e=>{if(this.isUnloaded())throw b.InvalidOperation(`Context is already unloaded. (${this.name})`,this.getAssemblyByName);if("string"!=typeof e)throw b.InvalidArgument("name",this.getAssemblyByName);return p[e]||null}),this.allAssemblies=(e=>{if(this.isUnloaded())throw b.InvalidOperation(`Context is already unloaded. (${this.name})`,this.allAssemblies);if(e){let e=[],t=Object.keys(f);for(let r of t)e.push(f[r]);return e}return Object.keys(f)}),this.registerResource=(e=>{if(this.isUnloaded())throw b.InvalidOperation(`Context is already unloaded. (${this.name})`,this.registerResource);if("string"!=typeof e.name||""===e.name||"string"!=typeof e.encodingType||""===e.encodingType||"string"!=typeof e.file||""===e.file||"string"!=typeof e.data||""===e.data)throw b.InvalidArgument("rdo",this.registerResource);let t=e.name.substr(0,e.name.lastIndexOf(".")),r=e.name.replace(t+".","");if(l[e.name])throw b.Duplicate(e.name,this.registerResource);if(a[e.name])throw b.Duplicate(`Already registered as Type. (${e.name})`,this.registerResource);if(c[e.name])throw b.Duplicate(`Already registered as Route. (${e.name})`,this.registerResource);return l[e.name]=Object.freeze(new X(e,t,this)),t?(d[t]||(d[t]={}),d[t][r]=l[e.name]):d[r]=l[e.name],t}),this.getResource=(e=>{if(this.isUnloaded())throw b.InvalidOperation(`Context is already unloaded. (${this.name})`,this.getResource);if("string"!=typeof e)throw b.InvalidArgument("qualifiedName",this.getResource);return l[e]||null}),this.allResources=(e=>{if(this.isUnloaded())throw b.InvalidOperation(`Context is already unloaded. (${this.name})`,this.allResources);if(e){let e=[],t=Object.keys(l);for(let r of t)e.push(l[r]);return e}return Object.keys(l)}),this.registerRoutes=((e,t)=>{if(this.isUnloaded())throw b.InvalidOperation(`Context is already unloaded. (${this.name})`,this.registerRoutes);for(let r of e){if("string"!=typeof r.name||""===r.name||"number"!=typeof r.index||"string"!=typeof r.mount||""===r.mount||"string"!=typeof r.path||""===r.path||"string"!=typeof r.handler||""===r.handler)throw b.InvalidArgument("route: "+r.name,this.registerRoutes);let e=r.name.substr(0,r.name.lastIndexOf(".")),n=r.name.replace(e+".","");if(c[r.name])throw b.Duplicate(r.name,this.registerRoutes);if(a[r.name])throw b.Duplicate(`Already registered as Type. (${r.name})`,this.registerRoutes);if(l[r.name])throw b.Duplicate(`Already registered as Resource. (${r.name})`,this.registerRoutes);c[r.name]=Object.freeze(new K(t,r,e,this)),e?(d[e]||(d[e]={}),d[e][n]=c[r.name]):d[n]=c[r.name]}}),this.getRoute=(e=>{if(this.isUnloaded())throw b.InvalidOperation(`Context is already unloaded. (${this.name})`,this.getRoute);if("string"!=typeof e)throw b.InvalidArgument("qualifiedName",this.getRoute);return c[e]||null}),this.allRoutes=(e=>{if(this.isUnloaded())throw b.InvalidOperation(`Context is already unloaded. (${this.name})`,this.allRoutes);if(e){let e=[],t=Object.keys(c);for(let r of t)e.push(c[r]);return e}return Object.keys(c)}),this.isBusy=(()=>!1),this.hasActiveInstances=(()=>Object.keys(u).length)},H=function(e,t,r){this.context=t,this.name=e.name,this.file=e.file,this.mainAssembly=e.mainAssembly,this.desc=e.desc,this.title=e.title,this.version=e.version,this.copyright=e.copyright,this.license=e.license,this.lupdate=e.lupdate,this.builder=e.builder.name,this.builderVersion=e.builder.version,this.format=Object.freeze({name:e.builder.format,version:e.builder.formatVersion,contains:e.builder.contains.slice()}),this.types=(()=>e.types.slice()),this.getType=(t=>{if("string"!=typeof t)throw b.InvalidArgument("qualifiedName",this.getType);if(-1===e.types.indexOf(t))throw b.NotFound(t,this.getType);return this.context.getType(t)}),this.getTypes=(t=>{if(["string","interface"]!==U(t))throw b.InvalidArgument("intf",this.getTypes);let r=[];for(let n of e.types)try{let e=this.context.getType(n);Ie(e,t)&&r.push(e)}catch(e){}return r}),this.resources=(()=>e.resources.slice()),this.getResource=(t=>{if("string"!=typeof t)throw b.InvalidArgument("qualifiedName",this.getResource);if(-1===e.resources.indexOf(t))throw b.NotFound(t,this.getResource);return this.context.getResource(t)}),this.routes=(()=>e.routes.slice()),this.getRoute=(t=>{if("string"!=typeof t)throw b.InvalidArgument("qualifiedName",this.getRoute);if(-1===e.routes.indexOf(t))throw b.NotFound(t,this.getRoute);return this.context.getRoute(t)}),this.assets=(()=>e.assets.slice()),this.assetsRoot=this.file.replace(".js","/"),this.getAsset=(t=>{if("string"!=typeof t)throw b.InvalidArgument("file",this.getAsset);let r=t.replace("./",this.assetsRoot);if(-1===e.assets.indexOf(t))throw b.NotFound(r,this.getAsset);return r}),this.config=(()=>r.config),this.settings=(()=>r.settings)},X=function(t,r,n){this.context=n,this.name=t.name,this.ns=r,this.assembly=(()=>n.getAssembly(w(t.asmFile,!0))||null),this.encodingType=t.encodingType,this.file=t.file,this.type=t.file.substr(t.file.lastIndexOf(".")+1).toLowerCase(),this.data=t.data;try{if(-1!==t.encodingType.indexOf("utf8;"))if(e){let e=Buffer.from(t.data,"base64");this.data=e.toString("utf8")}else this.data=E(t.data);else e&&(this.data=Buffer.from(t.data,"base64"))}catch(e){throw b.OperationFailed(`Resource data could not be decoded. (${t.name})`,X)}"json"===this.type&&(this.data=Object.freeze(JSON.parse(this.data)))},K=function(t,r,n,i){this.context=i,this.name=r.name,this.ns=n,this.assembly=(()=>i.getAssembly(t)||null),this.index=r.index,this.mount=r.mount,this.verbs=r.verbs||(e?["get"]:["view"]),this.path=r.path,this.handler=r.handler},Q=function(t,r){let n={},i=0,s=null,a=null;const o=function(){let e,t=null;const r=e=>{let r=e.data.func,n=null;const i=r=>{t.postMessage({data:{id:e.data.id,isComplete:!0,isError:!1,error:null,ctx:e.data.ctx,result:e.data.returnsAsIs?r:!!r}})},s=r=>{t.postMessage({data:{id:e.data.id,isComplete:!1,isError:!1,error:null,ctx:e.data.ctx,result:r}})},a=r=>{t.postMessage({data:{id:e.data.id,isComplete:!0,isError:!0,error:r?r.toString():"UnknownError",ctx:e.data.ctx,result:null}})},o=()=>{try{"alc"===e.data.obj&&"execute"===r&&e.data.args.push(e=>{s(e.args)});let t=n(...e.data.args);t&&"function"==typeof t.then?t.then(i).catch(a):i(t)}catch(e){a(e)}};switch(e.data.obj){case"ad":n=ee[r],o();break;case"alc":n=ee.contexts(e.data.name)[r],o();break}};if("<<{{isServer}}>>"=="true"){require("<<{{entryPoint}}>>");let e=require("worker_threads").parentPort;t=e,e.once("message",e=>{(t=e.privatePort).on("message",r)})}else importScripts("<<{{requirejs}}>>","<<{{entryPoint}}>>"),(t=this).onmessage=r};let l=o.toString().replace("<<{{entryPoint}}>>",ee.entryPoint());l=`(${l=(l=l.replace("<<{{requirejs}}>>",R("require.js","require.min.js"))).replace("<<{{isServer}}>>",e.toString())})();`;const c=(e,t,r,s,o,l,c)=>new Promise((u,f)=>{let p=v();n[p]={resolve:u,reject:f,progressListener:c},i++,a.postMessage({data:{id:p,obj:e,name:t,returnsAsIs:r,ctx:l||{},func:s,args:o&&Array.isArray(o)?o:[]}})}),u=e=>{if(n[e.data.id]){let t=n[e.data.id];e.data.isComplete?(delete n[e.data.id],i--,e.data.isError?t.reject(e.data.error):t.resolve(Object.freeze({ctx:e.data.ctx,result:e.data.result}))):"function"==typeof progressListener&&t.progressListener&&setTimeout(()=>{t.progressListener(Object.freeze({host:e.data.ctx._?e.data.ctx._.host:"",name:"progress",args:e.data.result}))},0)}else r(`Unknown operation is not supported. (${e.data.id})`)};if(e){const{Worker:e,MessageChannel:t}=require("worker_threads");a=new e(l,{eval:!0,workerData:{argv:process.argv}});const n=new t;a.postMessage({privatePort:n.port1},[n.port1]),n.port2.on("error",r),n.port2.on("message",u)}else{let e=new Blob([l]),t=(!0).URL.createObjectURL(e,{type:"application/javascript; charset=utf-8"});(a=new(!0).Worker(t)).onmessage=u,a.onerror=r}this.remoteCall=c,this.close=(()=>{e&&(s.close(),a.unref()),a.terminate()}),this.isBusy=(()=>i)},Y=function(e,t,r){let n=!1,i={},s=new Q(r,e=>{throw b.OperationFailed("Remote operation failed.",e)});this.name=e,this.isRemote=!0,this.isUnloaded=(()=>n),this.unload=(()=>{n||(n=!0,delete t[e],i={},s.remoteCall("ad","",!1,"unload").finally(()=>{s.close()}))}),this.context=Object.freeze(new Z("default",this,s)),this.contexts=(e=>i[e]||null),this.createContext=(e=>new Promise((t,r)=>{"string"!=typeof e||e&&"default"===e||i[e]?r(b.InvalidArguments("name")):s.remoteCall("ad","",!1,"createContext",[e]).then(n=>{if(n){let r=Object.freeze(new Z(e,this,s));i[e]=r,t(r)}else r(b.OperationFailed("Context could not be created."))}).catch(r)})),this.loadScripts=((...e)=>{if(this.isUnloaded())throw b.InvalidOperation(`AppDomain is already unloaded. (${this.name})`,this.loadScripts);return s.remoteCall("ad","",!1,"loadScripts",e)})},Z=function(e,t,r){let n=!1;this.name=e,this.domain=t,this.isUnloaded=(()=>n||t.isUnloaded()),this.unload=(()=>{n||(n=!0,r.remoteCall("alc",e,!1,"unload"))}),this.execute=((t,n)=>{if(this.isUnloaded())throw b.InvalidOperation(`Context is already unloaded. (${this.name})`,this.execute);let i=t.ctx||{};return i._={host:t.type},r.remoteCall("alc",e,!0,"execute",[t],i,n)}),this.loadAssembly=(t=>{if(this.isUnloaded())throw b.InvalidOperation(`Context is already unloaded. (${this.name})`,this.loadAssembly);return r.remoteCall("alc",e,!1,"loadAssembly",[t])}),this.isBusy=(()=>{if(this.isUnloaded())throw b.InvalidOperation(`Context is already unloaded. (${this.name})`,this.isBusy);return r.isBusy()}),this.hasActiveInstances=(()=>{r.remoteCall("alc",e,!1,"hasActiveInstances")})},ee=function(t){let r={},n={},i={},s={},a=[],o=[],l={},c="",f="",p=null,d=null,h=null,y=null,g=null,v=!1,x=!1;i[t]=this,this.name=t,this.isRemote=!1,this.isUnloaded=(()=>v),this.unload=(async()=>{if(!v){v=!0,d&&"function"==typeof d.stop&&(await d.stop(),Te(d)),h&&"function"==typeof h.stop&&(await h.stop(),Te(h));for(let e in s)s.hasOwnProperty(e)&&"function"==typeof s[e].unload&&s[e].unload();g();for(let e in i)i.hasOwnProperty(e)&&i[e]!==this&&i[e].unload();r={},n={},s={},i={},a=[],o=[],l={},c="",f="",p=null,d=null,h=null,y=null,g=null}}),this.createDomain=(e=>new Promise((t,r)=>{if("string"!=typeof e||e&&"default"===e||i[e])return void r(b.InvalidArguments("name"));let n=Object.freeze(new Y(e,i,o));i[e]=n,t(n)})),this.domains=(e=>i[e]||null);const O=()=>(y=new J("default",this,null,a,s),g=y.unload,delete y.unload,y=Object.freeze(y),s[y.name]=y,y);this.context=O(),this.contexts=(e=>s[e]||null),this.createContext=(e=>new Promise((t,r)=>{if("string"!=typeof e||e&&"default"===e||s[e])return void r(b.InvalidArguments("name"));let n=Object.freeze(new J(e,this,y,a,s));s[e]=n,t(n)})),this.registerAdo=(e=>{if("string"==typeof e&&(e=JSON.parse(e)),"array"!==U(e.types)||"array"!==U(e.resources)||"array"!==U(e.routes)||"array"!==U(e.assets)||"string"!=typeof e.name||"string"!=typeof e.file||""===e.file)throw b.InvalidArgument("ado",this.registerAdo);e.file=w(e.file,!0),r[e.file]||(r[e.file]=Object.freeze(e),e.types.forEach(t=>{if(n[t])throw b.Duplicate(t,this.registerAdo);n[t]=e.file}),e.resources.forEach(t=>{if(n[t])throw b.Duplicate(t,this.registerAdo);n[t]=e.file}),this.context.registerRoutes(e.routes,e.file),o.push(e))}),this.getAdo=(e=>{if("string"!=typeof e)throw b.InvalidArgument("file",this.getAdo);return r[e]||null}),this.allAdos=(()=>Object.keys(r)),this.resolve=(e=>{if("string"!=typeof e)throw b.InvalidArgument("qualifiedName",this.resolve);return n[e]||null}),this.allTypes=(()=>Object.keys(n)),this.boot=(async(t,r)=>{if(r=r||this.config(),!(t=t||this.entryPoint()))return console.log("No entry point defined, boot aborted."),!1;x&&(await this.unload(),v=!1,O()),this.root(e?process.cwd():"./"),t&&this.entryPoint(t),r&&await this.config(r);let n="";if(-1!==m.info.file.indexOf("flair.js")?n=m.info.file.replace("flair.js","preamble.js"):-1!==m.info.file.indexOf("flair.min.js")&&(n=m.info.file.replace("flair.min.js","preamble.js")),n){let e=await je(n);await e(m)}let i=await je(u.bootEngine);return await i.start(),x=!0,!0}),this.config=(e=>!p&&e?new Promise((t,r)=>{je(e).then(e=>{p=e,t(Object.assign({},p))}).catch(r)}):p?Object.assign({},p):null),this.entryPoint=(e=>("string"!=typeof e||c||(c=e),c)),this.app=(e=>(e&&!d&&(d=e),d)),this.host=(e=>(e&&(h=e),h)),this.loadPathOf=((e,t)=>{if("string"!=typeof e)throw b.InvalidArgument("file",this.loadPath);return t&&(l[e]||(l[e]=t)),l[e]||""}),this.root=(e=>("string"!=typeof e||f||(f=e).endsWith("/")||(f+="/"),f)),this.resolvePath=(e=>{if("string"!=typeof e)throw b.InvalidArgument("path",this.resolvePath);return e.replace("./",this.root())}),this.loadScripts=((...e)=>new Promise((t,r)=>{try{ke(e,()=>{t()})}catch(e){r(e)}})),this.onError=(e=>{if(!h)throw e;h.raiseError(e)})};let te=new ee("default"),re=te.unload;delete te.unload;const ne=te;d("AppDomain",ne,()=>{re()});const ie=(e,t,r)=>{let i=q("obj: flairinstance, memberName: string","obj: flairinstance, memberName: string, attrName: string","obj: flairtype","obj: flairtype, attrName: string")(e,t,r);i.throwOnError(ie);let s=[],a=e[n],o=null,l=null;return i.values.attrName?(l=i.index>1?a.attrs.type.probe(i.values.attrName).current():a.attrs.members.probe(i.values.attrName,i.values.memberName).current())&&s.push(C(l,"name, isCustom, args, type",!0)):(o=i.index>1?a.attrs.type.all().current():a.attrs.members.all(i.values.memberName).current())&&s.push(...C(o,"name, isCustom, args, type",!0)),s};d("getAttr",ie);const se=e=>{let t=q("Type: flairtype","Type: flairinstance","Type: string")(e);t.throwOnError(se);let r=null,i="",s="";switch(t.index){case 0:r=e[n].assembly();break;case 1:r=e[n].Type[n].assembly();break;case 2:e.startsWith("[")&&e.endsWith("]")?(s=e.substr(1,e.length-2),r=ne.context.getAssemblyByName(s)):(i=ne.resolve(e))&&(r=ne.context.getAssembly(i));break}return r};d("getAssembly",se);const ae=e=>{let t;return q("Type: string")(e).throwOnError(ae),ne.resolve(e)};d("getAssemblyOf",ae);const oe=e=>{let t;return q("Type: flairtype")(e).throwOnError(oe),e[n].context};d("getContext",oe);const le=e=>{let t;q("qualifiedName: string")(e).throwOnError(le);let r=ne.context.getResource(e)||null;return r?r.data:null};d("getResource",le);const ce=e=>{let t;q("qualifiedName: string")(e).throwOnError(ce),ne.context.getRoute(e)};d("getRoute",ce);const ue=e=>{let t;return q("qualifiedName: string")(e).throwOnError(ue),ne.context.getType(e)};d("getType",ue);const fe=e=>{let t;q("obj: flair")(e).throwOnError(fe);let r=e[n];return r&&r.Type||null};d("getTypeOf",fe);const pe=e=>{let t;q("obj: flair")(e).throwOnError(pe);let r=e[n].Type?e[n].Type[n]:e[n];return r&&r.name||""};d("getTypeName",pe);const me=(e,t)=>{let r;return q("name: undefined","name: string","name: string, asInType: string")(e,t).throwOnError(me),"string"==typeof t?new Promise((r,n)=>{je(t).then(()=>{r(ne.context.namespace(e))}).catch(n)}):ne.context.namespace(e)};d("ns",me);const de=(e,t)=>{if("class"!==U(e))throw b.InvalidArgument("Type",de);if(-1===["string","class"].indexOf(U(t)))throw b.InvalidArgument("Parent",de);return e[n].isDerivedFrom(t)};d("isDerivedFrom",de);const he=e=>{if("class"!==U(e))throw b.InvalidArgument("Type",he);return e[n].isAbstract()};d("isAbstract",he);const ye=e=>{if("class"!==U(e))throw b.InvalidArgument("Type",ye);return e[n].isSealed()};d("isSealed",ye);const ge=e=>{if("class"!==U(e))throw b.InvalidArgument("Type",ge);return e[n].isStatic()};d("isStatic",ge);const be=e=>{if("class"!==U(e))throw b.InvalidArgument("Type",be);return e[n].isSingleton()};d("isSingleton",be);const ve=e=>{if("class"!==U(e))throw b.InvalidArgument("Type",ve);return e[n].isDeprecated()};d("isDeprecated",ve);const we=(e,t)=>{let r=U(e),i=U(t),s=!1;if(-1===l.indexOf(r))throw b.InvalidArgument("obj",we);if(-1===o.indexOf(i)&&"string"!==i)throw b.InvalidArgument("Type",we);let a=e[n];switch(i){case"class":(s=a.isInstanceOf(t))||(s=a.Type[n].isDerivedFrom(t));break;case"struct":s=a.isInstanceOf(t);break;case"interface":s=a.isImplements(t);break;case"mixin":s=a.isMixed(t);break;case"string":(s=a.isInstanceOf(t))||"function"!=typeof a.isImplements||(s=a.isImplements(t)),s||"function"!=typeof a.isMixed||(s=a.isMixed(t));break}return s};d("isInstanceOf",we);const xe=(e,t)=>{if(t[n]&&(t=t[n].name),"string"!==U(t))throw b.InvalidArgument("type",xe);return W(e,t)?e:null};d("as",xe);const Oe=(e,t)=>{if(!e)throw b.InvalidArgument("obj",Oe);if("interface"!==U(t))throw b.InvalidArgument("intf",Oe);let r=!0;for(let i in t)if(t.hasOwnProperty(i)&&i!==n){if(!e[i]){r=!1;break}if("function"==typeof t[i]&&"function"!=typeof e[i]){r=!1;break}}return r};d("isComplies",Oe);const Ie=(e,t)=>{if(-1===["class","instance"].indexOf(U(e)))throw b.InvalidArgument("obj",Ie);if(-1===["string","interface"].indexOf(U(t)))throw b.InvalidArgument("intf",Ie);return e[n].isImplements(t)};d("isImplements",Ie);const Ae=(e,t)=>{if(-1===["class","instance"].indexOf(U(e)))throw b.InvalidArgument("obj",Ae);if(-1===["string","mixin"].indexOf(U(t)))throw b.InvalidArgument("mixin",Ae);return e[n].isMixed(t)};d("isMixed",Ae);const $e=[],ke=(t,r)=>{let n=q("deps: string, fn: afunction","deps: array, fn: afunction")(t,r);n.throwOnError(ke),0===n.index&&(t=[t]);let s=[],a=t.slice(),o=()=>{r(...s)},l=()=>{if(0!==a.length){let t=a.shift().trim(),r=null,n=e=>{if(t.startsWith("[")&&t.endsWith("]")&&-1===t.indexOf(".")){let e=t.substr(1,t.length-2).trim();"string"==typeof(r=Ye.resolve(e,!1))&&(t=r,r=null)}e()},o=e=>{-1===t.indexOf("/")&&((r=ue(t))||(r=le(t))),e()},c=e=>{if(-1===t.indexOf("/")){let n=ae(t);n?ne.context.loadAssembly(n).then(()=>{(r=ue(t))||(r=le(t)),e()}).catch(e=>{throw b.OperationFailed(`Assembly could not be loaded. (${n})`,e,ke)}):e()}else e()},u=n=>{if(t.startsWith("./")){let i=t.substr(t.lastIndexOf(".")+1).toLowerCase();if(t=ne.resolvePath(t),i)if("js"===i||"mjs"===i)t=w(t,!0),P(t).then(e=>{r=e||!0,n()}).catch(e=>{throw b.OperationFailed(`Module/File could not be loaded. (${t})`,e,ke)});else if(e)if("json"===i)P(t).then(e=>{r=e||!0,n()}).catch(e=>{throw b.OperationFailed(`Local Module/File could not be loaded. (${t})`,e,ke)});else{let e=require("fs");try{r=e.readFileSync(t),n()}catch(e){throw b.OperationFailed(`Local File could not be read. (${t})`,e,ke)}}else N(t).then(e=>{r=e,n()}).catch(e=>{throw b.OperationFailed(`File could not be loaded. (${t})`,e,ke)});else n()}else n()},f=n=>{t.startsWith("./")?n():(e||(t=`./${i}/${t}`),t=w(t,!0),P(t).then(e=>{r=e||!0,n()}).catch(e=>{throw b.OperationFailed(`Module could not be loaded. (${t})`,e,ke)}))},p=e=>{s.push(r),e||$e.pop(),l()};if(""===(t=w(t)))return r=!0,void p(!0);if(-1!==$e.indexOf(t))throw b.Circular(t,ke);$e.push(t),n(()=>{r?p():o(()=>{r?p():c(()=>{r?p():u(()=>{r?p():f(()=>{if(!r)throw b.OperationFailed(`Dependency could not be resolved. (${t})`,ke);p()})})})})})}else o()};l()};d("bring",ke,()=>{$e.length=0});const je=(e,t)=>new Promise((r,n)=>{if("string"==typeof e)try{ke([e],i=>{i?"boolean"!=typeof i||"string"!=typeof t||(i=(!0)[t])?r(i):n(b.OperationFailed(`Dependency object could not be located. (${e})`)):n(b.OperationFailed(`Dependency could not be resolved. (${e})`))})}catch(e){n(e)}else n(b.InvalidArgument("dep"))});d("include",je);const Te=e=>{let t=q("obj: instance","obj: boolean")(e);t.throwOnError(Te),1===t.index&&!0===e?(We(),s.forEach(e=>{e()}),s.length=0):"function"==typeof e[n].dispose&&e[n].dispose()};d("dispose",Te);const Ne=(e,t)=>{let r=q("obj: instance, fn: afunction","obj: string, fn: afunction")(e,t);if(r.throwOnError(Ne),1===r.index){let t=ue(e);if(!t)throw b.NotFound(e,Ne);e=new t}let i=null,s=!1,a=!1,o=()=>{s||"function"!=typeof e[n].dispose||(s=!0,e[n].dispose())};try{(i=t(e))&&"function"==typeof i.finally&&(a=!0,i=i.finally(()=>{o()}))}finally{a||o()}return i};d("using",Ne);const Pe=(e,...t)=>{let r=q("name: string","name: Attribute")(e);r.throwOnError(Pe);let i=null,s=null,a=null;if(0===r.index){if(!(a=De.inbuilt[e]||null)){if(!(i=ue(e)))throw b.NotFound(e,Pe);e=i[n].name}}else e=(i=e)[n].name;if(-1!==I(De.bucket,"name",e))throw b.Duplicate(e,Pe);if(i){try{s=new i(...t)}catch(e){throw new b(e,Pe)}a=new Se(s.constraints)}De.bucket.push({name:e,cfg:a,isCustom:null!==s,attr:s,args:t})},Se=function(e,t){let r=q("isModifier: boolean, constraints: string","constraints: string","isModifier: boolean,")(e,t),n;return r.throwOnError(Se),{isModifier:r.values.isModifier||!1,constraints:r.values.constraints}},Ce=(e,...t)=>Pe(e,...t),De=Ce[n]=Object.freeze({bucket:[],inbuilt:Object.freeze({static:new Se(!0,"(class && !$abstract) || ((class && (prop || func)) && !($abstract || $virtual || $override))"),abstract:new Se(!0,"(class && !$sealed && !$static) || ((class && (prop || func || event)) && !($override || $sealed || $static))"),virtual:new Se(!0,"class && (prop || func || construct || dispose || event) && !($abstract || $override || $sealed || $static)"),override:new Se(!0,"(class && (prop || func || construct || dispose || event) && ((@virtual || @abstract || @override) && !(virtual || abstract)) && !(@sealed || $static))"),sealed:new Se(!0,"(class || ((class && (prop || func || event)) && override))"),private:new Se(!0,"(class || struct) && (prop || func || event) && !($protected || @private || $static)"),protected:new Se(!0,"(class) && (prop || func || event) && !($private || $static)"),readonly:new Se(!0,"(class || struct) && prop && !abstract"),async:new Se(!0,"(class || struct) && func"),privateSet:new Se(!0,"(class || struct) && prop && !($private || $static)"),protectedSet:new Se(!0,"(class) && prop && !($protected || $private || $static)"),overload:new Se("((class || struct) && (func || construct) && !($virtual || $abstract || $override || $args))"),enumerate:new Se("(class || struct) && prop || func || event"),dispose:new Se("class && prop"),post:new Se("(class || struct) && event"),fetch:new Se("(class || struct) && (func && async) && !(timer || on || @fetch)"),on:new Se("class && func && !(event || $async || $args || $overload || $inject || $static)"),timer:new Se("class && func && !(event || $async || $args || $inject || @timer || $static)"),type:new Se("(class || struct) && prop"),args:new Se("(class || struct) && (func || construct) && !$on && !$overload"),inject:new Se("class && (prop || func || construct) && !(static || session || state)"),resource:new Se("class && prop && !(session || state || inject || asset)"),asset:new Se("class && prop && !(session || state || inject || resource)"),singleton:new Se("(class && !(prop || func || event) && !($abstract || $static))"),serialize:new Se("((class || struct) || ((class || struct) && prop)) && !($abstract || $static || noserialize)"),deprecate:new Se("!construct && !dispose"),session:new Se("(class && prop) && !($static || $state || $readonly || $abstract || $virtual)"),state:new Se("(class && prop) && !($static || $session || $readonly || $abstract || $virtual)"),conditional:new Se("(class || struct) && (prop || func || event)"),noserialize:new Se("(class || struct) && prop"),aspects:new Se("(class && func)"),ns:new Se("(class || struct || mixin || interface || enum) && !(prop || func || event || construct || dispose)"),mixin:new Se("class && (prop || func || event)"),interface:new Se("class && (prop || func || event)")})});for(let e in De.inbuilt)De.inbuilt.hasOwnProperty(e)&&(Pe[`$$${e}`]=((...t)=>{Pe(e,...t)}));Ce.collect=(()=>{let e=De.bucket.slice();return Ce.clear(),e}),Ce.has=(e=>{if("string"!=typeof e)throw b.InvalidArgument("name");return-1!==De.bucket.findIndex(t=>t.name===e)}),Ce.get=(e=>{if("string"!=typeof e)throw b.InvalidArgument("name");let t=De.bucket.findIndex(t=>t.name===e);return-1!==t?De.bucket[t]:null}),Ce.count=(()=>De.bucket.length),Ce.clear=(()=>{De.bucket.length=0}),d("$$",Pe);const Ee=(e,t,r,i,s)=>{let a=Ce.collect(),l=null,c=null,u=Fe(!0,e,t),f=Fe(!1,e,t),p="";if(i?(l=t.attrs.type,c=t.modifiers.type,p=`${t.name}`):(l=e.attrs.members[r],c=e.modifiers.members[r],p=`${e.name}::${r}`),!s)for(let e of a)if(e.isCustom)throw b.InvalidOperation(`Custom attribute cannot be applied. (${e.name})`,qe);const m=s=>{let a=!1,l=o,c=["prop","func","construct","dispose","event"],m=["static","abstract","sealed","virtual","override","private","privateSet","protected","protectedSet","readonly","async"],d=[],h=[],y=s.cfg.constraints;const g=e=>{let t={withWhat:"",matchType:"",original:e,name:"",value:!1};switch(e.substr(0,1)){case"$":t.matchType="anywhere",t.name=e.substr(1);break;case"@":t.matchType="inherited",t.name=e.substr(1);break;default:t.matchType="current",t.name=e;break}e.endsWith("^")?(t.withWhat="typeName",t.name=t.name.replace("^","")):-1!==l.indexOf(t.name)?(t.withWhat="typeType",t.matchType="current"):-1!==c.indexOf(t.name)?(t.withWhat="memberType",t.matchType="current"):m.indexOf(t.name)!==0-1?t.withWhat="modifier":t.withWhat="attribute","struct"===t.name?h.push(t):d.push(t)},v=()=>{let e=new RegExp("[^!&!|()]","g"),t="",r=[],n=0;for(;1&&null!==(t=e.exec(y));)r.push(t);t="",n=0;for(let e of r)n++," "!==e[0]?(t+=e[0],n===r.length&&(""!==t&&g(t),t="")):(""!==t&&g(t),t="");d=d.concat(h)};v();for(let s of d){switch(s.withWhat){case"typeName":switch(s.matchType){case"anywhere":s.value=s.name===t.name||t.Type[n].isDerivedFrom(s.name);break;case"inherited":s.value=t.Type[n].isDerivedFrom(s.name);break;case"current":s.value=s.name===t.name;break}break;case"typeType":s.value=t.type===s.name;break;case"memberType":s.value=!i&&e.members[r]===s.name;break;case"modifier":s.value=i?!!u.type.probe(s.name)[s.matchType]():!!u.members.probe(s.name,r)[s.matchType]();break;case"attribute":s.value=i?!!f.type.probe(s.name)[s.matchType]():!!f.members.probe(s.name,r)[s.matchType]();break}y=j(y,s.original,s.value.toString())}try{if(!(a=new Function("try {return ("+y+");}catch(e){return false;}")()))throw b.InvalidOperation(`${s.cfg.isModifier?"Modifier":"Attribute"} ${s.name} could not be applied. (${p} --\x3e [${y}])`,qe)}catch(e){throw b.OperationFailed(`${s.cfg.isModifier?"Modifier":"Attribute"} ${s.name} could not be applied. (${p} --\x3e [${y}])`,e,qe)}return a};for(let r of a)m(r)&&((r=C(r,null,!1,{type:i?t.name:e.name})).isCustom?l.push(r):r.cfg.isModifier?c.push(r):l.push(r))},Fe=(e,t,r)=>{let n=e?"modifiers":"attrs",i=(e,i,s,a)=>{let o=null;if(i&&"construct"===i&&(i="_construct"),i&&"dispose"===i&&(i="_dispose"),a)if(s){let t=r.previous();for(;1&&null!==t&&(t[n]&&t[n].type&&(o=A(t[n].type,"name",e)),!o);)t=t.previous()}else r[n]&&r[n].type&&(o=A(r[n].type,"name",e));else if(s){let r=t.previous();for(;1&&null!==r&&(r[n]&&r[n].members[i]&&(o=A(r[n].members[i],"name",e)),!o);)r=r.previous()}else t[n]&&t[n].members[i]&&(o=A(t[n].members[i],"name",e));return o},s=(e,t,r,n)=>null!==i(e,t,r,n);const a=(e,t)=>{let r;return Object.freeze({anywhere:()=>i(e,t,!1,!1)||i(e,t,!0,!1),current:()=>i(e,t,!1,!1),inherited:()=>i(e,t,!0,!1),only:Object.freeze({current:()=>i(e,t,!1,!1)&&!i(e,t,!0,!1),inherited:()=>!i(e,t,!1,!1)&&i(e,t,!0,!1)})})},o=e=>{let t;return Object.freeze({anywhere:()=>i(e,null,!1,!0)||i(e,null,!0,!0),current:()=>i(e,null,!1,!0),inherited:()=>i(e,null,!0,!0),only:Object.freeze({current:()=>i(e,null,!1,!0)&&!i(e,null,!0,!0),inherited:()=>!i(e,null,!1,!0)&&i(e,null,!0,!0)})})},l=e=>{let r=Object.freeze({current:()=>t[n].members[e].slice(),inherited:()=>{let r=[],i=null,s=t.previous();for(;1&&null!==s;)s[n]&&s[n].members&&(i=A(s[n].members,"name",e)),i&&r.push(...i),s=s.previous();return r},anywhere:()=>[...r.current(),...r.inherited()]});return r},c=()=>{let e=Object.freeze({current:()=>r[n].type.slice(),inherited:()=>{let e=[],t=null,i=r.previous();for(;1&&null!==i;)i[n]&&i[n].type&&(t=i[n].type.slice()),t&&e.push(...t),i=i.previous();return e},anywhere:()=>[...e.current(),...e.inherited()]});return e},u={type:Object.freeze({get:(e,t)=>i(e,null,t,!0),has:(e,t)=>s(e,null,t,!0),all:c,probe:o}),members:{get:(e,t,r)=>i(e,t,r,!1),has:(e,t,r)=>s(e,t,r,!1),all:l,probe:a}};return e&&(u.members.is=((e,t)=>{let r=a(e,t);switch(e){case"static":return r.anywhere();case"abstract":return r.anywhere()&&!(a("virtual",t).anywhere()||a("override",t).anywhere());case"virtual":return r.anywhere()&&!a("override",t).anywhere();case"override":return r.anywhere()&&!a("sealed",t).anywhere();case"sealed":return r.anywhere();case"private":return r.anywhere();case"protected":return r.anywhere();case"readonly":return r.anywhere();case"async":return r.anywhere()}}),u.members.type=(e=>{let r,n="";if(!("type"===t.level)){let r=t;for(;1&&null!==r&&(r.members[e]&&(n=r.members[e]),!n);)r=r.previous()}return n}),u.members.isProperty=(e=>"prop"===u.members.type(e)),u.members.isFunction=(e=>"func"===u.members.type(e)),u.members.isEvent=(e=>"event"===u.members.type(e))),u.members=Object.freeze(u.members),Object.freeze(u)},ze=e=>{let t={getType:function(){let e;return this.instance.def.Type}},r={id:v()};e.ex.instance=T(e.ex.instance,t,!1),e.mex.instance=T(e.mex.instance,r,!1);let n={getName:function(){let e;return this.type.def.name}},i={id:v()};e.ex.type=T(e.ex.type,n,!1),e.mex.type=T(e.mex.type,i,!1)},Me=(e,t,r,n,i,s)=>{let a={type:{Type:t,def:n,attrs:i,modifiers:s}};for(let t in e)e.hasOwnProperty(t)&&("function"==typeof e[t]?Object.defineProperty(r,t,{configurable:!0,enumerable:!1,value:e[t].bind(a)}):Object.defineProperty(r,t,{configurable:!0,enumerable:!1,value:e[t]}))},Re=(e,t,r,n,i,s,a,o,l,c)=>{let u={instance:{obj:t,def:i,attrs:a,modifiers:o},type:{Type:n,typeDef:s,attrs:l,modifiers:c}};for(let t in e)"function"==typeof e[t]?Object.defineProperty(r,t,{configurable:!0,enumerable:!1,value:e[t].bind(u)}):Object.defineProperty(r,t,{configurable:!0,enumerable:!1,value:e[t]})},Ue=(e,t,r,i,s,...o)=>{let l=t[n],c=l.def(),u="___flag___",f={_flagName:u};if(void 0!==i&&i===u?(f.isNeedProtected=!0,f.isTopLevelInstance=!1,f.staticInterface=e.static?s:null,f.args=o):(f.isNeedProtected=!1,f.isTopLevelInstance=!0,f.staticInterface=e.static?t:null,f.args=void 0!==i?void 0!==s?[i,s].concat(o):[i]:[]),e.singleton&&!c.staticConstructionCycle&&!$t&&f.isTopLevelInstance&&l.singleInstance.value)return l.singleInstance.value;let p={},m=null,d=null,y=null,g="_construct",v="_dispose",w={},I={},A=null,k={name:e.params.typeName,type:e.types.type,Type:t,level:"object",members:{},scope:{},attrs:{members:{}},modifiers:{members:{}},previous:()=>A},N=null,P=!1,C=null,D=e.storage?G("sessionStorage"):null,E=e.storage?G("localStorage"):null;const F=Object.freeze({id:j(k.name,".","_"),name:k.name,assemblyName:ae(k.name),Type:k.Type,obj:()=>{let e=r[n].Type[n].def();return Object.freeze({id:j(e.name,".","_"),name:e.name,assemblyName:ae(e.name),Type:e.Type})},static:k.Type,members:()=>{let e={};for(let t in k.members){e[t]={name:t,type:k.members[t],modifiers:[],attrs:[]};for(let r of k.modifiers.members[t])e[t].modifiers.push(r.name);for(let r of k.attrs.members[t])e[t].attrs.push(r.name);e[t].modifiers=Object.freeze(e[t].modifiers),e[t].attrs=Object.freeze(e[t].attrs),e[t]=Object.freeze(e[t])}return Object.freeze(e)}}),z=(e,t,r,n)=>{for(let i of ie.members.all(t).current())if(i.isCustom){if("prop"===r){let r=i.attr.decorateProperty(k.name,t,n);if(!r.get||!r.set)throw b.OperationFailed(`${i.name} decoration result is unexpected. (${k.name}::${t})`,qe);r.get=r.get.bind(e),r.set=r.set.bind(e),n=r}else{let s=null;if("func"===r){if(s=i.attr.decorateFunction(k.name,t,n),O(n)!==O(s))throw b.OperationFailed(`${i.name} decoration result is unexpected. (${k.name}::${t})`,qe)}else s=i.attr.decorateEvent(k.name,t,n);if(!s)throw b.OperationFailed(`${i.name} decoration result is unexpected. (${k.name}::${t})`,qe);n=s.bind(e)}i.attr=null}return n},M=(e,t,r)=>{let n=null,i=[];return i=st(k.name,e,r),k.aspects.members[e]=i,i.length>0&&(n=at(t,k.name,e,i))&&(t=n),t},R=()=>{let i=!1,s=e=>{Object.defineProperty(p,e,Object.getOwnPropertyDescriptor(r,e))},a=Object.getOwnPropertyDescriptor(r,n);a.enumerable=!1,Object.defineProperty(p,n,a),d=p[n];for(let e in r)if(i=!1,r.hasOwnProperty(e)&&e!==n){if(i=!0,k.members[e]?(ne.members.probe("private",e).current()&&(i=!1),i&&ne.members.probe("protected",e).current()&&!f.isNeedProtected&&(i=!1)):ne.members.probe("protected",e).anywhere()&&!f.isNeedProtected&&(i=!1),i&&s(e),i&&ne.members.isProperty(e))if(ne.members.probe("privateSet",e).current()){let t=Object.getOwnPropertyDescriptor(p,e);t.set=h,Object.defineProperty(p,e,t)}else if(ne.members.probe("protectedSet",e).current()&&!f.isNeedProtected){let t=Object.getOwnPropertyDescriptor(p,e);t.set=h,Object.defineProperty(p,e,t)}if(i&&ne.members.is("abstract",e)){if(!f.isNeedProtected)throw b.NotImplemented(`Abstract member is not implemented. (${k.name}::${e})`,qe);if(!ne.type.probe("abstract").current())throw b.InvalidDefinition(`Abstract member can exists only in abstract type. (${k.name}::${e})`,qe)}if(i){let t=ie.members.probe("enumerate",e).current();if(t&&!1===t.args[0]){let t=Object.getOwnPropertyDescriptor(p,e);t.enumerable=!1,Object.defineProperty(p,e,t)}}if(i&&!f.isNeedProtected&&ne.members.isEvent(e)){let t=Object.getOwnPropertyDescriptor(p,e);t.enumerable=!1,t.value=p[e].strip(),Object.defineProperty(p,e,t)}}f.isTopLevelInstance&&(Re(e.ex.instance,p,p,t,k,c,ie,ne,l.attrs,l.modifiers),Re(e.mex.instance,p,d,t,k,c,ie,ne,l.attrs,l.modifiers)),f.isTopLevelInstance||(d.def=k)},_=(t,r)=>{if((-1===Object.keys(p).indexOf(t)||ne.members.type(t)!==r[n].modifiers.members.type(t))&&("dispose"!==t||"function"!=typeof p[v]&&"function"!=typeof d.dispose))throw b.NotImplemented(`Interface member is not implemented. (${r[n].name+":"+t})`,qe);Ce("interface",r[n].name),Ee(k,c,t,!1,e.customAttrs)},V=()=>{if(k.interfaces){for(let e of k.interfaces)for(let t in e)e.hasOwnProperty(t)&&_(t,e);delete k.interfaces}},J=(t,r,n)=>{switch(-1!==["func","prop","event"].indexOf(r)&&t.startsWith("_")&&new b("InvalidName",`Name is not valid. (${k.name}::${t})`),r){case"func":if(!e.func)throw b.InvalidOperation(`Function cannot be defined on this type. (${k.name})`,qe);break;case"prop":if(!e.prop)throw b.InvalidOperation(`Property cannot be defined on this type. (${k.name})`,qe);break;case"event":if(!e.event)throw b.InvalidOperation(`Event cannot be defined on this type. (${k.name})`,qe);break;case"construct":if(!e.construct)throw b.InvalidOperation(`Constructor cannot be defined on this type. (${k.name})`,qe);r="func";break;case"dispose":if(!e.dispose)throw b.InvalidOperation(`Dispose cannot be defined on this type. (${k.name})`,qe);r="func";break}return r},H=(t,n,i,s)=>{let o=!0,c=ie.members.probe("conditional",n).current();if(c){let e=$(c.args[0]||[]);for(let t of e){if("test"!==(t=t.toLowerCase())||!a.env.isTesting){o=!1;break}if("server"!==t||!a.env.isServer){o=!1;break}if("client"!==t||!a.env.isClient){o=!1;break}if("worker"!==t||!a.env.isWorker){o=!1;break}if("main"!==t||!a.env.isMain){o=!1;break}if("debug"!==t||!a.env.isDebug){o=!1;break}if("prod"!==t||!a.env.isProd){o=!1;break}if("cordova"!==t||!a.env.isCordova){o=!1;break}if("nodewebkit"!==t||!a.env.isNodeWebkit){o=!1;break}if(-1===a.symbols.indexOf(t)){o=!1;break}}if(!o)return o}if(e.inheritance&&ne.members.probe("abstract",n).current()&&!0!==s.ni)throw b.InvalidDefinition(`Abstract member must not be implemented. (${k.name}::${n})`,qe);if((c=ne.type.probe("static").current())&&e.static)if(l.isStatic()){if(e.construct&&n===g&&0!==s.length)throw b.InvalidDefinition(`Static constructors cannot have arguments. (${k.name}::construct)`,qe);if(e.dispose&&n===v)throw b.InvalidDefinition(`Static types cannot have destructors. (${k.name}::dispose)`,qe)}else{if(e.construct&&n===g)throw b.InvalidDefinition(`Non-static types cannot have static constructors. (${k.name}::construct)`,qe);if(e.dispose&&n===v)throw b.InvalidDefinition(`Static destructors cannot be defined. (${k.name}::dispose)`,qe)}if(e.dispose&&n===v&&0!==s.length&&(s.length>1||1===s.length&&!ne.members.probe("override",n).current()))throw b.InvalidDefinition(`Destructor method cannot have arguments. (${k.name}::dispose)`,qe);if(-1!==Object.keys(r).indexOf(n)&&(!e.inheritance||e.inheritance&&!ne.members.probe("override",n).current())){if("prop"!==i||0!==k.attrs.members[n].length||0!==k.modifiers.members[n].length||s&&(!s||s.get||s.set))throw b.Duplicate(k.name+"::"+n,qe);return t[n]=s,!1}if(e.inheritance&&ne.members.probe("override",n).current()){if(-1===Object.keys(r).indexOf(n))throw b.InvalidDefinition(`Member not found to override. (${k.name}::${n})`,qe);if(ne.members.type(n)!==i)throw b.InvalidDefinition(`Overriding member type is invalid. (${k.name}::${n})`,qe)}if(e.static&&(ne.members.probe("static",n).current()||l.isStatic()))if("func"===i){if(x(s))throw b.InvalidDefinition(`Static functions cannot be defined as an arrow function. (${k.name}::${n})`,qe)}else if("prop"===i){if(s&&s.get&&"function"==typeof s.get&&x(s))throw b.InvalidDefinition(`Static property getters cannot be defined as an arrow function. (${k.name}::${n})`,qe);if(s&&s.set&&"function"==typeof s.set&&x(s))throw b.InvalidDefinition(`Static property setters cannot be defined as an arrow function. (${k.name}::${n})`,qe)}if(e.storage&&ie.members.probe("session",n).current()&&s&&s.get&&"function"==typeof s.get)throw b.InvalidDefinition(`Session properties cannot be defined with a custom getter/setter. (${k.name}::${n})`,qe);if(e.storage&&ie.members.probe("state",n).current()){if(s&&s.get&&"function"==typeof s.get)throw b.InvalidDefinition(`State properties cannot be defined with a custom getter/setter. (${k.name}::${n})`,qe);if(!E)throw b.InvalidOperation("Port is not configured. (localStorage)",qe)}return o},X=(t,i,s)=>{let a={get:null,set:null},o=h,l=h,c=ne.members.probe("readonly",t).anywhere(),u=ne.members.probe("static",t).anywhere(),p=ie.members.probe("session",t).anywhere(),m=ie.members.probe("state",t).anywhere(),d=ie.members.probe("deprecate",t).current(),y=ie.members.probe("inject",t).current(),g=ie.members.probe("asset",t).current(),v=ie.members.probe("resource",t).current(),x=ie.members.probe("type",t).current(),O=null!==d,I=O?d.args[0]||`Event is marked as deprecate. (${k.name}::${t})`:"",A=w,$=r,j=k.name+"_"+t,T=!1,N=null;if(s&&(s.get||s.set)){if(!e.propGetterSetter)throw b.InvalidDefinition(`Getter/Setter are not allowed. (${k.name}::${t})`,qe);s.get&&"function"==typeof s.get&&(o=s.get),s.set&&"function"==typeof s.set&&(l=s.set),e.static&&u&&($=f.staticInterface),a.get=function(){return O&&console.log(I),o.apply($)}.bind($),a.set=function(e){if(O&&console.log(I),c&&!$[n].constructing)throw b.InvalidOperation(`Property is readonly. (${k.name}::${t})`,qe);if(x&&x.args[0]&&!W(e,x.args[0]))throw b.InvalidArgument("value",qe);return l.apply($,[e])}.bind($)}else{if(e.static&&u){if(A=f.staticInterface[n].props,$=f.staticInterface,x&&x.args[0]&&!W(s,x.args[0]))throw b.InvalidArgument("value",qe);A[j]=s}else if(e.storage&&(p||m)){if(T=!0,p?(A=D,j=r[n].id+"_"+j):A=E,re(p?"session":"state",j),!A.key(j)){if(x&&x.args[0]&&!W(s,x.args[0]))throw b.InvalidArgument("value",qe);A.setItem(j,JSON.stringify({value:s}))}}else{if(x&&x.args[0]&&!W(s,x.args[0]))throw b.InvalidArgument("value",qe);if(e.numOnlyProps&&"number"!=typeof s)throw b.InvalidArgument("value",qe);A[j]=s}a.get=function(){return O&&console.log(I),T?JSON.parse(A.getItem(j)).value:A[j]}.bind($),a.set=function(e){if(O&&console.log(I),c&&!$[n].constructing)throw b.InvalidOperation(`Property is readonly. (${k.name}::${t})`,qe);if(x&&x.args[0]&&!W(e,x.args[0]))throw b.InvalidArgument("value",qe);T?A.setItem(j,JSON.stringify({value:e})):A[j]=e}.bind($)}if(y&&!u&&!T){let e=y.args[0],t=y.args.length>0?y.args[1]:[],r=y.args.length>1&&y.args[2],n=null;try{switch(U(e)){case"class":case"struct":n=t;break;case"string":if(n=ue(e)){if(-1===["class","struct"].indexOf(U(n)))throw b.InvalidArgument("inject",qe)}else N=Ye.resolve(e,t,r),Array.isArray(N)||(N=[N]);break;default:throw b.InvalidArgument("inject",qe)}!N&&n&&(N=[],t.length>0?N.push(new n(...t)):N.push(new n))}catch(e){throw new b(e,qe)}a.set(N)}if((ie.members.probe("dispose",t).anywhere()||y)&&re("prop",t),(v||g)&&!T){let e=null;if(v)v.args[0]&&(e=le(v.args[0]));else if(g.args[0]){let t=g.args[0];t.startsWith("../")&&(t=t.substr(3)),t.startsWith("./")&&(t=t.substr(2)),t.startsWith("/")&&(t=t.substr(1)),e=ae(k.name)+"/"+t}e&&a.set(e)}return e.customAttrs&&(a=z($,t,i,a)),a},K=(t,n,i)=>{if("func"===n){let n=Ce.get("overload");if(n){let s,a=e.static&&ne.members.probe("static",t).current()?f.staticInterface:r;if(Q(t,i,n),a[t]){if(Ce.count()>1)throw b.InvalidDefinition(`Overloaded function cannot define additional modifiers or attributes. (${k.name}::${t})`,qe);return Ce.collect(),!0}}}return!1},Q=(t,i,s)=>{let a=e.static&&ne.members.probe("static",t).current(),o=a?f.staticInterface:r,l,c,u;(a?o[n].overloads:I)[t+"_"+$(s.args[0]).join("_")]=i},Y=(t,...i)=>{let s=e.static&&ne.members.probe("static",t).current(),a=s?f.staticInterface:r,o=s?a[n].overloads:I,l="",c="";for(let e of i)l+="_"+typeof e;return l.startsWith("_")&&(l=l.substr(1)),o[c=t+"_"+l]||null},Z=(t,i,s)=>{let a=null,o=r,l=e.inheritance&&ne.members.probe("override",t).current(),c=e.static&&ne.members.probe("static",t).current(),u=ne.members.probe("async",t).current(),p=ie.members.probe("deprecate",t).current(),m=ie.members.probe("inject",t).current(),d=ie.members.probe("on",t).current(),y=ie.members.probe("timer",t).current(),g=ie.members.probe("args",t).current(),v=ie.members.probe("aspects",t).current(),w=ie.members.probe("fetch",t).current(),x=ie.members.probe("overload",t).current(),I=null!==p,A=I?p.args[0]||`Function is marked as deprecate. (${k.name}::${t})`:"",$=null,j="",T="",N="",P=null,C=[];if(l?!0!==($=r[t].bind(o)).ni&&$!==h||($=null):c&&(o=f.staticInterface),m){let e=m.args[0],t=m.args.length>0?m.args[1]:[],r=m.args.length>1&&m.args[2];C=Ye.resolve(e,t,r),Array.isArray(C)||(C=[C])}if((u=u||O(s))?(w&&w.args.length>0?(j=w.args[0],T=w.args[1],N=w.args[2],P=((e={})=>(e.method=j,S(N,T,e)))):P=null,a=async function(...e){return new Promise(function(r,n){I&&console.log(A);let i=[];if($&&i.push($),P&&i.push(P),C.length>0&&i.push(C),g&&g.args.length>0){let t=q(...g.args)(...e);t.error&&n(t.error,s),i.push(t)}else i=i.concat(e);x&&(s=Y(t,...i));try{let e=s.apply(o,i);e&&"function"==typeof e.then?e.then(r).catch(e=>{n(e,s)}):r(e)}catch(e){n(e,s)}}.bind(o))}.bind(o)):a=function(...e){I&&console.log(A);let r=[];if($&&r.push($),C.length>0&&r.push(C),g&&g.args.length>0){let t=q(...g.args)(...e);t.throwOnError(qe),r.push(t)}else r=r.concat(e);return x&&(s=Y(t,...r)),s.apply(o,r)}.bind(o),e.customAttrs&&(a=z(o,t,i,a)),e.aop){let e=[];v&&v.args.length>0&&(v.args.forEach(e=>{if(!W(e,"Aspect"))throw b.InvalidArgument(`Only Aspect types can be statically weaved on function. (${k.name}::${t})`,qe)}),e=v.args),a=M(t,a,e)}if(d&&d.args.length>0&&(Xe(d.args[0],a),re("handler",{name:d.args[0],handler:a})),y&&y.args.length>0){let e=!1,i=setInterval(()=>{o[n].constructing||e||(e=!0,r[t](),e=!1)},1e3*y.args[0]);re("timer",i)}return a},ee=(t,i,s)=>{let a=null,o=null,l=null,c=null,u=e.inheritance&&ne.members.probe("override",t).current(),f=ie.members.probe("deprecate",t).current(),p=ie.members.probe("post",t).current(),m=null!==f,d=m?f.args[0]||`Event is marked as deprecate. (${k.name}::${t})`:"",h=r;return C||(C=new B(k.name),re("event",C)),u&&!0===(l=r[t][n].processor).ni&&(l=null),a=function(...e){return m&&console.log(d),c=l?[l].concat(e):e,s.apply(h,c)}.bind(h),e.customAttrs&&(a=z(h,t,i,a)),o=a,(a=function(...e){let r=e;"function"==typeof o&&(r=o(...e)),C.dispatch(t,r),p&&p.args.length>0&&Ke(p.args[0],r)}.bind(h))[n]=Object.freeze({processor:o}),a.add=(e=>{C.add(t,e)}),a.remove=(e=>{C.remove(t,e)}),a.strip=(()=>{let e=T({},a,!0,["strip"]);return delete a.strip,Object.freeze(e)}),a},te=(t,i,s)=>{if(i=J(t,i,s),K(t,i,s))return;k.members[t]=i,k.attrs.members[t]=[],k.modifiers.members[t]=[],e.aop&&(k.aspects={members:{}}),e.mixins&&null!==y&&Ce("mixin",y[n].name),Ee(k,c,t,!1,e.customAttrs);let a=null,o=e.static&&ne.members.probe("static",t).current(),l=o?f.staticInterface:r;if(o){if(!c.staticConstructionCycle)return}else if(c.staticConstructionCycle)return;if(H(l,t,i,s)){switch(i){case"func":a=Z(t,i,s),Object.defineProperty(l,t,{configurable:!0,enumerable:!0,value:a});break;case"prop":a=X(t,i,s),Object.defineProperty(l,t,{configurable:!0,enumerable:!0,get:a.get,set:a.set});break;case"event":a=ee(t,i,s),Object.defineProperty(l,t,{configurable:!0,enumerable:!0,value:a});break}ne.members.probe("private",t).current()?k.scope[t]="private":ne.members.probe("protected",t).current()?k.scope[t]="protected":k.scope[t]="public"}},re=(e,t)=>{m.disposables.push({type:e,data:t})},ne=Fe(!0,k,c),ie=Fe(!1,k,c);if(e.inheritance){if(f.isTopLevelInstance&&!c.staticConstructionCycle&&!$t&&ne.type.probe("abstract").current())throw b.InvalidOperation(`Cannot create instance of an abstract type. (${k.name})`,qe);let e=l.inherits,t=null;if(e){if((t=e[n]).isSealed()||t.isSingleton()||t.isStatic())throw b.InvalidDefinition(`Cannot inherit from a sealed, static or singleton type. (${t.name})`,qe);if(t.type!==l.type)throw b.InvalidDefinition(`Cannot inherit from another type family. (${t.type})`,qe);if(t.context&&t.context.isUnloaded())throw b.InvalidOperation(`Parent context is not active anymore. (${t.name})`,qe);r=new e(f._flagName,f.staticInterface,f.args),m=r[n],A=m.def,delete m.def}else if(l.context&&l.context.isUnloaded())throw b.InvalidOperation(`Type context is not active anymore. (${l.name})`,qe)}if(void 0===r[n]&&(r[n]={},m=r[n],e.dispose&&(m.disposables=[])),e.mixins&&(k.mixins=e.params.mixins),e.interfaces&&(k.interfaces=e.params.interfaces),m.type=e.types.instance,f.isTopLevelInstance&&(m.Type=t,e.new&&(m.isInstanceOf=(e=>{if(e[n]&&(e=e[n].name),!e)throw b.InvalidArgument("name",qe);return l.name===e||l.isDerivedFrom(e)})),e.mixins&&(m.isMixed=(e=>l.isMixed(e))),e.interfaces&&(m.isImplements=(e=>l.isImplements(e))),m.modifiers=ne,m.attrs=ie,$t&&(m.def=k,m.typeDef=c,m.obj=r)),N=new Proxy({},{get:(t,i)=>{if(e.new&&i!==n&&"$"===i.substr(0,1)){if("$self"===i)return F;if("$static"===i)return F.static;if("$obj"===i)return F.obj()}"construct"===i?i=g:"dispose"===i&&(i=v);let s=null;if(i!==n)switch(k.scope[i]){case"private":s=r;break;case"protected":s=void 0!==p[i]?p:r;break;case"public":if("event"===k.members[i]){s=void 0!==r[i]?r:p;break}s=p;break;default:if("function"==typeof r[i]&&"function"==typeof p[i].add&&"function"==typeof p[i].remove)s=r;else{if(void 0===p[i])throw b.NotDefined(i,qe);s=p}}else s=r;return s[i]},set:(t,i,s)=>{if(e.new&&i!==n&&"$"===i.substr(0,1))throw b.InvalidOperation(`Special members cannot be custom defined. (${i})`,qe);if(P){let e="";"construct"===i?(e="construct",i=g):"dispose"===i?(e="dispose",i=v):"function"==typeof s?!0===s.event?(s!==L&&delete s.event,e="event"):e="func":e="prop",te(i,e,s)}else{if("function"==typeof s)throw b.InvalidOperation(`Redefinition of members is not allowed. (${i})`,qe);let e=null;if(i!==n)switch(k.scope[i]){case"private":e=r;break;case"protected":e=void 0!==p[i]?p:r;break;case"public":e=p;break;default:if(void 0!==p[i]){e=p;break}throw b.NotDefined(i,qe)}else e=r;e[i]=s}return!0}}),P=!0,e.mixins&&k.mixins&&!c.staticConstructionCycle){for(let e of k.mixins)y=e,e.apply(N),y=null;delete k.mixins}if(e.params.factory.apply(N),Ce.clear(),P=!1,f.isTopLevelInstance&&(e.construct&&"function"==typeof r[g]&&(m.construct=r[g],delete r[g]),e.dispose&&"function"==typeof r[v])){let e=r[v];delete r[v],m.dispose=(()=>{for(let e of m.disposables)switch(e.type){case"session":D.removeItem(e.data);break;case"state":E.removeItem(e.data);break;case"prop":r[e.data]=null;break;case"event":e.data.clear();break;case"handler":Xe(e.data.name,e.data.handler,!0);break;case"timer":clearInterval(e.data);break}"function"==typeof e&&e(),m.disposables.length=0,w=null,A=null,k=null,N=null,C=null,p=null,r=null})}return e.static&&l.isStatic()&&c.staticConstructionCycle&&t.construct&&"function"==typeof t[g]&&(l.construct=t[g],delete t[g]),R(),!e.interfaces||c.staticConstructionCycle||$t||V(),e.construct&&f.isTopLevelInstance&&!c.staticConstructionCycle&&!$t&&"function"==typeof d.construct&&(d.constructing=!0,d.construct(...f.args),delete d.constructing),e.construct&&c.staticConstructionCycle&&"function"==typeof l.construct&&(l.constructing=!0,l.construct(),delete l.constructing),!f.isTopLevelInstance||c.staticConstructionCycle||$t||e.singleton&&ie.type.probe("singleton").current()&&(l.singleInstance.value=p),!f.isTopLevelInstance||c.staticConstructionCycle||$t||(d=Object.freeze(d),p=Object.seal(p)),p},We=()=>{let t=G("sessionStorage");t?t.clear():e?(!0).sessionStorage&&delete global.sessionStorage:sessionStorage.clear()},qe=e=>{if(e.new=e.new||!1,e.mixins=e.mixins||!1,e.interfaces=e.interfaces||!1,e.inheritance=e.inheritance||!1,e.singleton=e.singleton||!1,e.static=e.static||!1,e.const=e.const||!1,e.func=e.func||!1,e.construct=e.construct||!1,e.dispose=e.dispose||!1,e.prop=e.prop||!1,e.propGetterSetter=e.propGetterSetter||!1,e.numOnlyProps=e.numOnlyProps||!1,e.event=e.event||!1,e.storage=e.storage||!1,e.aop=e.aop||!1,e.customAttrs=e.customAttrs||!1,e.types=e.types||{},e.types.instance=e.types.instance||"unknown",e.types.type=e.types.type||"unknown",e.params=e.params||{},e.params.typeName=e.params.typeName||"",e.params.inherits=e.params.inherits||null,e.params.mixinsAndInterfaces=e.params.mixinsAndInterfaces||null,e.params.factory=e.params.factory||null,e.mex=e.mex||{},e.mex.instance=e.mex&&e.mex.instance?e.mex.instance:{},e.mex.type=e.mex&&e.mex.type?e.mex.type:{},e.ex=e.ex||{},e.ex.instance=e.ex&&e.ex.instance?e.ex.instance:{},e.ex.type=e.ex&&e.ex.type?e.ex.type:{},e.params.ns="",e.params.mixins=[],e.params.interfaces=[],e.func||(e.construct=!1,e.dispose=!1),e.prop||(e.storage=!1),e.inheritance||(e.singleton=!1),e.func||e.prop||e.event||(e.aop=!1),e.new&&(e.const=!1),!e.params.typeName||-1!==e.params.typeName.indexOf("."))throw b.InvalidDefinition(`Type name is invalid. (${e.params.typeName})`,qe);let t=Ce.get("ns"),r=t?t.args[0]:"";if(r)switch(r){case"(auto)":throw b.InvalidDefinition(`Namespace '(auto)' should be used only when bundling the type in an assembly. (${r})`,qe);case"(root)":break;default:if(r.startsWith(".")||r.endsWith(".")||/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g.test(r))throw`Namespace name is invalid. (${r})`;e.params.typeName=r+"."+e.params.typeName,e.params.ns=r;break}if(e.params.mixinsAndInterfaces)for(let t of e.params.mixinsAndInterfaces)if(t[n])switch(t[n].type){case"mixin":e.params.mixins.push(t);break;case"interface":e.params.interfaces.push(t);break}delete e.params.mixinsAndInterfaces,ze(e);let i=ne.context.current(),s=i.currentAssemblyBeingLoaded()||"",a=null,o=null;if(e.new)if(e.inheritance){if(e.params.inherits&&(ge(e.params.inherits)||be(e.params.inherits)||ye(e.params.inherits)))throw b.InvalidDefinition(`Cannot inherit from a sealed, static or singleton type. (${e.params.inherits[n].name})`,qe);a=function(t,r,...n){return Ue(e,a,{},t,r,...n)}}else a=function(...t){return Ue(e,a,{},null,null,...t)};else a=e.const?function(){return Ue(e,a,{})}:function(...t){if(new.target)throw b.InvalidOperation(`Construction cannot be done for this type. (${e.params.typeName})`,a);e.params.factory.apply(this,...t)};a.typeName=(()=>e.params.typeName),a.typeType=(()=>e.params.type);let l={name:e.params.typeName,type:e.types.type,Type:a,level:"type",attrs:{type:[]},modifiers:{type:[]},previous:()=>a[n].inherits?a[n].inherits[n].def():null};const c=Fe(!0,null,l),u=Fe(!1,null,l);if(a[n]={},(o=a[n]).name=e.params.typeName,o.type=e.types.type,o.namespace=null,o.assembly=(()=>i.getAssembly(s)||null),o.context=i,e.inheritance&&(o.inherits=e.params.inherits||null,o.isAbstract=(()=>!!c.type.probe("abstract").current()),o.isSealed=(()=>!!c.type.probe("sealed").current()),o.isDerivedFrom=(t=>{if(t[n]&&(t=t[n].name),"string"!=typeof t)throw b.InvalidArgument("name",o.isDerivedFrom);let r=!1,i=e.params.inherits;if(!r)for(;1&&null!==i;){if(i[n].name===t){r=!0;break}i=i[n].inherits}return r}),o.inherits)){let e=u.type.probe("deprecate").anywhere();if(e){let t=e.args[0]||`Type is marked as deprecated. (${o.name})`;console.log(t)}}if(e.static&&(o.isStatic=(()=>!!c.type.probe("static").current()),o.props={},o.overloads={}),e.singleton&&(o.isSingleton=(()=>!!u.type.probe("singleton").current()),o.singleInstance={value:null}),e.mixins&&(o.mixins=e.params.mixins,o.isMixed=(e=>{if(e[n]&&(e=e[n].name),"string"!=typeof e)throw b.InvalidArgument("name",o.isMixed);let t=!1,r=a;for(;1&&null!==r&&(r[n].mixins&&(t=-1!==A(r[n].mixins,"name",e)),!t);)r=r[n].inherits;return t})),e.interfaces&&(o.interfaces=e.params.interfaces,o.isImplements=(e=>{if(e[n]&&(e=e[n].name),"string"!=typeof e)throw b.InvalidArgument("name",o.isImplements);let t=!1,r=a;for(;1&&null!==r&&(r[n].interfaces&&(t=-1!==A(r[n].interfaces,"name",e)),!t);)r=r[n].inherits;return t})),o.isDeprecated=(()=>!!u.type.probe("deprecate").current()),o.def=(()=>l),o.modifiers=c,o.attrs=u,Ee(null,l,null,!0,e.customAttrs),e.static&&c.type.probe("static").current()){if(e.params.interfaces.length>0)throw b.InvalidDefinition("Static types cannot implement interfaces.",qe);if(e.params.mixins.length>0)throw b.InvalidDefinition("Static types cannot implement mixins.",qe)}if(e.static){let t=e.params.factory?e.params.factory.toString():"";if(o.isStatic()||-1!==t.indexOf(`$$('static')`)||-1!==t.indexOf(`$$("static")`)){l.staticConstructionCycle=!0;let e=new a;Te(e),delete l.staticConstructionCycle}}Me(e.ex.type,a,a,l,u,c),Me(e.mex.type,a,o,l,u,c);let f=null,p=!1;return e.static&&o.isStatic()||e.const?(f=new a,e.const&&(p=!0)):(p=!0,f=a),r&&(o.namespace=ne.context.current().registerType(f)),a[n]=Object.freeze(o),p&&Object.freeze(f),f},_e=(e,t,r,n)=>{let i=q("name: string, inherits: class, factory: cfunction","name: string, inherits: class, mixints: array, factory: cfunction","name: string, factory: cfunction","name: string, mixints: array, factory: cfunction")(e,t,r,n);i.throwOnError(_e);let s={new:!0,mixins:!0,interfaces:!0,inheritance:!0,singleton:!0,static:!0,func:!0,construct:!0,dispose:!0,prop:!0,propGetterSetter:!0,event:!0,storage:!0,aop:!0,customAttrs:!0,types:{instance:"instance",type:"class"},params:{typeName:i.values.name,inherits:i.values.inherits,mixinsAndInterfaces:i.values.mixints,factory:i.values.factory},mex:{instance:{},type:{}},ex:{instance:{},type:{}}};return qe(s)};d("Class",_e);const Le=(e,t)=>{let r=q("name: string, factory: cfunction")(e,t);r.throwOnError(Le);let n={const:!0,func:!0,dispose:!0,prop:!0,propGetterSetter:!0,event:!0,types:{instance:"interface",type:"interface"},params:{typeName:r.values.name,factory:r.values.factory}};return qe(n)};d("Interface",Le);const Be=(e,t)=>{let r=q("name: string, factory: cfunction")(e,t);r.throwOnError(Be);let n={new:!0,func:!0,construct:!0,prop:!0,propGetterSetter:!0,types:{instance:"sinstance",type:"struct"},params:{typeName:r.values.name,factory:r.values.factory}};return qe(n)};d("Struct",Be);const Ve=(e,t)=>{let r=q("name: string, factory: cfunction")(e,t);r.throwOnError(Ve);let n={const:!0,prop:!0,numOnlyProps:!0,types:{instance:"enum",type:"enum"},params:{typeName:r.values.name,factory:r.values.factory},mex:{instance:{getName:function(e){let t=this.instance.obj,r=this.instance.def,n="";for(let i in r.members)if(r.members.hasOwnProperty(i)&&"prop"===r.members[i]&&t[i]===e){n=i;break}return n},getNames:function(){let e=this.instance.def,t=[];for(let r in e.members)e.members.hasOwnProperty(r)&&"prop"===e.members[r]&&t.push(r);return t},getValues:function(){let e=this.instance.def,t=this.instance.obj,r=[];for(let n in e.members)e.members.hasOwnProperty(n)&&"prop"===e.members[n]&&r.push(t[n]);return r}}}};return qe(n)};Ve.getName=((e,t)=>{let r;return q("enumType: enum, enumValue: number")(e,t).throwOnError(Ve.getName),e[n].getName(t)}),Ve.getNames=(e=>{let t;return q("enumType: enum")(e).throwOnError(Ve.getNames),e[n].getNames()}),Ve.getValues=(e=>{let t;return q("enumType: enum")(e).throwOnError(Ve.getValues),e[n].getValues()}),Ve.isDefined=((e,t)=>{let r=q("enumType: enum, nameOrValue: number","enumType: enum, nameOrValue: string")(e,t);return r.throwOnError(Ve.isDefined),1===r.index?-1!==e[n].getNames().indexOf(t):""!==e[n].getName(t)}),d("Enum",Ve);const Ge=(e,t)=>{let r=q("name: string, factory: cfunction")(e,t);r.throwOnError(Ge);let n={func:!0,prop:!0,propGetterSetter:!0,event:!0,customAttrs:!0,types:{type:"mixin"},params:{typeName:r.values.name,factory:r.values.factory}};return qe(n)};d("Mixin",Ge);const Je=new B,He=Je.dispatch,Xe=(e,t,r)=>{let n;q("event: string, handler: afunction")(e,t).throwOnError(Xe),r?Je.remove(e,t):Je.add(e,t)};d("on",Xe,()=>{Je.clear()});const Ke=(e,t)=>{if("string"!=typeof e)throw b.InvalidArgument("event",Ke);He(e,t)};d("post",Ke);let Qe={};const Ye={isRegistered:e=>{if("string"!=typeof e)throw b.InvalidArgument("alias",Ye.isRegistered);return void 0!==Qe[e]&&Qe[e].length>0},get:(e,t)=>{if("string"!=typeof e)throw b.InvalidArgument("alias",Ye.get);return t?Qe[e]?Qe[e].slice():[]:Qe[e]?Qe[e][0]:null},register:(e,t)=>{if("string"!=typeof e)throw b.InvalidArgument("alias",Ye.register);if(!t)throw b.InvalidArgument("item",Ye.register);if(-1!==e.indexOf("."))throw b.InvalidArgument("alias",Ye.register);"string"==typeof t&&((t=w(t)).endsWith(".js")||t.endsWith(".mjs"))&&(t=w(t,!0)),Qe[e]||(Qe[e]=[]),Qe[e].push(t)},resolve:(e,t,...r)=>{if("string"!=typeof e)throw b.InvalidArgument("alias",Ye.resolve);if("boolean"!=typeof t)throw b.InvalidArgument("isAll",Ye.resolve);let i=null;const s=e=>{let t=e;if("string"==typeof e)if(e.endsWith(".js")||e.endsWith(".mjs"));else{let t=ue(e);t&&(e=t)}if(-1!==["class","struct"].indexOf(U(e)))try{t=r?new e(...r):new e}catch(t){throw b.OperationFailed(`Type could not be instantiated. (${e[n].name})`,Ye.resolve)}return t};return Qe[e]&&Qe[e].length>0&&(t?(i=[],Qe[e].forEach(e=>{i.push(s(e))})):i=s(Qe[e][0])),i}};d("Container",Ye,()=>{Qe={}});let Ze=h,et=[],tt=500;const rt={on:(e,...t)=>{Ze===h&&("string"==typeof e?t.unshift(e):"function"==typeof e&&Xe("telemetry",e),Ze=((e,r)=>{if(0===t.length||-1!==t.indexOf(e)){let t=Object.freeze({type:e,data:r});et.push(t),et.length>tt-25&&et.splice(0,25),Ke("telemetry",t)}}))},collect:()=>{if(Ze!==h){let e=et.slice();return et.length=0,e}return[]},off:e=>Ze!==h?("function"==typeof e&&Xe("telemetry",e,!0),Ze=h,rt.collect()):[],isOn:()=>Ze!==h,types:Object.freeze({RAW:"raw",EXEC:"exec",INFO:"info",INCL:"incl"})};d("telemetry",rt,()=>{et.length=0});const nt=[],it={register:(e,t)=>{let r;q("pointcut: string, aspect: Aspect")(e,t).throwOnError(it.register);let n=e,i="",s="",a="",o="",l=null;-1!==n.indexOf(":")&&(n=(l=n.split(":"))[0].trim(),a=l[1].trim()||"*"),-1!==n.indexOf(".")?(i=n.substr(0,n.lastIndexOf(".")),s=n.substr(n.lastIndexOf(".")+1)):(i="",s=n),o=j(o=i+"/"+s+":"+a,".","[.]"),o=j(o,"?","."),o=j(o,"*",".*"),nt.push({rex:new RegExp(o),Aspect:t})}},st=(e,t,r)=>{let i=[],s="",a="",o=t.trim(),l="";return-1!==e.indexOf(".")?(s=e.substr(0,e.lastIndexOf(".")).trim(),a=e.substr(e.lastIndexOf(".")+1).trim()):(s="",a=e.trim()),l=s+"/"+a+":"+o,r&&i.push(...r),nt.forEach(e=>{e.rex.test(l)&&-1===I(i,"name",e.Aspect[n].name)&&i.push({name:e.Aspect[n].name,Aspect:e.Aspect})}),i},at=(e,t,r,n)=>{let i=[],s=[],a=[],o=null,l;for(let e of n)(o=new e.Aspect).before!==h&&i.push(o.before),o.around!==h&&a.push(o.around),o.after!==h&&s.push(o.after);return a.length>0&&a.reverse(),function(...n){let o=null,l=null,c={typeName:()=>t,funcName:()=>r,error:e=>(e&&(o=e),o),result:e=>(void 0!==e&&(l=e),l),args:()=>n,data:{}};for(let e of i)try{e(c)}catch(e){o=e}const u=e=>{for(let t of s)try{t(e)}catch(e){c.error(e)}};let f=e,p=null;for(let e of a)f=e(c,f);try{(p=f(...n))&&"function"==typeof p.then?c.result(new Promise((e,t)=>{p.then(t=>{c.result(t),u(c),e(c.result())}).catch(e=>{c.error(e),u(c),t(c.error())})})):(c.result(p),u(c))}catch(e){c.error(e)}return c.result()}};d("Aspects",it,()=>{nt.length=0});const ot=(e,t)=>{let r=null,i=null,s=t?JSON.parse(e):e,a=t?null:e[n].Type,o=a[n];const l=(e,t)=>{let r=e[n],i=r.attrs,s=r.modifiers,a=[],o=!1;for(let r in e)e.hasOwnProperty(r)&&r!==n&&((o=s.members.isProperty(r))&&(o=t?!i.members.probe("noserialize",r).anywhere():i.members.probe("serialize",r).anywhere())&&(o=!(s.members.is("private",r)||s.members.is("protected",r)||s.members.is("static",r)||s.members.is("readonly",r)||i.members.probe("resource",r).anywhere()||i.members.probe("asset",r).anywhere()||i.members.probe("inject",r).anywhere())),o&&a.push(r));return a};if(t){if(!s.type&&!s.data)throw b.InvalidArgument("json");if(!(a=ue(s.type)))throw b.NotFound(s.type,lt.deserialize);try{r=new a}catch(e){throw b.OperationFailed(`Object could not be deserialized. (${s.type})`,e,lt.deserialize)}i=o.attrs.type.probe("serialize").anywhere()?l(r,!0):l(r,!1);for(let e of i)r[e]=s.data[e]}else{i=o.attrs.type.probe("serialize").anywhere()?l(s,!0):l(s,!1),r={type:s[n].Type[n].name,data:{}};for(let e of i)r.data[e]=s[e];try{r=JSON.stringify(r)}catch(e){throw b.OperationFailed(`Object could not be serialized. (${s[n].Type[n].name})`,e,lt.serialize)}}return r},lt={serialize:e=>{if(l.indexOf(-1===U(e)))throw b.InvalidArgument("instance",lt.serialize);return ot(e)},deserialize:e=>{if(!e||"string"!=typeof e)throw b.InvalidArgument("json",lt.deserialize);return ot(e,!0)}};d("Serializer",lt);const ct=4*a.env.cores,ut=Math.round(ct/4),ft=[],pt=()=>{if(ft.length<=ut)return;let e=ft.slice(0),t=()=>{if(0!==e.length){let r=e.shift();r.context.isBusy()?t():r.context.hasActiveInstances().then(e=>{0===e?(r.unload(),ft.shift(),ft.length>ut&&t()):t()}).catch(()=>{t()})}};t()},mt=()=>new Promise((e,t)=>{let r=ft.slice(0),n=()=>{if(0!==r.length){let i=r.shift();i.context.isBusy()?n():i.context.hasActiveInstances().then(t=>{0===t?e(i):n()}).catch(t)}else ft.length<ct?ne.createDomain(v()).then(t=>{e(t)}).catch(t):t(b.OperationFailed("AppDomain pool limit reached."))};n()}),dt={TaskInfo:function(e,...t){if("string"!=typeof e)throw b.InvalidArgument("qualifiedName",dt.TaskInfo);return Object.freeze({type:e,typeArgs:t})},getHandle:(e,t)=>new Promise((r,n)=>{mt().then(n=>{let i;r({run:(...r)=>new Promise((i,s)=>{n.context.execute({type:e.type,typeArgs:e.typeArgs,func:"run",args:r,keepAlive:!0},t).then(i).catch(s)}),close:()=>new Promise((r,i)=>{n.context.execute({type:e.type,typeArgs:e.typeArgs,func:"",args:[],keepAlive:!1},t).then(r).catch(i).finally(pt)})})}).catch(n)}),invoke:(e,t)=>new Promise((r,n)=>{mt().then(i=>{i.context.execute({type:e.type,typeArgs:e.typeArgs,func:"run",args:[],keepAlive:!1},t).then(r).catch(n).finally(pt)}).catch(n)}),parallel:Object.freeze({invokeMany:(...e)=>{let t=[];for(let r of e)t.push(dt.invoke(r));return t},invoke:Object.freeze({any:(...e)=>Promise.race(dt.parallel.invokeMany(...e)),all:(...e)=>Promise.all(dt.parallel.invokeMany(...e)),each:(e,t,...r)=>new Promise((n,i)=>{let s=dt.parallel.invokeMany(...r),a=0;for(let r of s)r.then(e).catch(t).finally(()=>{a++,s.length===a&&n()})})})}),sequence:Object.freeze({invoke:(...e)=>new Promise((t,r)=>{let n=e.slice(0),i=[],s=()=>{if(0===n.length)return void t(...i);let e=n.shift();dt.invoke(e).then(e=>{i.push(e),s()}).catch(r)};n.length>0?s():t(...i)})})};d("Tasks",dt,()=>{ft.forEach(e=>{e.unload()}),ft.length=0});const ht=e=>{if(e.isServer){if(!(!0).sessionStorage){const e=function(){let e={};this.key=(t=>{if(!t)throw b.InvalidArgument("key",this.key);return!!e.key}),this.getItem=(t=>{if(!t)throw b.InvalidArgument("key",this.getItem);return e.key||null}),this.setItem=((t,r)=>{if(!t)throw b.InvalidArgument("key",this.setItem);if(void 0===r)throw b.InvalidArgument("value",this.setItem);e[t]=r}),this.removeItem=(t=>{if(!t)throw b.InvalidArgument("key",this.removeItem);delete e[t]}),this.clear=(()=>{e={}})};global.sessionStorage=new e}return(!0).sessionStorage}return(!0).sessionStorage};G.define("sessionStorage",["key","getItem","setItem","removeItem","clear"],ht);const yt=e=>e.isServer?ht(e):(!0).localStorage;G.define("localStorage",["key","getItem","setItem","removeItem","clear"],yt);const gt=e=>{let t={require:e=>new Promise((t,r)=>{if("string"==typeof e)try{t(require(e))}catch(e){r(new b(e))}else r(b.InvalidArgument("module"))}),undef:e=>{if("string"!=typeof e)throw b.InvalidArgument("module",t.undef);try{delete require.cache[require.resolve(e)]}catch(e){throw new b(e,t.undef)}}};return t};G.define("serverModule",["require","undef"],gt);const bt=e=>{let t={require:t=>new Promise((r,n)=>{if("string"!=typeof t)return void n(b.InvalidArgument("module"));let i=t.substr(t.lastIndexOf(".")+1).toLowerCase();try{if("undefined"!=typeof require)try{require([t],r,n)}catch(e){n(new b(e))}else if(e.isWorker)try{importScripts(t),r()}catch(e){n(new b(e))}else{let e=(!0).document.createElement("script");e.type="mjs"===i?"module":"text/javascript",e.name=t,e.src=t,e.onload=(()=>{r()}),e.onerror=(e=>{n(new b(e))}),(!0).document.head.appendChild(e)}}catch(e){n(new b(e))}}),undef:e=>{if("string"!=typeof e)throw b.InvalidArgument("module",t.undef);let r=null;(r=(!0).requirejs||null)&&r.undef(e)}};return t};G.define("clientModule",["require","undef"],bt);const vt=e=>e=>new Promise((t,r)=>{if("string"!=typeof e)return void r(b.InvalidArgument("file"));let n=e.substr(e.lastIndexOf(".")+1).toLowerCase();try{let i=null,s="";(i=e.startsWith("https")?require("https"):require("http")).get(e,e=>{e.on("data",e=>{s+=e}),e.on("end",()=>{let i=e.headers["content-type"];if("json"===n||/^application\/json/.test(i))try{let e=JSON.parse(s);t(e)}catch(e){r(new b(e))}else t(s)})}).on("error",e=>{r(new b(e))})}catch(e){r(new b(e))}});G.define("serverFile",vt);const wt=e=>e=>new Promise((t,r)=>{if("string"!=typeof e)return void r(b.InvalidArgument("file"));let n=e.substr(e.lastIndexOf(".")+1).toLowerCase();fetch(e).then(i=>{if(i.ok){let e=i.headers["content-type"];"json"===n||/^application\/json/.test(e)?i.json().then(t).catch(e=>{r(new b(e))}):i.text().then(t).catch(e=>{r(new b(e))})}else r(b.OperationFailed(e,i.status))}).catch(e=>{r(new b(e))})});G.define("clientFile",wt);const xt=e=>t=>{let r={},n=ne.config();return n&&n[t]&&(r=M([r,n[t]],!1)),e.isWorker&&n&&n[`worker:${t}`]&&(r=M([r,n[`worker:${t}`]],!1)),r};G.define("settingsReader",xt);const Ot=(e,t,r,n)=>new Promise((i,s)=>{"string"==typeof t?"string"==typeof r&&-1!==["text","json","buffer","form","blob"].indexOf(r)?n?e(t,n).then(e=>{if(e.ok){let t="";switch(r){case"text":t="text";break;case"json":t="json";break;case"buffer":t="arrayBuffer";break;case"form":t="formData";break;case"blob":t="blob";break}e[t]().then(i).catch(e=>{s(new b(e))})}else s(b.OperationFailed(t,e.status))}).catch(e=>{s(new b(e))}):s(b.InvalidArgument("reqData")):s(b.InvalidArgument("resDataType")):s(b.InvalidArgument("url"))}),It=e=>(e,t,r)=>Ot(require("node-fetch"),e,t,r);G.define("serverFetch",It);const At=e=>(e,t,r)=>Ot(fetch,e,t,r);G.define("clientFetch",At);let $t=!1;const kt=[],jt=function(e){if(!e||!e[n]&&-1!==o.indexOf(e[n].type))throw b.InvalidArgument("Type",jt);let t=null,r=null,i=null,s=null,a=null,l=null,c=null;const u=function(e){this.getType=(()=>"modifier"),this.getName=(()=>e.name),this.getArgs=(()=>e.args.slice()),this.getConstraints=(()=>e.cfg.constraints)},f=function(e){this.getType=(()=>"attribute"),this.getName=(()=>e.name),this.getArgs=(()=>e.args.slice()),this.getConstraints=(()=>e.cfg.constraints),this.isCustom=(()=>e.isCustom)},p=function(){this.getTarget=(()=>i),this.getTargetType=(()=>t.type),this.getName=(()=>t.name||""),this.getType=(()=>t.type),this.getId=(()=>t.id),this.getNamespace=(()=>t.namespace),this.getAssembly=(()=>t.assembly()),this.getContext=(()=>t.context),this.isClass=(()=>"class"===t.type),this.isEnum=(()=>"enum"===t.type),this.isStruct=(()=>"struct"===t.type),this.isMixin=(()=>"mixin"===t.type),this.isInterface=(()=>"interface"===t.type),this.isDeprecated=(()=>t.isDeprecated()),this.getModifiers=(()=>{let e=[];for(let t of l.modifiers.type)e.push(u(t));return e}),this.getAttributes=(()=>{let e=[];for(let t of l.attrs.type)e.push(f(t));return e}),this.getAttribute=(e=>{if("string"!=typeof e)throw b.InvalidArgument("name",this.getAttribute);let t=A(l.attrs.type,"name",e);return t?f(t):null}),this.getModifier=(e=>{if("string"!=typeof e)throw b.InvalidArgument("name",this.getModifier);let t=A(l.modifiers.type,"name",e);return t?u(t):null})},m=function(e){e.getMixins=(()=>{let e=[];if(t.mixins)for(let r of t.mixins)e.push(jt(r));return e}),e.isMixed=(r=>{if(!r)throw b.InvalidArgument("name",e.isMixed);return!!t.isMixed&&t.isMixed(r)})},d=function(e){e.getInterfaces=(()=>{let e=[];if(t.interfaces)for(let r of t.interfaces)e.push(jt(r));return e}),e.isImplements=(r=>{if(!r)throw b.InvalidArgument("name",e.isImplements);return!!t.isImplements&&t.isImplements(r)})},h=function(e){e.getInstanceType=(()=>r.type),e.isInstanceOf=(t=>{if(!t)throw b.InvalidArgument("name",e.isInstanceOf);return!!r.isInstanceOf&&r.isInstanceOf(t)})},y=e=>{let t=r.def;for(;1&&null!==t&&!t.members[e];)t=t.previous();return t},g=()=>{let e=null,t=null;c={};for(let n in r.obj){switch((e=y(n)).members[n]){case"prop":t=new x(n,e);break;case"func":t=new O(n,e);break;case"event":t=new $(n,e);break;case"construct":t=new O(n,e);break;case"dispose":t=new O(n,e);break}c[n]=t}},v=()=>{c||g()},w=function(e,r){this.getType=(()=>"member"),this.getMemberType=(()=>r.members[e]),this.getName=(()=>e),this.getModifiers=(()=>{let t=[];for(let r of a.modifiers[e])t.push(u(r));return t}),this.getAttributes=(()=>{let t=[];for(let r of a.attrs[e])t.push(f(r));return t}),this.getAttribute=(t=>{if("string"!=typeof t)throw b.InvalidArgument("name",this.getAttribute);let r=A(a.attrs[e],"name",t);return r?f(r):null}),this.getModifier=(t=>{if("string"!=typeof t)throw b.InvalidArgument("name",this.getModifier);let r=A(a.modifiers[e],"name",t);return r?u(r):null}),this.isPrivate=(()=>null!==A(a.modifiers[e],"name","private")),this.isProtected=(()=>null!==A(a.modifiers[e],"name","protected")),this.isPublic=(()=>!this.isPrivate()&&!this.isProtected()),this.isStatic=(()=>null!==A(a.modifiers[e],"name","static")),this.isSealed=(()=>null!==A(a.modifiers[e],"name","sealed")),this.isAbstract=(()=>null!==A(a.modifiers[e],"name","abstract")),this.isVirtual=(()=>null!==A(a.modifiers[e],"name","virtual")),this.isOverride=(()=>null!==A(a.modifiers[e],"name","virtual")),this.isEnumerable=(()=>Object.getOwnPropertyDescriptor(s,e).enumerable),this.isDeprecated=(()=>null!==A(a.attrs[e],"name","deprecate")),this.isConditional=(()=>null!==A(a.attrs[e],"name","conditional")),this.isMixed=(()=>null!==A(a.attrs[e],"name","mixin")),this.isInterfaced=(()=>null!==A(a.attrs[e],"name","interface")),this.getMixin=(()=>{let r=null,n=A(a.attrs[e],"name","mixin");if(n&&t.mixins)for(let e of t.mixins)if(e===n.name){r=jt(e);break}return r}),this.getInterface=(()=>{let r=null,n=A(a.attrs[e],"name","interface");if(n&&t.interfaces)for(let e of t.interfaces)if(e===n.name){r=jt(e);break}return r})},x=function(e,t){let r=new w(e,t);return r.isReadOnly=(()=>null!==A(a.modifiers[e],"name","readonly")),r.isSerializable=(()=>null!==A(a.attrs[e],"name","serialize")||null===A(a.attrs[e],"name","noserialize")&&null!==A(l.attrs.type,"name","serialize")),r.getValueType=(()=>{let t=A(a.attrs[e],"name","type");if(t)return t.args[0]}),r.isDisposable=(()=>null!==A(a.attrs[e],"name","dispose")),r.isInjectable=(()=>null!==A(a.attrs[e],"name","inject")),r.isResource=(()=>null!==A(a.attrs[e],"name","resource")),r.isAsset=(()=>null!==A(a.attrs[e],"name","asset")),r.isSession=(()=>null!==A(a.attrs[e],"name","session")),r.isState=(()=>null!==A(a.attrs[e],"name","state")),r},O=function(e,t){let r=new w(e,t);return r.isASync=(()=>null!==A(a.modifiers[e],"name","async")),r.isConstructor=(()=>"_construct"===e),r.isDestructor=(()=>"_dispose"===e),r.isSub=(()=>null!==A(a.attrs[e],"name","on")),r.isTimered=(()=>null!==A(a.attrs[e],"name","timer")),r.isInjectable=(()=>null!==A(a.attrs[e],"name","inject")),r.getArgs=(()=>{let t=A(a.attrs[e],"name","args");return t?t.args.slice():null}),r.getAspects=(()=>{if(a.aspects&&a.aspects[e].length>0){let t=[];for(let r of a.aspects[e])t.push(jt(r));return t}return null}),r.getAspect=(t=>{if("string"!=typeof t)throw b.InvalidArgument("name",r.getAspect);if(a.aspects&&a.aspects[e].length>0){let r=A(a.aspects[e],"name",t);if(r)return jt(r)}return null}),r},$=function(e,t){let r=new w(e,t);return delete r.isStatic,r.isPub=(()=>null!==A(a.attrs[e],"name","post")),r},k=function(e){e.getMembers=(e=>{(e=e||{}).types=e.types||[],e.modifiers=e.modifiers||[],e.attrs=e.attrs||[],e.aspects=e.aspects||[],e.inherited=void 0===e.inherited||e.inherited,v();let t=null,r=!0,n=[];for(let i in c)if(r=!0,c.hasOwnProperty(i)){if(t=c[i],e.types.length>0&&-1===e.types.indexOf(t.getMemberType())&&(r=!1),!r||e.inherited||a.members[i]||(r=!1),r&&e.modifiers.length>0)for(let t of e.modifiers)if(-1===I(a.modifiers[i],"name",t)){r=!1;break}if(r&&e.attrs.length>0)for(let t of e.attrs)if(-1===I(a.attrs[i],"name",t)){r=!1;break}if(r&&e.aspects.length>0&&"func"===t.getMemberType())for(let t of e.aspects)if(-1===I(a.aspects[i],"name",t)){r=!1;break}r&&n.push(c[i])}return n}),e.getMember=(t=>{if("string"!=typeof t)throw b.InvalidArgument("memberName",e.getMember);return v(),c[t]||null})},j=function(){let e=new p;return e.getParent=(()=>null!==t.inherits?jt(t.inherits):null),e.isDerivedFrom=(r=>{if(!r)throw b.InvalidArgument("name",e.isDerivedFrom);return!!t.isDerivedFrom&&t.isDerivedFrom(r)}),e.getFamily=(()=>{let e=[],r=t.inherits;for(null!==t.inherits&&e.push(jt(t.inherits));1&&null!==r;)e.push(jt(r)),r=r[n].inherits;return e}),e.isSealed=(()=>!!t.isSealed&&t.isSealed()),e.isAbstract=(()=>!!t.isAbstract&&t.isAbstract()),m(e),d(e),e.isSerializable=(()=>null!==A(l.attrs.type,"name","serialize")),e.isStatic=(()=>!!t.isStatic&&t.isStatic()),e.isSingleton=(()=>!!t.isSingleton&&t.isSingleton()),e.isSingleInstanceCreated=(()=>!!t.singleInstance.value),h(e),k(e),e},T=function(){let e=new p;return e.isSerializable=(()=>null!==A(l.attrs.type,"name","serialize")),h(e),k(e),e},N=function(){let e=new p;return k(e),e},P=function(){let e=new p;return k(e),e},S=function(){let e=new p;return e.getNames=(()=>{let e=[];for(let t of Ve.getNames(s))e.push(x(t,a));return e}),e.getName=(t=>{if(!t)throw b.InvalidArgument("enumValue",e.getName);let r=Ve.getName(s,t);return r?x(r,a):null}),e.getValues=(()=>Ve.getValues(s)),e.isDefined=(t=>{if(!t)throw b.InvalidArgument("nameOrValue",e.isDefined);return Ve.isDefined(s,t)}),e};let C=null,D=null,E=!1;switch($t=!0,e[n].type){case"class":i=e,s=new e,E=!0,C=new j;break;case"struct":i=e,s=new e,E=!0,C=new T;break;case"enum":i=e[n].Type,s=e,C=new S;break;case"mixin":D=_e("temp",[i=e],function(){}),s=new D,E=!0,C=new N;break;case"interface":i=e[n].Type,s=e,C=new P;break}return $t=!1,E&&kt.push(s),t=i[n],r=s[n],a=r.def,l=r.typeDef,C};jt.dispose=(()=>{if(kt.length>0)for(let e of kt)Te(e);kt.length=0}),d("Reflector",jt,()=>{jt.dispose()});const Tt=()=>{};Tt.guid=v,Tt.forEachAsync=z,Tt.replaceAll=j,Tt.splitAndTrim=$,Tt.findIndexByProp=I,Tt.findItemByProp=A,Tt.which=w,Tt.isArrowFunc=x,Tt.isASyncFunc=O,Tt.sieve=C,Tt.deepMerge=M,Tt.getLoadedScript=R,Tt.b64EncodeUnicode=D,Tt.b64DecodeUnicode=E,d("utils",Tt),m.members=Object.freeze(m.members);let Nt=e?__filename:t?self.location.href:R("flair.js","flair.min.js");m.info=Object.freeze({name:"flairjs",title:"Flair.js",file:Nt,version:"0.8.47",copyright:"(c) 2017-2019 Vikas Burman",license:"MIT",lupdate:new Date("Tue, 21 May 2019 02:01:06 GMT")});let Pt=w("./flair{.min}.js",!0);ne.context.current().loadBundledAssembly(Pt,Nt,(e,t)=>{const{Class:r,Struct:n,Enum:i,Interface:s,Mixin:a,Aspects:o,AppDomain:l,$$:c,attr:u,bring:f,Container:p,include:m,Port:d,on:h,post:y,telemetry:g,Reflector:b,Serializer:v,Tasks:w,as:x,is:O,isComplies:I,isDerivedFrom:A,isAbstract:$,isSealed:k,isStatic:j,isSingleton:T,isDeprecated:N,isImplements:P,isInstanceOf:S,isMixed:C,getAssembly:D,getAttr:E,getContext:F,getResource:z,getRoute:M,getType:R,ns:U,getTypeOf:W,getTypeName:q,typeOf:_,dispose:L,using:B,Args:V,Exception:G,noop:J,nip:H,nim:X,nie:K,event:Q}=e,{TaskInfo:Y}=e.Tasks,{env:Z}=e.options,{guid:ee,forEachAsync:te,replaceAll:re,splitAndTrim:ne,findIndexByProp:ie,findItemByProp:se,which:ae,isArrowFunc:oe,isASyncFunc:le,sieve:ce,deepMerge:ue,getLoadedScript:fe,b64EncodeUnicode:pe,b64DecodeUnicode:me}=e.utils,{$$static:de,$$abstract:he,$$virtual:ye,$$override:ge,$$sealed:be,$$private:ve,$$privateSet:we,$$protected:xe,$$protectedSet:Oe,$$readonly:Ie,$$async:Ae,$$overload:$e,$$enumerate:ke,$$dispose:je,$$post:Te,$$on:Ne,$$timer:Pe,$$type:Se,$$args:Ce,$$inject:De,$$resource:Ee,$$asset:Fe,$$singleton:ze,$$serialize:Me,$$deprecate:Re,$$session:Ue,$$state:We,$$conditional:qe,$$noserialize:_e,$$ns:Le}=c,Be=Z.isServer||Z.isWorker?null:(!0).document,Ve=l.context.current().name,Ge=t,Je=Ge.substr(0,Ge.lastIndexOf("/")+1);l.loadPathOf("flair",Je);let He=JSON.parse('{"bootEngine":"flair.app.BootEngine"}'),Xe=e.Port("settingsReader");if("function"==typeof Xe){let e=Xe("flair");e&&(He=ue([He,e],!1))}He=Object.freeze(He);let Ke=JSON.parse("{}");return Ke=Object.freeze(Ke),l.context.current().currentAssemblyBeingLoaded("./flair{.min}.js"),c("abstract"),c("ns","(root)"),r("Aspect",function(){c("virtual"),this.before=X,c("virtual"),this.around=X,c("virtual"),this.after=X}),c("abstract"),c("ns","(root)"),r("Attribute",function(){c("virtual"),this.construct=(e=>{this.args=e}),c("readonly"),this.args=[],c("readonly"),this.constraints="",c("virtual"),this.decorateProperty=X,c("virtual"),this.decorateFunction=X,c("virtual"),this.decorateEvent=X}),c("ns","(root)"),s("IDisposable",function(){this.dispose=X}),c("ns","(root)"),s("IProgressReporter",function(){this.progress=K}),(()=>{const{IProgressReporter:e,IDisposable:t}=U();c("ns","(root)"),r("Task",[e,t],function(){let e=!1,t=!1,r=l.context.current().name;this.construct=((...e)=>{this.args=e,this.context=l.contexts(r),this.domain=this.context.domain}),c("abstract"),this.dispose=X,c("protected"),this.args=[],c("protected"),this.context=null,c("protected"),this.domain=null,this.run=(async(...r)=>{if(t)throw G.InvalidOperation("Task is already running",this.run);if(t=!0,!e)try{await this.setup(),e=!0}catch(e){throw t=!1,e}try{let e;return await this.onRun(...r)}catch(e){throw e}finally{t=!1}}),this.progress=Q(e=>({data:e})),c("virtual"),c("protected"),c("async"),this.setup=J,c("abstract"),c("protected"),c("async"),this.onRun=X})})(),l.context.current().currentAssemblyBeingLoaded(""),l.registerAdo('{"name":"flair","file":"./flair{.min}.js","mainAssembly":"flair","desc":"True Object Oriented JavaScript","title":"Flair.js","version":"0.8.47","lupdate":"Tue, 21 May 2019 02:01:06 GMT","builder":{"name":"flairBuild","version":"1","format":"fasm","formatVersion":"1","contains":["init","func","type","vars","reso","asst","rout","sreg"]},"copyright":"(c) 2017-2019 Vikas Burman","license":"MIT","types":["Aspect","Attribute","IDisposable","IProgressReporter","Task"],"resources":[],"assets":[],"routes":[]}'),"function"==typeof onLoadComplete&&onLoadComplete(),Object.freeze({name:"flair",settings:He,config:Ke})});let St=se("[flair]");return u=St.settings(),f=St.config(),Object.freeze(m)});