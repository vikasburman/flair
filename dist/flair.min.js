/**
 * @preserve
 * FlairJS
 * True Object Oriented JavaScript
 * 
 * Assembly: flair
 *     File: ./flair.js
 *  Version: 0.15.140
 *  Wed, 20 Feb 2019 00:01:16 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * Licensed under MIT
 */
!function(e,n){"use strict";"function"==typeof define&&define.amd?define(n):"object"==typeof exports?(void 0!==module&&module.exports&&(exports=module.exports=n()),module.exports=exports=n()):e.flair=n()}(this,function(){"use strict";let e=new Function("try {return this===global;}catch(e){return false;}")(),n=!0,t={},r=[],i=[],s={},a="";if(e){let e=process.argv.findIndex(e=>{return!!e.startsWith("--flairSymbols")});e!==-1&&(a=process.argv[e].substr(2).split("=")[1])}else a="undefined"!=typeof(!0).flairSymbols?(!0).flairSymbols:"";a&&(r=a.split(",").map(e=>e.trim())),s.symbols=Object.freeze(r),s.env=Object.freeze({type:e?"server":"client",global:n,isTesting:r.indexOf("TEST")!==-1,isServer:e,isClient:!e,isCordova:!e&&!!(!0).cordova,isNodeWebkit:e&&process.versions["node-webkit"],isProd:r.indexOf("DEBUG")===-1&&r.indexOf("PROD")!==-1,isDebug:r.indexOf("DEBUG")!==-1}),t.info=Object.freeze({name:"<title>",version:"<version>",copyright:"<copyright>",license:"<license>",link:"<link>",lupdate:new Date("<datetime>")}),t.members=[],t.options=Object.freeze(s);const o=(e,n,r)=>{t[e]=Object.freeze(n),t.members.push(e),"function"==typeof r&&i.push(r)},u=()=>{};o("noop",u);const c=()=>{return"_xxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx".replace(/[xy]/g,e=>{var n=16*Math.random()|0,t="x"==e?n:3&n|8;return t.toString(16)})},f=(e,n)=>{if(n){if(e.indexOf("{.min}")!==-1)return t.options.env.isProd?e.replace("{.min}",".min"):e.replace("{.min}","")}else if(e.indexOf("|")!==-1){let n=e.split("|"),r="";return r=t.options.env.isServer?n[0].trim():n[1].trim(),"x"===r&&(r=""),r}return e},l=e=>{return!e.hasOwnProperty("prototype")},p=(e,n,t)=>{return e.findIndex(e=>{return e[n]===t})},m=(e,n,t)=>{let r=e.findIndex(e=>{return e[n]===t});return r!==-1?e[r]:null},d=e=>{return e.split(",").map(e=>{return e.trim()})},y=e=>{return e.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1")},g=(e,n,t)=>{return e.replace(new RegExp(y(n),"g"),t)},h=(e,n,t,r)=>{r||(r=[]);for(let i in n)if(n.hasOwnProperty(i)&&r.indexOf(i)===-1){if(!t&&i in e)continue;e[i]=n[i]}return e},b=n=>{return new Promise((t,r)=>{let i=n.substr(n.lastIndexOf(".")+1).toLowerCase();if(e)try{let e=null,s="";e=n.startsWith("https")?require("https"):require("http"),e.get(n,e=>{e.on("data",e=>{s+=e}),e.on("end",()=>{t("json"===i?JSON.parse(s):s)})}).on("error",r)}catch(e){r(e)}else fetch(n).then(e=>{200!==e.status?r(e.status):"json"===i?e.json().then(t).catch(r):t(e.text())}).catch(r)})},w=n=>{return new Promise((r,i)=>{if(e)try{r(require(n))}catch(e){i(e)}else{let e=n.substr(n.lastIndexOf(".")+1).toLowerCase();try{if("undefined"!=typeof require)require([n],r,i);else{let s=t.options.env.global.document.createElement("script");"mjs"===e?s.type="module":s.type="text/javascript",s.name=n,s.src=n,s.onload=r,s.onerror=i,t.options.env.global.document.head.appendChild(s)}}catch(e){i(e)}}})},v=(e,n,t,r)=>{let i=n?d(n):Object.keys(e);const s=n=>{let s={};if(i.length>0)for(let a of i)s[a]=n[a];else for(let a in e)e.hasOwnProperty(a)&&(s[a]=e[a]);if(r)for(let a in r)s[a]=r[a];return t&&(s=Object.freeze(s)),s};if(Array.isArray(e)){let n=[];for(let t of e)n.push(s(t));return n}return s(e)},_=function(e,n,t){let r=Error();switch(typeof e){case"string":switch(r.name=e,typeof n){case"string":r.message=n,r.error="object"==typeof t?t:null;break;case"object":r.message=n.message||"",r.error=n}break;case"object":r.name=e.name||"Unknown",r.message=e.message||"",r.error=e}return r.name=r.name||"Undefined",r.name.endsWith("Exception")||(r.name+="Exception"),Object.freeze(r)};_.InvalidArgument=(e=>{return new _("InvalidArgument",`Argument type is invalid. (${e})`)}),o("Exception",_);const x=function(){let e={};this.add=((n,t)=>{if("string"!=typeof name)throw new _("InvalidArgument","Argument type is invalid. (event)");if("function"!=typeof t)throw new _("InvalidArgument","Argument type is invalid. (handler)");e[n]||(e[name]=[]),e[name].push(t)}),this.remove=((n,t)=>{if("string"!=typeof name)throw new _("InvalidArgument","Argument type is invalid. (event)");if("function"!=typeof t)throw new _("InvalidArgument","Argument type is invalid. (handler)");if(e[n]){let r=e[n].indexOf(t);r!==-1&&e[n].splice(r,1)}}),this.dispatch=((n,t)=>{e[n]&&e[n].forEach(e=>{setTimeout(()=>{e({name:n,args:t})},0)})}),this.count=(n=>{return e[n]?e[n].length:0}),this.clear=(()=>{e={}})},I=(e,n,t)=>{if(!M(e,"flair"))throw new _.InvalidArgument("obj");let r=["class","struct","interface","mixin","enum"].indexOf(T(e)!==-1);r&&n&&(t=n,n=""),r||"construct"!==n||(n="_construct");let i=[],s=r?"type":"members";if(t){let r=e._.attrs[s].probe(t,n).anywhere();r&&i.push(v(r,"name, isCustom, args, type",!0))}else{let t=e._.attrs[s].all(n).anywhere();t&&i.push(...v(t,"name, isCustom, args, type",!0))}return i};o("getAttr",I);const A=e=>{if(!e)throw new _("InvalidArgument","Argument type is invalid. (obj)");return"string"==typeof e?ue.get(e):e._&&"function"==typeof e._.assembly?e._.assembly():e._&&e._.Type?e._.Type._.assembly():null};o("getAssembly",A);let O={};const k={register:(e,n,t,r,i)=>{if(O[e])throw new _("AlreadyRegistered","Resource is already registered");let s=S("Resource");O[e]=new s(e,n,t,r,i)},get:e=>{return O[e]||null}};o("Resource",k,()=>{O={}});const j=e=>{if("string"!=typeof e)throw new _("InvalidArgument","Argument type is invalid. (name)");return k.get(e)};o("getResource",j);const S=e=>{if("string"!=typeof e)throw new _("InvalidArgument","Argument type is invalid. (name)");return le.getType(e)};o("getType",S);const T=e=>{let n="";return"undefined"==typeof e&&(n="undefined"),n||null!==e||(n="null"),n||"number"!=typeof e||isFinite(e)!==!1||(n="infinity"),!n&&Array.isArray(e)&&(n="array"),!n&&e instanceof Date&&(n="date"),!n&&e._&&e._.type&&(n=e._.type),n||(n=typeof e),n};o("typeOf",T);const N=e=>{return e._&&e._.Type?e._.Type:null};o("getTypeOf",N);const $=(e,n)=>{if("class"!==T(e))throw new _("InvalidArgument","Argument type is invalid. (type)");if(["string","class"].indexOf(T(n))===-1)throw new _("InvalidArgument","Argument type is invalid. (parent)");return e._.isDerivedFrom(n)};o("isDerivedFrom",$);const P=(e,n)=>{let t=T(e),r=T(n),i=!1;if(["instance","sinstance"].indexOf(t)===-1)throw new _("InvalidArgument","Argument type is invalid. (obj)");if(["string","class","interface","struct","mixin"].indexOf(r)===-1)throw new _("InvalidArgument","Argument type is invalid. (type)");switch(r){case"class":case"struct":i=e._.isInstanceOf(n);break;case"interface":i=e._.isImplements(n);break;case"mixin":i=e._.isMixed(n);break;case"string":i=e._.isInstanceOf(n),i||"function"!=typeof e._.isImplements||(i=e._.isImplements(n)),i||"function"!=typeof e._.isMixed||(i=e._.isMixed(n))}return i};o("isInstanceOf",P);const z=(e,n)=>{return M(e,n)?e:null};o("as",z);const M=(e,n)=>{if(n._&&n._.name&&(n=n._.name),"string"!==T(n))throw new _("InvalidArgument","Argument type is invalid. (type)");let t=!1,r="";return"undefined"===n&&(t="undefined"==typeof e),t||"null"!==n||(t=null===e),t||"NaN"!==n||(t=isNaN(e)),t||"infinity"!==n||(t="number"==typeof e&&isFinite(e)===!1),t||"array"!==n&&"Array"!==n||(t=Array.isArray(e)),t||"date"!==n&&"Date"!==n||(t=e instanceof Date),!t&&"flair"===n&&e._&&e._.type&&(t=!0),t||(t=typeof e===n),t||e._&&e._.type&&(r=e._.type,t=r===n),!t&&r&&["instance","sinstance"].indexOf(r)!==-1&&(t=P(e,n)),t};o("is",M);const E=(e,n)=>{if(!e)throw new _("InvalidArgument","Argument type is invalid. (obj)");if("interface"!==T(n))throw new _("InvalidArgument","Argument type is invalid. (intf)");let t=!0;for(let r in n)if(n.hasOwnProperty(r)&&"_"!==r&&typeof e[r]!=typeof n[r]){t=!1;break}return t};o("isComplies",E);const C=(e,n)=>{if(["instance","class","sinstance","struct"].indexOf(T(e))===-1)throw new _("InvalidArgument","Argument type is invalid. (obj)");if(["string","interface"].indexOf(T(n))===-1)throw new _("InvalidArgument","Argument type is invalid. (intf)");return e._.isImplements(n)};o("isImplements",C);const D=(e,n)=>{if(["instance","class","sinstance","struct"].indexOf(T(e))===-1)throw new _("InvalidArgument","Argument type is invalid. (obj)");if(["string","mixin"].indexOf(T(n))===-1)throw new _("InvalidArgument","Argument type is invalid. (mixin)");return e._.isMixed(n)};o("isMixed",D);const L=[],W=(e,n)=>{if(["string","array"].indexOf(T(e))===-1)throw new _("InvalidArgument","Argument type is invalid. (deps)");if("function"!=typeof n)throw new _("InvalidArgument","Argument type is invalid. (fn)");Array.isArray(e)||(e=[e]);let t=[],r=e.slice(),i=()=>{n(...t)},s=()=>{if(0===r.length)return void i();{let e=r.shift().trim(),n=null;e=f(e);let i=t=>{if(e.startsWith("[")&&e.endsWith("]")&&e.indexOf(".")===-1){let t=e.substr(1,e.length-2).trim();n=de.resolve(t,!1),"string"==typeof n&&(e=n,n=null)}t()},a=t=>{n=S(e),t()},o=t=>{let r=A(e);r?r.isLoaded()?(n=S(e),t()):r.load().then(()=>{n=S(e),t()}).catch(e=>{throw new _("AssemblyLoad",`Assembly load operation failed with error: ${e}. (${r.file})`)}):t()},u=t=>{let r=e.substr(e.lastIndexOf(".")+1).toLowerCase();r?"js"===r||"mjs"===r?(e=f(e,!0),t()):b(e).then(e=>{n=e,t()}).catch(n=>{throw new _("FileLoad",`File load failed. (${e})`,n)}):t()},c=t=>{w(e).then(e=>{n=e,t()}).catch(n=>{throw new _("ModuleLoad",`Module load operation failed. (${e})`,n)})},l=e=>{t.push(n),e||L.pop(),s()};if(""===e)return void l(!0);if(L.indexOf(e)!==-1)throw new _("CircularDependency",`Circular dependency identified. (${e})`);L.push(e),i(()=>{n?l():a(()=>{n?l():o(()=>{n?l():u(()=>{n?l():c(()=>{if(!n)throw new _("DependencyResolution",`Failed to resolve dependency. ${e}`);l()})})})})})}};s()};o("include",W,()=>{L.length=0});const F=e=>{if("boolean"==typeof e&&e===!0)i.forEach(e=>{e()}),i.length=0;else{if("instance"!==T(e))throw new _("InvalidArgument","Argument type is invalid. (obj)");e._.dispose()}};o("dispose",F);const R=(e,n)=>{if("instance"!==T(e))throw new _("InvalidArgument","Argument type is invalid. (obj)");if("function"!==T(n))throw new _("InvalidArgument","Argument type is invalid. (fn)");let t=null,r=!1,i=!1,s=()=>{r||"function"!=typeof e._.dispose||(r=!0,e._.dispose())};try{t=n(e),t&&"function"==typeof t.finally&&(i=!0,t=t.finally(e=>{return s(),e}))}finally{i||s()}return t};o("using",R);const U=(...e)=>{if(0===e.length)throw new _("InvalidArgument","Argument must be defined. (patterns)");let n=(...n)=>{let t=null,r=null,i="",s="",a=-1,o=-1,u=!1,c=0,f={raw:n||[],index:-1,isInvalid:!1,error:null,values:{}};if(e)for(let l of e){a++,o=-1,u=!1,c=0,t=l.split(",");for(let e of t){if(o++,r=e.split(":"),2!==r.length?(i=`_${a}_${o}`,s=e.trim()||""):(i=r[0].trim()||"",s=r[1].trim()||""),o>f.raw.length){u=!1;break}if(!M(f.raw[o],s)){u=!1;break}f.values[i]=f.raw[o],u=!0,c++}if(u&&c===t.length){f.index=a;break}}return f.isInvalid=f.index===-1,f.error=f.isInvalid?new _("InvalidArguments","One or more argument types are invalid."):null,f};return Object.freeze(n)};o("Args",U);const q=(e,...n)=>{if(!e||["string","class"].indexOf(T(e))===-1)throw new _("InvalidArgument","Argument type is invalid. (name)");if(e&&"string"!=typeof e&&!$(e,"Attribute"))throw new _("InvalidArgument","Argument type is invalid. (name)");let t=null,r=null,i=null;if("string"==typeof e){if(i=B._.inbuilt[e]||null,!i){if(t=S(e),!t)throw new _("NotFound",`Attribute is not found. (${e})`);e=t._.name}}else t=e,e=t._.name;if(p(B._.bucket,"name",e)!==-1)throw new _("Duplicate",`Duplicate attributes are not allowed. (${e})`);t&&(r=new t(...n),i=new J(r.constraints)),B._.bucket.push({name:e,cfg:i,isCustom:null!==r,attr:r,args:n})},J=function(e,n){if("string"==typeof e&&(n=e,e=!1),"string"!=typeof n)throw new _.InvalidArgument("constraints");let t={isModifier:e,constraints:n};return t},B=(e,...n)=>{return q(e,...n)};B._=Object.freeze({bucket:[],inbuilt:Object.freeze({static:new J(!0,"((class || struct) && !$abstract) || (((class || struct) && (prop || func)) && !($abstract || $virtual || $override))"),abstract:new J(!0,"((class || struct) && !$sealed && !$static) || (((class || struct) && (prop || func || event)) && !($override || $sealed || $static))"),virtual:new J(!0,"(class || struct) && (prop || func || construct || dispose || event) && !($abstract || $override || $sealed || $static)"),override:new J(!0,"(class || struct) && (prop || func || construct || dispose || event) && ((@virtual || @abstract) && !(virtual || abstract)) && !($sealed || $static))"),sealed:new J(!0,"(class || ((class && (prop || func || event)) && override))"),private:new J(!0,"(class || struct) && (prop || func || event) && !($protected || @private || $static)"),protected:new J(!0,"(class || struct) && (prop || func || event) && !($private|| $static)"),readonly:new J(!0,"(class || struct) && prop && !abstract"),async:new J(!0,"(class || struct) && func"),enumerate:new J("(class || struct) && prop || func || event"),dispose:new J("class && prop"),post:new J("(class || struct || mixin) && event"),on:new J("class && func && !(event || $async || $args || $inject || $static)"),timer:new J("class && func && !(event || $async || $args || $inject || @timer || $static)"),type:new J("(class || struct || mixin) && prop"),args:new J("(class || struct || mixin) && (func || construct) && !$on"),inject:new J("class && (prop || func || construct) && !(static || session || state)"),singleton:new J("(class && !(prop || func || event) && !($abstract || $static)"),serialize:new J("((class || struct) || ((class || struct) && prop)) && !($abstract || $static)"),deprecate:new J("!construct && !dispose"),session:new J("(class && prop) && !($static || $state || $readonly || $abstract || $virtual)"),state:new J("(class && prop) && !($static || $session || $readonly || $abstract || $virtual)"),conditional:new J("(class || struct || mixin) && (prop || func || event)"),noserialize:new J("(class || struct || mixin) && prop"),ns:new J("(class || struct || mixin || interface || enum) && !(prop || func || event || construct || dispose)"),mixin:new J("class && (prop || func || event)"),interface:new J("class && (prop || func || event)")})}),B.collect=(()=>{let e=B._.bucket.slice();return B.clear(),e}),B.has=(e=>{return B._.bucket.findIndex(n=>n.name===e)!==-1}),B.get=(e=>{let n=B._.bucket.findIndex(n=>n.name===e);return n!==-1?B._.bucket[n]:null}),B.clear=(()=>{B._.bucket.length=0}),o("attr",q),o("$$",q);const V=(e,n,t,r)=>{let i=B.collect(),s=null,a=null,o=G(!0,e,n),u=G(!1,e,n);r?(s=n.attrs.type,a=n.modifiers.type):(s=e.attrs.members[t]=[],a=e.modifiers.members[t]=[]);const c=i=>{let s=!1,a=["class","struct","enum","interface","mixin"],c=["prop","func","construct","dispose","event"],f=["static","abstract","sealed","virtual","override","private","protected","readonly","async"],l=[],p=[],m=[],d=i.cfg.constraints;const y=e=>{let n={withWhat:"",matchType:"",original:e,name:"",value:!1};switch(e.substr(0,1)){case"$":n.matchType="anywhere",n.name=e.substr(1);break;case"@":n.matchType="inherited",n.name=e.substr(1);break;default:n.matchType="current",n.name=e}e.endsWith("^")?(n.withWhat="typeName",n.name=n.name.replace("^","")):a.indexOf(n.name)!==-1?(n.withWhat="typeType",n.matchType="current"):c.indexOf(n.name)!==-1?(n.withWhat="memberType",n.matchType="current"):f.indexOf(n.name)!==0-1?n.withWhat="modifier":n.withWhat="attribute","struct"===n.name?p.push(n):l.push(n)},h=()=>{let e=new RegExp("[^!&!|()]","g"),n="",t=0;for(;!0;){n=e.exec(d);{if(null===n)break;m.push(n)}}n="",t=0;for(let r of m)t++," "!==r[0]?(n+=r[0],t===m.length&&(""!==n&&y(n),n="")):(""!==n&&y(n),n="");l=l.concat(p)};h();for(let b of l){switch(b.withWhat){case"typeName":switch(b.matchType){case"anywhere":b.value=b.name===n.name||n.Type._.isDerivedFrom(b.name);break;case"inherited":b.value=n.Type._.isDerivedFrom(b.name);break;case"current":b.value=b.name===n.name}break;case"typeType":b.value=n.type===b.name;break;case"memberType":r?b.value=!1:b.value=e.members[t]===b.name;break;case"modifier":r?b.value=!!o.type.probe(b.name)[b.matchType]():b.value=!!o.members.probe(b.name,t)[b.matchType]();break;case"attribute":r?b.value=!!u.type.probe(b.name)[b.matchType]():b.value=!!u.members.probe(b.name,t)[b.matchType]()}d=g(d,b.original,b.value.toString())}if(s=new Function("try {return ("+d+");}catch(e){return false;}")(),!s)throw new _("InvalidOperation",`${i.cfg.isModifier?"Modifier":"Attribute"} ${i.name} could not be applied. (${t})`);return s};for(let f of i)c(f)&&(f=v(f,null,!1,{type:r?n.name:e.name}),f.isCustom?s.push(f):f.cfg.isModifier?a.push(f):s.push(f))},G=(e,n,t)=>{let r=e?"modifiers":"attrs",i=(e,i,s,a)=>{let o=null;if(a)if(s){let n=t.previous();for(;!0&&null!==n&&!(o=m(n[r].type,"name",e));)n=n.previous()}else o=m(t[r].type,"name",e);else if(s){let t=n.previous();for(;!0&&null!==t&&!(o=m(t[r].members[i],"name",e));)t=t.previous()}else o=m(n[r].members[i],"name",e);return o},s=(e,n,t,r)=>{return null!==i(e,n,t,r)};const a=(e,n)=>{let t=Object.freeze({anywhere:()=>{return i(e,n,!1,!1)||i(e,n,!0,!1)},current:()=>{return i(e,n,!1,!1)},inherited:()=>{return i(e,n,!0,!1)},only:Object.freeze({current:()=>{return i(e,n,!1,!1)&&!i(e,n,!0,!1)},inherited:()=>{return!i(e,n,!1,!1)&&i(e,n,!0,!1)}})});return t},o=e=>{let n=Object.freeze({anywhere:()=>{return i(e,null,!1,!0)||i(e,null,!0,!0)},current:()=>{return i(e,null,!1,!0)},inherited:()=>{return i(e,null,!0,!0)},only:Object.freeze({current:()=>{return i(e,null,!1,!0)&&!i(e,null,!0,!0)},inherited:()=>{return!i(e,null,!1,!0)&&i(e,null,!0,!0)}})});return n},u=e=>{let t=Object.freeze({current:()=>{return n[r].members[e].slice()},inherited:()=>{let t=[],i=null,s=n.previous();for(;!0&&null!==s;)i=m(s[r].members,"name",e),i&&t.push(...i),s=s.previous();return t},anywhere:()=>{return[...t.current(),...t.inherited()]}});return t},c=()=>{let e=Object.freeze({current:()=>{return t[r].type.slice()},inherited:()=>{let e=[],n=null,i=t.previous();for(;!0&&null!==i;)n=i[r].type.slice(),n&&e.push(...n),i=i.previous();return e},anywhere:()=>{return[...e.current(),...e.inherited()]}});return e},f={type:Object.freeze({get:(e,n)=>{return i(e,null,n,!0)},has:(e,n)=>{return s(e,null,n,!0)},all:c,probe:o}),members:{get:(e,n,t)=>{return i(e,n,t,!1)},has:(e,n,t)=>{return s(e,n,t,!1)},all:u,probe:a}};return e&&(f.members.is=((e,n)=>{let t=a(e,n);switch(e){case"static":return t.anywhere();case"abstract":return t.anywhere()&&!(a.anywhere("virtual",n)||a.anywhere("override",n));case"virtual":return t.anywhere()&&!a.anywhere("override",n);case"override":return t.anywhere()&&!a.anywhere("sealed",n);case"sealed":return t.anywhere();case"private":return t.anywhere();case"protected":return t.anywhere();case"readonly":return t.anywhere();case"async":return t.anywhere()}}),f.members.type=(e=>{let t="type"===n.level,r="";if(!t){let t=n;for(;!0&&null!==t&&!(r=t.members[e]);)t=t.previous()}return r}),f.members.isProperty=(e=>{return"prop"===f.members.type(e)}),f.members.isFunction=(e=>{return"func"===f.members.type(e)}),f.members.isEvent=(e=>{return"event"===f.members.type(e)})),f.members=Object.freeze(f.members),Object.freeze(f)},K=(n,t,r,i,a,...o)=>{let f="___flag___",p={_flagName:f};if("undefined"!=typeof i&&i===f?(p.isNeedProtected=!0,p.isTopLevelInstance=!1,p.staticInterface=a,p.args=o):(p.isNeedProtected=!1,p.isTopLevelInstance=!0,p.staticInterface=t,"undefined"!=typeof i?"undefined"!=typeof a?p.args=[i,a].concat(o):p.args=[i]:p.args=[]),n.singleton&&p.isTopLevelInstance&&t._.singleInstance())return t._.singleInstance();let m={},y=null,g=null,b="_construct",w="_dispose",v={},I=null,A={name:n.params.typeName,type:n.types.type,Type:t,level:"object",members:{},attrs:{members:{}},modifiers:{members:{}},previous:()=>{return I}},O=null,k=!1,j=null,S="Use of 'state' is not support on server. Using 'session' instead.";n.dump.push(A);const T={key:n=>{return e?!(!(!0).sessionStorage||!(!0).sessionStorage[n]):sessionStorage.key(n)},getItem:n=>{return e?(!0).sessionStorage&&(!0).sessionStorage[n]?(!0).sessionStorage[n]:null:sessionStorage.getItem(n)},setItem:(n,t)=>{e?((!0).sessionStorage||((!0).sessionStorage={}),(!0).sessionStorage[n]=t):sessionStorage.setItem(n,t)},removeItem:n=>{e?(!0).sessionStorage&&delete(!0).sessionStorage[n]:sessionStorage.removeItem(n)}},N={key:n=>{return e?(console.log(S),T.key(n)):localStorage.key(n)},getItem:n=>{return e?(console.log(S),T.getItem(n)):localStorage.getItem(n)},setItem:(n,t)=>{return e?(console.log(S),T.setItem(n,t)):void localStorage.setItem(n,t)},removeItem:n=>{return e?(console.log(S),T.removeItem(n)):void localStorage.removeItem(n)}},$=(e,n,t,r)=>{for(let i of X.members.all(n).current())if(i.isCustom){if("prop"===t){let t=i.attr.decorateProperty(A.name,n,r);if(!t.get||!t.set)throw new _("Unexpected",`${i.name} decoration result is unexpected. (${n})`);t.get=t.get.bind(e),t.set=t.set.bind(e),r=t}else{let s=null;if(s="func"===t?i.attr.decorateFunction(A.name,n,r):i.attr.decorateEvent(A.name,n,r),!s)throw new _("Unexpected",`${i.name} decoration result is unexpected. (${n})`);r=s.bind(e)}i.attr=null}return r},P=(e,n)=>{let t=null,r=[];return r=_e(A.name,e),A.aspects.members[e]=r,r.length>0&&(t=xe(n,A.name,e,r),t&&(n=t)),n},z=()=>{let e=!1,t=e=>{Object.defineProperty(m,e,Object.getOwnPropertyDescriptor(r,e))},i=Object.getOwnPropertyDescriptor(m,"_");i.enumerable=!1,Object.defineProperty(m,"_",i);for(let s in r)if(e=!1,r.hasOwnProperty(s)&&"_"!==s){if(e=!0,A.members[s]?(K.members.probe("private",s).current()&&(e=!1),e&&K.members.probe("protected",s).current()&&!p.isNeedProtected&&(e=!1)):K.members.probe("protected",s).anywhere()&&!p.isNeedProtected&&(e=!1),e&&t(s),e&&K.members.is("abstract",s))throw new _("InvalidDefinition",`Abstract member is not implemented. (${s})`);if(e){let e=X.members.probe("enumerate",s).current();if(e&&e.args[0]===!1){let e=Object.getOwnPropertyDescriptor(m,s);e.enumerable=!1,Object.defineProperty(m,s,e)}}e&&!p.isNeedProtected&&"function"==typeof r[s].subscribe&&m[s].strip(m)}p.isTopLevelInstance&&(m=h(m,n.ex.instance,!1)),p.isTopLevelInstance||(m._.def=A)},E=()=>{for(let e of A.interfaces)g=e,e.apply(O),g=null;delete A.interfaces},C=(e,t,r)=>{switch(["func","prop","event"].indexOf(t)!==-1&&e.startsWith("_")&&new _("InvalidName",`Name is not valid. (${e})`),t){case"func":if(!n.func)throw new _("InvalidOperation",`Function cannot be defined on this type. (${A.name})`);break;case"prop":if(!n.prop)throw new _("InvalidOperation",`Property cannot be defined on this type. (${A.name})`);break;case"event":if(!n.event)throw new _("InvalidOperation",`Event cannot be defined on this type. (${A.name})`);break;case"construct":if(!n.construct)throw new _("InvalidOperation",`Constructor cannot be defined on this type. (${A.name})`);t="func";break;case"dispose":if(!n.dispose)throw new _("InvalidOperation",`Dispose cannot be defined on this type. (${A.name})`);t="func"}return t},D=(e,t,i)=>{let a=!1,o=X.members.probe("conditional",e).current();if(o){let e=d(o.args[0]||[]);for(let n of e){if(n=n.toLowerCase(),"test"===n&&s.env.isTesting){a=!0;break}if("server"===n&&s.env.isServer){a=!0;break}if("client"===n&&s.env.isClient){a=!0;break}if("debug"===n&&s.env.isDebug){a=!0;break}if("prod"===n&&s.env.isProd){a=!0;break}if("cordova"===n&&s.env.isCordova){a=!0;break}if("nodewebkit"===n&&s.env.isNodeWebkit){a=!0;break}if(s.symbols.indexOf(n)!==-1){a=!0;break}}if(!a)return a}if(n.inheritance&&X.members.probe("abstract",e).current()&&(i!==u||null!==i)&&i.get&&i.get!==u)throw new _("InvalidDefinition",`Abstract member must point to noop function or a null value. (${e})`);if(n.static&&n.construct&&e===b&&0!==i.length)throw new _("InvalidDefinition",`Static constructors cannot have arguments. (construct)`);if(n.dispose&&e===w&&0!==i.length)throw new _("InvalidDefinition",`Destructor method cannot have arguments. (dispose)`);if(null===y&&"undefined"!=typeof r[e]&&!X.members.probe("mixin",e).current()&&(!n.inheritance||n.inheritance&&!X.members.probe("override",e).current()))throw new _("InvalidOperation",`Member with this name is already defined. (${e})`);if(n.inheritance&&X.members.probe("override",e).current()){if("undefined"==typeof r[e])throw new _("InvalidOperation",`Member not found to override. (${e})`);if(K.members.type(e)!==t)throw new _("InvalidOperation",`Overriding member type is invalid. (${e})`)}if(n.static&&X.members.probe("static",e).current())if("func"===t){if(l(i))throw new _("InvalidOperation",`Static functions cannot be defined as an arrow function. (${e})`)}else if("prop"===t&&i.get&&"function"==typeof i.get)throw new _("InvalidOperation",`Static properties cannot be defined with a custom getter/setter. (${e})`);if(n.storage&&X.members.probe("session",e).current()&&i.get&&"function"==typeof i.get)throw new _("InvalidOperation",`Session properties cannot be defined with a custom getter/setter. (${e})`);if(n.storage&&X.members.probe("state",e).current()){if(i.get&&"function"==typeof i.get)throw new _("InvalidOperation",`State properties cannot be defined with a custom getter/setter. (${e})`);if(!N)throw new _("NotConfigured","Port is not configured. (localStorage)")}return a},L=(e,t,i)=>{let s={get:null,set:null},a=u,o=u,c=X.members.probe("readonly",e).anywhere(),f=X.members.probe("static",e).anywhere(),l=X.members.probe("session",e).anywhere(),m=X.members.probe("state",e).anywhere(),d=X.members.probe("deprecate",e).current(),y=X.members.probe("inject",e).current(),g=X.members.probe("type",e).current(),h=null!==d,b=h?d.args[0]||`Event is marked as deprecate. (${e})`:"",w=v,x=r,I=A.name+"_"+e,O=!1,k=[];if(i.get||i.set)i.get&&"function"==typeof i.get&&(a=i.get),i.set&&"function"==typeof i.set&&(o=i.set),s.get=function(){return h&&console.log(b),a.apply(x)}.bind(x),s.set=function(n){if(h&&console.log(b),c&&!r._.constructing)throw new _("InvalidOperation",`Property is readonly. (${e})`);if(g&&g.args[0]&&!M(n,g.args[0]))throw new _("InvalidArgument","Argument type is invalid. (value)");return o.apply(x,[n])}.bind(x);else{if(n.static&&f){if(w=p.staticInterface._.props,x=p.staticInterface,g&&g.args[0]&&!M(i,g.args[0]))throw new _("InvalidArgument","Argument type is invalid. (value)");w[I]=i}else if(n.storage&&(l||m)){if(w=l?T:N,O=!0,I=r._.id+"_"+I,J(l?"session":"state",I),!w.key(I)){if(g&&g.args[0]&&!M(i,g.args[0]))throw new _("InvalidArgument","Argument type is invalid. (value)");w.setItem(I,JSON.stringify({value:i}))}}else{if(g&&g.args[0]&&!M(i,g.args[0]))throw new _("InvalidArgument","Argument type is invalid. (value)");w[I]=i}s.get=function(){return h&&console.log(b),O?JSON.parse(w.getItem(I)).value:w[I]}.bind(x),s.set=function(n){if(h&&console.log(b),c&&!f&&!r._.constructing)throw new _("InvalidOperation",`Property is readonly. (${e})`);if(g&&g.args[0]&&!M(n,g.args[0]))throw new _("InvalidArgument","Argument type is invalid. (value)");O?w.setItem(I,JSON.stringify({value:n})):w[I]=n}.bind(x)}if(y&&!f&&!O){let e=y.args[0],n=y.args.length>0?y.args[1]:[],t=y.args.length>1&&y.args[2];k=de.resolve(e,n,t),Array.isArray(k)||(k=[k]),s.set(k)}return(X.members.probe("dispose",e).anywhere()||y)&&J("prop",e),n.customAttrs&&(s=$(x,e,t,s)),s},W=(e,t,i)=>{let s=null,a=r,o=n.inheritance&&X.members.probe("override",e).current(),u=n.static&&X.members.probe("static",e).current(),c=K.members.probe("async",e).current(),f=X.members.probe("deprecate",e).current(),l=X.members.probe("inject",e).current(),m=X.members.probe("on",e).current(),d=X.members.probe("timer",e).current(),y=X.members.probe("args",e).current(),g=null!==f,h=g?f.args[0]||`Function is marked as deprecate. (${e})`:"",b=null,w=[];if(o?b=r[e].bind(a):u&&(a=p.staticInterface),l){let e=l.args[0],n=l.args.length>0?l.args[1]:[],t=l.args.length>1&&l.args[2];w=de.resolve(e,n,t),Array.isArray(w)||(w=[w])}if(s=c?function(...e){return new Promise(function(n,t){g&&console.log(h);let r=[];if(b&&r.push(b),w.length>0&&r.push(w),r.push(n),r.push(t),y&&e.attr.args.length>0){let n=U(...e.attr.args)(...e);if(n.isInvalid)throw n.error;r.push(n)}else r.concat(e);return i.apply(a,r)}.bind(a))}.bind(a):function(...e){g&&console.log(h);let n=[];if(b&&n.push(b),w.length>0&&n.push(w),y&&e.attr.args.length>0){let t=U(...e.attr.args)(...e);if(t.isInvalid)throw t.error;n.push(t)}else n.concat(e);return i.apply(a,n)}.bind(a),n.customAttrs&&(s=$(a,e,t,s)),n.aop&&(s=P(e,s)),m&&m.args.length>0&&(re(m.args[0],s),J("handler",{name:m.args[0],handler:s})),d&&d.args.length>0){let n=!1,t=setInterval(()=>{r._.constructing||n||(n=!0,r[e](),n=!1)},1e3*d.args[0]);J("timer",t)}return s},F=(e,t,i)=>{let s=null,a=null,o=null,u=null,c=n.inheritance&&X.members.probe("override",e).current(),f=X.members.probe("deprecate",e).current(),l=X.members.probe("post",e).current(),p=null!==f,m=p?f.args[0]||`Event is marked as deprecate. (${e})`:"",d=r;return j||(j=new x,J("event",j)),c&&(o=r[e]._.processor),s=function(...e){return p&&console.log(m),u=o?[o].concat(e):e,i.apply(d,u)}.bind(d),n.customAttrs&&(s=$(d,e,t,s)),a=s,s=function(...e){let n=e;"function"==typeof a&&(n=a(...e)),j.dispatch(name,n),l&&l.args.length>0&&ie(l.args[0],n)}.bind(d),s._=Object.freeze({processor:a}),s.add=(e=>{j.add(name,e)}),s.remove=(e=>{j.remove(name,e)}),s.strip=(e=>{let n=Object.freeze(h({},s,!0,["strip"]));return delete s.strip,delete e.strip,n}),s},R=(e,i,s)=>{if(i=C(e,i,s),A.members[e]=i,A.attrs.members[e]=[],A.modifiers.members[e]=[],n.aop&&(A.aspects={members:{}}),n.mixins&&null!==y&&B("mixin",y._.name),V(A,t._.def(),e,!1),D(e,i,s)){let t=null,a=n.static&&X.members.probe("static",e).current(),o=a?p.staticInterface:r;switch(i){case"func":t=W(e,i,s),Object.defineProperty(o,e,{configurable:!0,enumerable:!0,value:t});break;case"prop":t=L(e,i,s),Object.defineProperty(o,e,{configurable:!0,enumerable:!0,get:t.get,set:t.set});break;case"event":t=F(e,i,s),Object.defineProperty(r,e,{configurable:!0,enumerable:!0,value:t})}A.members[e]=t}},q=(e,n)=>{if("undefined"==typeof m[e]||K.members.type(e)!==n)throw new _("NotImplemented",`Interface member is not implemented. (${e})`);B("interface",g._.name),V(A,t._.def(),e,!1)},J=(e,n)=>{r._.disposables.push({type:e,data:n})},K=G(!0,A,t._.def()),X=G(!1,A,t._.def());if(n.inheritance){if(p.isTopLevelInstance&&K.type.probe("abstract").current())throw new _("InvalidOperation",`Cannot create instance of an abstract type. (${A.name})`);let e=t._.inherits;if(e){if(e._.isSealed()||e._.isSingleton()||e._.isStatic())throw new _("InvalidOperation",`Cannot inherit from a sealed, static or singleton type. (${e._.name})`);if(e._.type!==t._.type)throw new _("InvalidOperation",`Cannot inherit from another type family. (${e._.type})`);r=new e(p._flagName,p.staticInterface,p.args),I=r._.def,delete r._.def}}if("undefined"==typeof r._&&(r._=h({},n.mex.instance,!1),n.mixins&&(A.mixins=n.params.mixins),n.interfaces&&(A.interfaces=n.params.interfaces),n.dispose&&(r._.disposables=[])),r._.id=r._.id||c(),r._.type=n.types.instance,p.isTopLevelInstance&&(r._.Type=t,r._.isInstanceOf=(e=>{if(e._&&e._.name&&(e=e._.name),!e)throw new _("InvalidArgument","Argument type is invalid. (name)");return r._.Type._.name===e||t._.isDerivedFrom(e)}),n.mixins&&(r._.isMixed=(e=>{return r._.Type._.isMixed(e)})),n.interfaces&&(r._.isImplements=(e=>{return r._.Type._.isImplements(e)})),r._.modifiers=K,r._.attrs=X),k=!0,O=new Proxy({},{get:(e,n)=>{if("noop"===n)return u;if("event"===n){let e=e=>{if("function"!=typeof e)throw new _.InvalidArgument("fn");return e.event=!0,e};return e}return r[n]},set:(e,n,t)=>{if(k){let e="";"construct"===n?e="construct":"dispose"===n?e="dispose":"function"==typeof t?t.event===!0?(delete t.event,e="event"):e="func":e="prop",g?q(n,e,t):R(n,e,t)}else{if("function"==typeof t||"noop"===n||"event"===n)throw new _("InvalidOperation",`Redefinition of members is not allowed. (${n})`);r[n]=t}return!0}}),n.mixins){for(let e of A.mixins)y=e,e.apply(O),y=null;delete A.mixins}if(p.factory.apply(O),B.clear(),p.isTopLevelInstance&&(n.construct&&"function"==typeof r[b]&&(r._.construct=r[b],delete r[b]),n.dispose&&"function"==typeof r[w])){let e=r[w];delete r[w],r._.dispose=(()=>{for(let n of r._.disposables)switch(n.type){case"session":T.removeItem(n.data);break;case"state":N.removeItem(n.data);break;case"prop":r[n.data]=null;
break;case"event":r[n.data].clear();break;case"handler":re(n.data.name,n.data.handler,!0);break;case"timer":clearInterval(n.data)}"function"==typeof e&&e(),r._.disposables.length=0,r._.Type=null,r._.modifiers=null,r._.attrs=null,r._=null,v=null,I=null,A=null,O=null,j=null,m=null,r=null})}return z(),n.interfaces&&E(),n.construct&&p.isTopLevelInstance&&"function"==typeof m._[b]&&(m._.constructing=!0,m._[b](...p.args),delete m._.constructing),p.isTopLevelInstance&&n.singleton&&X.type.probe("singleton").current()&&(t._.singleInstance=(()=>{return m}),t._.singleInstance.clear=(()=>{t._.singleInstance=(()=>{return null})})),p.isTopLevelInstance&&(m._=Object.freeze(m._),m=Object.seal(m)),k=!1,m},X=e=>{if(e.new=e.new||!1,e.mixins=e.mixins||!1,e.interfaces=e.interfaces||!1,e.inheritance=e.inheritance||!1,e.singleton=e.singleton||!1,e.static=e.static||!1,e.func=e.func||!1,e.construct=e.construct||!1,e.dispose=e.dispose||!1,e.prop=e.prop||!1,e.storage=e.storage||!1,e.event=e.event||!1,e.aop=e.aop||!1,e.customAttrs=e.customAttrs||!1,e.types.instance=e.types.instance||"unknown",e.types.type=e.types.type||"unknown",e.mex.instance=e.mex&&e.mex.instance?e.mex.instance:{},e.mex.type=e.mex&&e.mex.type?e.mex.type:{},e.ex.instance=e.ex&&e.ex.instance?e.ex.instance:{},e.ex.type=e.ex&&e.ex.type?e.ex.type:{},e.params.typeName=e.params.typeName||"",e.params.ns="",e.params.inherits=e.params.inherits||null,e.params.mixins=[],e.params.interfaces=[],e.params.factory=e.params.factory||null,e.func||(e.construct=!1,e.dispose=!1),e.prop||(e.storage=!1),e.inheritance||(e.singleton=!1),e.func||e.prop||e.event||(e.aop=!1,e.customAttrs=!1),!e.params.typeName||e.params.typeName.indexOf(".")!==-1)throw`Type name is invalid. (${e.params.typeName})`;let n=B.get("ns"),t=n?n.args[0]:"";switch(t){case"(auto)":throw`Namespace name is invalid. (${t})`;case"(root)":break;default:if(t.startsWith(".")||t.endsWith("."))throw`Namespace name is invalid. (${t})`;e.params.typeName=t+"."+e.params.typeName,e.params.ns=t}if(e.params.mixinsAndInterfaces)for(let r of e.params.mixinsAndInterfaces)if(r._&&r._.type)switch(r._.type){case"mixin":e.params.mixins.push(r);break;case"interface":e.params.interfaces.push(r)}delete e.params.mixinsAndInterfaces;let i={};e.ex.instance=h(e.ex.instance,i,!1),e.dump=[];let s=null;s=e.new?function(n,t,...r){return K(e,s,{},n,t,...r)}:e.params.factory,s=h(s,e.ex.type,!1);let a={name:e.params.typeName,type:e.types.type,Type:s,level:"type",members:{},attrs:{type:[]},modifiers:{type:[]},previous:()=>{return s._.inherits?s._.inherits._.def():null}};const o=G(!0,null,a),f=G(!1,null,a);if(s._=h({},e.mex.type,!0),s._.name=e.params.typeName,s._.type=e.types.type,s._.id=c(),s._.namespace=null,s._.assembly=(()=>{return ue.get(s._.name)||null}),s._.inherits=null,e.inheritance&&(s._.inherits=e.params.inherits||null,s._.isAbstract=(()=>{return!!o.type.probe("abstract").current()}),s._.isSealed=(()=>{return!!o.type.probe("sealed").current()}),s._.isDerivedFrom=(n=>{if(n._&&n._.name&&(n=n._.name),"string"!=typeof n)throw new _("InvalidArgument","Argument type is invalid. (name)");let t=!1,r=e.params.inherits;if(!t)for(;!0&&null!==r;){if(r._.name===n){t=!0;break}r=r._.inherits}return t}),s._.inherits)){let e=f.type.probe("deprecate").anywhere();if(e){let n=e.args[0]||`Type is marked as deprecated. (${s._.name})`;console.log(n)}}return e.static&&(s._.isStatic=(()=>{return!!o.type.probe("static").current()}),s._.props={}),e.singleton&&(s._.isSingleton=(()=>{return!!f.type.probe("singleton").current()}),s._.singleInstance=(()=>{return null}),s._.singleInstance.clear=u),e.mixins&&(s._.mixins=e.params.mixins,s._.isMixed=(e=>{if(e._&&e._.name&&(e=e._.name),"string"!=typeof e)throw new _("InvalidArgument","Argument type is invalid. (name)");let n=!1,t=s;for(;!0&&null!==t&&!(n=m(t._.mixins,"name",e)!==-1);)t=t._.inherits;return n})),e.interfaces&&(s._.interfaces=e.params.interfaces,s._.isImplements=(e=>{if(e._&&e._.name&&(e=e._.name),"string"!=typeof e)throw new _("InvalidArgument","Argument type is invalid. (name)");let n=!1,t=s;for(;!0&&null!==t&&!(n=m(t._.interfaces,"name",e)!==-1);)t=t._.inherits;return n})),s._.isDeprecated=(()=>{return!!f.type.probe("deprecate").current()}),s._.def=(()=>{return a}),s._.modifiers=o,s._.attrs=f,V(null,a,null,!0),t&&pe(s),s._=Object.freeze(s._),s._.isStatic()?new s:Object.freeze(s)},H=(e,n,t,r)=>{let i=U("name: string, factory: function","name: string, inherits: class, factory: function","name: string, mixints: array, factory: function","name: string, inherits: class, mixints: array, factory: function")(e,n,t,r);if(i.isInvalid)throw i.error;let s={new:!0,mixins:!0,interfaces:!0,inheritance:!0,singleton:!0,static:!0,func:!0,construct:!0,dispose:!0,prop:!0,event:!0,storage:!0,aop:!0,customAttrs:!0,types:{instance:"instance",type:"class"},params:{typeName:i.values.name,inherits:i.values.inherits,mixinsAndInterfaces:i.values.mixints,factory:i.values.factory},mex:{instance:{},type:{}},ex:{instance:{},type:{}}};return X(s)};o("Class",H);const Q=(e,n)=>{let t=U("name: string, factory: function")(e,n);if(t.isInvalid)throw t.error;let r={func:!0,prop:!0,event:!0,types:{type:"interface"},params:{typeName:t.values.name,factory:t.values.factory}};return X(r)};o("Interface",Q);const Y=(e,n,t)=>{let r=U("name: string, factory: function","name: string, mixints: array, factory: function")(e,n,t);if(r.isInvalid)throw r.error;let i={new:!0,mixins:!0,interfaces:!0,static:!0,func:!0,construct:!0,prop:!0,event:!0,customAttrs:!0,types:{instance:"sinstance",type:"struct"},params:{typeName:r.values.name,mixinsAndInterfaces:r.values.mixints,factory:r.values.factory}};return X(i)};o("Struct",Y);const Z=(e,n)=>{let t=U("name: string, factory: function")(e,n);if(t.isInvalid)throw t.error;let r={prop:!0,types:{type:"enum"},params:{typeName:t.values.name,factory:t.values.factory}};return X(r)};o("Enum",Z);const ee=(e,n)=>{let t=U("name: string, factory: function")(e,n);if(t.isInvalid)throw t.error;let r={func:!0,prop:!0,event:!0,customAttrs:!0,types:{type:"mixin"},params:{typeName:t.values.name,factory:t.values.factory}};return X(r)};o("Mixin",ee);const ne=new x,te=ne.dispatch,re=(e,n,t)=>{return t?void ne.remove(e,n):void ne.add(e,n)};o("on",re,()=>{ne.clear()});const ie=(e,n)=>{te(e,n)};o("post",ie);const se={build:e?require("./flair.build.js"):null};o("cli",se);let ae={},oe={};const ue={register:(...e)=>{if(!e)throw new _("InvalidArgument","Argument type is invalid. (ados)");e.forEach(e=>{let n=new ce(e),t=n.file;if(ae[t])throw new _("DuplicateName",`Assembly is already registered. (${t})`);ae[t]=n,n.types.forEach(e=>{if(oe[e])throw new _("DuplicateName",`Type is already registered. (${e})`);oe[e]=n})})},get:e=>{if("string"!=typeof e)throw new _("InvalidArgument","Argument type if not valid. (typeName)");return oe[e]||null},all:()=>{return Object.values(ae).slice()}},ce=function(e){if("object"!=typeof e)throw _.InvalidArgument("ado");if("array"!==T(e.types)||"array"!==T(e.resources)||"array"!==T(e.assets)||"string"!=typeof e.name||"string"!=typeof e.file||""===e.file)throw _.InvalidArgument("ado");let n=!1,t={ado:e,name:e.name,file:f(e.file,!0),desc:e.desc||"",version:e.version||"",copyright:e.copyright||"",license:e.license||"",types:Object.freeze(e.types.slice()),resources:Object.freeze(e.types.slice()),settings:Object.freeze(e.settings||{}),assets:Object.freeze(e.assets.slice()),hasAssets:e.assets.length>0,isLoaded:()=>{return n},load:()=>{return new Promise((e,r)=>{return n?void e():void w(t.file).then(()=>{n=!0,e()}).catch(e=>{r(new _("ModuleLoad",`Module load operation failed. (${t.file})`,e))})})}};return Object.freeze(t)};o("Assembly",ue,()=>{ae={},oe={}});let fe={};const le={getType:e=>{return fe[e]||null}},pe=e=>{let n=e._.name,t=n.substr(0,n.lastIndexOf("."));if(["class","enum","interface","mixin","struct"].indexOf(T(e))===-1)throw new _("InvalidArgument",`Type cannot be placed in a namespace. (${n})`);if(fe[n])throw`Type (${n}) is already registered.`;fe[n]=e,e._.namespace=t};o("Namespace",le,()=>{fe={}});let me={};const de={isRegistered:e=>{if("string"!=typeof e)throw new _("InvalidArgument","Argument type is invalid. (alias)");return"undefined"!=typeof me[e]&&me[e].length>0},get:(e,n)=>{if("string"!=typeof e)throw new _("InvalidArgument","Argument type is invalid. (alias)");if("boolean"!=typeof n)throw new _("InvalidArgument","Argument type is invalid. (isAll)");return n?me[e]?me[e].slice():[]:me[e]?me[e][0]:null},register:(e,n)=>{if("string"!=typeof e)throw new _("InvalidArgument","Argument type is invalid. (alias)");if(e.indexOf(".")!==-1)throw new _("InvalidArgument","Argument type is invalid. (alias)");if(!n)throw new _("InvalidArgument","Argument type is invalid. (item)");"string"==typeof n&&(n=f(n),(n.endsWith(".js")||n.endsWith(".mjs"))&&(n=f(n,!0))),me[e]||(me[e]=[]),me[e].push(n)},resolve:(e,n,...t)=>{if("string"!=typeof e)throw new _("InvalidArgument","Argument type is invalid. (alias)");if("boolean"!=typeof n)throw new _("InvalidArgument","Argument type is invalid. (isAll)");let r=null;const i=e=>{let n=e;if("string"==typeof e)if(e.endsWith(".js")||e.endsWith(".mjs"));else{let n=S(e);n&&(e=n)}return["class","struct"].indexOf(T(e))!==-1&&(n=t?new e(...t):new e),n};return me[e]&&me[e].length>0&&(n?(r=[],me[e].forEach(e=>{r.push(i(e))})):r=i(me[e][0])),r}};o("Container",de,()=>{me={}});let ye=u,ge=[],he=500;const be={on:(e,...n)=>{ye===u&&("string"==typeof e?n.unshift(e):"function"==typeof e&&re("telemetry",e),ye=((e,t)=>{if(0===n.length||n.indexOf(e)!==-1){let n=Object.freeze({type:e,data:t});ge.push(n),ge.length>he-25&&ge.splice(0,25),ie("telemetry",n)}}))},collect:()=>{if(ye!==u){let e=ge.slice();return ge.length=0,e}return[]},off:e=>{return ye!==u?("function"==typeof e&&re("telemetry",e,!0),ye=u,be.collect()):[]},isOn:()=>{return ye!==u},types:Object.freeze({RAW:"raw",EXEC:"exec",INFO:"info",INCL:"incl"})};o("telemetry",be,()=>{ge.length=0});const we=[],ve={register:(e,n)=>{if("string"!=typeof e)throw new _.InvalidArgument("pointcut");if(!M(n,"Aspect"))throw new _.InvalidArgument("Aspect");let t=e,r="",i="",s="",a="",o=null;t.indexOf(":")!==-1&&(o=t.split(":"),t=o[0].trim(),s=o[1].trim()||"*"),t.indexOf(".")!==-1?(r=t.substr(0,t.lastIndexOf(".")),i=t.substr(t.lastIndexOf(".")+1)):(r="",i=t),a=r+"/"+i+":"+s,a=g(a,".","[.]"),a=g(a,"?","."),a=g(a,"*",".*"),we.push({rex:new RegExp(a),Aspect:n})}},_e=(e,n)=>{let t=[],r="",i="",s=n.trim(),a="";return e.indexOf(".")!==-1?(r=e.substr(0,e.lastIndexOf(".")).trim(),i=e.substr(e.lastIndexOf(".")+1).trim()):(r="",i=e.trim()),a=r+"/"+i+":"+s,we.forEach(e=>{e.rex.test(a)&&t.indexOf(e.Aspect)===-1&&t.push(e.Aspect)}),t},xe=(e,n,t,r)=>{let i=[],s=[],a=[],o=null;for(let c of r)o=new c,o.before!==u&&i.push(o.before),o.around!==u&&a.push(o.around),o.after!==u&&s.push(o.after);a.length>0&&a.reverse();let f=function(...r){let o=null,u=null,c={typeName:()=>{return n},funcName:()=>{return t},error:e=>{return e&&(o=e),o},result:e=>{return"undefined"!=typeof e&&(u=e),u},args:()=>{return r},data:{}};for(let f of i)try{f(c)}catch(e){o=e}const l=e=>{for(let n of s)try{n(e)}catch(e){c.error(e)}};let p=e,m=null;for(let d of a)p=d(c,p);try{m=p(...r),m&&"function"==typeof m.then?c.result(new Promise((e,n)=>{m.then(n=>{c.result(n),l(c),e(c.result())}).catch(e=>{c.error(e),l(c),n(c.error())})})):(c.result(m),l(c))}catch(e){c.error(e)}return c.result()};return f};o("Aspects",ve,()=>{we.length=0});const Ie=(e,n)=>{let t=null,r=null,i=n?JSON.parse(e):e,s=n?null:e._.Type;const a=(e,n)=>{let t=e._.attrs,r=e._.modifiers,i=[],s=!1;for(let a in e)e.hasOwnProperty(a)&&"_"!==a&&(s=r.members.isProperty(a),s&&(s=n?!t.members.probe("noserialize",a).anywhere():t.members.probe("serialize",a).anywhere(),s&&(s=!(r.members.is("private",a)||r.members.is("protected",a)||r.members.is("static",a)||r.members.is("readonly",a)||t.members.probe("inject",a).anywhere()))),s&&i.push(a));return i};if(n){if(!i.type&&!i.data)throw _.InvalidArgument("json");if(s=S(i.type),!s)throw new _("NotRegistered",`Type is not registered. (${i.type})`);t=new s,r=s._.attrs.type.probe("serialize").anywhere()?a(t,!0):a(t,!1);for(let e of r)t[e]=i.data[e]}else{r=s._.attrs.type.probe("serialize").anywhere()?a(i,!0):a(i,!1),t={type:i._.Type._.name,data:{}};for(let e of r)t.data[e]=i[e];t=JSON.stringify(t)}return t},Ae={serialize:e=>{if(!(e&&e._&&e._.type)||["instance","sinstance"].indexOf(e._.type)===-1)throw _.InvalidArgument("instance");return Ie(e)},deserialize:e=>{if(!e||"string"!=typeof e)throw _.InvalidArgument("json");return Ie(e,!0)}};o("Serializer",Ae);const Oe=function(e){if(!e||!e._||!e._.type)throw new _.InvalidArgument("forTarget");const n=function(e){this.getType=(()=>{return e._.type}),this.getId=(()=>{return e._.id}),this.getName=(()=>{return e._.name||""}),this.getNamespace=(()=>{return e._.namespace}),this.getAssembly=(()=>{let n=n.get(e._.name);return null}),this.getTarget=(()=>{return e}),this.isInstance=(()=>{return"instance"===e._.type}),this.isClass=(()=>{return"class"===e._.type}),this.isEnum=(()=>{return"enum"===e._.type}),this.isStruct=(()=>{return"struct"===e._.type}),this.isStructInstance=(()=>{return"sinstance"===e._.type}),this.isMixin=(()=>{return"mixin"===e._.type}),this.isInterface=(()=>{return"interface"===e._.type}),this.getModifiers=(()=>{return e._.modifiers.type}),this.getAttributes=(()=>{return e._.attrs.type})},t=function(e,n,t){this.getType=(()=>{return"member"}),this.getMemberType=(()=>{return e}),this.getTarget=(()=>{return n}),this.getTargetType=(()=>{return n._.type}),this.getName=(()=>{return t}),this.getModifiers=(()=>{return n._.modifiers.members}),this.getAttributes=(()=>{return n._.attrs.members})},r=function(e,n,t,r){this.getType=(()=>{return"attribute"}),this.getName=(()=>{return n}),this.getTarget=(()=>{return r}),this.getArgs=(()=>{return t.slice()}),this.getClass=(()=>{return e?new p(e):null})},i=function(e,n){this.getType=(()=>{return"aspect"}),this.getName=(()=>{return e._.name}),this.getTarget=(()=>{return n}),this.getClass=(()=>{return e?new p(e):null})},s=function(e,n,i,s){let a=new t(e,n,i);return a.getRef=(()=>{return s}),a.getAttributes=(()=>{let e=[],t=[];for(let s of n._.instanceOf)if(s.meta[i]){t=s.meta[i];for(let a of t)e.push(new r(a.Attr,a.name,a.args,n))}return e}),a.hasAttribute=(e=>{let t=!1,r=[];for(let s of n._.instanceOf){if(s.meta[i]){r=s.meta[i];for(let n of r)if(n.name==e){t=!0;break}}if(t)break}return t}),a.getAttribute=(e=>{let t=null;for(let s of n._.instanceOf){if(s.meta[i]){let a=s.meta[i];for(let o of a)if(o.name===e){t=new r(o.Attr,o.name,o.args,n);break}}if(null!==t)break}return t}),a.isEnumerable=(()=>{return!!n[i]&&Object.getOwnPropertyDescriptor(n,i).enumerable}),a.isDeprecated=(()=>{return n._._.hasAttrEx("deprecate",i)}),a.isConditional=(()=>{return n._._.hasAttrEx("conditional",i)}),a.isOverridden=(()=>{return n._._.hasAttrEx("override",i)}),a.isOwn=(()=>{return n._.isOwnMember(i)}),a.isDerived=(()=>{return n._._.isDerivedMember(i)}),a.isPrivate=(()=>{return n._._.hasAttrEx("private",i)}),a.isProtected=(()=>{return n._._.isProtectedMember(i)}),a.isPublic=(()=>{return!a.isPrivate&&!a.isProtected}),a.isSealed=(()=>{return n._._.isSealedMember(i)}),a.isMixed=(()=>{return n._._.hasAttrEx("mixed",i)}),a.getMixin=(()=>{if(a.isMixed()){let e=a.getAttribute("mixed").getArgs()[0];return new y(e)}return null}),a.isInterfaceEnforced=(()=>{return a.getInterfaces().length>0}),a.getInterfaces=(()=>{let e=[],t=[];for(let r of n._.instanceOf)if(r.meta[i]){t=r.meta[i].interfaces;for(let s of t)e.push(new g(s,n))}return e}),a.isProp=(()=>{return"prop"===e}),a.isFunc=(()=>{return"func"===e}),a.isEvent=(()=>{return"event"===e}),a},a=function(e,n,t){let r=new s("prop",e,n,t);return r.getValue=(()=>{return e[n]}),r.setValue=(t=>{return e[n]=t}),r.getRaw=(()=>{return t}),r.isReadOnly=(()=>{return e._._.hasAttrEx("readonly",n)}),r.isSetOnce=(()=>{return e._._.hasAttrEx("readonly",n)&&e._._.hasAttrEx("once",n)}),r.isStatic=(()=>{return e._._.hasAttrEx("static",n)}),r.isSerializable=(()=>{return e._._.isSerializableMember(n)}),r},o=function(e,n,t,r){let a=new s("func",e,n,t);return a.invoke=((...t)=>{return e[n](...t)}),a.getAspects=(()=>{let t=[],r=[];for(let s of e._.instanceOf)if(s.meta[n]){r=s.meta[n].aspects;for(let a of r)t.push(new i(a,e))}return t}),a.getRaw=(()=>{return r}),a.isASync=(()=>{return e._._.hasAttrEx("async",n)}),a.isConstructor=(()=>{return"_constructor"===n}),a.isDisposer=(()=>{return"_dispose"===n}),a},u=function(e,n,t){let r=new s("event",e,n,t);return r.raise=((...e)=>{return t(...e)}),r.isSubscribed=(()=>{return t.subscribe.all().length>0}),r},c=function(e,n){let r=new t("key",e,n);return r.getValue=(()=>{return e[n]}),r},f=function(e){let t=new n(e),r=(e,n,t)=>{if(""===n&&0===t.length)return e.slice();let r=[],i=!0;for(let s of e)if("member"===s.getType()&&(""===n||s.getMemberType()===n)){if(i=!0,0!==t.length)for(let e of t)if(!s.hasAttribute(e)){i=!1;break}i&&r.push(s)}return r},i=n=>{let t=[],i=[],s=null,c=null;for(let f of e._.instanceOf){for(let r in f.meta){if(f.meta.hasOwnProperty(r)){switch(i=f.meta[r],f.meta[r].type){case"func":s=new o(e,r,f.meta[r].ref,f.meta[r].raw),t.push(s);break;case"prop":s=new a(e,r,f.meta[r].ref),t.push(s);break;case"event":s=new u(e,r,f.meta[r].argNames,f.meta[r].ref),t.push(s);break;default:throw"Unknown member type"}"undefined"!=typeof n&&r===n&&(t=[],c=s)}if(null!==c)break}if(null!==c)break}return null!==c?c:{all:(...e)=>{return r(t,"",e)},func:(...e)=>{return r(t,"func",e)},prop:(...e)=>{return r(t,"prop",e)},event:(...e)=>{return r(t,"event",e)}}};return t.getClass=(()=>{return null!==e._.inherits?new p(e._.inherits):null}),t.getFamily=(()=>{let n=[],t=e._.inherits;for(;!0&&null!==t;)n.push(new p(t)),t=t._.inherits;return n}),t.getMixins=(()=>{let e=[],n=t.getFamily();for(let r of n)e=e.concat(r.getMixins());return e}),t.getInterfaces=(()=>{let e=[],n=t.getFamily();for(let r of n)e=e.concat(r.getInterfaces());return e}),t.getMembers=((...e)=>{let n=i();return 0!==e.length?n.all(...e):n}),t.getMember=(e=>{return i(e)}),t.isSingleton=(()=>{return t.getClass().isSingleton()}),t.isInstanceOf=(n=>{return e._.isInstanceOf(n)}),t.isMixed=(n=>{return e._.isMixed(n)}),t.isImplements=(n=>{return e._.isImplements(n)}),t},l=function(e){let t=new n(e);return t.getStruct=(()=>{return null!==e._.inherits?new d(e._.inherits):null}),t.getMembers=(()=>{let n=Object.keys(e),t=n.indexOf("_");return t!==-1&&n.splice(t,1),n}),t.getMember=(n=>{return e[n]}),t.invoke=((...n)=>{return e[name](...n)}),t.isInstanceOf=(n=>{return e._.inherits._.name===n}),t},p=function(e){let t=new n(e);return t.getParent=(()=>{return null!==e._.inherits?new p(e._.inherits):null}),t.getFamily=(()=>{let n=[],t=e._.inherits;for(;!0&&null!==t;)n.push(new p(t)),t=t._.inherits;return n}),t.getMixins=(()=>{let n=[];for(let t of e._.mixins)n.push(new y(t));return n}),t.getInterfaces=(()=>{let n=[];for(let t of e._.interfaces)n.push(new g(t));return n}),t.isSingleton=(()=>{return e._.isSingleton()}),t.isSingleInstanceCreated=(()=>{return null!==e._.singleInstance()}),t.isSealed=(()=>{return e._.isSealed()}),t.isAbstract=(()=>{return e._.isAbstract()}),t.isStatic=(()=>{return e._.isStatic()}),t.isDeprecated=(()=>{return e._.isDeprecated()}),t},m=function(e){let t=new n(e);return t.getMembers=(()=>{let n=e._.keys(),t=[];for(let r of n)t.push(new c(e,r));return t}),t.getMember=(n=>{if("undefined"==typeof e[n])throw`${n} is not defined.`;return new c(e,n)}),t.getKeys=(()=>{return e._.keys()}),t.getValues=(()=>{return e._.values()}),t},d=function(e){let r=new n(e);return r.getMembers=(()=>{let n=[];for(let r in e)e.hasOwnProperty(r)&&"_"!==r&&n.push(new t(e[r].type,e,r));return n}),r.getMember=(n=>{if("undefined"==typeof e[n])throw`${n} is not defined.`;return new t(e[n].type,e,n)}),r},y=function(e){let n=new d(e);return n},g=function(e){let n=new d(e);return n};let h=null;switch(e._.type){case"instance":h=new f(e);break;case"sinstance":h=new l(e);break;case"class":h=new p(e);break;case"enum":h=new m(e);break;case"struct":h=new d(e);break;case"mixin":h=new y(e);break;case"interface":h=new g(e);break;default:throw`Unknown type ${e._.type}.`}return h};return o("Reflector",Oe),t.members=Object.freeze(t.members),Object.freeze(t)}),(()=>{const{$$,attr,Class,Struct,Enum,Interface,Mixin,Exception,Args}=flair,{Aspects,Assembly,Resource,Namespace,Container,Reflector,Serializer}=flair,{getAttr,getAssembly,getResource,getTypeOf}=flair,{getType,typeOf,as,is,isDerivedFrom,isInstanceOf,isComplies,isImplements,isMixed}=flair,{include,dispose,using,on,dispatch}=flair,{noop,telemetry}=flair,{isServer}=flair.options.env;$$("abstract"),$$("ns","(root)"),Class("Aspect",function(){$$("virtual"),this.before=this.noop,$$("virtual"),this.around=this.noop,$$("virtual"),this.after=this.noop}),$$("abstract"),$$("ns","(root)"),Class("Attribute",function(){this.construct=(e=>{this.args=e}),$$("readonly"),this.args=[],this.constraints="",$$("virtual"),this.decorateProperty=this.noop,$$("virtual"),this.decorateFunction=this.noop,$$("virtual"),this.decorateEvent=this.noop}),$$("sealed"),$$("ns","(root)"),Class("Resource",function(){const e=e=>{return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function e(n,t){return String.fromCharCode("0x"+t)}))},n=e=>{return decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))};this.construct=((e,t,r,i,s)=>{let a=s,o=i.substr(i.lastIndexOf(".")+1).toLowerCase();if(r.indexOf("utf8;")!==-1)if(isServer){let e=new Buffer(a).toString("base64");a=e.toString("utf8")}else a=n(a);else isServer&&(a=new Buffer(a).toString("base64"));this.locale=t,this.encodingType=r,this.file=i,this.type=o,this.data=a}),$$("readonly"),this.name="",$$("readonly"),this.locale="",$$("readonly"),this.locale="",$$("readonly"),this.encodingType="",$$("readonly"),this.type="",$$("readonly"),this.data=""})})();