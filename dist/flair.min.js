/**
 * @preserve
 * FlairJS
 * True Object Oriented JavaScript
 * 
 * Assembly: flair
 *     File: ./flair.js
 *  Version: 0.15.689
 *  Sun, 03 Mar 2019 01:23:05 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * Licensed under MIT
 */
!function(e,t){"use strict";"function"==typeof define&&define.amd?define(t):"object"==typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t()),module.exports=exports=t()):e.flair=t()}(this,function(){"use strict";let e=new Function("try {return this===global;}catch(e){return false;}")(),t=e?!require("worker_threads").isMainThread:"undefined"!=typeof WorkerGlobalScope,n=!!e||(!t||WorkerGlobalScope),r={},i=e?__filename:n.document.currentScript.src,s=[],a=[],o={},l=["class","enum","interface","mixin","struct"],c="";if(e){let e=process.argv;t&&(e=require("worker_threads").workerData.argv);let n=e.findIndex(e=>!!e.startsWith("--flairSymbols"));-1!==n&&(c=e[n].substr(2).split("=")[1])}else c=void 0!==n.flairSymbols?n.flairSymbols:"";c&&(s=c.split(",").map(e=>e.trim())),o.symbols=Object.freeze(s),o.env=Object.freeze({type:e?"server":"client",global:n,isTesting:-1!==s.indexOf("TEST"),isServer:e,isClient:!e,isWorker:t,isMain:!t,cores:(e?require("os").cpus().length:n.navigator.hardwareConcurrency)||4,isCordova:!e&&!!n.cordova,isNodeWebkit:e&&process.versions["node-webkit"],isProd:-1===s.indexOf("DEBUG")&&-1!==s.indexOf("PROD"),isDebug:-1!==s.indexOf("DEBUG")}),r.info=Object.freeze({name:"flair",file:i,version:"0.15.689",copyright:"(c) 2017-2019 Vikas Burman",license:"MIT",lupdate:new Date("Sun, 03 Mar 2019 01:23:05 GMT")}),r.members=[],r.options=Object.freeze(o);const u=(e,t,n)=>{r[e]=Object.freeze(t),r.members.push(e),"function"==typeof n&&a.push(n)},p=()=>{};u("noop",p);const f=function(e,t,n){let r=Error();switch(typeof e){case"string":switch(r.name=e,typeof t){case"string":r.message=t,r.error="object"==typeof n?n:null;break;case"object":r.message=t.message||"",r.error=t;break}break;case"object":r.name=e.name||"Unknown",r.message=e.message||"",r.error=e;break}return r.name=r.name||"Undefined",r.name.endsWith("Exception")||(r.name+="Exception"),Object.freeze(r)};f.InvalidArgument=(e=>new f("InvalidArgument",`Argument type is invalid. (${e})`)),u("Exception",f);const m=function(){let e={};this.add=((t,n)=>{if("string"!=typeof name)throw new f("InvalidArgument","Argument type is invalid. (event)");if("function"!=typeof n)throw new f("InvalidArgument","Argument type is invalid. (handler)");e[t]||(e[name]=[]),e[name].push(n)}),this.remove=((t,n)=>{if("string"!=typeof name)throw new f("InvalidArgument","Argument type is invalid. (event)");if("function"!=typeof n)throw new f("InvalidArgument","Argument type is invalid. (handler)");if(e[t]){let r=e[t].indexOf(n);-1!==r&&e[t].splice(r,1)}}),this.dispatch=((t,n)=>{e[t]&&e[t].forEach(e=>{setTimeout(()=>{e({name:t,args:n})},0)})}),this.count=(t=>e[t]?e[t].length:0),this.clear=(()=>{e={}})};let d={};const h=e=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");return d[e]?d[e].handler:d[e].inbuilt};h.define=((e,t,n)=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");if(t&&!Array.isArray(t))throw new f("InvalidArgument","Argument type is invalid. (members)");if(d[e])throw new f("Duplicate",`Port is already defined. (${e})`);d[e]={type:t?"object":"function",members:t||null,handler:null,inbuilt:void 0!==n?n(o.env):null}}),h.connect=((e,t)=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");if("function"!=typeof t)throw new f("InvalidArgument","Argument type is invalid. (handler)");if(!d[e])throw new f("NotFound",`Port is not defined. (${e})`);let n=t(o.env);if(typeof n!==d[e].type)throw new f("InvalidType",`Handler type is invalid. (${e})`);let r=d[e].members;if(r)for(let t of r)if(void 0===n[t])throw new f("InvalidType",`Handler interface is invalid. (${e})`);d[e].handler=n}),h.disconnect=(e=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");d[e]&&(d[e].handler=null)}),h.isDefined=(e=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");return!!d[e]}),h.isConnected=(e=>!d[e]||!d[e].handler),u("Port",h,()=>{for(let e in d)d.hasOnwProperty(e)&&(d[e].handler=null);d={}});const y=()=>"_xxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx".replace(/[xy]/g,e=>{var t=16*Math.random()|0,n;return("x"==e?t:3&t|8).toString(16)}),g=(e,t)=>{if(t){if(-1!==e.indexOf("{.min}"))return r.options.env.isProd?e.replace("{.min}",".min"):e.replace("{.min}","")}else if(-1!==e.indexOf("|")){let t=e.split("|"),n="";return"x"===(n=r.options.env.isServer?t[0].trim():t[1].trim())&&(n=""),n}return e},w=e=>!e.hasOwnProperty("prototype"),b=(e,t,n)=>e.findIndex(e=>e[t]===n),v=(e,t,n)=>{let r=e.findIndex(e=>e[t]===n);return-1!==r?e[r]:null},_=e=>e.split(",").map(e=>e.trim()),A=e=>e.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1"),x=(e,t,n)=>e.replace(new RegExp(A(t),"g"),n),I=(e,t,n,r)=>{r||(r=[]);for(let i in t)if(t.hasOwnProperty(i)&&-1===r.indexOf(i)){if(!n&&i in e)continue;e[i]=t[i]}return e},O=t=>new Promise((n,r)=>{let i=null;(i=h(e?"serverFile":"clientFile"))(t).then(n).catch(r)}),k=t=>new Promise((n,r)=>{e?h("serverModule").require(t).then(n).catch(r):h("clientModule").require(t).then(n).catch(r)}),$=(e,t,n,r)=>{let i=t?_(t):Object.keys(e);const s=t=>{let s={};if(i.length>0)for(let e of i)s[e]=t[e];else for(let t in e)e.hasOwnProperty(t)&&(s[t]=e[t]);if(r)for(let e in r)s[e]=r[e];return n&&(s=Object.freeze(s)),s};if(Array.isArray(e)){let t=[];for(let n of e)t.push(s(n));return t}return s(e)},j=e=>btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function e(t,n){return String.fromCharCode("0x"+n)})),T=e=>decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join("")),S=t=>{e?h("serverModule").undef(t):h("clientModule").undef(t)},P=function(e,t,n,r,i){let s={},a={},o={},c={},u={},p=!1,m="";this.name=e,this.domain=t,this.isUnloaded=(()=>p||t.isUnloaded()),this.unload=(()=>{if(!p){p=!0,delete i[e];for(let e in o)e.hasOwnProperty(e)&&se(o[e]);s={},c={},a={},o={},u={}}}),this.current=(()=>{if(this.isUnloaded())throw"Unloaded";return 0===r.length?n||this:r[r.length-1]}),this.registerType=(e=>{if(this.isUnloaded())throw"Unloaded";if(-1===l.indexOf(G(e)))throw new f("InvalidArgument",`Type is not valid.`);let t=e._.name,n=t.substr(0,t.lastIndexOf(".")),r=t.replace(n+".","");if(s[t])throw`Type (${t}) is already registered.`;if(a[t])throw`Already registered as resource. (${t})`;return s[t]=e,n?(u[n]||(u[n]={}),u[n][r]=e):u[r]=e,n}),this.getType=(e=>{if(this.isUnloaded())throw"Unloaded";if("string"!=typeof e)throw new f("InvalidArgument",`Argument type is not valid. (${e})`);return s[e]||null}),this.ensureType=(e=>new Promise((n,r)=>{let i=this.getType(e);if(i)n(i);else{let s=t.resolve(e);s?this.loadAssembly(s).then(()=>{(i=this.getType(e))?n(i):r()}).catch(r):r()}})),this.allTypes=(()=>{if(this.isUnloaded())throw"Unloaded";return Object.keys(s)}),this.execute=((e,t)=>new Promise((n,r)=>{this.isUnloaded()&&r("Unloaded"),e.type=e.type||"",e.typeArgs=e.typeArgs||[],e.func=e.func||"",e.args=e.args||[],e.keepAlive=void 0!==e.keepAlive&&e.keepAlive;const i=()=>new Promise((n,r)=>{let i=null;this.ensureType(e.type).then(s=>{try{i=new s(...e.typeArgs),"function"==typeof t&&Y(i,"IProgressReporter")&&i.progress.add(t),n(i)}catch(e){r(e)}}).catch(r)}),s=t=>new Promise((n,r)=>{let i=null;(i=t[e.func](...e.args))&&"function"==typeof i.then?i.then(n).catch(r):n(i)});let a=null;e.keepAlive?o[e.type]?(a=o[e.type],s(a).then(n).catch(r)):i().then(t=>{a=t,o[e.type]=a,s(a).then(n).catch(r)}).catch(r):o[e.type]?(a=o[e.type],e.func?s(a).then(n).catch(r).finally(()=>{se(a),delete o[e.type]}):(se(a),delete o[e.type],n())):i().then(e=>{s(e).then(n).catch(r).finally(()=>{se(e)})}).catch(r)})),this.namespace=(e=>(e&&"(root)"===e&&(e=""),e?Object.freeze(u[e])||null:Object.freeze(u))),this.currentAssemblyBeingLoaded=(e=>{if(this.isUnloaded())throw"Unloaded";return void 0!==e&&(m=g(e,!0)),m}),this.loadAssembly=(e=>new Promise((t,n)=>{this.isUnloaded()&&n("Unloaded"),c[e]||(r.push(this),S(e),k(e).then(()=>{r.pop(),c[e]=Object.freeze(new M(this.domain.getADO(e),this)),t()}).catch(e=>{r.pop(),n(e)}))})),this.getAssembly=(e=>{if(this.isUnloaded())throw"Unloaded";if("string"!=typeof e)throw new f("InvalidArgument",`Argument type is not valid. (${e})`);return c[e]||null}),this.allAssemblies=(()=>{if(this.isUnloaded())throw"Unloaded";return Object.keys(c)}),this.registerResource=(e=>{if(this.isUnloaded())throw"Unloaded";if("string"!=typeof e.name||""===e.name||"string"!=typeof e.encodingType||""===e.encodingType||"string"!=typeof e.file||""===e.file||"string"!=typeof e.data||""===e.data)throw f.InvalidArgument("rdo");let t=e.name.substr(0,e.name.lastIndexOf(".")),n=e.name.replace(t+".","");if(a[e.name])throw`Resource (${e.name}) is already registered.`;if(s[e.name])throw`Already registered as Type. (${e.name})`;return a[e.name]=Object.freeze(new N(e,t,this)),t?(u[t]||(u[t]={}),u[t][n]=a[e.name]):u[n]=a[e.name],t}),this.getResource=(e=>{if(this.isUnloaded())throw"Unloaded";if("string"!=typeof e)throw new f("InvalidArgument",`Argument type is not valid. (${e})`);return a[e]||null}),this.allResources=(()=>{if(this.isUnloaded())throw"Unloaded";return Object.keys(a)}),this.isBusy=(()=>!1),this.hasActiveInstances=(()=>Object.keys(o).length)},M=function(e,t){this.context=t,this.name=e.name,this.file=e.file,this.desc=e.desc,this.version=e.version,this.copyright=e.copyright,this.license=e.license,this.lupdate=e.lupdate,this.builder=e.builder.name,this.flairVersion=e.builder.version,this.format=Object.freeze({name:e.builder.format,version:e.builder.formatVersion,contains:e.builder.contains.slice()}),this.types=(()=>e.types.slice()),this.getType=(t=>{if("string"!=typeof t)throw new f("InvalidArgument",`Argument type is not valid. (${t})`);if(-1===e.types.indexOf(t))throw new f("NotFound",`Type is not available in this assembly. (${t})`);return this.context.getType(t)}),this.resources=(()=>e.resources.slice()),this.getResource=(t=>{if("string"!=typeof t)throw new f("InvalidArgument",`Argument type is not valid. (${t})`);if(-1===e.resources.indexOf(t))throw new f("NotFound",`Resource is not available in this assembly. (${t})`);return this.context.getResource(t)}),this.assets=(()=>e.assets.slice()),this.assetsRoot=this.file.replace(".js","/"),this.getAsset=(t=>{if("string"!=typeof t)throw new f("InvalidArgument",`Argument type is not valid. (${t})`);let n=t.replace("./",this.assetsRoot);if(-1===e.assets.indexOf(t))throw new f("NotFound",`Asset is not available for this assembly. (${n})`);return n})},N=function(t,n,r){if(this.context=r,this.name=t.name,this.ns=n,this.assembly=(()=>r.getAssembly(g(t.asmFile,!0))||null),this.encodingType=t.encodingType,this.file=t.file,this.type=t.file.substr(t.file.lastIndexOf(".")+1).toLowerCase(),this.data=t.data,-1!==t.encodingType.indexOf("utf8;"))if(e){let e=new Buffer(t.data).toString("base64");this.data=e.toString("utf8")}else this.data=T(t.data);else e&&(this.data=new Buffer(t.data).toString("base64"));"json"===this.type&&(this.data=Object.freeze(JSON.parse(this.data)))},C=function(t,r){let s={},a=0,o=null,l=null;const c=function(){let e="<<isServer>>"=="true",t=JSON.parse("<<ados>>"),r=null,i=null,s=null;const a=e=>{let t=e.data.func,n=null;const r=t=>{i.postMessage({data:{id:e.data.id,isComplete:!0,isError:!1,error:null,result:e.data.returnsAsIs?t:!!t}})},a=t=>{i.postMessage({data:{id:e.data.id,isComplete:!1,isError:!1,error:null,result:t}})},o=t=>{i.postMessage({data:{id:e.data.id,isComplete:!0,isError:!0,error:t?t.toString():"UnknownError",result:null}})},l=()=>{try{"alc"===e.data.obj&&"execute"===t&&e.data.args.push(e=>{a(e.args)});let i=n(...e.data.args);i&&"function"==typeof i.then?i.then(r).catch(o):r(i)}catch(e){o(e)}};switch(e.data.obj){case"ad":n=s[t],l();break;case"alc":n=s.contexts(e.data.name)[t],l();break}};if(e){r=require("./flair{.min}.js");let e=require("worker_threads").parentPort;i=e,e.once("message",e=>{(i=e.privatePort).on("message",a)})}else n.importScripts("<<file>>"),r=n.flair,(i=this).onmessage=a;s=r.AppDomain,0!==t.length&&s.registerAdo(...t)};let u=c.toString().replace("<<file>>",i);u=`(${u=(u=u.replace("<<isServer>>",e.toString())).replace("<<ados>>",JSON.stringify(t))})();`;const p=(e,t,n,r,i,o)=>new Promise((c,u)=>{let p=y();s[p]={resolve:c,reject:u,progressListener:o},a++,l.postMessage({data:{id:p,obj:e,name:t,returnsAsIs:n,func:r,args:i&&Array.isArray(i)?i:[]}})}),f=e=>{if(s[e.data.id]){let t=s[e.data.id];e.data.isComplete?(delete s[e.data.id],a--,e.data.isError?t.reject(e.data.error):t.resolve(e.data.result)):"function"==typeof progressListener&&t.progressListener&&setTimeout(()=>{t.progressListener({name:"progress",args:e.data.result})},0)}else r(e.data)};if(e){const{Worker:e,MessageChannel:t}=require("worker_threads");l=new e(u,{eval:!0,workerData:{argv:process.argv}});const n=new t;l.postMessage({privatePort:n.port1},[n.port1]),n.port2.on("error",r),n.port2.on("message",f)}else{let e=new Blob([u]),t=n.URL.createObjectURL(e,{type:"application/javascript; charset=utf-8"});(l=new n.Worker(t)).onmessage=f,l.onerror=r}this.remoteCall=p,this.close=(()=>{e&&(o.close(),l.unref()),l.terminate()}),this.isBusy=(()=>a)},z=function(e,t,n){let r=!1,i={},s=new C(n,e=>{throw new f("RemoteError",e)});this.name=e,this.isRemote=!0,this.isUnloaded=(()=>r),this.unload=(()=>{r||(r=!0,delete t[e],i={},s.remoteCall("ad","",!1,"unload").finally(()=>{s.close()}))}),this.context=Object.freeze(new U("default",this,s)),this.contexts=(e=>i[e]||null),this.createContext=(e=>new Promise((t,n)=>{("string"!=typeof e||"default"===e||i[e])&&n(f.invalidArguments("name")),s.remoteCall("ad","",!1,"createContext",[e]).then(r=>{if(r){let n=Object.freeze(new U(e,this,s));i[e]=n,t(n)}else n()}).catch(n)})),this.loadScripts=((...e)=>{if(this.isUnloaded())throw"Unloaded";return s.remoteCall("ad","",!1,"loadScripts",e)})},U=function(e,t,n){let r=!1;this.name=e,this.domain=t,this.isUnloaded=(()=>r||t.isUnloaded()),this.unload=(()=>{r||(r=!0,n.remoteCall("alc",e,!1,"unload"))}),this.execute=((t,r)=>{if(this.isUnloaded())throw"Unloaded";return n.remoteCall("alc",e,!0,"execute",[t],r)}),this.loadAssembly=(t=>{if(this.isUnloaded())throw"Unloaded";return n.remoteCall("alc",e,!1,"loadAssembly",[t])}),this.isBusy=(()=>{if(this.isUnloaded())throw"Unloaded";return n.isBusy()}),this.hasActiveInstances=(()=>{n.remoteCall("alc",e,!1,"hasActiveInstances")})},D=function(e){let t={},n={},r={},i={},s=[],a=[],o=null,l=null,c=!1;o=new P("default",this,null,s,i),l=o.unload,delete o.unload,o=Object.freeze(o),i[o.name]=o,r[e]=this,this.name=e,this.isRemote=!1,this.isUnloaded=(()=>c),this.unload=(()=>{if(!c){c=!0;for(let e in i)i.hasOwnProperty(e)&&"function"==typeof e.unload&&e.unload();l();for(let e in r)r.hasOwnProperty(e)&&e!==this&&e.unload();t={},n={},i={},r={},a=[]}}),this.createDomain=(e=>new Promise((t,n)=>{("string"!=typeof e||"default"===e||r[e])&&n(f.invalidArguments("name"));let i=Object.freeze(new z(e,r,a));r[e]=i,t(i)})),this.domains=(e=>r[e]||null),this.context=o,this.contexts=(e=>i[e]||null),this.createContext=(e=>new Promise((t,n)=>{("string"!=typeof e||"default"===e||i[e])&&n(f.invalidArguments("name"));let r=Object.freeze(new P(e,this,o,s,i));i[e]=r,t(r)})),this.registerAdo=((...e)=>{let r=!0;if(1===e.length&&"string"==typeof e[0]){let t;e=[JSON.parse(e[0])],r=!1}e.forEach(e=>{if("array"!==G(e.types)||"array"!==G(e.resources)||"array"!==G(e.assets)||"string"!=typeof e.name||"string"!=typeof e.file||""===e.file)throw f.InvalidArgument("ado");if(e.file=g(e.file,!0),t[e.file]){if(r)throw new f("DuplicateName",`Assembly is already registered. (${e.file})`)}else t[e.file]=Object.freeze(e),e.types.forEach(t=>{if(n[t])throw new f("DuplicateName",`Type is already registered. (${t})`);n[t]=e.file})}),a.push(...e)}),this.getAdo=(e=>{if("string"!=typeof e)throw new f("InvalidArgument",`Argument type is not valid. (${e})`);return t[e]||null}),this.allAdos=(()=>Object.keys(t)),this.resolve=(e=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type if not valid. (qualifiedName)");return n[e]||null}),this.allTypes=(()=>Object.keys(n)),this.loadScripts=((...e)=>new Promise((t,n)=>{try{re(e,()=>{t()})}catch(e){n(e)}}))};let E=new D("default"),R=E.unload;delete E.unload;const F=E;u("AppDomain",F,()=>{R()});const L=(e,t,n)=>{if(!Y(e,"flair"))throw new f.InvalidArgument("obj");let r=l.indexOf(-1!==G(e));r&&t&&(n=t,t=""),r||"construct"!==t||(t="_construct");let i=[],s=r?"type":"members";if(n){let r=e._.attrs[s].probe(n,t).anywhere();r&&i.push($(r,"name, isCustom, args, type",!0))}else{let n=e._.attrs[s].all(t).anywhere();n&&i.push(...$(n,"name, isCustom, args, type",!0))}return i};u("getAttr",L);const W=e=>{if(!Y(e,"flair"))throw new f("InvalidArgument","Argument type is not valid. (Type)");return e._.assembly()};u("getAssembly",W);const q=e=>{if(!Y(e,"flair"))throw new f("InvalidArgument","Argument type is not valid. (Type)");return e._.context};u("getContext",q);const B=e=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (qualifiedName)");let t=F.context.getResource(e)||null;return t?t.data:null};u("getResource",B);const J=e=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (qualifiedName)");return F.context.getType(e)};u("getType",J);const G=e=>{let t="";return void 0===e&&(t="undefined"),t||null!==e||(t="null"),t||"number"!=typeof e||!1!==isFinite(e)||(t="infinity"),!t&&Array.isArray(e)&&(t="array"),!t&&e instanceof Date&&(t="date"),!t&&e._&&e._.type&&(t=e._.type),t||(t=typeof e),t};u("typeOf",G);const V=e=>e._&&e._.Type?e._.Type:null;u("getTypeOf",V);const H=e=>F.context.namespace(e);u("ns",H);const K=(e,t)=>{if("class"!==G(e))throw new f("InvalidArgument","Argument type is invalid. (type)");if(-1===["string","class"].indexOf(G(t)))throw new f("InvalidArgument","Argument type is invalid. (parent)");return e._.isDerivedFrom(t)};u("isDerivedFrom",K);const X=(e,t)=>{let n=G(e),r=G(t),i=!1;if(-1===["instance","sinstance"].indexOf(n))throw new f("InvalidArgument","Argument type is invalid. (obj)");if(-1===["string","class","interface","struct","mixin"].indexOf(r))throw new f("InvalidArgument","Argument type is invalid. (type)");switch(r){case"class":case"struct":i=e._.isInstanceOf(t);break;case"interface":i=e._.isImplements(t);break;case"mixin":i=e._.isMixed(t);break;case"string":(i=e._.isInstanceOf(t))||"function"!=typeof e._.isImplements||(i=e._.isImplements(t)),i||"function"!=typeof e._.isMixed||(i=e._.isMixed(t));break}return i};u("isInstanceOf",X);const Q=(e,t)=>Y(e,t)?e:null;u("as",Q);const Y=(e,t)=>{if(t._&&t._.name&&(t=t._.name),"string"!==G(t))throw new f("InvalidArgument","Argument type is invalid. (type)");let n=!1,r="";return"undefined"===t&&(n=void 0===e),n||"null"!==t||(n=null===e),n||"NaN"!==t||(n=isNaN(e)),n||"infinity"!==t||(n="number"==typeof e&&!1===isFinite(e)),n||"array"!==t&&"Array"!==t||(n=Array.isArray(e)),n||"date"!==t&&"Date"!==t||(n=e instanceof Date),!n&&"flair"===t&&e._&&e._.type&&(n=!0),n||(n=typeof e===t),n||e._&&e._.type&&(n=(r=e._.type)===t),!n&&r&&-1!==["instance","sinstance"].indexOf(r)&&(n=X(e,t)),n};u("is",Y);const Z=(e,t)=>{if(!e)throw new f("InvalidArgument","Argument type is invalid. (obj)");if("interface"!==G(t))throw new f("InvalidArgument","Argument type is invalid. (intf)");let n=!0;for(let r in t)if(t.hasOwnProperty(r)&&"_"!==r&&typeof e[r]!=typeof t[r]){n=!1;break}return n};u("isComplies",Z);const ee=(e,t)=>{if(-1===["instance","class","sinstance","struct"].indexOf(G(e)))throw new f("InvalidArgument","Argument type is invalid. (obj)");if(-1===["string","interface"].indexOf(G(t)))throw new f("InvalidArgument","Argument type is invalid. (intf)");return e._.isImplements(t)};u("isImplements",ee);const te=(e,t)=>{if(-1===["instance","class","sinstance","struct"].indexOf(G(e)))throw new f("InvalidArgument","Argument type is invalid. (obj)");if(-1===["string","mixin"].indexOf(G(t)))throw new f("InvalidArgument","Argument type is invalid. (mixin)");return e._.isMixed(t)};u("isMixed",te);const ne=[],re=(e,t)=>{if(-1===["string","array"].indexOf(G(e)))throw new f("InvalidArgument","Argument type is invalid. (deps)");if("function"!=typeof t)throw new f("InvalidArgument","Argument type is invalid. (fn)");Array.isArray(e)||(e=[e]);let n=[],r=e.slice(),i=()=>{t(...n)},s=()=>{if(0!==r.length){let e=r.shift().trim(),t=null,i=n=>{if(e.startsWith("[")&&e.endsWith("]")&&-1===e.indexOf(".")){let n=e.substr(1,e.length-2).trim();"string"==typeof(t=ke.resolve(n,!1))&&(e=t,t=null)}n()},a=n=>{t=J(e),n()},o=n=>{let r=W(e);r?r.isLoaded()?(t=J(e),n()):r.load().then(()=>{t=J(e),n()}).catch(e=>{throw new f("AssemblyLoad",`Assembly load operation failed with error: ${e}. (${r.file})`)}):n()},l=n=>{let r=e.substr(e.lastIndexOf(".")+1).toLowerCase();r?"js"===r||"mjs"===r?(e=g(e,!0),n()):O(e).then(e=>{t=e,n()}).catch(t=>{throw new f("FileLoad",`File load failed. (${e})`,t)}):n()},c=n=>{k(e).then(e=>{t=e,n()}).catch(t=>{throw new f("ModuleLoad",`Module load operation failed. (${e})`,t)})},u=e=>{n.push(t),e||ne.pop(),s()};if(""===(e=g(e)))return void u(!0);if(-1!==ne.indexOf(e))throw new f("CircularDependency",`Circular dependency identified. (${e})`);ne.push(e),i(()=>{t?u():a(()=>{t?u():o(()=>{t?u():l(()=>{t?u():c(()=>{if(!t)throw new f("DependencyResolution",`Failed to resolve dependency. ${e}`);u()})})})})})}else i()};s()};u("bring",re,()=>{ne.length=0});const ie=e=>new Promise((t,n)=>{if("string"==typeof e)try{re([e],e=>{e?t(e):n()})}catch(e){n(e)}else n(new f("InvalidArgument","Argument type is invalid. (dep)"))});u("include",ie);const se=e=>{if("boolean"==typeof e&&!0===e)he(),a.forEach(e=>{e()}),a.length=0;else{if("instance"!==G(e))throw new f("InvalidArgument","Argument type is invalid. (obj)");e._.dispose()}};u("dispose",se);const ae=(e,t)=>{if(-1===["instance","string"].indexOf(G(e)))throw new f("InvalidArgument","Argument type is invalid. (obj)");if("function"!==G(t))throw new f("InvalidArgument","Argument type is invalid. (fn)");if("string"==typeof e){let t=J(e);if(!t)throw new f("InvalidArgument","Argument type is invalid. (obj)");e=new t}let n=null,r=!1,i=!1,s=()=>{r||"function"!=typeof e._.dispose||(r=!0,e._.dispose())};try{(n=t(e))&&"function"==typeof n.finally&&(i=!0,n=n.finally(e=>(s(),e)))}finally{i||s()}return n};u("using",ae);const oe=(...e)=>{if(0===e.length)throw new f("InvalidArgument","Argument must be defined. (patterns)");let t=(...t)=>{let n=null,r=null,i="",s="",a=-1,o=-1,l=!1,c=0,u={raw:t||[],index:-1,isInvalid:!1,error:null,values:{}};if(e)for(let t of e){a++,o=-1,l=!1,c=0,n=t.split(",");for(let e of n){if(o++,2!==(r=e.split(":")).length?(i=`_${a}_${o}`,s=e.trim()||""):(i=r[0].trim()||"",s=r[1].trim()||""),o>u.raw.length){l=!1;break}if(!Y(u.raw[o],s)){l=!1;break}u.values[i]=u.raw[o],l=!0,c++}if(l&&c===n.length){u.index=a;break}}return u.isInvalid=-1===u.index,u.error=u.isInvalid?new f("InvalidArguments","One or more argument types are invalid."):null,u};return Object.freeze(t)};u("Args",oe);const le=(e,...t)=>{if(!e||-1===["string","class"].indexOf(G(e)))throw new f("InvalidArgument","Argument type is invalid. (name)");if(e&&"string"!=typeof e&&!K(e,"Attribute"))throw new f("InvalidArgument","Argument type is invalid. (name)");let n=null,r=null,i=null;if("string"==typeof e){if(!(i=ue._.inbuilt[e]||null)){if(!(n=J(e)))throw new f("NotFound",`Attribute is not found. (${e})`);e=n._.name}}else e=(n=e)._.name;if(-1!==b(ue._.bucket,"name",e))throw new f("Duplicate",`Duplicate attributes are not allowed. (${e})`);n&&(r=new n(...t),i=new ce(r.constraints)),ue._.bucket.push({name:e,cfg:i,isCustom:null!==r,attr:r,args:t})},ce=function(e,t){if("string"==typeof e&&(t=e,e=!1),"string"!=typeof t)throw new f.InvalidArgument("constraints");let n;return{isModifier:e,constraints:t}},ue=(e,...t)=>le(e,...t);ue._=Object.freeze({bucket:[],inbuilt:Object.freeze({static:new ce(!0,"((class || struct) && !$abstract) || (((class || struct) && (prop || func)) && !($abstract || $virtual || $override))"),abstract:new ce(!0,"((class || struct) && !$sealed && !$static) || (((class || struct) && (prop || func || event)) && !($override || $sealed || $static))"),virtual:new ce(!0,"(class || struct) && (prop || func || construct || dispose || event) && !($abstract || $override || $sealed || $static)"),override:new ce(!0,"(class || struct) && (prop || func || construct || dispose || event) && ((@virtual || @abstract) && !(virtual || abstract)) && !($sealed || $static))"),sealed:new ce(!0,"(class || ((class && (prop || func || event)) && override))"),private:new ce(!0,"(class || struct) && (prop || func || event) && !($protected || @private || $static)"),protected:new ce(!0,"(class || struct) && (prop || func || event) && !($private|| $static)"),readonly:new ce(!0,"(class || struct) && prop && !abstract"),async:new ce(!0,"(class || struct) && func"),enumerate:new ce("(class || struct) && prop || func || event"),dispose:new ce("class && prop"),post:new ce("(class || struct || mixin) && event"),on:new ce("class && func && !(event || $async || $args || $inject || $static)"),timer:new ce("class && func && !(event || $async || $args || $inject || @timer || $static)"),type:new ce("(class || struct || mixin) && prop"),args:new ce("(class || struct || mixin) && (func || construct) && !$on"),inject:new ce("class && (prop || func || construct) && !(static || session || state)"),singleton:new ce("(class && !(prop || func || event) && !($abstract || $static)"),serialize:new ce("((class || struct) || ((class || struct) && prop)) && !($abstract || $static)"),deprecate:new ce("!construct && !dispose"),session:new ce("(class && prop) && !($static || $state || $readonly || $abstract || $virtual)"),state:new ce("(class && prop) && !($static || $session || $readonly || $abstract || $virtual)"),conditional:new ce("(class || struct || mixin) && (prop || func || event)"),noserialize:new ce("(class || struct || mixin) && prop"),ns:new ce("(class || struct || mixin || interface || enum) && !(prop || func || event || construct || dispose)"),mixin:new ce("class && (prop || func || event)"),interface:new ce("class && (prop || func || event)")})}),ue.collect=(()=>{let e=ue._.bucket.slice();return ue.clear(),e}),ue.has=(e=>-1!==ue._.bucket.findIndex(t=>t.name===e)),ue.get=(e=>{let t=ue._.bucket.findIndex(t=>t.name===e);return-1!==t?ue._.bucket[t]:null}),ue.clear=(()=>{ue._.bucket.length=0}),u("attr",le),u("$$",le);const pe=(e,t,n,r)=>{let i=ue.collect(),s=null,a=null,o=fe(!0,e,t),c=fe(!1,e,t);r?(s=t.attrs.type,a=t.modifiers.type):(s=e.attrs.members[n]=[],a=e.modifiers.members[n]=[]);const u=i=>{let s=!1,a=l,u=["prop","func","construct","dispose","event"],p=["static","abstract","sealed","virtual","override","private","protected","readonly","async"],m=[],d=[],h=[],y=i.cfg.constraints;const g=e=>{let t={withWhat:"",matchType:"",original:e,name:"",value:!1};switch(e.substr(0,1)){case"$":t.matchType="anywhere",t.name=e.substr(1);break;case"@":t.matchType="inherited",t.name=e.substr(1);break;default:t.matchType="current",t.name=e;break}e.endsWith("^")?(t.withWhat="typeName",t.name=t.name.replace("^","")):-1!==a.indexOf(t.name)?(t.withWhat="typeType",t.matchType="current"):-1!==u.indexOf(t.name)?(t.withWhat="memberType",t.matchType="current"):p.indexOf(t.name)!==0-1?t.withWhat="modifier":t.withWhat="attribute","struct"===t.name?d.push(t):m.push(t)},w=()=>{let e=new RegExp("[^!&!|()]","g"),t="",n=0;for(;1&&null!==(t=e.exec(y));)h.push(t);t="",n=0;for(let e of h)n++," "!==e[0]?(t+=e[0],n===h.length&&(""!==t&&g(t),t="")):(""!==t&&g(t),t="");m=m.concat(d)};w();for(let i of m){switch(i.withWhat){case"typeName":switch(i.matchType){case"anywhere":i.value=i.name===t.name||t.Type._.isDerivedFrom(i.name);break;case"inherited":i.value=t.Type._.isDerivedFrom(i.name);break;case"current":i.value=i.name===t.name;break}break;case"typeType":i.value=t.type===i.name;break;case"memberType":i.value=!r&&e.members[n]===i.name;break;case"modifier":i.value=r?!!o.type.probe(i.name)[i.matchType]():!!o.members.probe(i.name,n)[i.matchType]();break;case"attribute":i.value=r?!!c.type.probe(i.name)[i.matchType]():!!c.members.probe(i.name,n)[i.matchType]();break}y=x(y,i.original,i.value.toString())}if(!(s=new Function("try {return ("+y+");}catch(e){return false;}")()))throw new f("InvalidOperation",`${i.cfg.isModifier?"Modifier":"Attribute"} ${i.name} could not be applied. (${n})`);return s};for(let n of i)u(n)&&((n=$(n,null,!1,{type:r?t.name:e.name})).isCustom?s.push(n):n.cfg.isModifier?a.push(n):s.push(n))},fe=(e,t,n)=>{let r=e?"modifiers":"attrs",i=(e,i,s,a)=>{let o=null;if(a)if(s){let t=n.previous();for(;1&&null!==t&&!(o=v(t[r].type,"name",e));)t=t.previous()}else o=v(n[r].type,"name",e);else if(s){let n=t.previous();for(;1&&null!==n&&!(o=v(n[r].members[i],"name",e));)n=n.previous()}else o=v(t[r].members[i],"name",e);return o},s=(e,t,n,r)=>null!==i(e,t,n,r);const a=(e,t)=>{let n;return Object.freeze({anywhere:()=>i(e,t,!1,!1)||i(e,t,!0,!1),current:()=>i(e,t,!1,!1),inherited:()=>i(e,t,!0,!1),only:Object.freeze({current:()=>i(e,t,!1,!1)&&!i(e,t,!0,!1),inherited:()=>!i(e,t,!1,!1)&&i(e,t,!0,!1)})})},o=e=>{let t;return Object.freeze({anywhere:()=>i(e,null,!1,!0)||i(e,null,!0,!0),current:()=>i(e,null,!1,!0),inherited:()=>i(e,null,!0,!0),only:Object.freeze({current:()=>i(e,null,!1,!0)&&!i(e,null,!0,!0),inherited:()=>!i(e,null,!1,!0)&&i(e,null,!0,!0)})})},l=e=>{let n=Object.freeze({current:()=>t[r].members[e].slice(),inherited:()=>{let n=[],i=null,s=t.previous();for(;1&&null!==s;)(i=v(s[r].members,"name",e))&&n.push(...i),s=s.previous();return n},anywhere:()=>[...n.current(),...n.inherited()]});return n},c=()=>{let e=Object.freeze({current:()=>n[r].type.slice(),inherited:()=>{let e=[],t=null,i=n.previous();for(;1&&null!==i;)(t=i[r].type.slice())&&e.push(...t),i=i.previous();return e},anywhere:()=>[...e.current(),...e.inherited()]});return e},u={type:Object.freeze({get:(e,t)=>i(e,null,t,!0),has:(e,t)=>s(e,null,t,!0),all:c,probe:o}),members:{get:(e,t,n)=>i(e,t,n,!1),has:(e,t,n)=>s(e,t,n,!1),all:l,probe:a}};return e&&(u.members.is=((e,t)=>{let n=a(e,t);switch(e){case"static":return n.anywhere();case"abstract":return n.anywhere()&&!(a.anywhere("virtual",t)||a.anywhere("override",t));case"virtual":return n.anywhere()&&!a.anywhere("override",t);case"override":return n.anywhere()&&!a.anywhere("sealed",t);case"sealed":return n.anywhere();case"private":return n.anywhere();case"protected":return n.anywhere();case"readonly":return n.anywhere();case"async":return n.anywhere()}}),u.members.type=(e=>{let n,r="";if(!("type"===t.level)){let n=t;for(;1&&null!==n&&!(r=n.members[e]);)n=n.previous()}return r}),u.members.isProperty=(e=>"prop"===u.members.type(e)),u.members.isFunction=(e=>"func"===u.members.type(e)),u.members.isEvent=(e=>"event"===u.members.type(e))),u.members=Object.freeze(u.members),Object.freeze(u)},me=(e,t,n,r,i,...s)=>{let a="___flag___",l={_flagName:a};if(void 0!==r&&r===a?(l.isNeedProtected=!0,l.isTopLevelInstance=!1,l.staticInterface=i,l.args=s):(l.isNeedProtected=!1,l.isTopLevelInstance=!0,l.staticInterface=t,l.args=void 0!==r?void 0!==i?[r,i].concat(s):[r]:[]),e.singleton&&l.isTopLevelInstance&&t._.singleInstance())return t._.singleInstance();let c={},u=null,d=null,g="_construct",b="_dispose",v={},A=null,x={name:e.params.typeName,type:e.types.type,Type:t,level:"object",members:{},attrs:{members:{}},modifiers:{members:{}},previous:()=>A},O=null,k=()=>{throw new f("NotImplemented","Method is not implemented.")},$={get:()=>{throw new f("NotImplemented","Property is not implemented.")},set:()=>{throw new f("NotImplemented","Property is not implemented.")}},j=!1,T=null,S=h("sessionStorage"),P=h("localStorage");e.dump.push(x);const M=(e,t,n,r)=>{for(let i of J.members.all(t).current())if(i.isCustom){if("prop"===n){let n=i.attr.decorateProperty(x.name,t,r);if(!n.get||!n.set)throw new f("Unexpected",`${i.name} decoration result is unexpected. (${t})`);n.get=n.get.bind(e),n.set=n.set.bind(e),r=n}else{let s=null;if(!(s="func"===n?i.attr.decorateFunction(x.name,t,r):i.attr.decorateEvent(x.name,t,r)))throw new f("Unexpected",`${i.name} decoration result is unexpected. (${t})`);r=s.bind(e)}i.attr=null}return r},N=(e,t)=>{let n=null,r=[];return r=Ne(x.name,e),x.aspects.members[e]=r,r.length>0&&(n=Ce(t,x.name,e,r))&&(t=n),t},C=()=>{let t=!1,r=e=>{Object.defineProperty(c,e,Object.getOwnPropertyDescriptor(n,e))},i=Object.getOwnPropertyDescriptor(c,"_");i.enumerable=!1,Object.defineProperty(c,"_",i);for(let e in n)if(t=!1,n.hasOwnProperty(e)&&"_"!==e){if(t=!0,x.members[e]?(B.members.probe("private",e).current()&&(t=!1),t&&B.members.probe("protected",e).current()&&!l.isNeedProtected&&(t=!1)):B.members.probe("protected",e).anywhere()&&!l.isNeedProtected&&(t=!1),t&&r(e),t&&B.members.is("abstract",e))throw new f("InvalidDefinition",`Abstract member is not implemented. (${e})`);if(t){let t=J.members.probe("enumerate",e).current();if(t&&!1===t.args[0]){let t=Object.getOwnPropertyDescriptor(c,e);t.enumerable=!1,Object.defineProperty(c,e,t)}}t&&!l.isNeedProtected&&"function"==typeof n[e].subscribe&&c[e].strip(c)}l.isTopLevelInstance&&(c=I(c,e.ex.instance,!1)),l.isTopLevelInstance||(c._.def=x)},z=()=>{for(let e of x.interfaces)d=e,e.apply(O),d=null;delete x.interfaces},U=(t,n,r)=>{switch(-1!==["func","prop","event"].indexOf(n)&&t.startsWith("_")&&new f("InvalidName",`Name is not valid. (${t})`),n){case"func":if(!e.func)throw new f("InvalidOperation",`Function cannot be defined on this type. (${x.name})`);break;case"prop":if(!e.prop)throw new f("InvalidOperation",`Property cannot be defined on this type. (${x.name})`);break;case"event":if(!e.event)throw new f("InvalidOperation",`Event cannot be defined on this type. (${x.name})`);break;case"construct":if(!e.construct)throw new f("InvalidOperation",`Constructor cannot be defined on this type. (${x.name})`);n="func";break;case"dispose":if(!e.dispose)throw new f("InvalidOperation",`Dispose cannot be defined on this type. (${x.name})`);n="func";break}return n},D=(t,r,i)=>{let s=!0,a=J.members.probe("conditional",t).current();if(a){let e=_(a.args[0]||[]);for(let t of e){if("test"!==(t=t.toLowerCase())||!o.env.isTesting){s=!1;break}if("server"!==t||!o.env.isServer){s=!1;break}if("client"!==t||!o.env.isClient){s=!1;break}if("worker"!==t||!o.env.isWorker){s=!1;break}if("main"!==t||!o.env.isMain){s=!1;break}if("debug"!==t||!o.env.isDebug){s=!1;break}if("prod"!==t||!o.env.isProd){s=!1;break}if("cordova"!==t||!o.env.isCordova){s=!1;break}if("nodewebkit"!==t||!o.env.isNodeWebkit){s=!1;break}if(-1===o.symbols.indexOf(t)){s=!1;break}}if(!s)return s}if(e.inheritance&&J.members.probe("abstract",t).current()&&(i!==p||i!==k||i!==$)&&i.get&&i.get!==p)throw new f("InvalidDefinition",`Abstract member must point to this.noop, this.nip or this.nim calls. (${t})`);if(a=J.type.probe("static").current(),e.static&&e.construct&&t===g&&a&&0!==i.length)throw new f("InvalidDefinition",`Static constructors cannot have arguments. (construct)`);if(e.dispose&&t===b&&0!==i.length)throw new f("InvalidDefinition",`Destructor method cannot have arguments. (dispose)`);if(null===u&&void 0!==n[t]&&!J.members.probe("mixin",t).current()&&(!e.inheritance||e.inheritance&&!J.members.probe("override",t).current()))throw new f("InvalidOperation",`Member with this name is already defined. (${t})`);if(e.inheritance&&J.members.probe("override",t).current()){if(void 0===n[t])throw new f("InvalidOperation",`Member not found to override. (${t})`);if(B.members.type(t)!==r)throw new f("InvalidOperation",`Overriding member type is invalid. (${t})`)}if(e.static&&J.members.probe("static",t).current())if("func"===r){if(w(i))throw new f("InvalidOperation",`Static functions cannot be defined as an arrow function. (${t})`)}else if("prop"===r&&i.get&&"function"==typeof i.get)throw new f("InvalidOperation",`Static properties cannot be defined with a custom getter/setter. (${t})`);if(e.storage&&J.members.probe("session",t).current()&&i.get&&"function"==typeof i.get)throw new f("InvalidOperation",`Session properties cannot be defined with a custom getter/setter. (${t})`);if(e.storage&&J.members.probe("state",t).current()){if(i.get&&"function"==typeof i.get)throw new f("InvalidOperation",`State properties cannot be defined with a custom getter/setter. (${t})`);if(!P)throw new f("NotConfigured","Port is not configured. (localStorage)")}return s},E=(t,r,i)=>{let s={get:null,set:null},a=p,o=p,c=J.members.probe("readonly",t).anywhere(),u=e.inheritance&&J.members.probe("override",t).current(),m=J.members.probe("static",t).anywhere(),d=J.members.probe("session",t).anywhere(),h=J.members.probe("state",t).anywhere(),y=J.members.probe("deprecate",t).current(),g=J.members.probe("inject",t).current(),w=J.members.probe("type",t).current(),b=null!==y,_=b?y.args[0]||`Event is marked as deprecate. (${t})`:"",A=v,I=n,O=x.name+"_"+t,j=!1,T=[];if(u&&(i.get===p||i.get===$||i.get===k?i.set===p||i.set===$||i.get===k?i=null:i.get=p:i.set!==p&&i.set!==$&&i.get!==k||(i.set=p)),i.get||i.set)i.get&&"function"==typeof i.get&&(a=i.get),i.set&&"function"==typeof i.set&&(o=i.set),s.get=function(){return b&&console.log(_),a.apply(I)}.bind(I),s.set=function(e){if(b&&console.log(_),c&&!n._.constructing)throw new f("InvalidOperation",`Property is readonly. (${t})`);if(w&&w.args[0]&&!Y(e,w.args[0]))throw new f("InvalidArgument","Argument type is invalid. (value)");return o.apply(I,[e])}.bind(I);else{if(e.static&&m){if(A=l.staticInterface._.props,I=l.staticInterface,w&&w.args[0]&&!Y(i,w.args[0]))throw new f("InvalidArgument","Argument type is invalid. (value)");A[O]=i}else if(e.storage&&(d||h)){if(A=d?S:P,j=!0,O=n._.id+"_"+O,q(d?"session":"state",O),!A.key(O)){if(w&&w.args[0]&&!Y(i,w.args[0]))throw new f("InvalidArgument","Argument type is invalid. (value)");A.setItem(O,JSON.stringify({value:i}))}}else{if(w&&w.args[0]&&!Y(i,w.args[0]))throw new f("InvalidArgument","Argument type is invalid. (value)");A[O]=i}s.get=function(){return b&&console.log(_),j?JSON.parse(A.getItem(O)).value:A[O]}.bind(I),s.set=function(e){if(b&&console.log(_),c&&!m&&!n._.constructing)throw new f("InvalidOperation",`Property is readonly. (${t})`);if(w&&w.args[0]&&!Y(e,w.args[0]))throw new f("InvalidArgument","Argument type is invalid. (value)");j?A.setItem(O,JSON.stringify({value:e})):A[O]=e}.bind(I)}if(g&&!m&&!j){let e=g.args[0],t=g.args.length>0?g.args[1]:[],n=g.args.length>1&&g.args[2];T=ke.resolve(e,t,n),Array.isArray(T)||(T=[T]),s.set(T)}return(J.members.probe("dispose",t).anywhere()||g)&&q("prop",t),e.customAttrs&&(s=M(I,t,r,s)),s},R=(t,r,i)=>{let s=null,a=n,o=e.inheritance&&J.members.probe("override",t).current(),c=e.static&&J.members.probe("static",t).current(),u=B.members.probe("async",t).current(),f=J.members.probe("deprecate",t).current(),m=J.members.probe("inject",t).current(),d=J.members.probe("on",t).current(),h=J.members.probe("timer",t).current(),y=J.members.probe("args",t).current(),g=null!==f,w=g?f.args[0]||`Function is marked as deprecate. (${t})`:"",b=null,v=[];if(o?(b=n[t].bind(a))!==p&&b!==$&&b!==k||(b=p):c&&(a=l.staticInterface),m){let e=m.args[0],t=m.args.length>0?m.args[1]:[],n=m.args.length>1&&m.args[2];v=ke.resolve(e,t,n),Array.isArray(v)||(v=[v])}if(s=u?function(...e){return new Promise(function(t,n){g&&console.log(w);let r=[];if(b&&r.push(b),v.length>0&&r.push(v),r.push(t),r.push(n),y&&e.attr.args.length>0){let t=oe(...e.attr.args)(...e);if(t.isInvalid)throw t.error;r.push(t)}else r.concat(e);return i.apply(a,r)}.bind(a))}.bind(a):function(...e){g&&console.log(w);let t=[];if(b&&t.push(b),v.length>0&&t.push(v),y&&e.attr.args.length>0){let n=oe(...e.attr.args)(...e);if(n.isInvalid)throw n.error;t.push(n)}else t.concat(e);return i.apply(a,t)}.bind(a),e.customAttrs&&(s=M(a,t,r,s)),e.aop&&(s=N(t,s)),d&&d.args.length>0&&(xe(d.args[0],s),q("handler",{name:d.args[0],handler:s})),h&&h.args.length>0){let e=!1,r=setInterval(()=>{n._.constructing||e||(e=!0,n[t](),e=!1)},1e3*h.args[0]);q("timer",r)}return s},F=(t,r,i)=>{let s=null,a=null,o=null,l=null,c=e.inheritance&&J.members.probe("override",t).current(),u=J.members.probe("deprecate",t).current(),f=J.members.probe("post",t).current(),d=null!==u,h=d?u.args[0]||`Event is marked as deprecate. (${t})`:"",y=n;return T||(T=new m,q("event",T)),c&&((o=n[t]._.processor)!==p&&o!==$&&o!==k||(o=p)),s=function(...e){return d&&console.log(h),l=o?[o].concat(e):e,i.apply(y,l)}.bind(y),e.customAttrs&&(s=M(y,t,r,s)),a=s,(s=function(...e){let t=e;"function"==typeof a&&(t=a(...e)),T.dispatch(name,t),f&&f.args.length>0&&Ie(f.args[0],t)}.bind(y))._=Object.freeze({processor:a}),s.add=(e=>{T.add(name,e)}),s.remove=(e=>{T.remove(name,e)}),s.strip=(e=>{let t=Object.freeze(I({},s,!0,["strip"]));return delete s.strip,delete e.strip,t}),s},L=(r,i,s)=>{if(i=U(r,i,s),x.members[r]=i,x.attrs.members[r]=[],x.modifiers.members[r]=[],e.aop&&(x.aspects={members:{}}),e.mixins&&null!==u&&ue("mixin",u._.name),pe(x,t._.def(),r,!1),!D(r,i,s))return;let a=null,o,c=e.static&&J.members.probe("static",r).current()?l.staticInterface:n;switch(i){case"func":a=R(r,i,s),Object.defineProperty(c,r,{configurable:!0,enumerable:!0,value:a});break;case"prop":a=E(r,i,s),Object.defineProperty(c,r,{configurable:!0,enumerable:!0,get:a.get,set:a.set});break;case"event":a=F(r,i,s),Object.defineProperty(n,r,{configurable:!0,enumerable:!0,value:a});break}x.members[r]=a},W=(e,n)=>{if((void 0===c[e]||B.members.type(e)!==n)&&("dispose"!==e||"function"!=typeof c.dispose&&"function"!=typeof c[b]&&"function"!=typeof c._.dispose))throw new f("NotImplemented",`Interface member is not implemented. (${e})`);ue("interface",d._.name),pe(x,t._.def(),e,!1)},q=(e,t)=>{n._.disposables.push({type:e,data:t})},B=fe(!0,x,t._.def()),J=fe(!1,x,t._.def());if(e.inheritance){if(l.isTopLevelInstance&&B.type.probe("abstract").current())throw new f("InvalidOperation",`Cannot create instance of an abstract type. (${x.name})`);let e=t._.inherits;if(e){if(e._.isSealed()||e._.isSingleton()||e._.isStatic())throw new f("InvalidOperation",`Cannot inherit from a sealed, static or singleton type. (${e._.name})`);if(e._.type!==t._.type)throw new f("InvalidOperation",`Cannot inherit from another type family. (${e._.type})`);if(e._.context&&e._.context.isUnloaded())throw new f("InvalidOperation",`Parent context is not active anymore. (${e._.name})`);n=new e(l._flagName,l.staticInterface,l.args),A=n._.def,delete n._.def}else if(t._.context&&t._.context.isUnloaded())throw new f("InvalidOperation",`Type context is not active anymore. (${t._.name})`)}if(void 0===n._&&(n._=I({},e.mex.instance,!1),e.mixins&&(x.mixins=e.params.mixins),e.interfaces&&(x.interfaces=e.params.interfaces),e.dispose&&(n._.disposables=[])),n._.id=n._.id||y(),n._.type=e.types.instance,l.isTopLevelInstance&&(n._.Type=t,n._.isInstanceOf=(e=>{if(e._&&e._.name&&(e=e._.name),!e)throw new f("InvalidArgument","Argument type is invalid. (name)");return n._.Type._.name===e||t._.isDerivedFrom(e)}),e.mixins&&(n._.isMixed=(e=>n._.Type._.isMixed(e))),e.interfaces&&(n._.isImplements=(e=>n._.Type._.isImplements(e))),n._.modifiers=B,n._.attrs=J),j=!0,O=new Proxy({},{get:(e,t)=>{if("noop"===t)return p;if("nim"===t)return k;if("nip"===t)return $;if("event"===t){let e;return e=>{if("function"!=typeof e)throw new f.InvalidArgument("fn");return e.event=!0,e}}return n[t]},set:(e,t,r)=>{if(j){let e="";"construct"===t?e="construct":"dispose"===t?e="dispose":"function"==typeof r?!0===r.event?(delete r.event,e="event"):e="func":e="prop",d?W(t,e,r):L(t,e,r)}else{if("function"==typeof r||-1!==["noop","event","nim","nip"].indexOf(t))throw new f("InvalidOperation",`Redefinition of members is not allowed. (${t})`);n[t]=r}return!0}}),e.mixins){for(let e of x.mixins)u=e,e.apply(O),u=null;delete x.mixins}if(l.factory.apply(O),ue.clear(),l.isTopLevelInstance&&(e.construct&&"function"==typeof n[g]&&(n._.construct=n[g],delete n[g]),e.dispose&&"function"==typeof n[b])){let e=n[b];delete n[b],n._.dispose=(()=>{for(let e of n._.disposables)switch(e.type){case"session":S.removeItem(e.data);break;case"state":P.removeItem(e.data);break;case"prop":n[e.data]=null;break;case"event":n[e.data].clear();break;case"handler":xe(e.data.name,e.data.handler,!0);break;case"timer":clearInterval(e.data);break}"function"==typeof e&&e(),n._.disposables.length=0,n._.Type=null,n._.modifiers=null,n._.attrs=null,n._=null,v=null,A=null,x=null,O=null,T=null,c=null,n=null})}return C(),e.interfaces&&z(),e.construct&&l.isTopLevelInstance&&"function"==typeof c._[g]&&(c._.constructing=!0,c._[g](...l.args),delete c._.constructing),l.isTopLevelInstance&&e.singleton&&J.type.probe("singleton").current()&&(t._.singleInstance=(()=>c),t._.singleInstance.clear=(()=>{t._.singleInstance=(()=>null)})),l.isTopLevelInstance&&(c._=Object.freeze(c._),c=Object.seal(c)),j=!1,c},de=e=>{if(e.new=e.new||!1,e.mixins=e.mixins||!1,e.interfaces=e.interfaces||!1,e.inheritance=e.inheritance||!1,e.singleton=e.singleton||!1,e.static=e.static||!1,e.func=e.func||!1,e.construct=e.construct||!1,e.dispose=e.dispose||!1,e.prop=e.prop||!1,e.storage=e.storage||!1,e.event=e.event||!1,e.aop=e.aop||!1,e.customAttrs=e.customAttrs||!1,e.types.instance=e.types.instance||"unknown",e.types.type=e.types.type||"unknown",e.mex.instance=e.mex&&e.mex.instance?e.mex.instance:{},e.mex.type=e.mex&&e.mex.type?e.mex.type:{},e.ex.instance=e.ex&&e.ex.instance?e.ex.instance:{},e.ex.type=e.ex&&e.ex.type?e.ex.type:{},e.params.typeName=e.params.typeName||"",e.params.ns="",e.params.inherits=e.params.inherits||null,e.params.mixins=[],e.params.interfaces=[],e.params.factory=e.params.factory||null,e.func||(e.construct=!1,e.dispose=!1),e.prop||(e.storage=!1),e.inheritance||(e.singleton=!1),e.func||e.prop||e.event||(e.aop=!1,e.customAttrs=!1),!e.params.typeName||-1!==e.params.typeName.indexOf("."))throw`Type name is invalid. (${e.params.typeName})`;let t=ue.get("ns"),n=t?t.args[0]:"";switch(n){case"(auto)":throw`Namespace '(auto)' should be used only when bundling the type in an assembly. (${n})`;case"(root)":break;default:if(n.startsWith(".")||n.endsWith(".")||/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g.test(n))throw`Namespace name is invalid. (${n})`;e.params.typeName=n+"."+e.params.typeName,e.params.ns=n;break}if(e.params.mixinsAndInterfaces)for(let t of e.params.mixinsAndInterfaces)if(t._&&t._.type)switch(t._.type){case"mixin":e.params.mixins.push(t);break;case"interface":e.params.interfaces.push(t);break}delete e.params.mixinsAndInterfaces;let r={};e.ex.instance=I(e.ex.instance,r,!1),e.dump=[];let i=F.context.current(),s=i.currentAssemblyBeingLoaded()||"",a=null;a=e.new?function(t,n,...r){return me(e,a,{},t,n,...r)}:e.params.factory,a=I(a,e.ex.type,!1);let o={name:e.params.typeName,type:e.types.type,Type:a,level:"type",members:{},attrs:{type:[]},modifiers:{type:[]},previous:()=>a._.inherits?a._.inherits._.def():null};const l=fe(!0,null,o),c=fe(!1,null,o);if(a._=I({},e.mex.type,!0),a._.name=e.params.typeName,a._.type=e.types.type,a._.id=y(),a._.namespace=null,a._.assembly=(()=>i.getAssembly(s)||null),a._.context=i,a._.inherits=null,e.inheritance&&(a._.inherits=e.params.inherits||null,a._.isAbstract=(()=>!!l.type.probe("abstract").current()),a._.isSealed=(()=>!!l.type.probe("sealed").current()),a._.isDerivedFrom=(t=>{if(t._&&t._.name&&(t=t._.name),"string"!=typeof t)throw new f("InvalidArgument","Argument type is invalid. (name)");let n=!1,r=e.params.inherits;if(!n)for(;1&&null!==r;){if(r._.name===t){n=!0;break}r=r._.inherits}return n}),a._.inherits)){let e=c.type.probe("deprecate").anywhere();if(e){let t=e.args[0]||`Type is marked as deprecated. (${a._.name})`;console.log(t)}}return e.static&&(a._.isStatic=(()=>!!l.type.probe("static").current()),a._.props={}),e.singleton&&(a._.isSingleton=(()=>!!c.type.probe("singleton").current()),a._.singleInstance=(()=>null),a._.singleInstance.clear=p),e.mixins&&(a._.mixins=e.params.mixins,a._.isMixed=(e=>{if(e._&&e._.name&&(e=e._.name),"string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");let t=!1,n=a;for(;1&&null!==n&&!(t=-1!==v(n._.mixins,"name",e));)n=n._.inherits;return t})),e.interfaces&&(a._.interfaces=e.params.interfaces,a._.isImplements=(e=>{if(e._&&e._.name&&(e=e._.name),"string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");let t=!1,n=a;for(;1&&null!==n&&!(t=-1!==v(n._.interfaces,"name",e));)n=n._.inherits;return t})),a._.isDeprecated=(()=>!!c.type.probe("deprecate").current()),a._.def=(()=>o),a._.modifiers=l,a._.attrs=c,pe(null,o,null,!0),n&&(a._.namespace=F.context.current().registerType(a)),a._=Object.freeze(a._),a._.isStatic()?new a:Object.freeze(a)},he=()=>{let t=h("sessionStorage");t?t.clear():e?(!0).sessionStorage&&delete global.sessionStorage:sessionStorage.clear()},ye=(e,t,n,r)=>{let i=oe("name: string, factory: function","name: string, inherits: class, factory: function","name: string, mixints: array, factory: function","name: string, inherits: class, mixints: array, factory: function")(e,t,n,r);if(i.isInvalid)throw i.error;let s={new:!0,mixins:!0,interfaces:!0,inheritance:!0,singleton:!0,static:!0,func:!0,construct:!0,dispose:!0,prop:!0,event:!0,storage:!0,aop:!0,customAttrs:!0,types:{instance:"instance",type:"class"},params:{typeName:i.values.name,inherits:i.values.inherits,mixinsAndInterfaces:i.values.mixints,factory:i.values.factory},mex:{instance:{},type:{}},ex:{instance:{},type:{}}};return de(s)};u("Class",ye);const ge=(e,t)=>{let n=oe("name: string, factory: function")(e,t);if(n.isInvalid)throw n.error;let r={func:!0,prop:!0,event:!0,types:{type:"interface"},params:{typeName:n.values.name,factory:n.values.factory}};return de(r)};u("Interface",ge);const we=(e,t,n)=>{let r=oe("name: string, factory: function","name: string, mixints: array, factory: function")(e,t,n);if(r.isInvalid)throw r.error;let i={new:!0,mixins:!0,interfaces:!0,static:!0,func:!0,construct:!0,prop:!0,event:!0,customAttrs:!0,types:{instance:"sinstance",type:"struct"},params:{typeName:r.values.name,mixinsAndInterfaces:r.values.mixints,factory:r.values.factory}};return de(i)};u("Struct",we);const be=(e,t)=>{let n=oe("name: string, factory: function")(e,t);if(n.isInvalid)throw n.error;let r={prop:!0,types:{type:"enum"},params:{typeName:n.values.name,factory:n.values.factory}};return de(r)};u("Enum",be);const ve=(e,t)=>{let n=oe("name: string, factory: function")(e,t);if(n.isInvalid)throw n.error;let r={func:!0,prop:!0,event:!0,customAttrs:!0,types:{type:"mixin"},params:{typeName:n.values.name,factory:n.values.factory}};return de(r)};u("Mixin",ve);const _e=new m,Ae=_e.dispatch,xe=(e,t,n)=>{n?_e.remove(e,t):_e.add(e,t)};u("on",xe,()=>{_e.clear()});const Ie=(e,t)=>{Ae(e,t)};u("post",Ie);let Oe={};const ke={isRegistered:e=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (alias)");return void 0!==Oe[e]&&Oe[e].length>0},get:(e,t)=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (alias)");if("boolean"!=typeof t)throw new f("InvalidArgument","Argument type is invalid. (isAll)");return t?Oe[e]?Oe[e].slice():[]:Oe[e]?Oe[e][0]:null},register:(e,t)=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (alias)");if(-1!==e.indexOf("."))throw new f("InvalidArgument","Argument type is invalid. (alias)");if(!t)throw new f("InvalidArgument","Argument type is invalid. (item)");"string"==typeof t&&((t=g(t)).endsWith(".js")||t.endsWith(".mjs"))&&(t=g(t,!0)),Oe[e]||(Oe[e]=[]),Oe[e].push(t)},resolve:(e,t,...n)=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (alias)");if("boolean"!=typeof t)throw new f("InvalidArgument","Argument type is invalid. (isAll)");let r=null;const i=e=>{let t=e;if("string"==typeof e)if(e.endsWith(".js")||e.endsWith(".mjs"));else{let t=J(e);t&&(e=t)}return-1!==["class","struct"].indexOf(G(e))&&(t=n?new e(...n):new e),t};return Oe[e]&&Oe[e].length>0&&(t?(r=[],Oe[e].forEach(e=>{r.push(i(e))})):r=i(Oe[e][0])),r}};u("Container",ke,()=>{Oe={}});let $e=p,je=[],Te=500;const Se={on:(e,...t)=>{$e===p&&("string"==typeof e?t.unshift(e):"function"==typeof e&&xe("telemetry",e),$e=((e,n)=>{if(0===t.length||-1!==t.indexOf(e)){let t=Object.freeze({type:e,data:n});je.push(t),je.length>Te-25&&je.splice(0,25),Ie("telemetry",t)}}))},collect:()=>{if($e!==p){let e=je.slice();return je.length=0,e}return[]},off:e=>$e!==p?("function"==typeof e&&xe("telemetry",e,!0),$e=p,Se.collect()):[],isOn:()=>$e!==p,types:Object.freeze({RAW:"raw",EXEC:"exec",INFO:"info",INCL:"incl"})};u("telemetry",Se,()=>{je.length=0});const Pe=[],Me={register:(e,t)=>{if("string"!=typeof e)throw new f.InvalidArgument("pointcut");if(!Y(t,"Aspect"))throw new f.InvalidArgument("Aspect");let n=e,r="",i="",s="",a="",o=null;-1!==n.indexOf(":")&&(n=(o=n.split(":"))[0].trim(),s=o[1].trim()||"*"),-1!==n.indexOf(".")?(r=n.substr(0,n.lastIndexOf(".")),i=n.substr(n.lastIndexOf(".")+1)):(r="",i=n),a=x(a=r+"/"+i+":"+s,".","[.]"),a=x(a,"?","."),a=x(a,"*",".*"),Pe.push({rex:new RegExp(a),Aspect:t})}},Ne=(e,t)=>{let n=[],r="",i="",s=t.trim(),a="";return-1!==e.indexOf(".")?(r=e.substr(0,e.lastIndexOf(".")).trim(),i=e.substr(e.lastIndexOf(".")+1).trim()):(r="",i=e.trim()),a=r+"/"+i+":"+s,Pe.forEach(e=>{e.rex.test(a)&&-1===n.indexOf(e.Aspect)&&n.push(e.Aspect)}),n},Ce=(e,t,n,r)=>{let i=[],s=[],a=[],o=null,l;for(let e of r)(o=new e).before!==p&&i.push(o.before),o.around!==p&&a.push(o.around),o.after!==p&&s.push(o.after);return a.length>0&&a.reverse(),function(...r){let o=null,l=null,c={typeName:()=>t,funcName:()=>n,error:e=>(e&&(o=e),o),result:e=>(void 0!==e&&(l=e),l),args:()=>r,data:{}};for(let e of i)try{e(c)}catch(e){o=e}const u=e=>{for(let t of s)try{t(e)}catch(e){c.error(e)}};let p=e,f=null;for(let e of a)p=e(c,p);try{(f=p(...r))&&"function"==typeof f.then?c.result(new Promise((e,t)=>{f.then(t=>{c.result(t),u(c),e(c.result())}).catch(e=>{c.error(e),u(c),t(c.error())})})):(c.result(f),u(c))}catch(e){c.error(e)}return c.result()}};u("Aspects",Me,()=>{Pe.length=0});const ze=(e,t)=>{let n=null,r=null,i=t?JSON.parse(e):e,s=t?null:e._.Type;const a=(e,t)=>{let n=e._.attrs,r=e._.modifiers,i=[],s=!1;for(let a in e)e.hasOwnProperty(a)&&"_"!==a&&((s=r.members.isProperty(a))&&(s=t?!n.members.probe("noserialize",a).anywhere():n.members.probe("serialize",a).anywhere())&&(s=!(r.members.is("private",a)||r.members.is("protected",a)||r.members.is("static",a)||r.members.is("readonly",a)||n.members.probe("inject",a).anywhere())),s&&i.push(a));return i};if(t){if(!i.type&&!i.data)throw f.InvalidArgument("json");if(!(s=J(i.type)))throw new f("NotRegistered",`Type is not registered. (${i.type})`);n=new s,r=s._.attrs.type.probe("serialize").anywhere()?a(n,!0):a(n,!1);for(let e of r)n[e]=i.data[e]}else{r=s._.attrs.type.probe("serialize").anywhere()?a(i,!0):a(i,!1),n={type:i._.Type._.name,data:{}};for(let e of r)n.data[e]=i[e];n=JSON.stringify(n)}return n},Ue={serialize:e=>{if(!(e&&e._&&e._.type)||-1===["instance","sinstance"].indexOf(e._.type))throw f.InvalidArgument("instance");return ze(e)},deserialize:e=>{if(!e||"string"!=typeof e)throw f.InvalidArgument("json");return ze(e,!0)}};u("Serializer",Ue);const De=4*o.env.cores,Ee=Math.round(De/4),Re=[],Fe=()=>{if(Re.length<=Ee)return;let e=Re.slice(0),t=()=>{if(0!==e.length){let n=e.shift();n.context.isBusy()?t():n.context.hasActiveInstances().then(e=>{0===e?(n.unload(),Re.shift(),Re.length>Ee&&t()):t()}).catch(()=>{t()})}};t()},Le=()=>new Promise((e,t)=>{let n=Re.slice(0),r=()=>{if(0!==n.length){let i=n.shift();i.context.isBusy()?r():i.context.hasActiveInstances().then(t=>{0===t?e(i):r()}).catch(t)}else Re.length<De?F.createDomain(y()).then(t=>{e(t)}).catch(t):t("AD POOL FULL")};r()}),We={TaskInfo:function(e,...t){return Object.freeze({type:e,typeArgs:t})},getHandle:(e,t)=>new Promise((n,r)=>{Le().then(r=>{let i;n({run:(...n)=>new Promise((i,s)=>{r.context.execute({type:e.type,typeArgs:e.typeArgs,func:"run",args:n,keepAlive:!0},t).then(i).catch(s)}),close:()=>new Promise((n,i)=>{r.context.execute({type:e.type,typeArgs:e.typeArgs,func:"",args:[],keepAlive:!1},t).then(n).catch(i).finally(Fe)})})}).catch(r)}),invoke:(e,t)=>new Promise((n,r)=>{Le().then(i=>{i.context.execute({type:e.type,typeArgs:e.typeArgs,func:"run",args:[],keepAlive:!1},t).then(n).catch(r).finally(Fe)}).catch(r)}),parallel:Object.freeze({invokeMany:(...e)=>{let t=[];for(let n of e)t.push(We.invoke(n));return t},invoke:Object.freeze({any:(...e)=>Promise.race(We.parallel.invokeMany(...e)),all:(...e)=>Promise.all(We.parallel.invokeMany(...e)),each:(e,t,...n)=>new Promise((r,i)=>{let s=We.parallel.invokeMany(...n),a=0;for(let n of s)n.then(e).catch(t).finally(()=>{a++,s.length===a&&r()})})})}),sequence:Object.freeze({invoke:(...e)=>new Promise((t,n)=>{let r=e.slice(0),i=[],s=()=>{if(0===r.length)return void t(...i);let e=r.shift();We.invoke(e).then(e=>{i.push(e),s()}).catch(n)};r.length>0?s():t(...i)})})};u("Tasks",We,()=>{Re.forEach(e=>{e.unload()}),Re.length=0});const qe=function(e){if(!e||!e._||!e._.type)throw new f.InvalidArgument("forTarget");const t=function(e){this.getType=(()=>e._.type),this.getId=(()=>e._.id),this.getName=(()=>e._.name||""),this.getNamespace=(()=>e._.namespace),this.getAssembly=(()=>{let t=t.get(e._.name);return null}),this.getTarget=(()=>e),this.isInstance=(()=>"instance"===e._.type),this.isClass=(()=>"class"===e._.type),this.isEnum=(()=>"enum"===e._.type),this.isStruct=(()=>"struct"===e._.type),this.isStructInstance=(()=>"sinstance"===e._.type),this.isMixin=(()=>"mixin"===e._.type),this.isInterface=(()=>"interface"===e._.type),this.getModifiers=(()=>e._.modifiers.type),this.getAttributes=(()=>e._.attrs.type)},n=function(e,t,n){this.getType=(()=>"member"),this.getMemberType=(()=>e),this.getTarget=(()=>t),this.getTargetType=(()=>t._.type),this.getName=(()=>n),this.getModifiers=(()=>t._.modifiers.members),this.getAttributes=(()=>t._.attrs.members)},r=function(e,t,n,r){this.getType=(()=>"attribute"),this.getName=(()=>t),this.getTarget=(()=>r),this.getArgs=(()=>n.slice()),this.getClass=(()=>e?new m(e):null)},i=function(e,t){this.getType=(()=>"aspect"),this.getName=(()=>e._.name),this.getTarget=(()=>t),this.getClass=(()=>e?new m(e):null)},s=function(e,t,i,s){let a=new n(e,t,i);return a.getRef=(()=>s),a.getAttributes=(()=>{let e=[],n=[];for(let s of t._.instanceOf)if(s.meta[i]){n=s.meta[i];for(let i of n)e.push(new r(i.Attr,i.name,i.args,t))}return e}),a.hasAttribute=(e=>{let n=!1,r=[];for(let s of t._.instanceOf){if(s.meta[i]){r=s.meta[i];for(let t of r)if(t.name==e){n=!0;break}}if(n)break}return n}),a.getAttribute=(e=>{let n=null;for(let s of t._.instanceOf){if(s.meta[i]){let a=s.meta[i];for(let i of a)if(i.name===e){n=new r(i.Attr,i.name,i.args,t);break}}if(null!==n)break}return n}),a.isEnumerable=(()=>!!t[i]&&Object.getOwnPropertyDescriptor(t,i).enumerable),a.isDeprecated=(()=>t._._.hasAttrEx("deprecate",i)),a.isConditional=(()=>t._._.hasAttrEx("conditional",i)),a.isOverridden=(()=>t._._.hasAttrEx("override",i)),a.isOwn=(()=>t._.isOwnMember(i)),a.isDerived=(()=>t._._.isDerivedMember(i)),a.isPrivate=(()=>t._._.hasAttrEx("private",i)),a.isProtected=(()=>t._._.isProtectedMember(i)),a.isPublic=(()=>!a.isPrivate&&!a.isProtected),a.isSealed=(()=>t._._.isSealedMember(i)),a.isMixed=(()=>t._._.hasAttrEx("mixed",i)),a.getMixin=(()=>{if(a.isMixed()){let e=a.getAttribute("mixed").getArgs()[0];return new y(e)}return null}),a.isInterfaceEnforced=(()=>a.getInterfaces().length>0),a.getInterfaces=(()=>{let e=[],n=[];for(let r of t._.instanceOf)if(r.meta[i]){n=r.meta[i].interfaces;for(let r of n)e.push(new g(r,t))}return e}),a.isProp=(()=>"prop"===e),a.isFunc=(()=>"func"===e),a.isEvent=(()=>"event"===e),a},a=function(e,t,n){let r=new s("prop",e,t,n);return r.getValue=(()=>e[t]),r.setValue=(n=>e[t]=n),r.getRaw=(()=>n),r.isReadOnly=(()=>e._._.hasAttrEx("readonly",t)),r.isSetOnce=(()=>e._._.hasAttrEx("readonly",t)&&e._._.hasAttrEx("once",t)),r.isStatic=(()=>e._._.hasAttrEx("static",t)),r.isSerializable=(()=>e._._.isSerializableMember(t)),r},o=function(e,t,n,r){let a=new s("func",e,t,n);return a.invoke=((...n)=>e[t](...n)),a.getAspects=(()=>{let n=[],r=[];for(let s of e._.instanceOf)if(s.meta[t]){r=s.meta[t].aspects;for(let t of r)n.push(new i(t,e))}return n}),a.getRaw=(()=>r),a.isASync=(()=>e._._.hasAttrEx("async",t)),a.isConstructor=(()=>"_constructor"===t),a.isDisposer=(()=>"_dispose"===t),a},l=function(e,t,n){let r=new s("event",e,t,n);return r.raise=((...e)=>n(...e)),r.isSubscribed=(()=>n.subscribe.all().length>0),r},c=function(e,t){let r=new n("key",e,t);return r.getValue=(()=>e[t]),r},u=function(e){let n=new t(e),r=(e,t,n)=>{if(""===t&&0===n.length)return e.slice();let r=[],i=!0;for(let s of e)if("member"===s.getType()&&(""===t||s.getMemberType()===t)){if(i=!0,0!==n.length)for(let e of n)if(!s.hasAttribute(e)){i=!1;break}i&&r.push(s)}return r},i=t=>{let n=[],i=[],s=null,c=null;for(let r of e._.instanceOf){for(let u in r.meta){if(r.meta.hasOwnProperty(u)){switch(i=r.meta[u],r.meta[u].type){case"func":s=new o(e,u,r.meta[u].ref,r.meta[u].raw),n.push(s);break;case"prop":s=new a(e,u,r.meta[u].ref),n.push(s);break;case"event":s=new l(e,u,r.meta[u].argNames,r.meta[u].ref),n.push(s);break;default:throw"Unknown member type"}void 0!==t&&u===t&&(n=[],c=s)}if(null!==c)break}if(null!==c)break}return null!==c?c:{all:(...e)=>r(n,"",e),func:(...e)=>r(n,"func",e),prop:(...e)=>r(n,"prop",e),event:(...e)=>r(n,"event",e)}};return n.getClass=(()=>null!==e._.inherits?new m(e._.inherits):null),n.getFamily=(()=>{let t=[],n=e._.inherits;for(;1&&null!==n;)t.push(new m(n)),n=n._.inherits;return t}),n.getMixins=(()=>{let e=[],t=n.getFamily();for(let n of t)e=e.concat(n.getMixins());return e}),n.getInterfaces=(()=>{let e=[],t=n.getFamily();for(let n of t)e=e.concat(n.getInterfaces());return e}),n.getMembers=((...e)=>{let t=i();return 0!==e.length?t.all(...e):t}),n.getMember=(e=>i(e)),n.isSingleton=(()=>n.getClass().isSingleton()),n.isInstanceOf=(t=>e._.isInstanceOf(t)),n.isMixed=(t=>e._.isMixed(t)),n.isImplements=(t=>e._.isImplements(t)),n},p=function(e){let n=new t(e);return n.getStruct=(()=>null!==e._.inherits?new h(e._.inherits):null),n.getMembers=(()=>{let t=Object.keys(e),n=t.indexOf("_");return-1!==n&&t.splice(n,1),t}),n.getMember=(t=>e[t]),n.invoke=((...t)=>e[name](...t)),n.isInstanceOf=(t=>e._.inherits._.name===t),n},m=function(e){let n=new t(e);return n.getParent=(()=>null!==e._.inherits?new m(e._.inherits):null),n.getFamily=(()=>{let t=[],n=e._.inherits;for(;1&&null!==n;)t.push(new m(n)),n=n._.inherits;return t}),n.getMixins=(()=>{let t=[];for(let n of e._.mixins)t.push(new y(n));return t}),n.getInterfaces=(()=>{let t=[];for(let n of e._.interfaces)t.push(new g(n));return t}),n.isSingleton=(()=>e._.isSingleton()),n.isSingleInstanceCreated=(()=>null!==e._.singleInstance()),n.isSealed=(()=>e._.isSealed()),n.isAbstract=(()=>e._.isAbstract()),n.isStatic=(()=>e._.isStatic()),n.isDeprecated=(()=>e._.isDeprecated()),n},d=function(e){let n=new t(e);return n.getMembers=(()=>{let t=e._.keys(),n=[];for(let r of t)n.push(new c(e,r));return n}),n.getMember=(t=>{if(void 0===e[t])throw`${t} is not defined.`;return new c(e,t)}),n.getKeys=(()=>e._.keys()),n.getValues=(()=>e._.values()),n},h=function(e){let r=new t(e);return r.getMembers=(()=>{let t=[];for(let r in e)e.hasOwnProperty(r)&&"_"!==r&&t.push(new n(e[r].type,e,r));return t}),r.getMember=(t=>{if(void 0===e[t])throw`${t} is not defined.`;return new n(e[t].type,e,t)}),r},y=function(e){let t;return new h(e)},g=function(e){let t;return new h(e)};let w=null;switch(e._.type){case"instance":w=new u(e);break;case"sinstance":w=new p(e);break;case"class":w=new m(e);break;case"enum":w=new d(e);break;case"struct":w=new h(e);break;case"mixin":w=new y(e);break;case"interface":w=new g(e);break;default:throw`Unknown type ${e._.type}.`}return w};u("Reflector",qe);const Be=e=>{if(e.isServer){if(!e.global.sessionStorage){let t=function(){let e={};this.key=(t=>{if(!t)throw f.invalidArgument("key");return!!e.key}),this.getItem=(t=>{if(!t)throw f.invalidArgument("key");return e.key||null}),this.setItem=((t,n)=>{if(!t)throw f.invalidArgument("key");if(void 0===n)throw f.invalidArgument("value");e[t]=n}),this.removeItem=(t=>{if(!t)throw f.invalidArgument("key");delete e[t]}),this.clear=(()=>{e={}})};e.global.sessionStorage=new t}return e.global.sessionStorage}return e.global.sessionStorage};h.define("sessionStorage",["key","getItem","setItem","removeItem","clear"],Be);const Je=e=>e.isServer?(console.log("Use of 'state' is not support on server. Using 'session' instead."),Be(e)):e.global.localStorage;h.define("localStorage",["key","getItem","setItem","removeItem","clear"],Je);const Ge=e=>({require:e=>new Promise((t,n)=>{try{t(require(e))}catch(e){n(e)}}),undef:e=>{delete require.cache[require.resolve(e)]}});h.define("serverModule",["require","undef"],Ge);const Ve=e=>({require:t=>new Promise((n,r)=>{let i=t.substr(t.lastIndexOf(".")+1).toLowerCase();try{if(void 0!==e.global.require)e.global.require([t],n,r);else if(e.isWorker)try{e.global.importScripts(t),n()}catch(e){r(e)}else{let s=e.global.document.createElement("script");s.type="mjs"===i?"module":"text/javascript",s.name=t,s.src=t,s.onload=(()=>{n()}),s.onerror=(e=>{r(e)}),e.global.document.head.appendChild(s)}}catch(e){r(e)}}),undef:t=>{void 0!==e.global.requirejs&&e.global.requirejs.undef(t)}});h.define("clientModule",["require","undef"],Ve);const He=e=>e=>new Promise((t,n)=>{let r=e.substr(e.lastIndexOf(".")+1).toLowerCase();try{let i=null,s="";(i=e.startsWith("https")?require("https"):require("http")).get(e,e=>{e.on("data",e=>{s+=e}),e.on("end",()=>{let i=e.headers["content-type"];if("json"===r||/^application\/json/.test(i))try{let e=JSON.parse(s);t(e)}catch(e){n(e)}else t(s)})}).on("error",n)}catch(e){n(e)}});h.define("serverFile",null,He);const Ke=e=>e=>new Promise((t,n)=>{let r=e.substr(e.lastIndexOf(".")+1).toLowerCase();fetch(e).then(e=>{if(200!==e.status)n(e.status);else{let i=e.headers["content-type"];"json"===r||/^application\/json/.test(i)?e.json().then(t).catch(n):e.text().then(t).catch(n)}}).catch(n)});return h.define("clientFile",null,Ke),r.members=Object.freeze(r.members),Object.freeze(r)}),(()=>{"use strict";const e=void 0!==!0?require("flair"):"undefined"!=typeof WorkerGlobalScope?WorkerGlobalScope.flair:(!0).flair,{Class:t,Struct:n,Enum:r,Interface:i,Mixin:s}=e,{Aspects:a}=e,{AppDomain:o}=e,l=e.AppDomain.context.current().name,{$$:c,attr:u}=e,{bring:p,Container:f,include:m}=e,{Port:d}=e,{on:h,post:y,telemetry:g}=e,{Reflector:w}=e,{Serializer:b}=e,{Tasks:v}=e,{TaskInfo:_}=e.Tasks,{as:A,is:x,isComplies:I,isDerivedFrom:O,isImplements:k,isInstanceOf:$,isMixed:j}=e,{getAssembly:T,getAttr:S,getContext:P,getResource:M,getType:N,ns:C,getTypeOf:z,typeOf:U}=e,{dispose:D,using:E}=e,{args:R,Exception:F,noop:L}=e,{env:W}=e.options;e.AppDomain.context.current().currentAssemblyBeingLoaded("./flair{.min}.js"),(async()=>{c("abstract"),c("ns","(root)"),t("Aspect",function(){c("virtual"),this.before=this.noop,c("virtual"),this.around=this.noop,c("virtual"),this.after=this.noop})})(),(async()=>{c("abstract"),c("ns","(root)"),t("Attribute",function(){this.construct=(e=>{this.args=e}),c("readonly"),this.args=[],this.constraints="",c("virtual"),this.decorateProperty=this.noop,c("virtual"),this.decorateFunction=this.noop,c("virtual"),this.decorateEvent=this.noop})})(),(async()=>{c("ns","(root)"),i("IDisposable",function(){this.dispose=this.noop})})(),(async()=>{c("ns","(root)"),i("IProgressReporter",function(){this.progress=this.event(this.noop)})})(),(async()=>{const{IProgressReporter:e,IDisposable:n}=C("(root)");c("virtual"),c("ns","(root)"),t("Task",[e,n],function(){let e=!1,t=!1;this.construct=((...e)=>{this.args=e,this.context=o.contexts(l),this.domain=this.context.domain}),c("abstract"),this.dispose=this.nim,c("protected"),this.args=[],c("protected"),this.context=null,c("protected"),this.domain=null,this.run=((...n)=>new Promise((r,i)=>{if(t)i("Already running");else{t=!0;const s=()=>{e=!0;let s=this.onRun(...n);s&&"function"==typeof s.then?s.then(r).catch(i).finally(()=>{t=!1}):(t=!1,r(s))};e?s():this.setup().then(s).catch(e=>{t=!1,i(e)})}})),this.progress=this.event(e=>({data:e})),c("virtual"),c("protected"),this.setup=this.noop,c("abstract"),c("protected"),this.onRun=this.nim})})(),e.AppDomain.context.current().currentAssemblyBeingLoaded("")})();