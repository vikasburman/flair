/**
 * @preserve
 * FlairJS
 * True Object Oriented JavaScript
 * Version 0.15.27
 * Wed, 06 Feb 2019 01:28:03 GMT
 * (c) 2017-2019 Vikas Burman
 * MIT
 * https://flairjs.com
 */
(function(e){"use strict";let n=!0;n&&(e.build=require("./flair.build.js"));let t=Object.freeze(e);"function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof exports?(void 0!==module&&module.exports&&(exports=module.exports=t),module.exports=exports=t):n||((!0).Flair=t)}).call(new Function("try {return global;}catch(e){return window;}")(),e=>{"use strict";let n=new Function("try {return this===global;}catch(e){return false;}")(),t=!0,i={},r=[],s=!1,o=()=>{},a={};if(t.flair){let n=null;for(let i of t.flair.members)n=t.flair[i]._?t.flair[i]._.reset:null,"function"==typeof n&&n(),delete t[i];if(delete t.flair,"string"==typeof e&&"END"===e)return}e?"string"==typeof e&&(e={symbols:e.split(",").map(e=>e.trim())}):e={},a.symbols=Object.freeze(e.symbols||[]),r=a.symbols,s=r.indexOf("TEST")!==-1,a.env=Object.freeze({type:n?"server":"client",global:t,isTesting:s,isServer:s?r.indexOf("SERVER")!==-1||n:n,isClient:s?r.indexOf("CLIENT")!==-1||!n:!n,isProd:r.indexOf("DEBUG")===-1&&r.indexOf("PROD")!==-1,isDebug:r.indexOf("DEBUG")!==-1,suppressGlobals:"undefined"!=typeof suppressGlobals?e.suppressGlobals:a.symbols.indexOf("SUPPRESS")!==-1,args:n?process.argv:new(!0).URLSearchParams((!0).location.search)}),i.info=Object.freeze({name:"FlairJS",version:"0.15.27",copyright:"(c) 2017-2019 Vikas Burman",license:"MIT",link:"https://flairjs.com",lupdate:new Date("Wed, 06 Feb 2019 01:28:03 GMT")}),i.members=[],i.options=Object.freeze(a);const u=()=>{return"_xxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx".replace(/[xy]/g,e=>{var n=16*Math.random()|0,t="x"==e?n:3&n|8;return t.toString(16)})},c=(e,n)=>{if(n){if(e.indexOf("{.min}")!==-1)return i.options.env.isProd?e.replace("{.min}",".min"):e.replace("{.min}","")}else if(e.indexOf("|")!==-1){let n=e.split("|"),t="";return t=i.options.env.isServer?n[0].trim():n[1].trim(),"x"===t&&(t=""),t}return e},f=function(e,n,t){let i="",r="",s=null;e?"string"==typeof e?i=e:"object"==typeof e?(i=e.name||"UnknownException",s=e,r=s.message):i="UndefinedException":i="UndefinedException",n?"string"==typeof n?r=n:"object"==typeof n?s||(s=n,i=i||s.name,r=s.message):i="UndefinedException":s&&(i=i||s.name,r=s.message),t&&"object"==typeof t&&(s||(s=t)),i&&!i.endsWith("Exception")&&(i+="Exception");let o=new Error(r||"");return o.name=i||"UndefinedException",o.error=s||null,Object.freeze(o)};i.Exception=f,i.members.push("Exception");const l=(...e)=>{if(0===e.length)throw new f("InvalidArgument","Argument must be defined. (patterns)");let n=(...n)=>{let t=null,i=null,r="",s="",o=-1,a=-1,u=!1,c=0,l={raw:n||[],index:-1,isInvalid:()=>{return l.index===-1}};if(e)for(let p of e){o++,a=-1,u=!1,c=0,t=p.split(",");for(let e of t){if(a++,i=e.split(":"),2!==i.length?(r=`_${o}_${a}`,s=e.trim()||""):(r=i[0].trim()||"",s=i[1].trim()||""),["raw","index","isInvalid"].indexOf(r)!==-1)throw new f("InvalidArgument",`Argument name cannot be a reserved name. (${r})`);if(a>l.raw.length){u=!1;break}if(!m(l.raw[a],s)){u=!1;break}l[r]=l.raw[a],u=!0,c++}if(u&&c===l.raw.length){l.index=o;break}}return l};return Object.freeze(n)};i.Args=l,i.members.push("Args");const p=e=>{let n="";return"undefined"==typeof e&&(n="undefined"),n||null!==e||(n="null"),!n&&Array.isArray(e)&&(n="array"),!n&&e instanceof Date&&(n="date"),!n&&e._&&e._.type&&(n=e._.type),n||(n=typeof e),n};i.typeOf=p,i.members.push("typeOf");const d=(e,n)=>{let t=p(e),i=p(n),r=!1;if(["instance","sinstance"].indexOf(t)===-1)throw new f("InvalidArgument","Argument type is invalid. (obj)");if(["string","class","interface","struct","mixin"].indexOf(i)===-1)throw new f("InvalidArgument","Argument type is invalid. (type)");switch(t){case"instance":switch(i){case"class":r=e._.isInstanceOf(n);break;case"interface":r=e._.isImplements(n);break;case"mixin":r=e._.isMixed(n);break;case"string":r=e._.isInstanceOf(n),r||(r=e._.isImplements(n)),r||(r=e._.isMixed(n))}break;case"sinstance":switch(i){case"string":case"struct":r=e._.isInstanceOf(n)}}return r};i.isInstanceOf=d,i.members.push("isInstanceOf");const m=(e,n)=>{if("string"!==p(n))throw new f("InvalidArgument","Argument type is invalid. (type)");let t=!1,i="";return e&&("array"!==n&&"Array"!==n||(t=Array.isArray(e)),t||"date"!==n&&"Date"!==n||(t=e instanceof Date),!t&&"flair"===n&&e._&&e._.type&&(t=!0),t||(t=typeof e===n),t||e._&&e._.type&&(i=e._.type,t=i===n),!t&&i&&["instance","sinstance"].indexOf(i)!==-1&&(t=d(e,n))),t};i.is=m,i.members.push("is");const g=(e,n)=>{if("class"!==p(e))throw new f("InvalidArgument","Argument type is invalid. (type)");if(["string","class"].indexOf(p(n))===-1)throw new f("InvalidArgument","Argument type is invalid. (parent)");return e._.isDerivedFrom(n)};i.isDerivedFrom=g,i.members.push("isDerivedFrom");const y=(e,n)=>{if(["instance","class","sinstance"].indexOf(p(e))===-1)throw new f("InvalidArgument","Argument type is invalid. (obj)");if(["string","interface"].indexOf(p(n))===-1)throw new f("InvalidArgument","Argument type is invalid. (intf)");return e._.isImplements(n)};i.isImplements=y,i.members.push("isImplements");const h=(e,n)=>{if(!e)throw new f("InvalidArgument","Argument type is invalid. (obj)");if("interface"!==p(n))throw new f("InvalidArgument","Argument type is invalid. (intf)");let t=!0;for(let i in n)if(n.hasOwnProperty(i)&&"_"!==i&&typeof e[i]!=typeof n[i]){t=!1;break}return t};i.isComplies=h,i.members.push("isComplies");const w=(e,n)=>{if(["instance","class","sinstance"].indexOf(p(e))===-1)throw new f("InvalidArgument","Argument type is invalid. (obj)");if(["string","mixin"].indexOf(p(n))===-1)throw new f("InvalidArgument","Argument type is invalid. (mixin)");return e._.isMixed(n)};i.isMixed=w,i.members.push("isMixed");const b=(e,n)=>{return m(e,n)?e:null};i.as=b,i.members.push("as");const _=(e,n)=>{if("instance"!==p(e))throw new f("InvalidArgument","Argument type is invalid. (obj)");if("function"!==p(n))throw new f("InvalidArgument","Argument type is invalid. (fn)");let t=null,i=!1,r=!1,s=()=>{i||"function"!=typeof e._.dispose||(i=!0,e._.dispose())};try{t=n(e),t&&"function"==typeof t.finally&&(r=!0,t=t.finally(e=>{return s(),e}))}finally{r||s()}return t};i.using=_,i.members.push("using");const v=(e,...n)=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");let t=null;"string"==typeof e?t=i.Container(e):(t=e,e=t._.name),v._.bucket.push({name:e,Attr:t,args:n})};v._=Object.freeze({bucket:[]}),v.collect=(()=>{let e=v._.bucket.slice();return v.clear(),e}),v.has=(e=>{return v._.bucket.findIndex(n=>n.name===e)!==-1}),v.clear=(()=>{v._.bucket.length=0}),i.attr=v,i.members.push("attr");let A={};const x=e=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");return A[e]?A[e].handler:null};x.define=((e,n,t)=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");if("string"!=typeof n)throw new f("InvalidArgument","Argument type is invalid. (type)");if(t&&["interface","array"].indexOf(p(t))===-1)throw new f("InvalidArgument","Argument type is invalid. (intf)");if(A[e])throw new f("Duplicate",`Port is already defined. (${e})`);A[e]={type:n,interface:t||null,handler:null}}),x.connect=((e,n)=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");if(!n)throw new f("InvalidArgument","Argument type is invalid. (handler)");if(!A[e])throw new f("NotFound",`Port is not defined. (${e})`);if(p(n)!==A[e].type)throw new f("InvalidType",`Handler type is invalid. (${e})`);let t=A[e].intf;if(t)if(Array.isArray(t)){for(let i of t)if("undefined"==typeof n[i])throw new f("InvalidType",`Handler interface is invalid. (${e})`)}else if(!y(n,t)||!h(n,t))throw new f("InvalidType",`Handler interface is invalid. (${e})`);A[e].handler=n}),x.disconnect=(e=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");A[e]&&(A[e].handler=null)}),x.disconnect.all=(()=>{for(let e in A)A.hasOnwProperty(e)&&(A[e].handler=null)}),x.isDefined=(e=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");return!!A[e]}),x.isConnected=(e=>{return!A[e]||!A[e].handler}),x._={reset:()=>{A={}}},i._Port=x,i.members.push("Port");let O={},I=null,k=null,j=null,S,N=e=>{S=e,i.Channel=S,a.env.suppressGlobals||(t.Channel=S)};const C=(e,n)=>{if(I){if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");if(!O[e])throw new f("NotFound",`Channel is not defined. (${e})`);if(!n)throw new f("InvalidArgument","Argument type is invalid. (payload)");let t={id:u(),type:e,stamp:Date.now(),payload:n};O[e].buffer.push(t)}};C.define=((e,n)=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");if("string"!=typeof n)throw new f("InvalidArgument","Argument type is invalid. (path)");if(O[e])throw new f("Duplicate",`Channel is already defined. (${e})`);O[e]={path:n,buffer:[]}}),C.publish=(()=>{let e=S.isActive();clearInterval(I);let n=x("pubsub");if(!n)throw new f("NotConfigured","Port is not configured. (pubsub)");for(let t in O)O.hasOwnProperty(t)&&O[t].buffer.length>0&&((!j||j&&j.indexOf(t)!==-1)&&n.publish(O[t].path,O[t].buffer.slice()),O[t].buffer.length=0);e&&(I=setInterval(S.publish,k))}),C.activate=((e,n)=>{if(!I){if("number"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (freq)");N(C),k=e,j=n||[],I=setInterval(S.publish,e)}}),C.deactivate=(()=>{if(I){clearInterval(I),I=null,j=null,N(P);for(let e in O)O.hasOwnProperty(e)&&(O[e].buffer.length=0)}}),C.isDefined=(e=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");return!!O[e]}),C.isActive=(()=>{return null!==I}),C._={reset:()=>{S.deactivate(),O={}}};const P=()=>{};P.define=C.define,P.publish=C.publish,P.activate=C.activate,P.deactivate=C.deactivate,P.isDefined=C.isDefined,P.isActive=C.isActive,P._=C._,S=P,i.Channel=S,i.members.push("Channel");const D=(e,n)=>{for(let t of e)if(t)for(let i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n},E=e=>{let n={mixins:[],interfaces:[]};for(let t of e)switch(t._.type){case"mixin":n.mixins.push(t);break;case"interface":n.interfaces.push(t)}return n},M=(e,n,t,r,s,c,l,p,d,m)=>{if(l.singleton&&n._.singleInstance())return n._.singleInstance();let g=o,y={},h=null,w=[],b=[],_=[],A=n,O=!1,I="__flag__",k="____type",j="_construct",S="_dispose",N={},C=null,P=null,M=null,T=null,L=!1,z=x("sessionStorage"),R=x("localStorage");const F={isSpecial:e=>{return[j,S,k,"_"].indexOf(e)!==-1},isConditional:e=>{return U.has("conditional",e)},isDefined:e=>{let n=!1,t=0,i=p._.instanceOf.slice().reverse();for(let r of i){if(0!==t&&r.meta[e]){n=!0;break}t++}return n},isOwn:e=>{return"undefined"!=typeof C[e]},type:e=>{let n="";if("undefined"!=typeof C[e])n=C[e].type;else for(let t of p._.instanceOf)if(t.meta[e]){n=t.meta[e].type;break}return n},isProperty:e=>{return"prop"===F.type(e)},isEvent:e=>{return"event"===F.type(e)},isFunction:e=>{return"func"===F.type(e)},attrs:e=>{return C[e]?C[e].slice():[]},meta:e=>{return C[e]||[]},isSerializable:e=>{return U.has("serialize",e)},isReadOnly:e=>{return U.has("readonly",e)},isStatic:e=>{return U.has("static",e)},isSealed:e=>{return U.has("sealed",e)},isPrivate:e=>{return U.has("private",e)},isProtected:e=>{return U.has("protected",e)},isDerived:e=>{return!F.isOwn(e)&&p._.instanceOf.findIndex(n=>{return!!n.meta[e]})!==-1},isHidden:e=>{return U.has("hide",e)}},U={get:(e,n,t,i)=>{let r=null,s=p._.instanceOf.slice().reverse();t?i&&s.shift():s=[s[0]];for(let o of s)if(o.meta[n]){for(let t of o.meta[n])if(t.name===e){r=t;break}if(r)break}return r},has:(e,n,t,i)=>{return!!U.get(e,n,t,i)},getArgs:(e,n,t,i)=>{let r=U.get(e,n,t,i);return r?r.args:[]}},J={getParentMeta:e=>{let n=p._.instanceOf[p._.instanceOf.length-1];return n.meta[e]||null},isConditionalOK:e=>{let n=!0,t=U.getArgs("conditional",e,!1),i=t.length>0?t[0]:"";if(i)switch(i){case"server":n=a.env.isServer===!0;break;case"client":n=a.env.isServer===!1;break;default:n=a.symbols.indexOf(i)!==-1}return n},collectTypeAttributes:()=>{C[k]=v.collect()},applyAttrs:e=>{let n=null,t=C[e].type,i=null,r=null,s=null;for(let o of C[e])if(n=o.Attr){if(i=o.args||[],r=new n(...i),s=r.decorator(),"function"!=typeof s)throw new f("NotDefined",`Decorator is not defined for applied attribute. (${o.name})`);{let n=Object.getOwnPropertyDescriptor(p,e);s(p,t,e,n),Object.defineProperty(p,e,n)}}},isArrow:e=>{return!e.hasOwnProperty("prototype")},guid:u,addInstanceMeta:()=>{p._=J.copyMembers([p._,r],{}),p._.type=e,p._.Type=(()=>{return p._.instanceOf[p._.instanceOf.length-1].type}),p._.namespace=null,p._.assembly=(()=>{return i.Assembly.get(t)||null}),p._.id=J.guid(),p._.instanceOf=p._.instanceOf||[],0===p._.instanceOf.length&&p._.instanceOf.push(J.topLevelObjectDef()),p._.instanceOf.push(N),p._.isInstanceOf=(e=>{if(!e)throw new f("InvalidArgument","Argument type is invalid. (name)");return e._&&e._.name&&(e=e._.name),p._.instanceOf.findIndex(n=>{return n.name===e})!==-1}),l.serialize&&(p._.serialize=(()=>{return J.processJson(p,{})}),p._.deserialize=(e=>{J.processJson(e,p,!0)})),l.mixins&&(p._.isMixed=(e=>{if(!e)throw new f("InvalidArgument","Argument type is invalid. (name)");e._&&e._.name&&(e=e._.name);let n=!1;for(let t of p._.instanceOf)for(let i of t.mixins){if(i._.name===e){n=!0;break}if(n)break}return n})),l.interfaces&&(p._.isImplements=(e=>{if(!e)throw new f("InvalidArgument","Argument type is invalid. (name)");e._&&e._.name&&(e=e._.name);let n=!1;for(let t of p._.instanceOf)for(let i of t.interfaces){if(i._.name===e){n=!0;break}if(n)break}return n})),p._._={},p._._.raw=(e=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");return C[e]&&C[e].raw?C[e].raw:null}),p._._.member=F,p._._.attrs=U,p._._.type=W},buildDef:()=>{N={name:t,type:n,meta:{},mixins:w,interfaces:b,props:{},events:[]},C=N.meta,P=N.props,M=N.events},topLevelObjectDef:()=>{return{name:"Object",type:Object,meta:{},mixins:w,interfaces:b,props:{},events:[]}},extractMixinsAndInterfaces:()=>{let e=E(c);w=e.mixins,b=e.interfaces},copyMembers:D,processJson:(e,n,t)=>{let i="";for(let r in p)p.hasOwnProperty(r)&&("prop"!==F.type(r)||!F.isSerializable(r)||F.isReadOnly(r)||F.isStatic(r)||F.isPrivate(r)||F.isProtected(r)||F.isSpecial(r)||(i=U.getArgs("serialize",r,!0)[0]||r,t?n[r]=e[i]||n[r]:n[i]=e[r]))},applyAspects:(e,n)=>{let i=p[e],r=[],s=[],o=[],a=null,u=null;for(let c of n)a=new c,u=a.before(),"function"==typeof u&&r.push(u),u=a.around(),"function"==typeof u&&o.push(u),u=a.after(),"function"==typeof u&&s.push(u);o.length>0&&o.reverse();let f=function(...n){let a=null,u=null,c={obj:()=>{return p},typeName:()=>{return t},funcName:()=>{return e},error:e=>{return e&&(a=e),a},result:e=>{return"undefined"!=typeof e&&(u=e),u},args:()=>{return n},data:{}};for(let f of r)try{f(c)}catch(e){a=e}const l=e=>{for(let n of s)try{n(e)}catch(e){c.error(e)}};let d=i,m=!1,g=null;for(let y of o)d=y(c,d);try{g=d(...n),g&&"function"==typeof g.then?(m=!0,c.result(new Promise((e,n)=>{g.then(n=>{c.result(n),l(c),e(c.result())}).catch(e=>{c.error(e),l(c),n(c.error())})}))):(c.result(g),l(c))}catch(e){c.error(e)}return c.result()}.bind(p);return f},weave:()=>{if(["Attribute","Aspect"].indexOf(t)===-1&&!p._.isInstanceOf("Attribute")&&!p._.isInstanceOf("Aspect")){let e=[];for(let n in C)C.hasOwnProperty(n)&&"func"===C[n].type&&!F.isSpecial(n)&&(e=i.Aspects(t,n,C[n]),e.length>0&&(C[n].aspects=e.slice(),Object.defineProperty(p,n,{configurable:!0,enumerable:!0,writable:!0,value:J.applyAspects(n,e)})))}},constructObj:()=>{if(_=m.args,l.inheritance){m._flag&&m._flag===I&&(O=!0,l.static&&(A=m._static));let e=n._.inherits;if(e){if(e._.isSealed()||e._.isSingleton())throw new f("InvalidOperation",`Cannot inherit from a sealed/singleton type. (${e._.name})`);if(e._.type!==n._.type)throw new f("InvalidOperation",`Cannot inherit from another type. (${e._.name})`);p=new e(I,A,..._)}}},buildObj:()=>{if(L=!0,T=new Proxy({},{get:(e,n)=>{return p[n]},set:(e,n,t)=>{if(L)if("construct"===n)p.construct(t);else if("dispose"===n)p.dispose(t);else{if(["func","prop","event"].indexOf(n)!==-1)throw new f("InvalidOperation",`Inbuilt helper functions cannot be reassigned. (${n})`);"function"==typeof t?v.has("event")?p.event(n,t):p.func(n,t):p.prop(n,t)}else{if("function"==typeof p[n]&&"function"==typeof t)throw new f("InvalidOperation",`Redefinition of members at runtime is not allowed. (${n})`);p[n]=t}return!0}}),l.func&&(p.func=K._func),l.prop&&(p.prop=K._prop),l.event&&(p.event=K._event),l.construct&&(p.construct=K._construct),l.dispose&&(p.dispose=K._dispose),d.apply(T),l.inheritance&&m._flag!==I&&W.isAbstract())throw new f("InvalidOperation",`Cannot create instance of an abstract type. (${t})`);if(l.mixins)for(let e of w)"mixin"===e._.type&&(h=e,e.apply(T),h=null);l.func&&delete p.func,l.prop&&delete p.prop,l.event&&delete p.event,l.construct&&delete p.construct,l.dispose&&delete p.dispose,L=!1},processConstructor:()=>{"function"==typeof p[j]&&(p._.constructing=!0,p[j](..._),p._.construct=p[j],delete p[j],delete p._.constructing)},processDestructor:()=>{"function"==typeof p[S]&&(p._.dispose=p[S],delete p[S])},buildExposedObj:()=>{let e=!1,n=e=>{Object.defineProperty(y,e,Object.getOwnPropertyDescriptor(p,e))};n("_");for(let t in p)e=!1,p.hasOwnProperty(t)&&(e=!0,F.isOwn(t)?(F.isPrivate(t)&&(e=!1),e&&F.isProtected(t)&&!O&&(e=!1)):(F.isProtected(t)&&!O&&(e=!1),e&&!F.isDerived(t)&&(e=!1))),l.hide&&e&&F.isHidden(t)&&(e=!1),e&&n(t),e&&!O&&F.isEvent(t)&&y[t].rewire(y);for(let t in y)!F.isSpecial(t)&&F.isOwn(t)&&F.isSealed(t)&&Object.defineProperty(y,t,{configurable:!1})},validateInterfaces:()=>{for(let e of b)for(let n in e)if(e.hasOwnProperty(n)&&"_"!==n){let t=e[n],i=typeof y[n];if("undefined"===i)throw new f("NotDefined",`Interface (${e._.name}) member is not defined. (${n})`);switch(t.type){case"func":if("function"!==i)throw new f("NotDefined",`Interface (${e._.name}) member is not defined as a function. (${n})`);C[n].interfaces.indexOf(e)===-1&&C[n].interfaces.push(e);break;case"prop":if("function"===i)throw new f("NotDefined",`Interface (${e._.name}) member is not defined as a property. (${n})`);C[n].interfaces.indexOf(e)===-1&&C[n].interfaces.push(e);break;case"event":if("function"!==i||"function"!=typeof y[n].subscribe)throw new f("NotDefined",`Interface (${e._.name}) member is not defined as an event. (${n})`);C[n].interfaces.indexOf(e)===-1&&C[n].interfaces.push(e)}}},storeObjects:()=>{p._.pu=O?null:y,p._.pr=O?null:p},storeInstance:()=>{n._.isSingleton=(()=>{return!0}),n._.singleInstance=(()=>{return Object.freeze(y)}),n._.singleInstance.clear=(()=>{n._.singleInstance=(()=>{return null}),n._.isSingleton=(()=>{return!1})})},setTypeSealed:()=>{n._.isSealed=(()=>{return!0})}},W={isSingleton:()=>{return U.has("singleton",k)},isAbstract:()=>{return U.has("abstract",k)},isSealed:()=>{return U.has("sealed",k)}},K={_func:(e,n)=>{if(!e)throw new f("InvalidArgument","Argument type is invalid. (name)");if("function"==typeof e&&(n=e,e=j),"_"===e&&new f("InvalidName",`Name is not valid. (${e})`),n||(n=g),l.mixins&&null!==h&&v("mixed",h),C[e]=v.collect(),C[e].type="func",l.aop&&(C[e].aspects=[]),l.interfaces&&(C[e].interfaces=[]),!l.construct&&e===j)throw new f("InvalidOperation",`A constructor function cannot be defined on this type. (${e})`);if(!l.dispose&&e===S)throw new f("InvalidOperation",`A destructor function cannot be defined on this type. (${e})`);if(l.conditional&&!J.isConditionalOK(e))return void delete C[e];let t=!1,i=null;if(l.inheritance){if(U.has("override",e)){let r=Object.getOwnPropertyDescriptor(p,e);if(!r||"function"!=typeof r.value)throw new f("InvalidOperation",`Function is not found to override. (${e})`);if(!F.isDefined(e))throw new f("InvalidOperation",`Function is not found to override. (${e})`);if(U.has("sealed",e,!0,!0))throw new f("InvalidOperation",`Cannot override a sealed function. (${e})`);if(l.static&&U.has("static",e,!0,!0))throw new f("InvalidOperation",`Cannot override a static function. (${e})`);let s=p[e].bind(p);i=function(...e){let t=[s].concat(e);return J.isArrow(n)?n(...t):n.apply(p,t)}.bind(p),t=!0}}else if(l.duplicate&&F.isDefined(e))throw new f("InvalidOperation",`A member with this name is already defined. (${e})`);if(!t&&l.static&&U.has("static",e)){if(J.isArrow(n))throw new f("InvalidOperation",`Static functions must not be defined as arrow function. (${e})`);i=function(...e){return n.apply(A,e)}.bind(A),A[e]||(A[e]=i),t=!0}t||(i=function(...e){return J.isArrow(n)?n(...e):n.apply(p,e)}.bind(p)),Object.defineProperty(p,e,{configurable:!0,enumerable:!0,value:i}),l.customAttrs&&J.applyAttrs(e),C[e].ref=p[e],C[e].raw=n},_construct:e=>{K._func(j,e)},_dispose:e=>{K._func(S,e)},_prop:(e,n,i)=>{if(!e||"string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");if(F.isSpecial(e))throw new f("NotAllowed",`Special names are now allowed as property name. (${e})`);if("undefined"==typeof n&&"undefined"==typeof i&&(n=null),l.mixins&&null!==h&&v("mixed",h),C[e]=v.collect(),C[e].type="prop",l.aop&&(C[e].aspects=[]),l.interfaces&&(C[e].interfaces=[]),l.conditional&&!J.isConditionalOK(e))return void delete C[e];if(l.inheritance&&U.has("abstract",e))throw new f("InvalidOperation",`A property cannot be defined as abstract. (${e})`);if(l.inheritance){if(U.has("override",e)){let n=Object.getOwnPropertyDescriptor(p,e);if(!n||"function"!=typeof n.value)throw new f("InvalidOperation",`Property is not found to override. (${e})`);if(!F.isDefined(e))throw new f("InvalidOperation",`Property is not found to override. (${e})`);if(U.has("sealed",e,!0,!0))throw new f("InvalidOperation",`Cannot override a sealed property. (${e})`);if(l.static&&U.has("static",e,!0,!0))throw new f("InvalidOperation",`Cannot override a static property. (${e})`)}}else if(l.duplicate&&F.isDefined(e))throw new f("InvalidOperation",`A member with this name is already defined. (${e})`);if(!n||"function"!=typeof n&&"function"!=typeof n.get){let i=null,r="",s=!1,o=null,a=null;if(l.static&&U.has("static",e)){if(r=e,l.storage&&(U.has("session",e,!0)||U.has("state",e,!0)))throw new f("InvalidOperation",`A static property cannot be stored in session/state. (${e})`);i=A,i[r]||(i[r]=n)}if(l.storage){if(U.has("session",e,!0)&&U.has("state",e,!0))throw new f("InvalidOperation",`Both session and state attributes cannot be applied together. (${e})`);if(r=t+"_"+e,U.has("session",e,!0)){if(!z)throw new f("NotConfigured","Port is not configured. (sessionStorage)");i=z,s=!0}if(U.has("state",e,!0)){if(!R)throw new f("NotConfigured","Port is not configured. (localStorage)");i=R,s=!0}i.key(r)||i.setKey(r,JSON.stringify({value:n}))}i||(r=e,i=P,i[r]=n),o=(()=>{return s?JSON.parse(i.getKey(r)).value:i[r]}),a=U.has("readonly",e,!0)?n=>{if(!(p._.constructing||U.has("once",e,!1)&&!o()))throw new f("InvalidOperation",`Property is readonly. (${e})`);s?i.setKey(r,JSON.stringify({value:n})):i[r]=n}:e=>{s?i.setKey(r,JSON.stringify({value:e})):i[r]=e},Object.defineProperty(p,e,{configurable:!0,enumerable:!0,get:o,set:a})}else{if(l.static&&U.has("static",e))throw new f("InvalidOperation",`Static properties cannot be defined with a custom getter/setter. (${e})`);if(l.storage&&(U.has("session",e)||U.has("state",e)))throw new f("InvalidOperation",`Session/State properties cannot be defined with a custom getter/setter. (${e})`);let t=null,r=null,s=null;t="function"==typeof n?n:n.get,r="function"==typeof i?i:n.set&&"function"==typeof n.set?n.set:g,s=l.readonly&&U.has("readonly",e)?n=>{if(p._.constructing||U.has("once",e)&&!t())return r(n);throw new f("InvalidOperation",`Property is readonly. (${e})`)}:r,Object.defineProperty(p,e,{configurable:!0,enumerable:!0,get:t,set:s})}l.customAttrs&&J.applyAttrs(e),C[e].ref={get:()=>{return p[e]},set:n=>{p[e]=n}}},_event:(e,n)=>{if(!e||"string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");if(n&&"function"!=typeof n)throw new f("InvalidArgument","Argument type is invalid. (argsProcessor)");if(F.isSpecial(e))throw new f("NotAllowed",`Special names are now allowed as event name. (${e})`);if(l.mixins&&null!==h&&J.attr("mixed",h),C[e]=v.collect(),C[e].type="event",l.aop&&(C[e].aspects=[]),l.interfaces&&(C[e].interfaces=[]),l.conditional&&!J.isConditionalOK(e))return void delete C[e];if(l.static&&U.has("static",e))throw new f("InvalidOperation",`An event cannot be defined as static. (${e})`);if(l.inheritance&&U.has("abstract",e))throw new f("InvalidOperation",`An event cannot be defined as abstract. (${e})`);if(C[e].argsProcessor=n||null,l.inheritance){if(U.has("override",e)){let t=Object.getOwnPropertyDescriptor(p,e);if(!t||"function"!=typeof t.value)throw new f("InvalidOperation",`Event is not found to override. (${e})`);if(!F.isDefined(e))throw new f("InvalidOperation",`Event is not found to override. (${e})`);if(U.has("sealed",e,!0,!0))throw new f("InvalidOperation",`Cannot override a sealed event. (${e})`);let i=J.getParentMeta(e),r=i?i.argsProcessor:null;r&&(n?C[e].argsProcessor=function(...e){let t=[r].concat(e);return J.isArrow(n)?n(...t):n.apply(p,t)}:C[e].argsProcessor=r)}}else if(l.duplicate&&F.isDefined(e))throw new f("InvalidOperation",`A member with this name is already defined. (${e})`);n=C[e].argsProcessor;let t={};t._=Object.freeze({subscribers:[]}),t.subscribe=(e=>{if("function"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (fn)");t._.subscribers.push(e)}),t.subscribe.all=(()=>{return t._.subscribers.slice()}),t.unsubscribe=(e=>{if("function"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (fn)");let n=t._.subscribers.indexOf(e);n!==-1&&t._.subscribers.splice(n,1)}),t.unsubscribe.all=(()=>{t._.subscribers.length=0}),t.raise=((...i)=>{let r={};"function"==typeof n&&(r=n(...i));let s={name:e,args:Object.freeze(r),stop:!1};for(let o of t._.subscribers)if(o(s),s.stop)break}),t.rewire=(n=>{let t=n[e].raise;t._=n[e]._,t.subscribe=n[e].subscribe,t.unsubscribe=n[e].unsubscribe,p[e]=t,delete n[e].raise,delete n[e].rewire}),M.push(t),Object.defineProperty(p,e,{configurable:!0,enumerable:!0,writable:!0,value:t}),l.customAttrs&&J.applyAttrs(e),C[e].ref=p[e]}};return J.buildDef(),(l.mixins||l.interfaces)&&J.extractMixinsAndInterfaces(),J.collectTypeAttributes(),J.addInstanceMeta(),J.constructObj(),J.buildObj(),l.aop&&J.weave(),J.buildExposedObj(),l.interfaces&&J.validateInterfaces(),O||(l.construct&&J.processConstructor(),l.dispose&&J.processDestructor()),l.inheritance&&J.storeObjects(),l.inheritance&&W.isSealed()&&J.setTypeSealed(),v.clear(),l.singleton&&W.isSingleton()?(J.storeInstance(),n._.singleInstance()):y},T=(e,n,t,r,s,o,a)=>{let c=E(o);return n._=D([n._,r],{}),a.inheritance&&(n._.inherits=s||null),n._.name=t,n._.type=e,n._.namespace=null,n._.assembly=(()=>{return i.Assembly.get(t)||null}),n._.id=u(),a.inheritance&&(n._.isDerivedFrom=(e=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");e._&&e._.name&&(e=e._.name);let n="Object"===e,t=s;if(!n)for(;;){if(null===t)break;if(t._.name===e){n=!0;break}t=t._.inherits}return n}),n._.isSealed=(()=>{return!1})),a.singleton&&(n._.singleInstance=(()=>{return null}),n._.isSingleton=(()=>{return!1}),n._.singleInstance.clear=(()=>{})),a.mixins&&(n._.isMixed=(e=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");e._&&e._.name&&(e=e._.name);let t=!1,i=n,r=[];for(;;){if(null===i)break;r=i._._.mixins;for(let n of r)if(n._.name===e){t=!0;break}if(t)break;i=i._.inherits}return t})),a.interfaces&&(n._.isImplements=(e=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");e._&&e._.name&&(e=e._.name);let t=!1,i=n,r=[];for(;;){if(null===i)break;r=i._._.interfaces;for(let n of r)if(n._.name===e){t=!0;break}if(t)break;i=i._.inherits}return t})),a.static&&(n._.static={}),n._._=n._._||{},a.mixins&&(n._._.mixins=c.mixins||[]),a.interfaces&&(n._._.interfaces=c.interfaces||[]),i.Namespace(n),n},L=e=>{let n={};n.config=e.config||{},n.config.mixins=e.config.mixins||!1,n.config.interfaces=e.config.interfaces||!1,n.config.inheritance=e.config.inheritance||!1,n.config.singleton=e.config.singleton||!1,n.config.static=e.config.static||!1,n.config.func=e.config.func||!1,n.config.construct=e.config.construct||!1,n.config.dispose=e.config.dispose||!1,n.config.prop=e.config.prop||!1,n.config.storage=e.config.storage||!1,n.config.readonly=e.config.readonly||!1,n.config.event=e.config.event||!1,n.config.aop=e.config.aop||!1,n.config.conditional=e.config.conditional||!1,n.config.duplicate=e.config.duplicate||!1,n.config.customAttrs=e.config.customAttrs||!1,n.config.hide=e.config.hide||!1,n.params=e.params||{},n.params.typeName=e.params.typeName||"",n.params.inherits=e.params.inherits||null,n.params.mixinsAndInterfaces=e.params.mixinsAndInterfaces||null,n.params.factory=e.params.factory||null,n.instance=e.instance||{},n.instance.type=e.instance.type||"",n.instance.mex=e.instance.mex||{},n.type=e.type||{},n.type.type=e.type.type||"",n.type.mex=e.type.mex||{},n.config.func||(n.config.construct=!1,n.config.dispose=!1),n.config.prop||(n.config.storage=!1,n.config.readonly=!1),n.config.inheritance||(n.config.singleton=!1),n.config.func||n.config.prop||n.config.event||(n.config.aop=!1,n.config.conditional=!1,n.config.duplicate=!1,n.config.customAttrs=!1,n.config.hide=!1);let t=function(e,i,...r){let s={};n.config.inheritance?n.config.static?(s._flag=e,s._static=i,s.args=r):(s._flag=e,s.args=[i].concat(r)):s.args=[e,i].concat(r);let o={};return M(n.instance.type,t,n.params.typeName,n.instance.mex,n.params.inherits,n.params.mixinsAndInterfaces,n.config,o,n.params.factory,s)};return T(n.type.type,t,n.params.typeName,n.type.mex,n.params.inherits,n.params.mixinsAndInterfaces,n.config)},z=(e,n,t)=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");if("array"===p(n)){if("function"!=typeof t)throw new f("InvalidArgument","Argument type is invalid. (factory)")}else{if("function"!=typeof n)throw new f("InvalidArgument","Argument type is invalid. (factory)");t=n,n=[]}let i="sinstance";e.indexOf("<")!==-1&&e.indexOf(">")!==-1&&(i=e.substr(e.indexOf("<")+1),i=i.substr(0,i.indexOf(">")).trim(),e=e.substr(0,e.indexOf("<")).trim());let r={};return r.config={mixins:!0,interfaces:!0,static:!0,func:!0,construct:!0,prop:!0,readonly:!0,event:!0,conditional:!0,duplicate:!0,customAttrs:!0,hide:!0},r.params={typeName:e,inherits:null,mixinsAndInterfaces:n,factory:t},r.instance={type:i},r.type={type:"struct"},r.instance.mex={},r.type.mex={},L(r)};i.Struct=z,i.members.push("Struct");let R={},F={};i.Assembly=(e=>{if("object"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (ado)");if("array"!==p(e.types)||"array"!==p(e.assets)||"string"!=typeof e.name||"string"!=typeof e.file)throw new f("InvalidArgument","Argument type is invalid. (ado)");let n=i.Struct("Assembly<assembly>",function(){this.construct(e=>{this.ado=e,this.name=e.name,this.file=c(e.file,!0),this.desc=e.desc||"",this.version=e.version||"",this.copyright=e.copyright||"",this.license=e.license||"",this.types=e.types.slice()||[],this.settings=e.settings||{},this.assets=e.assets.slice()||[],this.hasAssets=e.assets.length>0}),this.props(["readonly"],["ado","name","file","desc","version","copyright","license","types","hasAssets"]),this.prop("isLoaded",!1),this.func("load",()=>{return i.Assembly.load(this.file)}),this.func("getType",e=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");if(!this.isLoaded)throw new f("NotLoaded",`Assembly is not yet loaded. (${this.file})`);if(this.types.indexOf(e)===-1)throw new f("NotFound",`Type is not found in this assembly. (${e})`);let n=i.Namespace.getType(e);if(!n)throw new f("NotRegistered",`Type is not registered. (${e})`);return n}),this.func("createInstance",(e,...n)=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");let t=i.Assembly.get(e),r=null;return r=n?new t(...n):new t})});return new n(e)}),i.Assembly.register=((...e)=>{if(!e)throw new f("InvalidArgument","Argument type is invalid. (ados)");
let n=!1;for(let t of e){let e=i.Assembly(t),r=e.file;if(R[r])throw new f("DuplicateName",`Assembly is already registered. (${r})`);R[r]=e;for(let s of e.types){if(F[s])throw new f("DuplicateName",`Type is already registered. (${s})`);F[s]=e}n=!0}return n}),i.Assembly.load=(e=>{return new Promise((t,r)=>{if("string"!=typeof e)return void r(new f("InvalidArgument","Argument type is invalid. (file)"));if(!i.Assembly.isRegistered(e))return void r(new f("NotFound",`Assembly is not registered. (${e})`));if(R[e].isLoaded)return void t();if(n)try{require(e),R[e].markLoaded(),t()}catch(n){r(new f("FileLoad",`File load operation failed. (${e})`,n))}else{const n=i.options.env.global.document.createElement("script");n.onload=(()=>{R[e].isLoaded=!0,t()}),n.onerror=(n=>{r(new f("FileLoad",`File load operation failed. (${e})`,n))}),n.async=!0,n.src=e,i.options.env.global.document.body.appendChild(n)}})}),i.Assembly.isRegistered=(e=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type if not valid. (file)");return"undefined"!=typeof R[e]}),i.Assembly.isLoaded=(e=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type if not valid. (file)");return"undefined"!=typeof R[e]&&R[e].isLoaded}),i.Assembly.get=(e=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type if not valid. (name)");return F[e]||null}),i.Assembly.all=(()=>{return Object.values(R).slice()}),i.Assembly.allTypes=(()=>{return Object.keys(F).slice()}),i.Assembly._={reset:()=>{R={},F={}}},i.members.push("Assembly"),i.Namespace=(e=>{if(["class","enum","interface","mixin","struct","resource","proc"].indexOf(e._.type)===-1)throw`Type (${e._.type}) cannot be placed in a namespace.`;if(e._.namespace)throw`Type (${e._.name}) is already contained in a namespace.`;let n=!1;e._.name.startsWith("~")&&(e._.name=e._.name.substr(1),n=!0);let t=i.Namespace.root,r=e._.name,s="",o=r.substr(0,r.lastIndexOf("."));if(r=r.substr(r.lastIndexOf(".")+1),o){let n=o.split(".");for(let i of n)if(i){if("_"===i)throw`Special name "_" is used as namespace in ${e._.name}.`;if(t[i]=t[i]||{},s=i,t[i]._&&"namespace"!==t[i]._.type)throw`${e._.name} cannot be contained in another type (${t[i]._.name})`;t=t[i]}}else if(!n)return;if(t[r])throw`Type ${r} already contained at ${o}.`;t[r]=e,e._.namespace=t,t._=t._||{},t._.name=t._.name||s,t._.type=t._.type||"namespace",t._.types=t._.types||[],t._.types.push(e);let a=()=>{return t._.types.slice()},u=e=>{let n=null,i=t;if(e.indexOf(".")!==-1){let t=e.split(".");for(let r of t)if(r){if("_"===r)throw`Special name "_" is used as name in ${e}.`;if(i=i[r],!i)break}n=i}else n=i[e];return n&&n._&&["class","enum","interface","mixin","struct"].indexOf(n._.type)!==-1?n:null},c=(e,...n)=>{let i=t.getType(e);if(i&&"class"!=i._.type)throw`${G} is not a class.`;return i?new i(...n):null};t.getTypes=t.getTypes||a,t.getType=t.getType||u,t.createInstance=t.createInstance||c}),i.Namespace.root={},i.Namespace.getType=(e=>{return i.Namespace.root.getType?i.Namespace.root.getType(e):null}),i.Namespace.getTypes=(()=>{return i.Namespace.root.getTypes?i.Namespace.root.getTypes():[]}),i.Namespace.createInstance=((e,...n)=>{return i.Namespace.root.createInstance?i.Namespace.root.createInstance(e,...n):null}),i.Namespace._={reset:()=>{}},i.members.push("Namespace"),i.Types=(e=>{if("string"!==p(e))throw new f("InvalidArgument","Argument type is invalid. (name)");return i.Namespace.getType(e)}),i.members.push("Types"),i.Class=((e,n,t,i)=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");switch(p(n)){case"function":i=n,n=null,t=[];break;case"array":if("function"!=typeof t)throw new f("InvalidArgument","Argument type is invalid. (factory)");i=t,t=n,n=null;break;case"class":if(["array","function"].indexOf(p(t))===-1)throw new f("InvalidArgument","Argument type is invalid. (factory)");if("function"==typeof t)i=t,t=[];else if("function"!=typeof i)throw new f("InvalidArgument","Argument type is invalid. (factory)");break;default:throw new f("InvalidArgument","Argument type is invalid. (factory)")}let r={};return r.config={mixins:!0,interfaces:!0,inheritance:!0,singleton:!0,static:!0,func:!0,construct:!0,dispose:!0,prop:!0,storage:!0,readonly:!0,event:!0,aop:!0,conditional:!0,duplicate:!0,customAttrs:!0,hide:!0},r.params={typeName:e,inherits:n,mixinsAndInterfaces:t,factory:i},r.instance={type:"instance"},r.type={type:"class"},r.instance.mex={},r.type.mex={},L(r)}),i.members.push("Class"),i.Mixin=((e,n)=>{return n._={name:e,type:"mixin",namespace:null},i.Namespace(n),n}),i.members.push("Mixin"),i.Interface=((e,n)=>{let t={},r={};const s=e=>{return["constructor","dispose","_constructor","_dispose","_"].indexOf(e)!==-1};return r.func=(n=>{if("undefined"!=typeof t[n])throw`${e}.${n} is already defined.`;if(s(n))throw`${e}.${n} can only be defined for a class.`;t[n]=[],t[n].type="func"}),r.prop=(n=>{if("undefined"!=typeof t[n])throw`${e}.${n} is already defined.`;if(s(n))throw`${e}.${n} can only be defined as a function for a class.`;t[n]=[],t[n].type="prop"}),r.event=(n=>{if("undefined"!=typeof t[n])throw`${e}.${n} is already defined.`;if(s(n))throw`${e}.${n} can only be defined as a function for a class.`;t[n]=[],t[n].type="event"}),t._={name:e,type:"interface",namespace:null},i.Namespace(t),n.apply(r),delete r.func,delete r.prop,delete r.event,t}),i.members.push("Interface"),i.Enum=((e,n)=>{if("object"!=typeof n&&!Array.isArray(n))throw i.Exception("ENUM01","Invalid enum data.")}),i.Enum.getKeys=(e=>{try{return e._.keys()}catch(e){throw i.Exception("ENUM02","Object is not an Enum.",e)}}),i.Enum.getValues=(e=>{try{return e._.values()}catch(e){throw i.Exception("ENUM02","Object is not an Enum.",e)}}),i.Enum.isDefined=((e,n)=>{return i.Enum.getKeys().indexOf(n)!==-1||i.Enum.getValues().indexOf(n)!==-1}),i.members.push("Enum"),i.Proc=((e,n,t)=>{"function"==typeof n&&(t=n,n=!1);let r=t;return r.isASync=(()=>{return n}),r._={name:e,type:"proc",namespace:null,invoke:(...e)=>{t(...e)}},i.Namespace(r),Object.freeze(r)}),i.Resource=((e,n,t)=>{const r=e=>{return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function e(n,t){return String.fromCharCode("0x"+t)}))},s=e=>{return decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))};let o=t,a=n.substr(n.lastIndexOf(".")+1).toLowerCase(),u=["txt","xml","js","json","md","css","html","svg"];if(u.indexOf(a)!==-1)if(i.options.env.isServer){let e=new Buffer(o).toString("base64");o=e.toString("utf8")}else o=s(o);else i.options.env.isServer&&(o=new Buffer(o).toString("base64"));let c={file:()=>{return n},type:()=>{return a},get:()=>{return o},load:(...e)=>{if(i.options.env.isClient&&!c._.isLoaded)if(c._.isLoaded=!0,["gif","jpeg","jpg","png"].indexOf(a)!==-1){let n=e[0];if(n){let e=new Image;e.src="data:image/png;base64,"+t,n.appendChild(e),c._.isLoaded=!0}}else{let t,r,s,u=null;switch(a){case"css":t=i.options.env.global.document.createElement("style"),t.type="text/css",t.name=n,t.innerHTML=o,i.options.env.global.document.head.appendChild(t);break;case"js":r=i.options.env.global.document.createElement("script"),r.type="text/javascript",r.name=n,r.src=o,"function"==typeof cb&&(r.onload=e[0],r.onerror=(()=>{c._.isLoaded=!1})),i.options.env.global.document.head.appendChild(r);break;case"html":s=e[0],u=e[1]||"",s&&(u?s.innerHTML=o:s.insertAdjacentHTML(u,o))}}return c._.isLoaded}};if(c._={name:e,type:"resource",namespace:null,file:n,isLoaded:!1,data:()=>{return o}},c.JSON=null,"json"===c.type())try{c.JSON=Object.freeze(JSON.parse(o))}catch(e){}return i.Namespace(c),Object.freeze(c)}),i.Resource.get=(e=>{let n=i.Namespace.getType(e);return n._&&"resource"===n._.type?n.get():null});let U={};i.Container=((e,n)=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (alias)");return n?(U[e]||[]).slice():U[e]&&U[e].length>0?U[e][0]:null}),i.Container.isRegistered=(e=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (alias)");return"undefined"!=typeof U[e]&&U[e].length>0}),i.Container.register=((e,n)=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (alias)");if(!n)throw new f("InvalidArgument","Argument type is invalid. (type)");if(m(n,"flair"));else if("object"==typeof n);else{if("string"!=typeof n)throw new f("InvalidArgument",`Argument type is invalid. (${p(n)})`);n=c(n),n.endsWith(".js")||n.endsWith(".mjs")}return U[e]||(U[e]=[]),U[e].push(n),!0}),i.Container.resolve=((e,n,...t)=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (alias)");if("boolean"!=typeof n)throw new f("InvalidArgument","Argument type is invalid. (isMultiResolve)");let r=null,s=e=>{let n=e;if("string"==typeof e)if(e.endsWith(".js")||e.endsWith(".mjs"));else{let n=i.Namespace.getType(e);n&&(e=n)}return["class","struct"].indexOf(p(e))!==-1&&(n=t?new e(...t):new e),n};if(U[e]&&U[e].length>0)if(n){r=[];for(let n of U[e])r.push(s(n))}else{let n=U[e][0];r=s(n)}return r}),i.Container._={reset:()=>{U={}}},i.members.push("Container"),i.Attribute=i.Class("Attribute",function(e){let n=null;e("abstract"),this.construct((...e)=>{this.args=[];for(let n of e)if("string"==typeof n)if(n.startsWith("[")&&n.endsWith("]")){let e=n.replace("[","").replace("]",""),t=function(){let n=this[e];return"function"==typeof n?n():n};this.args.push(t)}else this.args.push(n);else this.args.push(n)}),this.prop("args",[]),this.func("decorator",e=>{return"function"==typeof e&&(n=e),n}),this.func("resetEventInterface",(e,n)=>{n.subscribe=e.subscribe,n.unsubscribe=e.unsubscribe,delete e.subscribe,delete e.unsubscribe})}),i.Container.register("async",i.Class("async",i.Attribute,function(){this.decorator((e,n,t,i)=>{if(["func"].indexOf(n)===-1)throw`async attribute cannot be applied on ${n} members.`;if(["_constructor","_dispose"].indexOf(n)!==-1)throw`async attribute cannot be applied on special function.`;let r=i.value;i.value=function(...e){return new Promise((n,t)=>{let i=[n,t].concat(e);r(...i)})}.bind(e)})})),i.Container.register("deprecate",i.Class("deprecate",i.Attribute,function(){this.decorator((e,n,t,i)=>{if(["_constructor","_dispose"].indexOf(n)!==-1)throw`deprecate attribute cannot be applied on special function.`;let r=`${t} is deprecated.`,s,o,a,u=null;switch("undefined"!=typeof this.args[0]&&(r+=" "+this.args[0]),n){case"prop":i.get&&(s=i.get,i.get=function(){return console.warn(r),s()}.bind(e)),i.set&&(o=i.set,i.set=function(e){return console.warn(r),o(e)}.bind(e));break;case"func":a=i.value,i.value=function(...e){console.warn(r),a(...e)}.bind(e);break;case"event":u=i.value,i.value=function(...e){console.warn(r),u(...e)}.bind(e),this.resetEventInterface(a,i.value)}})})),i.Container.register("enumerate",i.Class("enumerate",i.Attribute,function(){this.decorator((e,n,t,i)=>{if(["_constructor","_dispose"].indexOf(n)!==-1)throw`enumerate attribute cannot be applied on special function.`;let r=this.args[0];i.enumerable=r})}));let J=[];i.include=((e,n)=>{let t=p(e),r=null;"string"!==t&&"array"!==t&&(r=new f("InvalidArgument","Argument type is invalid. (deps)")),r||"string"!==t||(e=[e]),r||"function"==typeof n||(r=new f("InvalidArgument","Argument type is invalid. (fn)"));let s={},o=r?null:e.slice(),a=(e,n,t)=>{let r=x("moduleLoader"),s=x("fileLoader");return a=null,new Promise((o,u)=>{let c=t.substr(t.lastIndexOf(".")+1).toLowerCase();if(e)if(n)if(a=r||null,"function"==typeof a)a(t).then(o).catch(u);else try{o(require(t))}catch(e){u(e)}else if(a=s||null,"function"==typeof a)a(t).then(o).catch(u);else try{let e=null,n="";e=t.startsWith("https")?require("https"):require("http"),e.get(t,e=>{e.on("data",e=>{n+=e}),e.on("end",()=>{o("json"===c?JSON.parse(n):n)})}).on("error",u)}catch(e){u(e)}else if(n)if(a=r||null,"function"==typeof a)a(t).then(o).catch(u);else try{if("undefined"!=typeof require)require([t],o,u);else{let e=i.options.env.global.document.createElement("script");e.type="text/javascript",e.name=t,e.src=t,e.onload=o,e.onerror=u,i.options.env.global.document.head.appendChild(e)}}catch(e){u(e)}else a=s||null,"function"==typeof a?a(t).then(o).catch(u):fetch(t).then(e=>{200!==e.status?u(e.status):"json"===c?e.json().then(o).catch(u):o(e.text())}).catch(u)})},u=(e,n)=>{if("string"!=typeof e)throw new f("InvalidArgument","Argument type is invalid. (name)");if(!s[e])throw new f("InvalidName",`Name is not valid. (${e})`);if(s[e].error&&n)throw s[e].error;return s[e].dep},l=()=>{"function"==typeof n&&n(u,r)},d=()=>{if(r||0===o.length)return void l();{let e=o.shift().trim(),n="",t=null,u=null;if(""===e)return r=new f("InvalidArgument",`Argument type is invalid. (deps)`),void l();let p=e.split(":");if(2!==p.length)return r=new f("InvalidArgument",`Argument type is invalid. (${e})`),void l();if(n=p[0].trim(),e=p[1].trim(),s[n])return r=new f("DuplicateName",`Duplicate names are not allowed. (${n})`),void l();s[n]={error:null,dep:null},e=c(e);let m=n=>{if(e.startsWith("[")&&e.endsWith("]")&&e.indexOf(".")===-1){let n=e.substr(1,e.length-2).trim();i.Container.isRegistered(n)&&(t=i.Container(n),"string"==typeof t&&(e=t,t=null))}n()},g=n=>{t=i.Namespace.getType(e),n()},y=n=>{let r=i.Assembly.get(e);r?r.isLoaded()?(t=i.Namespace.getType(e),n()):r.load().then(()=>{t=i.Namespace.getType(e),n()}).catch(e=>{u=new f("AssemblyLoad",`Assembly load operation failed with error: ${e}. (${r.file()})`),n()}):n()},h=n=>{let r=e.substr(e.lastIndexOf(".")+1).toLowerCase();r?"js"===r||"mjs"===r?(e=c(e,!0),n()):a(i.options.env.isServer,!1,e).then(e=>{t=e,n()}).catch(t=>{u=new f("FileLoad",`File load failed. (${e})`,t),n()}):n()},w=n=>{a(i.options.env.isServer,!0,e).then(e=>{t=e,n()}).catch(t=>{u=new f("ModuleLoad",`Module load operation failed with error: ${t}. (${e})`),n()})},b=e=>{s[n].error=u,s[n].dep=t,e||J.pop(),d()};if(""===e)return void b(!0);if(J.indexOf(e)!==-1)return u=new f("CircularDependency",`Circular dependency identified. (${e})`),void b(!0);J.push(e),m(()=>{t?b():g(()=>{t?b():y(()=>{t?b():h(()=>{t?b():w(()=>{return t?void b():(u=new f("DependencyResolution",`Failed to resolve dependency. ${e}`),void b())})})})})})}};d()}),i.include._={reset:()=>{J=[]}},i.members.push("include"),i.Container.register("inject",i.Class("inject",i.Attribute,function(){this.decorator((e,n,t,r)=>{if(["func","prop"].indexOf(n)===-1)throw`inject attribute cannot be applied on ${n} members.`;if(["_constructor","_dispose"].indexOf(t)!==-1)throw`inject attribute cannot be applied on special function.`;let s=this.args[0],o=this.args[1],a=null,u=null;switch(Array.isArray(o)||(o=[o]),"string"==typeof s?(s=c(s),a=i.Container.resolve(s,!1,...o)):a=new s(...o),n){case"func":u=r.value,r.value=function(...e){u(a,...e)}.bind(e);break;case"prop":e[t]=a}})})),i.Container.register("multiinject",i.Class("multiinject",i.Attribute,function(){this.decorator((e,n,t,r)=>{if(["func","prop"].indexOf(n)===-1)throw`multiinject attribute cannot be applied on ${n} members.`;if(["_constructor","_dispose"].indexOf(t)!==-1)throw`multiinject attribute cannot be applied on special function.`;let s=this.args[0],o=this.args[1],a=null,u=null;if(Array.isArray(o)||(o=[o]),"string"!=typeof s)throw`multiinject attribute does not support direct type injections.`;switch(s=c(s),a=i.Container.resolve(s,!0,...o),n){case"func":u=r.value,r.value=function(...e){u(a,...e)}.bind(e);break;case"prop":e[t]=a}})}));let W=[],K=e=>{return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")},q=e=>{return new RegExp("^"+e.split(/\*+/).map(K).join(".*")+"$")};if(i.Aspects={},i.Aspects.raw=(()=>{return W}),i.Aspects.register=((e,n)=>{let t=e||"~",i="",r="",s="",o="~",a="";if(t.indexOf("/")!==-1){let e=t.split("/");t=e[0].trim(),o=e[1].trim()}if("~"===t)i="~",r="~",s="~";else if(""===t)i="^",r="~",s="~";else if(t.indexOf(".")===-1)if(i="^",t.indexOf(":")===-1)r=t,s="~";else{let e=t.split(":");r=e[0].trim(),s=e[1].trim()}else if(i=t.substr(0,t.lastIndexOf(".")),t=t.substr(t.lastIndexOf(".")+1),t.indexOf(":")===-1)r=t,s="~";else{let e=t.split(":");r=e[0].trim(),s=e[1].trim()}"*"!==i&&""!==i||(i="~"),"*"!==r&&""!==r||(r="~"),"*"!==s&&""!==s||(s="~"),"*"!==o&&""!==o||(o="~"),a=`${i}=${r}=${s}=${o}`,W[a]=W[a]||[],W[a].push(n)}),i.Aspects.get=((e,n,t)=>{let i=[],r="",s="",o=n.trim();e.indexOf(".")!==-1?(r=e.substr(0,e.lastIndexOf(".")).trim(),s=e.substr(e.lastIndexOf(".")+1).trim()):(r="^",s=e.trim());for(let a in W){let e=a.split("="),n=e[0],u=q(n),c=e[1],f=q(c),l=e[2],p=q(l),d=e[3],m=q(d),g="~"===d;if((r===n||u.test(r))&&(s===c||f.test(s))&&(o===l||p.test(o))){if(!g)for(let e of t)if(e.name===d||m.test(e.name)){g=!0;break}if(g)for(let n of W[a])i.indexOf(n)===-1&&i.push(n)}}return i}),i.Aspect=i.Class("Aspect",function(e){let n=null,t=null,i=null;e("abstract"),this.construct((...e)=>{this.args=e}),this.prop("args",[]),this.func("before",e=>{return"function"==typeof e&&(n=e),n}),this.func("after",e=>{return"function"==typeof e&&(t=e),t}),this.func("around",e=>{return"function"==typeof e&&(i=e),i})}),i.Serializer={},i.Serializer.serialize=(e=>{return"instance"===e._.type?e._.serialize():null}),i.Serializer.deserialize=((e,n)=>{let t=new e;return"instance"===t._.type?(t._.deserialize(n),t):null}),i.Reflector=function(e){const n=function(e){this.getType=(()=>{return e._.type}),this.getName=(()=>{return e._.name||""}),this.getNamespace=(()=>{let n=e._.namespace;return n?new w(n):null}),this.getAssembly=(()=>{let n=i.Assembly.get(e._.name);return n?new b(n):null}),this.getTarget=(()=>{return e}),this.isInstance=(()=>{return"instance"===e._.type}),this.isClass=(()=>{return"class"===e._.type}),this.isEnum=(()=>{return"enum"===e._.type}),this.isProc=(()=>{return"proc"===e._.type}),this.isStruct=(()=>{return"struct"===e._.type}),this.isStructInstance=(()=>{return"sinstance"===e._.type}),this.isNamespace=(()=>{return"namespace"===e._.type}),this.isResource=(()=>{return"resource"===e._.type}),this.isAssembly=(()=>{return"assembly"===e._.type}),this.isMixin=(()=>{return"mixin"===e._.type}),this.isInterface=(()=>{return"interface"===e._.type})},t=function(e,n,t){this.getType=(()=>{return"member"}),this.getMemberType=(()=>{return e}),this.getTarget=(()=>{return n}),this.getTargetType=(()=>{return n._.type}),this.getName=(()=>{return t})},r=function(e,n,t,i){this.getType=(()=>{return"attribute"}),this.getName=(()=>{return n}),this.getTarget=(()=>{return i}),this.getArgs=(()=>{return t.slice()}),this.getClass=(()=>{return e?new d(e):null})},s=function(e,n){this.getType=(()=>{return"aspect"}),this.getName=(()=>{return e._.name}),this.getTarget=(()=>{return n}),this.getClass=(()=>{return e?new d(e):null})},o=function(e,n,i,s){let o=new t(e,n,i);return o.getRef=(()=>{return s}),o.getAttributes=(()=>{let e=[],t=[];for(let s of n._.instanceOf)if(s.meta[i]){t=s.meta[i];for(let o of t)e.push(new r(o.Attr,o.name,o.args,n))}return e}),o.hasAttribute=(e=>{let t=!1,r=[];for(let s of n._.instanceOf){if(s.meta[i]){r=s.meta[i];for(let n of r)if(n.name==e){t=!0;break}}if(t)break}return t}),o.getAttribute=(e=>{let t=null;for(let s of n._.instanceOf){if(s.meta[i]){let o=s.meta[i];for(let a of o)if(a.name===e){t=new r(a.Attr,a.name,a.args,n);break}}if(null!==t)break}return t}),o.isEnumerable=(()=>{return!!n[i]&&Object.getOwnPropertyDescriptor(n,i).enumerable}),o.isDeprecated=(()=>{return n._._.hasAttrEx("deprecate",i)}),o.isConditional=(()=>{return n._._.hasAttrEx("conditional",i)}),o.isOverridden=(()=>{return n._._.hasAttrEx("override",i)}),o.isOwn=(()=>{return n._.isOwnMember(i)}),o.isDerived=(()=>{return n._._.isDerivedMember(i)}),o.isPrivate=(()=>{return n._._.hasAttrEx("private",i)}),o.isProtected=(()=>{return n._._.isProtectedMember(i)}),o.isPublic=(()=>{return!o.isPrivate&&!o.isProtected}),o.isSealed=(()=>{return n._._.isSealedMember(i)}),o.isMixed=(()=>{return n._._.hasAttrEx("mixed",i)}),o.getMixin=(()=>{if(o.isMixed()){let e=o.getAttribute("mixed").getArgs()[0];return new _(e)}return null}),o.isInterfaceEnforced=(()=>{return o.getInterfaces().length>0}),o.getInterfaces=(()=>{let e=[],t=[];for(let r of n._.instanceOf)if(r.meta[i]){t=r.meta[i].interfaces;for(let s of t)e.push(new v(s,n))}return e}),o.isProp=(()=>{return"prop"===e}),o.isFunc=(()=>{return"func"===e}),o.isEvent=(()=>{return"event"===e}),o},a=function(e,n,t){let i=new o("prop",e,n,t);return i.getValue=(()=>{return e[n]}),i.setValue=(t=>{return e[n]=t}),i.getRaw=(()=>{return t}),i.isReadOnly=(()=>{return e._._.hasAttrEx("readonly",n)}),i.isSetOnce=(()=>{return e._._.hasAttrEx("readonly",n)&&e._._.hasAttrEx("once",n)}),i.isStatic=(()=>{return e._._.hasAttrEx("static",n)}),i.isSerializable=(()=>{return e._._.isSerializableMember(n)}),i},u=function(e,n,t,i){let r=new o("func",e,n,t);return r.invoke=((...t)=>{return e[n](...t)}),r.getAspects=(()=>{let t=[],i=[];for(let r of e._.instanceOf)if(r.meta[n]){i=r.meta[n].aspects;for(let o of i)t.push(new s(o,e))}return t}),r.getRaw=(()=>{return i}),r.isASync=(()=>{return e._._.hasAttrEx("async",n)}),r.isConstructor=(()=>{return"_constructor"===n}),r.isDisposer=(()=>{return"_dispose"===n}),r},c=function(e,n,t){let i=new o("event",e,n,t);return i.raise=((...e)=>{return t(...e)}),i.isSubscribed=(()=>{return t.subscribe.all().length>0}),i},f=function(e,n){let i=new t("key",e,n);return i.getValue=(()=>{return e[n]}),i},l=function(e){let t=new n(e),i=(e,n,t)=>{if(""===n&&0===t.length)return e.slice();let i=[],r=!0;for(let s of e)if("member"===s.getType()&&(""===n||s.getMemberType()===n)){if(r=!0,0!==t.length)for(let e of t)if(!s.hasAttribute(e)){r=!1;break}r&&i.push(s)}return i},r=n=>{let t=[],r=[],s=null,o=null;for(let f of e._.instanceOf){for(let i in f.meta){if(f.meta.hasOwnProperty(i)){switch(r=f.meta[i],f.meta[i].type){case"func":s=new u(e,i,f.meta[i].ref,f.meta[i].raw),t.push(s);break;case"prop":s=new a(e,i,f.meta[i].ref),t.push(s);break;case"event":s=new c(e,i,f.meta[i].argNames,f.meta[i].ref),t.push(s);break;default:throw"Unknown member type"}"undefined"!=typeof n&&i===n&&(t=[],o=s)}if(null!==o)break}if(null!==o)break}return null!==o?o:{all:(...e)=>{return i(t,"",e)},func:(...e)=>{return i(t,"func",e)},prop:(...e)=>{return i(t,"prop",e)},event:(...e)=>{return i(t,"event",e)}}};return t.getClass=(()=>{return null!==e._.inherits?new d(e._.inherits):null}),t.getFamily=(()=>{let n=[],t=e._.inherits;for(;;){if(null===t)break;n.push(new d(t)),t=t._.inherits}return n}),t.getMixins=(()=>{let e=[],n=t.getFamily();for(let i of n)e=e.concat(i.getMixins());return e}),t.getInterfaces=(()=>{let e=[],n=t.getFamily();for(let i of n)e=e.concat(i.getInterfaces());return e}),t.getMembers=((...e)=>{let n=r();return 0!==e.length?n.all(...e):n}),t.getMember=(e=>{return r(e)}),t.isSingleton=(()=>{return t.getClass().isSingleton()}),t.isInstanceOf=(n=>{return e._.isInstanceOf(n)}),t.isMixed=(n=>{return e._.isMixed(n)}),t.isImplements=(n=>{return e._.isImplements(n)}),t},p=function(e){let t=new n(e);return t.getStruct=(()=>{return null!==e._.inherits?new h(e._.inherits):null}),t.getMembers=(()=>{let n=Object.keys(e),t=n.indexOf("_");return t!==-1&&n.splice(t,1),n}),t.getMember=(n=>{return e[n]}),t.invoke=((...n)=>{return e[G](...n)}),t.isInstanceOf=(n=>{return e._.inherits._.name===n}),t},d=function(e){let t=new n(e);return t.getParent=(()=>{return null!==e._.inherits?new d(e._.inherits):null}),t.getFamily=(()=>{let n=[],t=e._.inherits;for(;;){if(null===t)break;n.push(new d(t)),t=t._.inherits}return n}),t.getMixins=(()=>{let n=[];for(let t of e._.mixins)n.push(new _(t));return n}),t.getInterfaces=(()=>{let n=[];for(let t of e._.interfaces)n.push(new v(t));return n}),t.isSingleton=(()=>{return e._.isSingleton()}),t.isSingleInstanceCreated=(()=>{return null!==e._.singleInstance()}),t.isSealed=(()=>{return e._.isSealed()}),t.isDerivedFrom=(n=>{return e._.isDerivedFrom(n)}),t.isMixed=(n=>{return e._.isMixed(n)}),t.isImplements=(n=>{return e._.isImplements(n)}),t},m=function(e){let t=new n(e);return t.getMembers=(()=>{let n=e._.keys(),t=[];for(let i of n)t.push(new f(e,i));return t}),t.getMember=(n=>{if("undefined"==typeof e[n])throw`${n} is not defined.`;return new f(e,n)}),t.getKeys=(()=>{return e._.keys()}),t.getValues=(()=>{return e._.values()}),t},g=function(e){let t=new n(e);return t.isASync=(()=>{e.isASync()}),t.invoke=((...n)=>{return e._.invoke(...n)}),t},y=function(e){let t=new n(e);return t.getFile=(()=>{return e.file()}),t.getResType=(()=>{return e.type()}),t.getContent=(()=>{return e.get()}),t},h=function(e){let t=new n(e);return t},w=function(e){let t=new n(e);return t.getMembers=(()=>{let n=e.getTypes(),t=[];if(n)for(let i of n)switch(i._.type){case"class":t.push(new d(i));break;case"enum":t.push(new m(i));break;case"struct":t.push(new h(i));break;case"mixin":t.push(new _(i));break;case"interface":t.push(new v(i))}return t}),t.getMember=(n=>{let t=e.getType(n),i=null;if(t)switch(t._.type){case"class":i=new d(t);break;case"enum":i=new m(t);break;case"struct":i=new h(t);break;case"mixin":i=new _(t);break;case"interface":i=new v(t)}return i}),t.createInstance=((n,...t)=>{return e.createInstance(n,...t)}),t},b=function(e){let t=new n(e);return t.getTypes=(()=>{return e.types}),t.getAssets=(()=>{return e.assets}),t.getADO=(()=>{return e._.ado}),t.load=(()=>{return e.load()}),t},_=function(e){let t=new n(e);return t},v=function(e){let i=new n(e),r=()=>{let n=[];for(let i in e)e.hasOwnProperty(i)&&"_"!==i&&n.push(new t(e[i].type,e,i));return n};return i.getMembers=(()=>{return r()}),i.getMember=(n=>{if("undefined"==typeof e[n])throw`${n} is not defined.`;return new t(e[n].type,e,n)}),i};let A=null;switch(e._.type){case"instance":A=new l(e);break;case"sinstance":A=new p(e);break;case"class":A=new d(e);break;case"enum":A=new m(e);break;case"proc":A=new g(e);break;case"resource":A=new y(e);break;case"struct":A=new h(e);break;case"namespace":A=new w(e);break;case"assembly":A=new b(e);break;case"mixin":A=new _(e);break;case"interface":A=new v(e);break;default:throw`Unknown type ${e._.type}.`}return A},i.members.push("Reflector"),x.define("moduleLoader","function"),x.define("fileLoader","function"),x.define("sessionStorage","object",["key","setItem","getItem"]),x.define("localStorage","object",["key","setItem","getItem"]),x.define("pubsub","object",["publish","subscribe"]),S.define("raw","flair.system.raw"),S.define("exec","flair.system.exec"),S.define("info","flair.system.info"),!a.env.suppressGlobals)for(let G of i.members)t[G]=Object.freeze(i[G]);return i.members=Object.freeze(i.members),t.flair=i,t.flair});