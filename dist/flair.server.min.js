/**
 * @preserve
 * Flair.js
 * True Object Oriented JavaScript
 * 
 * Assembly: flair.server
 *     File: ./flair.server.js
 *  Version: 0.17.13
 *  Sun, 17 Mar 2019 01:44:38 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * Licensed under MIT
 */
(()=>{"use strict";const e=void 0!==!0?require("flairjs"):"undefined"!=typeof WorkerGlobalScope?WorkerGlobalScope.flair:(!0).flair,{Class:r,Struct:s,Enum:t,Interface:n,Mixin:i}=e,{Aspects:o}=e,{AppDomain:a}=e,l=e.AppDomain.context.current().name,{$$:c,attr:d}=e,{bring:p,Container:f,include:u}=e,{Port:v}=e,{on:m,post:y,telemetry:h}=e,{Reflector:b}=e,{Serializer:$}=e,{Tasks:g}=e,{TaskInfo:w}=e.Tasks,{as:A,is:S,isComplies:x,isDerivedFrom:O,isImplements:j,isInstanceOf:R,isMixed:T}=e,{getAssembly:k,getAttr:B,getContext:E,getResource:M,getRoute:F,getType:H,ns:V,getTypeOf:z,typeOf:D}=e,{dispose:I,using:W}=e,{Args:P,Exception:q,noop:C,nip:N,nim:G,nie:L,event:J}=e,{env:U}=e.options,{forEachAsync:K,replaceAll:Q,splitAndTrim:X,findIndexByProp:Y,findItemByProp:Z,which:_,isArrowFunc:ee,isASyncFunc:re,sieve:se,b64EncodeUnicode:te,b64DecodeUnicode:ne}=e.utils,{$static:ie,$abstract:oe,$virtual:ae,$override:le,$sealed:ce,$private:de,$privateSet:pe,$protected:fe,$protectedSet:ue,$readonly:ve,$async:me}=c,{$enumerate:ye,$dispose:he,$post:be,$on:$e,$timer:ge,$type:we,$args:Ae,$inject:Se,$resource:xe,$asset:Oe,$singleton:je,$serialize:Re,$deprecate:Te,$session:ke,$state:Be,$conditional:Ee,$noserialize:Me,$ns:Fe}=c;let He=JSON.parse('{"envVars":[],"envVarsloadOptions":{"overwrite":true},"mounts":{"main":"/"},"main-appSettings":[{"name":"case sensitive routing","value":false},{"name":"strict routing","value":false}],"main-middlewares":[],"main-resHeaders":[]}'),Ve=e.Port("settingsReader");if("function"==typeof Ve){let e=Ve("flair.server");e&&(He=Object.assign(He,e))}He=Object.freeze(He),e.AppDomain.context.current().currentAssemblyBeingLoaded("./flair.server{.min}.js"),(async()=>{const{Bootware:e}=V();c("sealed"),c("ns","flair.bw.server"),r("Middlewares",e,function(){c("override"),this.construct=(e=>{e("Express Middlewares",!0)}),c("override"),this.boot=(async e=>{let r=He[`${e.name}-middlewares`];if(r&&r.length>0){let s=null,t=null;for(let n of r)if(n.module)try{s=require(n.name),t=n.func?s[n.func]:s;let r=[],i=null;n.args=n.args||[];for(let e of n.args){if("string"==typeof e&&e.startsWith("return "))i=new Function(e)();else if("object"==typeof e)for(let r in e)e.hasOwnProperty(r)&&"string"==typeof(i=e[r])&&i.startsWith("return ")&&(i=new Function(e)(),e[r]=i);else i=e;r.push(i)}e.app.use(t(...r))}catch(e){throw q.OperationFailed(`Middleware ${n.module} load failed.`,e,this.boot)}}})})})(),(async()=>{const{Bootware:e}=V();c("sealed"),c("ns","flair.bw.server"),r("NodeEnv",e,function(){c("override"),this.construct=(e=>{e("Node Server Environment")}),c("override"),this.boot=(async()=>{if(He.envVars.length>0){const e=require("node-env-file");for(let r of He.envVars)e(r,He.envVarsLoadOptions)}})})})(),(async()=>{const{Bootware:e}=V();c("sealed"),c("ns","flair.bw.server"),r("ResHeaders",e,function(){c("override"),this.construct=(e=>{e("Server Response Headers",!0)}),c("override"),this.boot=(async e=>{let r=He[`${e.name}-resHeaders`];r&&r.length>0&&e.app.use((e,s,t)=>{for(let e of r)s.setHeader(e.name,e.value);t()})})})})(),(async()=>{const{Bootware:e}=V();c("sealed"),c("ns","flair.bw.server"),r("Router",e,function(){let e=null;c("override"),this.construct=(e=>{e("Server Router",!0)}),c("override"),this.boot=(async r=>{e||(e=a.context.current().allRoutes(!0)).sort((e,r)=>e.index<r.index?-1:e.index>r.index?1:0);let s=null,t=!1;for(let n of e)n.mount===r.name&&(r.app[n.verb]=(n.path,(e,r,i)=>{const o=e=>{e?r.end():i()},a=e=>{throw r.status(500).end(),q.OperationFailed(e,s[n.verb])};s=new n.Handler;try{"function"==typeof(t=s[n.verb](e,r)).then?t.then(e=>{o(e)}).catch(a):o(t)}catch(e){a(e)}}))})})})(),(async()=>{const{App:e}=V("flair.boot");c("ns","flair.server"),r("App",e,function(){c("override"),this.boot=(async()=>{}),c("override"),this.start=(async()=>{}),c("override"),this.stop=(async()=>{}),c("override"),this.ready=(async()=>{})})})(),(async()=>{const e=require("express"),{ServerHost:s}=V("flair.boot");c("sealed"),c("ns","flair.server"),r("Server",s,function(){let r={};c("override"),this.construct=(e=>{e("Express","4.x")}),this.mounts={get:()=>r,set:C},c("override"),this.boot=(async s=>{s();const t=(e,r)=>{let s=He[`${e}-appSettings`];if(s&&s.length>0)for(let e of s)r.set(e.name,e.value)};let n=e();t("main",n);let i="",o=null;for(let s of Object.keys(He.mounts))"main"===s?(i="/",o=n):(i=He.mounts[s],o=e()),r[s]=Object.freeze({name:s,root:i,app:o}),"main"!==s&&(t(s,o),n.use(i,o));r=Object.freeze(r)}),c("override"),this.start=(async e=>{e()}),c("override"),this.stop=(async e=>{e()}),c("override"),this.ready=(async e=>{e()}),c("override"),this.dispose=(e=>{e(),r=null})})})(),(async()=>{const{App:e}=V("flair.boot");c("ns","flair.server"),r("WorkerApp",e,function(){c("override"),this.boot=(async()=>{}),c("override"),this.start=(async()=>{}),c("override"),this.stop=(async()=>{}),c("override"),this.ready=(async()=>{})})})(),e.AppDomain.context.current().currentAssemblyBeingLoaded(""),e.AppDomain.registerAdo('{"name":"flair.server","file":"./flair.server{.min}.js","desc":"True Object Oriented JavaScript","title":"Flair.js","version":"0.17.13","lupdate":"Sun, 17 Mar 2019 01:44:38 GMT","builder":{"name":"<<name>>","version":"<<version>>","format":"fasm","formatVersion":"1","contains":["initializer","types","enclosureVars","enclosedTypes","resources","assets","routes","selfreg"]},"copyright":"(c) 2017-2019 Vikas Burman","license":"MIT","types":["flair.bw.server.Middlewares","flair.bw.server.NodeEnv","flair.bw.server.ResHeaders","flair.bw.server.Router","flair.server.App","flair.server.Server","flair.server.WorkerApp"],"resources":[],"assets":[],"routes":[]}')})();
//# sourceMappingURL=./flair.server.min.js.map