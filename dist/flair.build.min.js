/**
 * @preserve
 * FlairJS
 * True Object Oriented JavaScript
 * 
 * Assembly: flair.build
 *     File: ./flair.build.js
 *  Version: 0.15.201
 *  Wed, 20 Feb 2019 03:35:59 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * Licensed under MIT
 */
const e=require("recursive-readdir-sync"),n=require("copy-dir"),i=require("path"),t=require("fs-extra"),s=require("del"),r=new require("eslint").CLIEngine,o=require("uglify-js-harmony"),c=require("zlib");let a,f,u,l,p,g=!1,d=!1,y=!1,h=!1,S=!1,m,j=["flair","flair.build"],F=null,x=(e,n)=>{const s=()=>{return t.readdirSync(e).filter(n=>{return t.statSync(i.join(e,n)).isDirectory()})};return n?s():["/"].concat(s())},w=e=>{s.sync([e+"/**","!"+e])};const O=(e,i,s)=>{i.length>0&&P(`
      deps: ${i.length} `+(e?"(post)":"(pre)"));const r=i=>{if(0!==i.length){let s=i.shift();if(P(`            - ${s.dest}`),!e&&s.src.startsWith("http")){let e=null,n="";e=s.src.startsWith("https")?require("https"):require("http"),e.get(s.src,e=>{e.on("data",e=>{n+=e}),e.on("end",()=>{t.ensureFileSync(s.dest),t.writeFileSync(s.dest,n,"utf8"),r(i)})}).on("error",e=>{throw`Failed to fetch dependency: ${s.src}. 

 ${e}`})}else t.lstatSync(s.src).isDirectory()?n.sync(s.src,s.dest):t.copyFileSync(s.src,s.dest),r(i)}else s()};r(i.slice())},b=e=>{return e.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1")},z=(e,n,i)=>{return e.replace(new RegExp(b(n),"g"),i)},N=(e,n)=>{const s="\\s*([\\(\\)\\w@_\\-.\\\\/]+)\\s*",r="<filename>",o="<!--\\s*inject:<filename>-->",c="^([ \\t]*)(.*?)"+o.replace(r,s),a=new RegExp(c,"m");let f,u,l,p,g;for(;p=a.exec(n);){g=p[0],l=p[1],u=p[2],f=p[3];var d=l+u+t.readFileSync(i.join(e,f),"utf8").split(/\r?\n/).map((e,n)=>{return n>0?l+e:e}).join("\n");n=n.replace(g,function(){return d})}return n},C=e=>{let n=p.version.split(".");n[0]=parseInt(n[0]),n[1]=parseInt(n[1]),n[2]=parseInt(n[2]),n[2]>=99999?(n[2]=0,n[1]>=999?(n[1]=0,n[0]+=1):n[1]+=1):n[2]+=1;let i=n[0].toString()+"."+n[1].toString()+"."+n[2].toString();return p.version=i,t.writeFileSync(e,JSON.stringify(p,null,4),"utf8"),i},P=e=>{g||console.log(e)},k=(s,r,f,l,g,d,O)=>{const b=(e,n,i=true)=>{i?t.writeFileSync(e,n,{flag:"a"}):t.writeFileSync(e,n)},C=(e,n)=>{let i=`/**
`+` * @preserve
`+` * ${p.title}
`+` * ${p.description}
`+` * 
`+` * Assembly: ${n}
`+` *     File: ${e.replace(l,".")}
`+` *  Version: ${p.version}
`+` *  ${(new Date).toUTCString()}
`+` * 
`+` * ${p.copyright}
`+` * Licensed under ${p.license}
`+` */
`;b(e,i)},k=(e,n)=>{let i=`(() => {
`+`   const { $$, attr, Class, Struct, Enum, Interface, Mixin, Exception, Args } = flair; // eslint-disable-line no-unused-vars
`+`   const { Aspects, Assembly, Resource, Namespace, Container, Reflector, Serializer } = flair;   // eslint-disable-line no-unused-vars
`+`   const { getAttr, getAssembly, getResource, getTypeOf } = flair;                     // eslint-disable-line no-unused-vars
`+`   const { getType, typeOf, as, is, isDerivedFrom, isInstanceOf, isComplies, isImplements, isMixed } = flair;  // eslint-disable-line no-unused-vars
`+`   const { include, dispose, using, on, dispatch } = flair;                            // eslint-disable-line no-unused-vars
`+`   const { noop, telemetry } = flair;                                                  // eslint-disable-line no-unused-vars
`+`   const { isServer } = flair.options.env;                                             // eslint-disable-line no-unused-vars
`+`
`;n?i+=`   const settings = JSON.parse('${n}'); // eslint-disable-line no-unused-vars
`:`   const settings = {}; // eslint-disable-line no-unused-vars
`,b(e,i)},q=e=>{let n=`
`+`})();
`;b(e,n)},J=(e,n,i)=>{if(j.indexOf(i)===-1){let t={name:i,file:n.replace(".js","{.min}.js").replace(l,"."),desc:p.description,version:p.version,copyright:p.copyright,license:p.license,types:[],resources:[],assets:[]};return e.push(t),t}},v=(e,n,i,t)=>{if(j.indexOf(n)===-1)if(["types","resources","assets"].indexOf(i)!==-1){if(e[i].indexOf(t)!==-1)throw`Member is already added/associated with assembly. (${t})`;e[i].push(t)}else e[i]=t},A=(e,s,r,o)=>{t.existsSync(r)&&(P(`    assets: ${r.replace(f,".")}`),t.ensureDirSync(o),n.sync(r,o,function(n,a,f){if("file"===n){v(e,s,"assets","./"+f);let n=i.extname(f),p=!1,g="",y="",h=t.statSync(f);if(S&&d.indexOf(n)!==-1&&(g=a,y=a.replace(r,o)+".gz",t.writeFileSync(y,c.gzipSync(t.readFileSync(g,"utf8"),u)),p=!0),p){let e=t.statSync(y);P("            - ./"+i.join(o.replace(l,"./")+"/"+f)+" ("+Math.round(h.size/1024)+"kb, "+Math.round(e.size/1024)+"kb gzipped)")}else P("            - ./"+i.join(o.replace(l,"./")+"/"+f)+" ("+Math.round(h.size/1024)+"kb)")}return!0},function(e){throw e}))},M=(e,n)=>{return t.existsSync(n)?(P("  settings: "+n.replace(f,".")),JSON.stringify(JSON.parse(t.readFileSync(n)))):""},W=(e,n,i,t,s,r)=>{e.push({ado:n,asmName:i,asm:t,file:s,qualifiedName:r})},T=(e,n,s,r,o)=>{let c="",a="",u=i.extname(r).toLowerCase();v(e,n,"resources",o),g.indexOf(u)===-1?(c=t.readFileSync(r,"utf8"),a="utf8;"):(c=t.readFileSync(r),a=""),c=new Buffer(c).toString("base64"),a+="base64;";let p=`flair.Resource.register("${o}", "${a}", "${r.replace(l,".")}", "${c}");
`;b(s,p),P("            - "+o+" ("+r.replace(f,".")+")")},E=e=>{if(e.length>0){P(` resources: ${e.length}`);for(let n of e)T(n.ado,n.asmName,n.asm,n.file,n.qualifiedName)}},L=(e,n,i,t,s,r,o,c,a)=>{e.push({ado:n,asmName:i,asm:t,file:s,basepath:r,nsName:o,typeName:c,qualifiedName:a})},R=(e,n,i,s,r,o,c,a)=>{v(e,n,"types",a);let u=t.readFileSync(s,"utf8");u=z(u,`$$('ns', '(auto)');`,`$$$('ns', '${o}');`),u=z(u,`$$("ns", "(auto)");`,`$$$("ns", "${o}");`),u=z(u,`Class('(auto)'`,`Class('${c}'`),u=z(u,`Class("(auto)"`,`Class("${c}"`),u=z(u,`Struct('(auto)'`,`Struct('${c}'`),u=z(u,`Struct("(auto)"`,`Struct("${c}"`),u=z(u,`Mixin('(auto)'`,`Mixin('${c}'`),u=z(u,`Mixin("(auto)"`,`Mixin("${c}"`),u=z(u,`Enum('(auto)'`,`Enum('${c}'`),u=z(u,`Enum("(auto)"`,`Enum("${c}"`),u=z(u,`Interface('(auto)'`,`Interface('${c}'`),u=z(u,`Interface("(auto)"`,`Interface("${c}"`),u=I(r,u),b(i,u),P("            - "+a+" ("+s.replace(f,".")+")")},_=(e,n,t,s)=>{if(e.length>0){P(`     types: ${e.length}`);let r=i.join(s,t,"settings.json");k(n,M(t,r));for(let o of e)R(o.ado,o.asmName,o.asm,o.file,o.basepath,o.nsName,o.typeName,o.qualifiedName);q(n)}},D=(e,n,i)=>{if(j.indexOf(i)===-1){P("   selfreg: yes");let i=`flair.Assembly.register('${JSON.stringify(e)}');
`;b(n,i)}},G=(e,n,i)=>{if(t.existsSync(n)){let s=t.readFileSync(n,"utf8");s=I(i,s),b(e,s),P("     index: "+n.replace(f,"."))}},I=(e,n)=>{return N(e,n)},B=e=>{let n=m.executeOnFiles([e]);if((n.errorCount>0||n.warningCount>0)&&(P(F(n.results)),n.errorCount>0))throw`${n.errorCount} Linting errors found.`},Z=(e,n,i)=>{let s=o.minify([e],a);if(s.error)throw`Error minifying ${e}. 

 ${s.error}`;t.writeFileSync(n,s.code),h&&t.writeFileSync(i,c.gzipSync(s.code,u))},$=(e,n)=>{if(0!==e.length){P(`
  preamble: ${n.replace(l,".")}`);let i=JSON.stringify(e),s=`(() => { let ados = JSON.parse('${i}');flair.Assembly.register(ados);})();`;t.writeFileSync(n,s)}},U=(n,s)=>{"."!==n.replace(f,".")&&P(`
     group: ${n.replace(f,".")} (start)`);let r=[],o=i.join(s,"preamble.js"),c=x(n,!0);for(let a of c)if(!a.startsWith("_")){P("\n       asm: "+a);let o=i.join(s,a+".js"),c=[],f=[];t.ensureFileSync(o),C(o,a);let u=i.join(n,a,"index.js"),p=i.join(n,a);G(o,u,p);let g=J(r,o,a),d=x(i.join(n,a),!0);for(let S of d)if(!S.startsWith("_")&&["(assets)","(bundle)"].indexOf(S)===-1){let t="",s="",r=i.join(n,a,S),u=e(r),l="";for(let p of u)if(t=i.extname(p).toLowerCase(),p.indexOf("/_")===-1&&!p.endsWith(".spec.js"))if(p.endsWith(".res.js")){if(s=i.basename(p).replace(".res.js",""),s.indexOf(".")!==-1)throw`Resource name cannot contain dots. (${s})`;l=("(root)"!==S?S+".":"")+s,W(c,g,a,o,p,l)}else if(p.endsWith(".js")){if(s=i.basename(p).replace(".js",""),s.indexOf(".")!==-1)throw`Type name cannot contain dots. (${s})`;l=("(root)"!==S?S+".":"")+s,L(f,g,a,o,p,r,S,s,l)}else{if(!p.endsWith(".res"+t))continue;if(s=i.basename(p).replace(".res"+t,""),s.indexOf(".")!==-1)throw`Resource name cannot contain dots. (${s})`;l=("(root)"!==S?S+".":"")+s,W(c,g,a,o,p,l)}}let m=i.join(n,a,"(assets)"),j=i.join(s,a);A(g,a,m,j),_(f,o,a,n),E(c),D(g,o,a),B(o);let F=o.replace(".js",".min.js"),w=F+".gz";y&&Z(o,F,w);let O=t.statSync(o),b=y?t.statSync(F):null,z=h?t.statSync(w):null;P(y?h?"       ==>: "+o.replace(l,".")+" ("+Math.round(O.size/1024)+"kb, "+Math.round(b.size/1024)+"kb minified, "+ +Math.round(z.size/1024)+"kb gzipped)":"       ==>: "+o.replace(l,".")+" ("+Math.round(O.size/1024)+"kb, "+Math.round(b.size/1024)+"kb minified)":"       ==>: "+o.replace(l,".")+" ("+Math.round(O.size/1024)+"kb)")}$(r,o),"."!==n.replace(f,".")&&P(`
     group: ${n.replace(f,".")} (end)`)};w(l);let H,K="";for(let Q of s)H=Q,H.startsWith("_")||(K=Q.replace(f,l),U(H,K));"function"==typeof O&&O()};module.exports=function(e,n){"function"==typeof e&&(n=e,e={}),e=e||{},e.suppressLogging=e.suppressLogging||!1,e.rootPath=e.rootPath||process.cwd(),e.isFull=e.isFull||!1,e.minify=e.minify||!1,e.gzip=e.gzip||!1,e.gzipAssets=e.gzipAssets||!1,e.src=e.src||i.join(e.rootPath,"src"),e.dest=e.dest||i.join(e.rootPath,"dist"),e.processAsGroups=e.processAsGroups||!1,e.gzConfig=e.gzConfig||i.join(e.rootPath,"build/config/.gz.json"),e.uglifyConfig=e.uglifyConfig||i.join(e.rootPath,"build/config/.uglify.json"),e.eslintConfig=e.eslintConfig||i.join(e.rootPath,"build/config/.eslint.json"),e.depsConfig=e.depsConfig||i.join(e.rootPath,"build/config/.deps.json"),e.packageJSON=e.packageJSON||i.join(e.rootPath,"package.json"),e.gZipAssetFileTypes=[".txt",".xml",".js",".md",".json",".css",".html",".svg","jpg","jpeg","gif","png"].concat(e.gZipAssetFileTypes||[]),e.utf8EncResFileTypes=[".txt",".xml",".js",".md",".json",".css",".html",".svg"].concat(e.utf8EncResFileTypes||[]),e.cb=e.cb||n,a=JSON.parse(t.readFileSync(e.uglifyConfig,"utf8")),f=JSON.parse(t.readFileSync(e.eslintConfig,"utf8")),u=JSON.parse(t.readFileSync(e.gzConfig,"utf8")),l=JSON.parse(t.readFileSync(e.depsConfig,"utf8")),p=JSON.parse(t.readFileSync(e.packageJSON,"utf8")),g=e.suppressLogging,d=e.isFull,y=e.minify,h=y&&e.gzip,S=h&&e.gzipAssets,P("\nflairBuild: start\n"),P(`   grouped: ${e.processAsGroups?"yes":"no"}`),P(`      root: ${e.rootPath}`),P(`       src: ${e.src.replace(e.rootPath,".")}`),P(`      dest: ${e.dest.replace(e.rootPath,".")}`),P(`      deps: ${e.depsConfig.replace(e.rootPath,".")}`),P(`    verify: ${e.eslintConfig.replace(e.rootPath,".")}`),P(`    minify: ${e.uglifyConfig.replace(e.rootPath,".")}`),m=new r(f),F=m.getFormatter();let s=()=>{P("\nflairBuild: end\n"),"function"==typeof n&&n()},o=()=>{let n=[];e.processAsGroups?n=x(e.src,!0):n.push(e.src);let i=p.version,t=C(e.packageJSON);P(`
   version: ${i} -> ${t}`),k(n,e.rootPath,e.src,e.dest,e.utf8EncResFileTypes,e.gZipAssetFileTypes,()=>{l.post.update&&d?O(!0,l.post.deps,s):s()})};l.pre.update&&d?O(!1,l.pre.deps,o):o()};