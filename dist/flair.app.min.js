/**
 * @preserve
 * Flair.js
 * True Object Oriented JavaScript
 * 
 * Assembly: flair.app
 *     File: ./flair.app.js
 *  Version: 0.30.13
 *  Tue, 02 Apr 2019 11:22:39 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * Licensed under MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof!0&&(!0).amd?(!0)(e):t.page=e()}(this,function(){"use strict";var t=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)},e=g,n=a,i=c,r=p,o=y,s=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function a(t){for(var e=[],n=0,i=0,r="",o;null!=(o=s.exec(t));){var a=o[0],c=o[1],p=o.index;if(r+=t.slice(i,p),i=p+a.length,c)r+=c[1];else{r&&(e.push(r),r="");var h=o[2],u=o[3],f=o[4],d=o[5],v=o[6],m=o[7],y="+"===v||"*"===v,g="?"===v||"*"===v,w=h||"/",b=f||d||(m?".*":"[^"+w+"]+?");e.push({name:u||n++,prefix:h||"",delimiter:w,optional:g,repeat:y,pattern:l(b)})}}return i<t.length&&(r+=t.substr(i)),r&&e.push(r),e}function c(t){return p(a(t))}function p(e){for(var n=new Array(e.length),i=0;i<e.length;i++)"object"==typeof e[i]&&(n[i]=new RegExp("^"+e[i].pattern+"$"));return function(i){for(var r="",o=i||{},s=0;s<e.length;s++){var a=e[s];if("string"!=typeof a){var c=o[a.name],p;if(null==c){if(a.optional)continue;throw new TypeError('Expected "'+a.name+'" to be defined')}if(t(c)){if(!a.repeat)throw new TypeError('Expected "'+a.name+'" to not repeat, but received "'+c+'"');if(0===c.length){if(a.optional)continue;throw new TypeError('Expected "'+a.name+'" to not be empty')}for(var h=0;h<c.length;h++){if(p=encodeURIComponent(c[h]),!n[s].test(p))throw new TypeError('Expected all "'+a.name+'" to match "'+a.pattern+'", but received "'+p+'"');r+=(0===h?a.prefix:a.delimiter)+p}}else{if(p=encodeURIComponent(c),!n[s].test(p))throw new TypeError('Expected "'+a.name+'" to match "'+a.pattern+'", but received "'+p+'"');r+=a.prefix+p}}else r+=a}return r}}function h(t){return t.replace(/([.+*?=^!:${}()[\]|\/])/g,"\\$1")}function l(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function u(t,e){return t.keys=e,t}function f(t){return t.sensitive?"":"i"}function d(t,e){var n=t.source.match(/\((?!\?)/g);if(n)for(var i=0;i<n.length;i++)e.push({name:i,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return u(t,e)}function v(t,e,n){for(var i=[],r=0;r<t.length;r++)i.push(g(t[r],e,n).source);var o;return u(new RegExp("(?:"+i.join("|")+")",f(n)),e)}function m(t,e,n){for(var i=a(t),r=y(i,n),o=0;o<i.length;o++)"string"!=typeof i[o]&&e.push(i[o]);return u(r,e)}function y(t,e){for(var n=(e=e||{}).strict,i=!1!==e.end,r="",o=t[t.length-1],s="string"==typeof o&&/\/$/.test(o),a=0;a<t.length;a++){var c=t[a];if("string"==typeof c)r+=h(c);else{var p=h(c.prefix),l=c.pattern;c.repeat&&(l+="(?:"+p+l+")*"),r+=l=c.optional?p?"(?:"+p+"("+l+"))?":"("+l+")?":p+"("+l+")"}}return n||(r=(s?r.slice(0,-2):r)+"(?:\\/(?=$))?"),r+=i?"$":n&&s?"":"(?=\\/|$)",new RegExp("^"+r,f(e))}function g(e,n,i){return t(n=n||[])?i||(i={}):(i=n,n=[]),e instanceof RegExp?d(e,n,i):t(e)?v(e,n,i):m(e,n,i)}e.parse=n,e.compile=i,e.tokensToFunction=r,e.tokensToRegExp=o;var w="undefined"!=typeof document,b=void 0!==!0,$="undefined"!=typeof history,_="undefined"!=typeof process,x=w&&document.ontouchstart?"touchstart":"click",E=b&&!(!(!0).history.location&&!(!0).location),R;function S(){this.callbacks=[],this.exits=[],this.current="",this.len=0,this._decodeURLComponents=!0,this._base="",this._strict=!1,this._running=!1,this._hashbang=!1,this.clickHandler=this.clickHandler.bind(this),this._onpopstate=this._onpopstate.bind(this)}function k(){var t=new S;function e(){return O.apply(t,arguments)}return e.callbacks=t.callbacks,e.exits=t.exits,e.base=t.base.bind(t),e.strict=t.strict.bind(t),e.start=t.start.bind(t),e.stop=t.stop.bind(t),e.show=t.show.bind(t),e.back=t.back.bind(t),e.redirect=t.redirect.bind(t),e.replace=t.replace.bind(t),e.dispatch=t.dispatch.bind(t),e.exit=t.exit.bind(t),e.configure=t.configure.bind(t),e.sameOrigin=t.sameOrigin.bind(t),e.clickHandler=t.clickHandler.bind(t),e.create=k,Object.defineProperty(e,"len",{get:function(){return t.len},set:function(e){t.len=e}}),Object.defineProperty(e,"current",{get:function(){return t.current},set:function(e){t.current=e}}),e.Context=A,e.Route=L,e}function O(t,e){if("function"==typeof t)return O.call(this,"*",t);if("function"==typeof e)for(var n=new L(t,null,this),i=1;i<arguments.length;++i)this.callbacks.push(n.middleware(arguments[i]));else"string"==typeof t?this["string"==typeof e?"redirect":"show"](t,e):this.start(t)}function C(t){if(!t.handled){var e,n=this,i=this._window;(e=this._hashbang?E&&this._getBase()+i.location.hash.replace("#!",""):E&&i.location.pathname+i.location.search)!==t.canonicalPath&&(this.stop(),t.handled=!1,E&&(i.location.href=t.canonicalPath))}}function H(t){return t.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function A(t,e,n){var i=this.page=n||O,r=i._window,o=i._hashbang,s=i._getBase();"/"===t[0]&&0!==t.indexOf(s)&&(t=s+(o?"#!":"")+t);var a=t.indexOf("?");this.canonicalPath=t;var c=new RegExp("^"+H(s));if(this.path=t.replace(c,"")||"/",o&&(this.path=this.path.replace("#!","")||"/"),this.title=w&&r.document.title,this.state=e||{},this.state.path=t,this.querystring=~a?i._decodeURLEncodedURIComponent(t.slice(a+1)):"",this.pathname=i._decodeURLEncodedURIComponent(~a?t.slice(0,a):t),this.params={},this.hash="",!o){if(!~this.path.indexOf("#"))return;var p=this.path.split("#");this.path=this.pathname=p[0],this.hash=i._decodeURLEncodedURIComponent(p[1])||"",this.querystring=this.querystring.split("#")[0]}}function L(t,n,i){var r=this.page=i||P,o=n||{};o.strict=o.strict||i._strict,this.path="*"===t?"(.*)":t,this.method="GET",this.regexp=e(this.path,this.keys=[],o)}S.prototype.configure=function(t){var e=t||{};this._window=e.window||b&&!0,this._decodeURLComponents=!1!==e.decodeURLComponents,this._popstate=!1!==e.popstate&&b,this._click=!1!==e.click&&w,this._hashbang=!!e.hashbang;var n=this._window;this._popstate?n.addEventListener("popstate",this._onpopstate,!1):b&&n.removeEventListener("popstate",this._onpopstate,!1),this._click?n.document.addEventListener(x,this.clickHandler,!1):w&&n.document.removeEventListener(x,this.clickHandler,!1),this._hashbang&&b&&!$?n.addEventListener("hashchange",this._onpopstate,!1):b&&n.removeEventListener("hashchange",this._onpopstate,!1)},S.prototype.base=function(t){if(0===arguments.length)return this._base;this._base=t},S.prototype._getBase=function(){var t=this._base;if(t)return t;var e=b&&this._window&&this._window.location;return b&&this._hashbang&&e&&"file:"===e.protocol&&(t=e.pathname),t},S.prototype.strict=function(t){if(0===arguments.length)return this._strict;this._strict=t},S.prototype.start=function(t){var e=t||{};if(this.configure(e),!1!==e.dispatch){var n;if(this._running=!0,E){var i,r=this._window.location;n=this._hashbang&&~r.hash.indexOf("#!")?r.hash.substr(2)+r.search:this._hashbang?r.search+r.hash:r.pathname+r.search+r.hash}this.replace(n,null,!0,e.dispatch)}},S.prototype.stop=function(){if(this._running){this.current="",this.len=0,this._running=!1;var t=this._window;this._click&&t.document.removeEventListener(x,this.clickHandler,!1),b&&t.removeEventListener("popstate",this._onpopstate,!1),b&&t.removeEventListener("hashchange",this._onpopstate,!1)}},S.prototype.show=function(t,e,n,i){var r=new A(t,e,this),o=this.prevContext;return this.prevContext=r,this.current=r.path,!1!==n&&this.dispatch(r,o),!1!==r.handled&&!1!==i&&r.pushState(),r},S.prototype.back=function(t,e){var n=this;if(this.len>0){var i=this._window;$&&i.history.back(),this.len--}else t?setTimeout(function(){n.show(t,e)}):setTimeout(function(){n.show(n._getBase(),e)})},S.prototype.redirect=function(t,e){var n=this;"string"==typeof t&&"string"==typeof e&&O.call(this,t,function(t){setTimeout(function(){n.replace(e)},0)}),"string"==typeof t&&void 0===e&&setTimeout(function(){n.replace(t)},0)},S.prototype.replace=function(t,e,n,i){var r=new A(t,e,this),o=this.prevContext;return this.prevContext=r,this.current=r.path,r.init=n,r.save(),!1!==i&&this.dispatch(r,o),r},S.prototype.dispatch=function(t,e){var n=0,i=0,r=this;function o(){var t=r.exits[i++];if(!t)return s();t(e,o)}function s(){var e=r.callbacks[n++];if(t.path===r.current)return e?void e(t,s):C.call(r,t);t.handled=!1}e?o():s()},S.prototype.exit=function(t,e){if("function"==typeof t)return this.exit("*",t);for(var n=new L(t,null,this),i=1;i<arguments.length;++i)this.exits.push(n.middleware(arguments[i]))},S.prototype.clickHandler=function(t){if(1===this._which(t)&&!(t.metaKey||t.ctrlKey||t.shiftKey||t.defaultPrevented)){var e=t.target,n=t.path||(t.composedPath?t.composedPath():null);if(n)for(var i=0;i<n.length;i++)if(n[i].nodeName&&"A"===n[i].nodeName.toUpperCase()&&n[i].href){e=n[i];break}for(;e&&"A"!==e.nodeName.toUpperCase();)e=e.parentNode;if(e&&"A"===e.nodeName.toUpperCase()){var r="object"==typeof e.href&&"SVGAnimatedString"===e.href.constructor.name;if(!e.hasAttribute("download")&&"external"!==e.getAttribute("rel")){var o=e.getAttribute("href");if((this._hashbang||!this._samePath(e)||!e.hash&&"#"!==o)&&!(o&&o.indexOf("mailto:")>-1)&&(r?!e.target.baseVal:!e.target)&&(r||this.sameOrigin(e.href))){var s=r?e.href.baseVal:e.pathname+e.search+(e.hash||"");s="/"!==s[0]?"/"+s:s,_&&s.match(/^\/[a-zA-Z]:\//)&&(s=s.replace(/^\/[a-zA-Z]:\//,"/"));var a=s,c=this._getBase();0===s.indexOf(c)&&(s=s.substr(c.length)),this._hashbang&&(s=s.replace("#!","")),(!c||a!==s||E&&"file:"===this._window.location.protocol)&&(t.preventDefault(),this.show(a))}}}}},S.prototype._onpopstate=(R=!1,b?(w&&"complete"===document.readyState?R=!0:(!0).addEventListener("load",function(){setTimeout(function(){R=!0},0)}),function t(e){if(R){var n=this;if(e.state){var i=e.state.path;this.replace(i,e.state)}else if(E){var r=this._window.location;this.show(r.pathname+r.search+r.hash,void 0,void 0,!1)}}}):function(){}),S.prototype._which=function(t){return null==(t=t||b&&this._window.event).which?t.button:t.which},S.prototype._toURL=function(t){var e=this._window;if("function"==typeof URL&&E)return new URL(t,e.location.toString());if(w){var n=e.document.createElement("a");return n.href=t,n}},S.prototype.sameOrigin=function(t){if(!t||!E)return!1;var e=this._toURL(t),n,i=this._window.location;return i.protocol===e.protocol&&i.hostname===e.hostname&&i.port===e.port},S.prototype._samePath=function(t){if(!E)return!1;var e,n=this._window.location;return t.pathname===n.pathname&&t.search===n.search},S.prototype._decodeURLEncodedURIComponent=function(t){return"string"!=typeof t?t:this._decodeURLComponents?decodeURIComponent(t.replace(/\+/g," ")):t},A.prototype.pushState=function(){var t=this.page,e=t._window,n=t._hashbang;t.len++,$&&e.history.pushState(this.state,this.title,n&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},A.prototype.save=function(){var t=this.page;$&&t._window.history.replaceState(this.state,this.title,t._hashbang&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},L.prototype.middleware=function(t){var e=this;return function(n,i){if(e.match(n.path,n.params))return t(n,i);i()}},L.prototype.match=function(t,e){var n=this.keys,i=t.indexOf("?"),r=~i?t.slice(0,i):t,o=this.regexp.exec(decodeURIComponent(r));if(!o)return!1;for(var s=1,a=o.length;s<a;++s){var c=n[s-1],p=this.page._decodeURLEncodedURIComponent(o[s]);void 0===p&&hasOwnProperty.call(e,c.name)||(e[c.name]=p)}return!0};var P=k(),U=P,T=P;return U.default=T,U}),(()=>{"use strict";const t=void 0!==!0?require("flairjs"):(!0).flair,{Class:e,Struct:n,Enum:i,Interface:r,Mixin:o,Aspects:s,AppDomain:a,$$:c,attr:p,bring:h,Container:l,include:u,Port:f,on:d,post:v,telemetry:m,Reflector:y,Serializer:g,Tasks:w,as:b,is:$,isComplies:_,isDerivedFrom:x,isAbstract:E,isSealed:R,isStatic:S,isSingleton:k,isDeprecated:O,isImplements:C,isInstanceOf:H,isMixed:A,getAssembly:L,getAttr:P,getContext:U,getResource:T,getRoute:j,getType:I,ns:B,getTypeOf:M,getTypeName:D,typeOf:V,dispose:z,using:F,Args:N,Exception:W,noop:q,nip:K,nim:G,nie:J,event:Z}=t,{TaskInfo:Q}=t.Tasks,{env:X}=t.options,{forEachAsync:Y,replaceAll:tt,splitAndTrim:et,findIndexByProp:nt,findItemByProp:it,which:rt,isArrowFunc:ot,isASyncFunc:st,sieve:at,b64EncodeUnicode:ct,b64DecodeUnicode:pt}=t.utils,{$$static:ht,$$abstract:lt,$$virtual:ut,$$override:ft,$$sealed:dt,$$private:vt,$$privateSet:mt,$$protected:yt,$$protectedSet:gt,$$readonly:wt,$$async:bt,$$overload:$t,$$enumerate:_t,$$dispose:xt,$$post:Et,$$on:Rt,$$timer:St,$$type:kt,$$args:Ot,$$inject:Ct,$$resource:Ht,$$asset:At,$$singleton:Lt,$$serialize:Pt,$$deprecate:Ut,$$session:Tt,$$state:jt,$$conditional:It,$$noserialize:Bt,$$ns:Mt}=c,Dt=a.context.current().name;let Vt=X.isServer?__filename:(!0).document.currentScript.src.replace((!0).document.location.href,"./"),zt=Vt.substr(0,Vt.lastIndexOf("/")+1);a.loadPathOf("flair.app",zt);const Ft=t=>{a.onError(t)};let Nt=JSON.parse('{"host":"flair.app.ServerHost | flair.app.ClientHost","app":"flair.app.App","load":[],"container":{},"envVars":[],"envVarsloadOptions":{"overwrite":true},"mounts":{"main":"/"},"main-appSettings":[],"main-middlewares":[],"server-http":{"enable":false,"port":80,"timeout":-1},"server-https":{"enable":false,"port":443,"timeout":-1,"privateKey":"","publicCert":""}}'),Wt=t.Port("settingsReader");if("function"==typeof Wt){let t=Wt("flair.app");t&&(Nt=Object.assign(Nt,t))}Nt=Object.freeze(Nt),a.context.current().currentAssemblyBeingLoaded("./flair.app{.min}.js"),(async()=>{try{c("abstract"),c("ns","flair.app"),e("Bootware",function(){c("virtual"),this.construct=((t,e,n)=>{let i=N("name: string, version: string","name: string, version: string, isMountSpecific: boolean","name: string, isMountSpecific: boolean","name: string")(t,e,n);i.throwOnError(this.construct),this.info=Object.freeze({name:i.values.name||"",version:i.values.version||"",isMountSpecific:i.values.isMountSpecific||!1})}),c("virtual"),c("async"),this.boot=q,c("readonly"),this.info=null,c("virtual"),c("async"),this.ready=q,c("virtual"),this.dispose=q})}catch(t){Ft(t)}})(),(async()=>{try{const{IDisposable:t}=B(),{Bootware:n}=B("flair.app");c("ns","flair.app"),e("App",n,[t],function(){c("override"),this.construct=(t=>{let e=L(this);t(e.title,e.version)}),c("override"),this.boot=(async t=>{t(),a.host().error.add(this.onError)}),c("virtual"),c("async"),this.start=q,c("virtual"),c("async"),this.stop=q,c("virtual"),this.onError=(t=>{throw W.OperationFailed(t.error,this.onError)}),c("override"),this.dispose=(()=>{a.host().error.remove(this.onError)})})}catch(t){Ft(t)}})(),(async()=>{try{const{IDisposable:t}=B(),{Bootware:n}=B("flair.app");c("ns","flair.app"),e("Host",n,[t],function(){c("privateSet"),this.isStarted=!1,c("virtual"),this.start=(async()=>{this.isStarted=!0}),c("virtual"),this.stop=(async()=>{this.isStarted=!1}),this.restart=(async()=>{await this.stop(),await this.start()}),this.error=Z(t=>({error:t})),this.raiseError=(t=>{this.error(t)})})}catch(t){Ft(t)}})(),(async()=>{try{const{IDisposable:t}=B();c("ns","flair.app"),e("Handler",[t],function(){c("privateSet"),this.flags=[],c("virtual"),this.construct=(t=>{this.flags=t}),c("virtual"),this.dispose=(()=>{this.flags=null})})}catch(t){Ft(t)}})(),(async()=>{try{const{Bootware:t}=B("flair.app");c("static"),c("ns","flair.app"),e("BootEngine",function(){this.start=async function(){let e=[],n=[];const i=async()=>{let i=null,r=null,o=null;for(let s of Nt.load)(s=rt(s))&&(i=await u(s))&&"boolean"!=typeof i&&(r=b(i,t))&&(o=new r,e.push(o),o.info.isMountSpecific&&n.push(o))},r=async t=>{if(X.isWorker){0!==n.length&&console.warn("Mount specific bootwares are not supported for worker environment. Revisit worker:flair.app->load setting.");for(let n of e)n.info.isMountSpecific||await n[t]()}else{let i=a.host().mounts,r=Object.keys(i),o="",s=null;s=i[o="main"];for(let n of e)await n[t](o,s);for(let e of r)if("main"!==e){s=i[e];for(let i of n)await i[t](e,s)}}},o=async()=>{if(!X.isWorker){let e=rt(Nt.host),n=b(await u(e),t),i=null;if(!n)throw W.InvalidDefinition(e,this.start);i=new n,await i.boot(),a.host(i)}await r("boot");let e=rt(Nt.app),n=b(await u(e),t),i=null;if(!n)throw W.InvalidDefinition(e,this.start);i=new n,await i.boot(),a.app(i)},s=async()=>{X.isWorker||await a.host().start(),await a.app().start()},c=()=>new Promise((t,e)=>{"loading"!==document.readyState?t():(!0).document.addEventListener("DOMContentLoaded",()=>{t()})}),p=()=>new Promise((t,e)=>{(!0).document.addEventListener("deviceready",()=>{t()},!1)}),h=async()=>{X.isClient&&!X.isWorker&&(await c(),X.isCordova&&await p()),X.isWorker||await a.host().ready(),await r("ready"),await a.app().ready()};await i(),await o(),await s(),await h(),console.log("ready!")}})}catch(t){Ft(t)}})(),(async()=>{try{const{Host:t}=B("flair.app");c("sealed"),c("ns","flair.app"),e("ClientHost",t,function(){let t={},e=(!0).page,n=null;c("override"),this.construct=(t=>{t("Page","1.x")}),this.app=(()=>this.mounts["main"]),this.mounts={get:()=>t,set:q},c("override"),this.boot=(async n=>{n();let i=null,r="",o=null;const s=t=>{let e={},n=Nt[`${t}-appSettings`];if(n&&n.length>0)for(let t of n)e[t.name]=t.value;return e.click=!1,e.popstate=!1,e.dispatch=!1,e.hashbang=!1,e.decodeURLComponents=!0,e};i=s("main");let a=e.create(i);a.strict(i.strict),a.base("/");for(let n of Object.keys(Nt.mounts))"main"===n?(r="/",o=a):(i=s(n),r=Nt.mounts[n],(o=e.create(i)).strict(i.strict),o.base(r)),t[n]=Object.freeze({name:n,root:r,app:o});t=Object.freeze(t)}),c("override"),this.start=(async t=>{t(),n=(()=>{let t=(!0).location.hash;"#!/"===t.substr(0,3)&&(t=t.substr(3)),"#!"===t.substr(0,2)&&(t=t.substr(2)),"#/"===t.substr(0,2)&&(t=t.substr(2)),"#"===t.substr(0,1)&&(t=t.substr(1));let e=null;for(let n of this.mounts)if(t.startsWith(n.root)){e=n.app,t=t.substr(n.root.length);break}e||(e=this.mounts["main"]),setTimeout(()=>{try{e(t)}catch(t){this.error(t)}},0)})}),c("override"),this.ready=(async t=>{t(),(!0).addEventListener("hashchange",n),console.log(`${a.app().info.name}, v${a.app().info.version}`)}),c("override"),this.stop=(async t=>{t(),(!0).removeEventListener("hashchange",n)}),c("override"),this.dispose=(e=>{e(),t=null})})}catch(t){Ft(t)}})(),(async()=>{try{const{Handler:t}=B("flair.app");c("ns","flair.app"),e("RestHandler",t,function(){c("virtual"),this.get=q,c("virtual"),this.post=q,c("virtual"),this.put=q,c("virtual"),this.delete=q})}catch(t){Ft(t)}})(),(async()=>{try{const t=await u("express | x"),n=await u("fs | x"),i=await u("http | x"),r=await u("https | x"),o=await u("http-shutdown | x"),{Host:s}=B("flair.app");c("sealed"),c("ns","flair.app"),e("ServerHost",s,function(){let e={},s=null,p=null,h=Nt["server-https"],l=Nt["server-http"];c("override"),this.construct=(t=>{t("Express","4.x")}),this.app=(()=>this.mounts["main"].app),this.mounts={get:()=>e,set:q},c("override"),this.boot=(async n=>{n();const i=(t,e)=>{let n=Nt[`${t}-appSettings`];if(n&&n.length>0)for(let t of n)e.set(t.name,t.value)};let r=t();i("main",r);let o="",s=null;for(let n of Object.keys(Nt.mounts))"main"===n?(o="/",s=r):(o=Nt.mounts[n],s=t()),e[n]=Object.freeze({name:n,root:o,app:s}),"main"!==n&&(i(n,s),r.use(o,s));e=Object.freeze(e)}),c("override"),this.start=(async t=>{if(t(),l.enable&&(s=i.createServer(this.app()),(s=o(s)).on("error",t=>{this.error(t)}),-1!==l.timeout&&(s.timeout=l.timeout)),h.enable){const t=n.readFileSync(a.resolvePath(h.privateKey),"utf8"),e=n.readFileSync(a.resolvePath(h.publicCert),"utf8"),i={key:t,cert:e};p=r.createServer(i,this.app()),(p=o(p)).on("error",t=>{this.error(t)}),-1!==h.timeout&&(p.timeout=h.timeout)}}),c("override"),this.ready=(t=>new Promise((e,n)=>{t();let i=l.port||80,r=process.env.PORT||h.port||443;s&&p?s.listen(i,()=>{p.listen(r,()=>{console.log(`${a.app().info.name}, v${a.app().info.version} (http: ${i}, https: ${r})`),e()})}):s?s.listen(i,()=>{console.log(`${a.app().info.name}, v${a.app().info.version} (http: ${i})`),e()}):p?p.listen(r,()=>{console.log(`${a.app().info.name}, v${a.app().info.version} (https: ${r})`),e()}):(console.log(`${a.app().info.name}, v${a.app().info.version}`),e())})),c("override"),this.stop=(async t=>{t(),s&&(console.log("http server is shutting down..."),s.shutdown(()=>{s=null,console.log("http server is cleanly shutdown!")})),p&&(console.log("https server is shutting down..."),p.shutdown(()=>{p=null,console.log("https server is cleanly shutdown!")}))}),c("override"),this.dispose=(t=>{t(),e=null})})}catch(t){Ft(t)}})(),(async()=>{try{const{Handler:t}=B("flair.app");c("ns","flair.app"),e("ViewHandler",t,function(){c("virtual"),this.view=q})}catch(t){Ft(t)}})(),(async()=>{try{const{Bootware:t}=B("flair.app");c("sealed"),c("ns","flair.boot"),e("DIContainer",t,function(){c("override"),this.construct=(t=>{t("DI Container")}),c("override"),this.boot=(async()=>{let t=Nt.container;for(let e in t)t.hasOwnProperty(e)&&l.register(e,t[e])})})}catch(t){Ft(t)}})(),(async()=>{try{const{Bootware:t}=B("flair.app");c("sealed"),c("ns","flair.boot"),e("Middlewares",t,function(){c("override"),this.construct=(t=>{t("Express Middlewares",!0)}),c("override"),this.boot=(async t=>{let e=Nt[`${t.name}-middlewares`];if(e&&e.length>0){let n=null,i=null;for(let r of e)if(r.module)try{n=require(r.name),i=r.func?n[r.func]:n;let e=[],o=null;r.args=r.args||[];for(let t of r.args){if("string"==typeof t&&t.startsWith("return "))o=new Function(t)();else if("object"==typeof t)for(let e in t)t.hasOwnProperty(e)&&"string"==typeof(o=t[e])&&o.startsWith("return ")&&(o=new Function(t)(),t[e]=o);else o=t;e.push(o)}t.app.use(i(...e))}catch(t){throw W.OperationFailed(`Middleware ${r.module} load failed.`,t,this.boot)}}})})}catch(t){Ft(t)}})(),(async()=>{try{const t=await u("node-env-file | x"),{Bootware:n}=B("flair.app");c("sealed"),c("ns","flair.boot"),e("NodeEnv",n,function(){c("override"),this.construct=(t=>{t("Node Server Environment")}),c("override"),this.boot=(async()=>{if(Nt.envVars.length>0)for(let e of Nt.envVars)t(a.resolvePath(e),Nt.envVarsLoadOptions)})})}catch(t){Ft(t)}})(),(async()=>{try{const{Bootware:t}=B("flair.app");c("sealed"),c("ns","flair.boot"),e("ResHeaders",t,function(){c("override"),this.construct=(t=>{t("Server Response Headers",!0)}),c("override"),this.boot=(async t=>{let e=Nt[`${t.name}-resHeaders`];e&&e.length>0&&t.app.use((t,n,i)=>{for(let t of e)n.setHeader(t.name,t.value);i()})})})}catch(t){Ft(t)}})(),(async()=>{try{const{Bootware:t}=B("flair.app");c("sealed"),c("ns","flair.boot"),e("Router",t,function(){let t=null;c("override"),this.construct=(t=>{t("Router",!0)}),c("override"),this.boot=(async e=>{t||(t=a.context.current().allRoutes(!0)).sort((t,e)=>t.index<e.index?-1:t.index>e.index?1:0);let n=!1;const i=()=>{for(let i of t)i.mount===e.name&&(e.app[i.verb]=(i.path,(t,e,r)=>{const o=t=>{t?e.end():r()},s=t=>{e.status(500).end(),a.host().raiseError(t)};try{F(new i.Handler(i.flags),r=>{(n=r[i.verb](t,e))&&"function"==typeof n.then?n.then(t=>{o(t)}).catch(s):o(n)})}catch(t){s(t)}}))},r=()=>{for(let i of t)i.mount===e.name&&e.app(i.path,(t,e)=>{const r=t=>{t||e()},o=t=>{a.host().raiseError(t)};try{F(new i.Handler(i.flags),e=>{(n=e[i.verb](t))&&"function"==typeof n.then?n.then(t=>{r(t)}).catch(o):r(n)})}catch(t){o(t)}})};X.isServer?i():r()})})}catch(t){Ft(t)}})(),a.context.current().currentAssemblyBeingLoaded(""),a.registerAdo('{"name":"flair.app","file":"./flair.app{.min}.js","mainAssembly":"flair","desc":"True Object Oriented JavaScript","title":"Flair.js","version":"0.30.13","lupdate":"Tue, 02 Apr 2019 11:22:39 GMT","builder":{"name":"<<name>>","version":"<<version>>","format":"fasm","formatVersion":"1","contains":["initializer","types","enclosureVars","enclosedTypes","resources","assets","routes","selfreg"]},"copyright":"(c) 2017-2019 Vikas Burman","license":"MIT","types":["flair.app.Bootware","flair.app.App","flair.app.Host","flair.app.Handler","flair.app.BootEngine","flair.app.ClientHost","flair.app.RestHandler","flair.app.ServerHost","flair.app.ViewHandler","flair.boot.DIContainer","flair.boot.Middlewares","flair.boot.NodeEnv","flair.boot.ResHeaders","flair.boot.Router"],"resources":[],"assets":[],"routes":[]}')})();