/**
 * @preserve
 * Flair.js
 * True Object Oriented JavaScript
 * 
 * Assembly: flair.app
 *     File: ./flair.app.js
 *  Version: 0.30.71
 *  Sat, 27 Apr 2019 21:54:36 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * Licensed under MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof!0&&(!0).amd?(!0)(e):t.page=e()}(this,function(){"use strict";var t=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)},e=g,n=a,r=c,i=p,o=y,s=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function a(t){for(var e=[],n=0,r=0,i="",o;null!=(o=s.exec(t));){var a=o[0],c=o[1],p=o.index;if(i+=t.slice(r,p),r=p+a.length,c)i+=c[1];else{i&&(e.push(i),i="");var h=o[2],u=o[3],f=o[4],d=o[5],v=o[6],m=o[7],y="+"===v||"*"===v,g="?"===v||"*"===v,w=h||"/",b=f||d||(m?".*":"[^"+w+"]+?");e.push({name:u||n++,prefix:h||"",delimiter:w,optional:g,repeat:y,pattern:l(b)})}}return r<t.length&&(i+=t.substr(r)),i&&e.push(i),e}function c(t){return p(a(t))}function p(e){for(var n=new Array(e.length),r=0;r<e.length;r++)"object"==typeof e[r]&&(n[r]=new RegExp("^"+e[r].pattern+"$"));return function(r){for(var i="",o=r||{},s=0;s<e.length;s++){var a=e[s];if("string"!=typeof a){var c=o[a.name],p;if(null==c){if(a.optional)continue;throw new TypeError('Expected "'+a.name+'" to be defined')}if(t(c)){if(!a.repeat)throw new TypeError('Expected "'+a.name+'" to not repeat, but received "'+c+'"');if(0===c.length){if(a.optional)continue;throw new TypeError('Expected "'+a.name+'" to not be empty')}for(var h=0;h<c.length;h++){if(p=encodeURIComponent(c[h]),!n[s].test(p))throw new TypeError('Expected all "'+a.name+'" to match "'+a.pattern+'", but received "'+p+'"');i+=(0===h?a.prefix:a.delimiter)+p}}else{if(p=encodeURIComponent(c),!n[s].test(p))throw new TypeError('Expected "'+a.name+'" to match "'+a.pattern+'", but received "'+p+'"');i+=a.prefix+p}}else i+=a}return i}}function h(t){return t.replace(/([.+*?=^!:${}()[\]|\/])/g,"\\$1")}function l(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function u(t,e){return t.keys=e,t}function f(t){return t.sensitive?"":"i"}function d(t,e){var n=t.source.match(/\((?!\?)/g);if(n)for(var r=0;r<n.length;r++)e.push({name:r,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return u(t,e)}function v(t,e,n){for(var r=[],i=0;i<t.length;i++)r.push(g(t[i],e,n).source);var o;return u(new RegExp("(?:"+r.join("|")+")",f(n)),e)}function m(t,e,n){for(var r=a(t),i=y(r,n),o=0;o<r.length;o++)"string"!=typeof r[o]&&e.push(r[o]);return u(i,e)}function y(t,e){for(var n=(e=e||{}).strict,r=!1!==e.end,i="",o=t[t.length-1],s="string"==typeof o&&/\/$/.test(o),a=0;a<t.length;a++){var c=t[a];if("string"==typeof c)i+=h(c);else{var p=h(c.prefix),l=c.pattern;c.repeat&&(l+="(?:"+p+l+")*"),i+=l=c.optional?p?"(?:"+p+"("+l+"))?":"("+l+")?":p+"("+l+")"}}return n||(i=(s?i.slice(0,-2):i)+"(?:\\/(?=$))?"),i+=r?"$":n&&s?"":"(?=\\/|$)",new RegExp("^"+i,f(e))}function g(e,n,r){return t(n=n||[])?r||(r={}):(r=n,n=[]),e instanceof RegExp?d(e,n,r):t(e)?v(e,n,r):m(e,n,r)}e.parse=n,e.compile=r,e.tokensToFunction=i,e.tokensToRegExp=o;var w="undefined"!=typeof document,b=void 0!==!0,$="undefined"!=typeof history,_="undefined"!=typeof process,x=w&&document.ontouchstart?"touchstart":"click",E=b&&!(!(!0).history.location&&!(!0).location),S;function k(){this.callbacks=[],this.exits=[],this.current="",this.len=0,this._decodeURLComponents=!0,this._base="",this._strict=!1,this._running=!1,this._hashbang=!1,this.clickHandler=this.clickHandler.bind(this),this._onpopstate=this._onpopstate.bind(this)}function R(){var t=new k;function e(){return O.apply(t,arguments)}return e.callbacks=t.callbacks,e.exits=t.exits,e.base=t.base.bind(t),e.strict=t.strict.bind(t),e.start=t.start.bind(t),e.stop=t.stop.bind(t),e.show=t.show.bind(t),e.back=t.back.bind(t),e.redirect=t.redirect.bind(t),e.replace=t.replace.bind(t),e.dispatch=t.dispatch.bind(t),e.exit=t.exit.bind(t),e.configure=t.configure.bind(t),e.sameOrigin=t.sameOrigin.bind(t),e.clickHandler=t.clickHandler.bind(t),e.create=R,Object.defineProperty(e,"len",{get:function(){return t.len},set:function(e){t.len=e}}),Object.defineProperty(e,"current",{get:function(){return t.current},set:function(e){t.current=e}}),e.Context=L,e.Route=U,e}function O(t,e){if("function"==typeof t)return O.call(this,"*",t);if("function"==typeof e)for(var n=new U(t,null,this),r=1;r<arguments.length;++r)this.callbacks.push(n.middleware(arguments[r]));else"string"==typeof t?this["string"==typeof e?"redirect":"show"](t,e):this.start(t)}function C(t){if(!t.handled){var e,n=this,r=this._window;(e=this._hashbang?E&&this._getBase()+r.location.hash.replace("#!",""):E&&r.location.pathname+r.location.search)!==t.canonicalPath&&(this.stop(),t.handled=!1,E&&(r.location.href=t.canonicalPath))}}function A(t){return t.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function L(t,e,n){var r=this.page=n||O,i=r._window,o=r._hashbang,s=r._getBase();"/"===t[0]&&0!==t.indexOf(s)&&(t=s+(o?"#!":"")+t);var a=t.indexOf("?");this.canonicalPath=t;var c=new RegExp("^"+A(s));if(this.path=t.replace(c,"")||"/",o&&(this.path=this.path.replace("#!","")||"/"),this.title=w&&i.document.title,this.state=e||{},this.state.path=t,this.querystring=~a?r._decodeURLEncodedURIComponent(t.slice(a+1)):"",this.pathname=r._decodeURLEncodedURIComponent(~a?t.slice(0,a):t),this.params={},this.hash="",!o){if(!~this.path.indexOf("#"))return;var p=this.path.split("#");this.path=this.pathname=p[0],this.hash=r._decodeURLEncodedURIComponent(p[1])||"",this.querystring=this.querystring.split("#")[0]}}function U(t,n,r){var i=this.page=r||H,o=n||{};o.strict=o.strict||r._strict,this.path="*"===t?"(.*)":t,this.method="GET",this.regexp=e(this.path,this.keys=[],o)}k.prototype.configure=function(t){var e=t||{};this._window=e.window||b&&!0,this._decodeURLComponents=!1!==e.decodeURLComponents,this._popstate=!1!==e.popstate&&b,this._click=!1!==e.click&&w,this._hashbang=!!e.hashbang;var n=this._window;this._popstate?n.addEventListener("popstate",this._onpopstate,!1):b&&n.removeEventListener("popstate",this._onpopstate,!1),this._click?n.document.addEventListener(x,this.clickHandler,!1):w&&n.document.removeEventListener(x,this.clickHandler,!1),this._hashbang&&b&&!$?n.addEventListener("hashchange",this._onpopstate,!1):b&&n.removeEventListener("hashchange",this._onpopstate,!1)},k.prototype.base=function(t){if(0===arguments.length)return this._base;this._base=t},k.prototype._getBase=function(){var t=this._base;if(t)return t;var e=b&&this._window&&this._window.location;return b&&this._hashbang&&e&&"file:"===e.protocol&&(t=e.pathname),t},k.prototype.strict=function(t){if(0===arguments.length)return this._strict;this._strict=t},k.prototype.start=function(t){var e=t||{};if(this.configure(e),!1!==e.dispatch){var n;if(this._running=!0,E){var r,i=this._window.location;n=this._hashbang&&~i.hash.indexOf("#!")?i.hash.substr(2)+i.search:this._hashbang?i.search+i.hash:i.pathname+i.search+i.hash}this.replace(n,null,!0,e.dispatch)}},k.prototype.stop=function(){if(this._running){this.current="",this.len=0,this._running=!1;var t=this._window;this._click&&t.document.removeEventListener(x,this.clickHandler,!1),b&&t.removeEventListener("popstate",this._onpopstate,!1),b&&t.removeEventListener("hashchange",this._onpopstate,!1)}},k.prototype.show=function(t,e,n,r){var i=new L(t,e,this),o=this.prevContext;return this.prevContext=i,this.current=i.path,!1!==n&&this.dispatch(i,o),!1!==i.handled&&!1!==r&&i.pushState(),i},k.prototype.back=function(t,e){var n=this;if(this.len>0){var r=this._window;$&&r.history.back(),this.len--}else t?setTimeout(function(){n.show(t,e)}):setTimeout(function(){n.show(n._getBase(),e)})},k.prototype.redirect=function(t,e){var n=this;"string"==typeof t&&"string"==typeof e&&O.call(this,t,function(t){setTimeout(function(){n.replace(e)},0)}),"string"==typeof t&&void 0===e&&setTimeout(function(){n.replace(t)},0)},k.prototype.replace=function(t,e,n,r){var i=new L(t,e,this),o=this.prevContext;return this.prevContext=i,this.current=i.path,i.init=n,i.save(),!1!==r&&this.dispatch(i,o),i},k.prototype.dispatch=function(t,e){var n=0,r=0,i=this;function o(){var t=i.exits[r++];if(!t)return s();t(e,o)}function s(){var e=i.callbacks[n++];if(t.path===i.current)return e?void e(t,s):C.call(i,t);t.handled=!1}e?o():s()},k.prototype.exit=function(t,e){if("function"==typeof t)return this.exit("*",t);for(var n=new U(t,null,this),r=1;r<arguments.length;++r)this.exits.push(n.middleware(arguments[r]))},k.prototype.clickHandler=function(t){if(1===this._which(t)&&!(t.metaKey||t.ctrlKey||t.shiftKey||t.defaultPrevented)){var e=t.target,n=t.path||(t.composedPath?t.composedPath():null);if(n)for(var r=0;r<n.length;r++)if(n[r].nodeName&&"A"===n[r].nodeName.toUpperCase()&&n[r].href){e=n[r];break}for(;e&&"A"!==e.nodeName.toUpperCase();)e=e.parentNode;if(e&&"A"===e.nodeName.toUpperCase()){var i="object"==typeof e.href&&"SVGAnimatedString"===e.href.constructor.name;if(!e.hasAttribute("download")&&"external"!==e.getAttribute("rel")){var o=e.getAttribute("href");if((this._hashbang||!this._samePath(e)||!e.hash&&"#"!==o)&&!(o&&o.indexOf("mailto:")>-1)&&(i?!e.target.baseVal:!e.target)&&(i||this.sameOrigin(e.href))){var s=i?e.href.baseVal:e.pathname+e.search+(e.hash||"");s="/"!==s[0]?"/"+s:s,_&&s.match(/^\/[a-zA-Z]:\//)&&(s=s.replace(/^\/[a-zA-Z]:\//,"/"));var a=s,c=this._getBase();0===s.indexOf(c)&&(s=s.substr(c.length)),this._hashbang&&(s=s.replace("#!","")),(!c||a!==s||E&&"file:"===this._window.location.protocol)&&(t.preventDefault(),this.show(a))}}}}},k.prototype._onpopstate=(S=!1,b?(w&&"complete"===document.readyState?S=!0:(!0).addEventListener("load",function(){setTimeout(function(){S=!0},0)}),function t(e){if(S){var n=this;if(e.state){var r=e.state.path;this.replace(r,e.state)}else if(E){var i=this._window.location;this.show(i.pathname+i.search+i.hash,void 0,void 0,!1)}}}):function(){}),k.prototype._which=function(t){return null==(t=t||b&&this._window.event).which?t.button:t.which},k.prototype._toURL=function(t){var e=this._window;if("function"==typeof URL&&E)return new URL(t,e.location.toString());if(w){var n=e.document.createElement("a");return n.href=t,n}},k.prototype.sameOrigin=function(t){if(!t||!E)return!1;var e=this._toURL(t),n,r=this._window.location;return r.protocol===e.protocol&&r.hostname===e.hostname&&r.port===e.port},k.prototype._samePath=function(t){if(!E)return!1;var e,n=this._window.location;return t.pathname===n.pathname&&t.search===n.search},k.prototype._decodeURLEncodedURIComponent=function(t){return"string"!=typeof t?t:this._decodeURLComponents?decodeURIComponent(t.replace(/\+/g," ")):t},L.prototype.pushState=function(){var t=this.page,e=t._window,n=t._hashbang;t.len++,$&&e.history.pushState(this.state,this.title,n&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},L.prototype.save=function(){var t=this.page;$&&t._window.history.replaceState(this.state,this.title,t._hashbang&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},U.prototype.middleware=function(t){var e=this;return function(n,r){if(e.match(n.path,n.params))return t(n,r);r()}},U.prototype.match=function(t,e){var n=this.keys,r=t.indexOf("?"),i=~r?t.slice(0,r):t,o=this.regexp.exec(decodeURIComponent(i));if(!o)return!1;for(var s=1,a=o.length;s<a;++s){var c=n[s-1],p=this.page._decodeURLEncodedURIComponent(o[s]);void 0===p&&hasOwnProperty.call(e,c.name)||(e[c.name]=p)}return!0};var H=R(),P=H,j=H;return P.default=j,P}),(()=>{"use strict";const t=void 0!==!0?require("flairjs"):(!0).flair,{Class:e,Struct:n,Enum:r,Interface:i,Mixin:o,Aspects:s,AppDomain:a,$$:c,attr:p,bring:h,Container:l,include:u,Port:f,on:d,post:v,telemetry:m,Reflector:y,Serializer:g,Tasks:w,as:b,is:$,isComplies:_,isDerivedFrom:x,isAbstract:E,isSealed:S,isStatic:k,isSingleton:R,isDeprecated:O,isImplements:C,isInstanceOf:A,isMixed:L,getAssembly:U,getAttr:H,getContext:P,getResource:j,getRoute:T,getType:I,ns:B,getTypeOf:M,getTypeName:D,typeOf:z,dispose:F,using:N,Args:V,Exception:W,noop:q,nip:K,nim:G,nie:J,event:Z}=t,{TaskInfo:Q}=t.Tasks,{env:X}=t.options,Y=X.isServer?null:(!0).document,{forEachAsync:tt,replaceAll:et,splitAndTrim:nt,findIndexByProp:rt,findItemByProp:it,which:ot,guid:st,isArrowFunc:at,isASyncFunc:ct,sieve:pt,b64EncodeUnicode:ht,b64DecodeUnicode:lt}=t.utils,{$$static:ut,$$abstract:ft,$$virtual:dt,$$override:vt,$$sealed:mt,$$private:yt,$$privateSet:gt,$$protected:wt,$$protectedSet:bt,$$readonly:$t,$$async:_t,$$overload:xt,$$enumerate:Et,$$dispose:St,$$post:kt,$$on:Rt,$$timer:Ot,$$type:Ct,$$args:At,$$inject:Lt,$$resource:Ut,$$asset:Ht,$$singleton:Pt,$$serialize:jt,$$deprecate:Tt,$$session:It,$$state:Bt,$$conditional:Mt,$$noserialize:Dt,$$ns:zt}=c,Ft=a.context.current().name;let Nt=X.isServer?__filename:(!0).document.currentScript.src.replace((!0).document.location.href,"./"),Vt=Nt.substr(0,Nt.lastIndexOf("/")+1);a.loadPathOf("flair.app",Vt);const Wt=t=>{a.onError(t)};let qt=JSON.parse('{"host":"flair.app.ServerHost | flair.app.ClientHost","app":"flair.app.App","load":[],"container":{},"envVars":[],"envVarsloadOptions":{"overwrite":true},"mounts":{"main":"/"},"main-appSettings":[],"main-middlewares":[],"url":{"404":"/404","home":"/"},"http":{"enable":false,"port":80,"timeout":-1},"https":{"enable":false,"port":443,"timeout":-1,"privateKey":"","publicCert":""}}'),Kt=t.Port("settingsReader");if("function"==typeof Kt){let t=Kt("flair.app");t&&(qt=Object.assign(qt,t))}qt=Object.freeze(qt),a.context.current().currentAssemblyBeingLoaded("./flair.app{.min}.js"),(async()=>{try{c("abstract"),c("ns","flair.app"),e("Bootware",function(){c("virtual"),this.construct=((t,e,n)=>{let r=V("name: string, version: string","name: string, version: string, isMountSpecific: boolean","name: string, isMountSpecific: boolean","name: string")(t,e,n);r.throwOnError(this.construct),this.info=Object.freeze({name:r.values.name||"",version:r.values.version||"",isMountSpecific:r.values.isMountSpecific||!1})}),c("virtual"),c("async"),this.boot=q,c("readonly"),this.info=null,c("virtual"),c("async"),this.ready=q,c("virtual"),this.dispose=q})}catch(t){Wt(t)}})(),(async()=>{try{const{IDisposable:t}=B(),{Bootware:n}=B("flair.app");c("ns","flair.app"),e("App",n,[t],function(){c("override"),this.construct=(t=>{let e=U(this);t(e.title,e.version)}),c("override"),this.boot=(async t=>{t(),a.host().error.add(this.onError)}),c("virtual"),c("async"),this.start=q,c("virtual"),c("async"),this.stop=q,c("virtual"),this.onError=(t=>{throw W.OperationFailed(t.error,this.onError)}),c("override"),this.dispose=(()=>{a.host().error.remove(this.onError)})})}catch(t){Wt(t)}})(),(async()=>{try{const{IDisposable:t}=B(),{Bootware:n}=B("flair.app");c("ns","flair.app"),e("Host",n,[t],function(){c("privateSet"),this.isStarted=!1,c("virtual"),this.start=(async()=>{this.isStarted=!0}),c("virtual"),this.stop=(async()=>{this.isStarted=!1}),this.restart=(async()=>{await this.stop(),await this.start()}),this.error=Z(t=>({error:t})),this.raiseError=(t=>{this.error(t)})})}catch(t){Wt(t)}})(),(async()=>{try{const{IDisposable:t}=B();c("ns","flair.app"),e("Handler",[t],function(){c("virtual"),this.construct=(()=>{}),c("virtual"),this.dispose=(()=>{})})}catch(t){Wt(t)}})(),(async()=>{try{const{Handler:t}=B("flair.app");c("ns","flair.api"),e("RestHandler",t,function(){c("virtual"),this.get=q,c("virtual"),this.post=q,c("virtual"),this.put=q,c("virtual"),this.delete=q})}catch(t){Wt(t)}})(),(async()=>{try{const{Bootware:t}=B("flair.app");c("static"),c("ns","flair.app"),e("BootEngine",function(){this.start=async function(){let e=[],n=[];const r=async()=>{let r=null,i=null,o=null;for(let s of qt.load)(s=ot(s))&&(r=await u(s))&&"boolean"!=typeof r&&(i=b(r,t))&&(o=new i,e.push(o),o.info.isMountSpecific&&n.push(o))},i=async t=>{if(X.isWorker){0!==n.length&&console.warn("Mount specific bootwares are not supported for worker environment. Revisit worker:flair.app->load setting.");for(let n of e)n.info.isMountSpecific||await n[t]()}else{let r=a.host().mounts,i=Object.keys(r),o="",s=null;s=r[o="main"];for(let n of e)await n[t](s);for(let e of i)if("main"!==e){s=r[e];for(let e of n)await e[t](s)}}},o=async()=>{if(!X.isWorker){let e=ot(qt.host),n=b(await u(e),t),r=null;if(!n)throw W.InvalidDefinition(e,this.start);r=new n,await r.boot(),a.host(r)}await i("boot");let e=ot(qt.app),n=b(await u(e),t),r=null;if(!n)throw W.InvalidDefinition(e,this.start);r=new n,await r.boot(),a.app(r)},s=async()=>{X.isWorker||await a.host().start(),await a.app().start()},c=()=>new Promise((t,e)=>{"loading"!==document.readyState?t():(!0).document.addEventListener("DOMContentLoaded",()=>{t()})}),p=()=>new Promise((t,e)=>{(!0).document.addEventListener("deviceready",()=>{t()},!1)}),h=async()=>{X.isClient&&!X.isWorker&&(await c(),X.isCordova&&await p()),X.isWorker||await a.host().ready(),await i("ready"),await a.app().ready()};await r(),await o(),await s(),await h(),console.log("ready!")}})}catch(t){Wt(t)}})(),(async()=>{try{const{Host:t}=B("flair.app");c("sealed"),c("ns","flair.app"),e("ClientHost",t,function(){let t={},e=(!0).page,n=null;c("override"),this.construct=(t=>{t("Page","1.x")}),this.app=(()=>this.mounts["main"]),this.mounts={get:()=>t,set:q},c("override"),this.boot=(async n=>{n();let r=null,i="",o=null;const s=t=>{let e={},n=qt[`${t}-appSettings`];if(n&&n.length>0)for(let t of n)e[t.name]=t.value;return e.click=!1,e.popstate=!1,e.dispatch=!1,e.hashbang=!1,e.decodeURLComponents=!0,e};r=s("main");let a=e.create(r);a.strict(r.strict),a.base("/");for(let n of Object.keys(qt.mounts))"main"===n?(i="/",o=a):(r=s(n),i=qt.mounts[n],(o=e.create(r)).strict(r.strict),o.base(i)),t[n]=Object.freeze({name:n,root:i,app:o});t=Object.freeze(t)}),c("override"),this.start=(async t=>{t(),n=(()=>{let t=(!0).location.hash;"#!/"===t.substr(0,3)&&(t=t.substr(3)),"#!"===t.substr(0,2)&&(t=t.substr(2)),"#/"===t.substr(0,2)&&(t=t.substr(2)),"#"===t.substr(0,1)&&(t=t.substr(1));let e=null;for(let n of this.mounts)if(t.startsWith(n.root)){e=n.app,t=t.substr(n.root.length);break}e||(e=this.mounts["main"]),"/"!==t.substr(0,1)&&(t="/"+t),setTimeout(()=>{try{e(t)}catch(t){this.error(t)}},0)})}),c("override"),this.ready=(async t=>{t(),(!0).addEventListener("hashchange",n),this.app.redirect(qt.url.home),console.log(`${a.app().info.name}, v${a.app().info.version}`)}),c("override"),this.stop=(async t=>{t(),(!0).removeEventListener("hashchange",n)}),c("override"),this.dispose=(e=>{e(),t=null})})}catch(t){Wt(t)}})(),(async()=>{try{const t=await u("express | x"),n=await u("fs | x"),r=await u("http | x"),i=await u("https | x"),o=await u("http-shutdown | x"),{Host:s}=B("flair.app");c("sealed"),c("ns","flair.app"),e("ServerHost",s,function(){let e={},s=null,p=null,h=qt["https"],l=qt["http"];c("override"),this.construct=(t=>{t("Express","4.x")}),this.app=(()=>this.mounts["main"].app),this.mounts={get:()=>e,set:q},c("override"),this.boot=(async n=>{n();const r=(t,e)=>{let n=qt[`${t}-appSettings`];if(n&&n.length>0)for(let t of n)e.set(t.name,t.value)};let i=t();r("main",i);let o="",s=null;for(let n of Object.keys(qt.mounts))"main"===n?(o="/",s=i):(o=qt.mounts[n],s=t()),e[n]=Object.freeze({name:n,root:o,app:s}),"main"!==n&&(r(n,s),i.use(o,s));e=Object.freeze(e)}),c("override"),this.start=(async t=>{if(t(),l.enable&&(s=r.createServer(this.app()),(s=o(s)).on("error",t=>{this.error(t)}),-1!==l.timeout&&(s.timeout=l.timeout)),h.enable){const t=n.readFileSync(a.resolvePath(h.privateKey),"utf8"),e=n.readFileSync(a.resolvePath(h.publicCert),"utf8"),r={key:t,cert:e};p=i.createServer(r,this.app()),(p=o(p)).on("error",t=>{this.error(t)}),-1!==h.timeout&&(p.timeout=h.timeout)}}),c("override"),this.ready=(t=>new Promise((e,n)=>{t();let r=l.port||80,i=process.env.PORT||h.port||443;s&&p?s.listen(r,()=>{p.listen(i,()=>{console.log(`${a.app().info.name}, v${a.app().info.version} (http: ${r}, https: ${i})`),e()})}):s?s.listen(r,()=>{console.log(`${a.app().info.name}, v${a.app().info.version} (http: ${r})`),e()}):p?p.listen(i,()=>{console.log(`${a.app().info.name}, v${a.app().info.version} (https: ${i})`),e()}):(console.log(`${a.app().info.name}, v${a.app().info.version}`),e())})),c("override"),this.stop=(async t=>{t(),s&&(console.log("http server is shutting down..."),s.shutdown(()=>{s=null,console.log("http server is cleanly shutdown!")})),p&&(console.log("https server is shutting down..."),p.shutdown(()=>{p=null,console.log("https server is cleanly shutdown!")}))}),c("override"),this.dispose=(t=>{t(),e=null})})}catch(t){Wt(t)}})(),(async()=>{try{const{Bootware:t}=B("flair.app");c("sealed"),c("ns","flair.boot"),e("DIContainer",t,function(){c("override"),this.construct=(t=>{t("DI Container")}),c("override"),this.boot=(async()=>{let t=qt.container;for(let e in t)t.hasOwnProperty(e)&&l.register(e,t[e])})})}catch(t){Wt(t)}})(),(async()=>{try{const{Bootware:t}=B("flair.app");c("sealed"),c("ns","flair.boot"),e("Middlewares",t,function(){c("override"),this.construct=(t=>{t("Express Middlewares",!0)}),c("override"),this.boot=(async t=>{let e=qt[`${t.name}-middlewares`];if(e&&e.length>0){let n=null,r=null;for(let i of e)if(i.module)try{n=require(i.name),r=i.func?n[i.func]:n;let e=[],o=null;i.args=i.args||[];for(let t of i.args){if("string"==typeof t&&t.startsWith("return "))o=new Function(t)();else if("object"==typeof t)for(let e in t)t.hasOwnProperty(e)&&"string"==typeof(o=t[e])&&o.startsWith("return ")&&(o=new Function(t)(),t[e]=o);else o=t;e.push(o)}t.app.use(r(...e))}catch(t){throw W.OperationFailed(`Middleware ${i.module} load failed.`,t,this.boot)}}})})}catch(t){Wt(t)}})(),(async()=>{try{const t=await u("node-env-file | x"),{Bootware:n}=B("flair.app");c("sealed"),c("ns","flair.boot"),e("NodeEnv",n,function(){c("override"),this.construct=(t=>{t("Node Server Environment")}),c("override"),this.boot=(async()=>{if(qt.envVars.length>0)for(let e of qt.envVars)t(a.resolvePath(e),qt.envVarsLoadOptions)})})}catch(t){Wt(t)}})(),(async()=>{try{const{Bootware:t}=B("flair.app");c("sealed"),c("ns","flair.boot"),e("ResHeaders",t,function(){c("override"),this.construct=(t=>{t("Server Response Headers",!0)}),c("override"),this.boot=(async t=>{let e=qt[`${t.name}-resHeaders`];e&&e.length>0&&t.app.use((t,n,r)=>{for(let t of e)n.setHeader(t.name,t.value);r()})})})}catch(t){Wt(t)}})(),(async()=>{try{const{Bootware:t}=B("flair.app");c("sealed"),c("ns","flair.boot"),e("Router",t,function(){let t=null;c("override"),this.construct=(t=>{t("Router",!0)}),c("override"),this.boot=(async e=>{t||(t=a.context.current().allRoutes(!0)).sort((t,e)=>t.index<e.index?-1:t.index>e.index?1:0);let n=!1;const r=()=>{for(let r of t)r.mount===e.name&&r.verbs.forEach(t=>{e.app[t](r.path,(e,i,o)=>{const s=t=>{t||o()},a=t=>{o(t)};try{N(new r.Handler,r=>{(n=r[t](e,i))&&"function"==typeof n.then?n.then(t=>{s(t)}).catch(a):s(n)})}catch(t){a(t)}})});e.app.use((t,e,n)=>{var r=new Error("Not Found");r.status=404,n(r)}),X.isProd,e.app.use((t,e,n)=>{n.status(t.status||500),e.xhr?n.status(500).send({error:t.toString()}):n.render("error",{message:t.message,error:t}),n.end()})},i=()=>{for(let n of t)n.mount===e.name&&e.app(n.path,t=>{try{N(new n.Handler,n=>{t.redirectUrl="",n.view(t).then(n=>{n?t.handled=!0:""!==t.redirectUrl?(t.handled=!0,e.app.redirect(t.redirectUrl)):t.handled=!1}).catch(t=>{a.host().raiseError(t)})})}catch(t){a.host().raiseError(t)}});e.app("*",t=>{let n=qt.url["404"];n?(t.handled=!0,e.app.redirect(n)):(!0).history.back()})};X.isServer?r():i()})})}catch(t){Wt(t)}})(),a.context.current().currentAssemblyBeingLoaded(""),a.registerAdo('{"name":"flair.app","file":"./flair.app{.min}.js","mainAssembly":"flair","desc":"True Object Oriented JavaScript","title":"Flair.js","version":"0.30.71","lupdate":"Sat, 27 Apr 2019 21:54:36 GMT","builder":{"name":"<<name>>","version":"<<version>>","format":"fasm","formatVersion":"1","contains":["initializer","types","enclosureVars","enclosedTypes","resources","assets","routes","selfreg"]},"copyright":"(c) 2017-2019 Vikas Burman","license":"MIT","types":["flair.app.Bootware","flair.app.App","flair.app.Host","flair.app.Handler","flair.api.RestHandler","flair.app.BootEngine","flair.app.ClientHost","flair.app.ServerHost","flair.boot.DIContainer","flair.boot.Middlewares","flair.boot.NodeEnv","flair.boot.ResHeaders","flair.boot.Router"],"resources":[],"assets":[],"routes":[]}')})();