/**
 * @preserve
 * Flair.js
 * True Object Oriented JavaScript
 * 
 * Assembly: flair.app
 *     File: ./flair.app.js
 *  Version: 0.30.93
 *  Sun, 28 Apr 2019 17:40:00 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * Licensed under MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof!0&&(!0).amd?(!0)(e):t.page=e()}(this,function(){"use strict";var t=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)},e=w,i=o,n=c,r=h,s=y,a=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function o(t){for(var e=[],i=0,n=0,r="",s;null!=(s=a.exec(t));){var o=s[0],c=s[1],h=s.index;if(r+=t.slice(n,h),n=h+o.length,c)r+=c[1];else{r&&(e.push(r),r="");var l=s[2],d=s[3],u=s[4],f=s[5],v=s[6],m=s[7],y="+"===v||"*"===v,w="?"===v||"*"===v,g=l||"/",b=u||f||(m?".*":"[^"+g+"]+?");e.push({name:d||i++,prefix:l||"",delimiter:g,optional:w,repeat:y,pattern:p(b)})}}return n<t.length&&(r+=t.substr(n)),r&&e.push(r),e}function c(t){return h(o(t))}function h(e){for(var i=new Array(e.length),n=0;n<e.length;n++)"object"==typeof e[n]&&(i[n]=new RegExp("^"+e[n].pattern+"$"));return function(n){for(var r="",s=n||{},a=0;a<e.length;a++){var o=e[a];if("string"!=typeof o){var c=s[o.name],h;if(null==c){if(o.optional)continue;throw new TypeError('Expected "'+o.name+'" to be defined')}if(t(c)){if(!o.repeat)throw new TypeError('Expected "'+o.name+'" to not repeat, but received "'+c+'"');if(0===c.length){if(o.optional)continue;throw new TypeError('Expected "'+o.name+'" to not be empty')}for(var l=0;l<c.length;l++){if(h=encodeURIComponent(c[l]),!i[a].test(h))throw new TypeError('Expected all "'+o.name+'" to match "'+o.pattern+'", but received "'+h+'"');r+=(0===l?o.prefix:o.delimiter)+h}}else{if(h=encodeURIComponent(c),!i[a].test(h))throw new TypeError('Expected "'+o.name+'" to match "'+o.pattern+'", but received "'+h+'"');r+=o.prefix+h}}else r+=o}return r}}function l(t){return t.replace(/([.+*?=^!:${}()[\]|\/])/g,"\\$1")}function p(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function d(t,e){return t.keys=e,t}function u(t){return t.sensitive?"":"i"}function f(t,e){var i=t.source.match(/\((?!\?)/g);if(i)for(var n=0;n<i.length;n++)e.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return d(t,e)}function v(t,e,i){for(var n=[],r=0;r<t.length;r++)n.push(w(t[r],e,i).source);var s;return d(new RegExp("(?:"+n.join("|")+")",u(i)),e)}function m(t,e,i){for(var n=o(t),r=y(n,i),s=0;s<n.length;s++)"string"!=typeof n[s]&&e.push(n[s]);return d(r,e)}function y(t,e){for(var i=(e=e||{}).strict,n=!1!==e.end,r="",s=t[t.length-1],a="string"==typeof s&&/\/$/.test(s),o=0;o<t.length;o++){var c=t[o];if("string"==typeof c)r+=l(c);else{var h=l(c.prefix),p=c.pattern;c.repeat&&(p+="(?:"+h+p+")*"),r+=p=c.optional?h?"(?:"+h+"("+p+"))?":"("+p+")?":h+"("+p+")"}}return i||(r=(a?r.slice(0,-2):r)+"(?:\\/(?=$))?"),r+=n?"$":i&&a?"":"(?=\\/|$)",new RegExp("^"+r,u(e))}function w(e,i,n){return t(i=i||[])?n||(n={}):(n=i,i=[]),e instanceof RegExp?f(e,i,n):t(e)?v(e,i,n):m(e,i,n)}e.parse=i,e.compile=n,e.tokensToFunction=r,e.tokensToRegExp=s;var g="undefined"!=typeof document,b=void 0!==!0,$="undefined"!=typeof history,_="undefined"!=typeof process,x=g&&document.ontouchstart?"touchstart":"click",E=b&&!(!(!0).history.location&&!(!0).location),S;function R(){this.callbacks=[],this.exits=[],this.current="",this.len=0,this._decodeURLComponents=!0,this._base="",this._strict=!1,this._running=!1,this._hashbang=!1,this.clickHandler=this.clickHandler.bind(this),this._onpopstate=this._onpopstate.bind(this)}function k(){var t=new R;function e(){return C.apply(t,arguments)}return e.callbacks=t.callbacks,e.exits=t.exits,e.base=t.base.bind(t),e.strict=t.strict.bind(t),e.start=t.start.bind(t),e.stop=t.stop.bind(t),e.show=t.show.bind(t),e.back=t.back.bind(t),e.redirect=t.redirect.bind(t),e.replace=t.replace.bind(t),e.dispatch=t.dispatch.bind(t),e.exit=t.exit.bind(t),e.configure=t.configure.bind(t),e.sameOrigin=t.sameOrigin.bind(t),e.clickHandler=t.clickHandler.bind(t),e.create=k,Object.defineProperty(e,"len",{get:function(){return t.len},set:function(e){t.len=e}}),Object.defineProperty(e,"current",{get:function(){return t.current},set:function(e){t.current=e}}),e.Context=I,e.Route=A,e}function C(t,e){if("function"==typeof t)return C.call(this,"*",t);if("function"==typeof e)for(var i=new A(t,null,this),n=1;n<arguments.length;++n)this.callbacks.push(i.middleware(arguments[n]));else"string"==typeof t?this["string"==typeof e?"redirect":"show"](t,e):this.start(t)}function O(t){if(!t.handled){var e,i=this,n=this._window;(e=this._hashbang?E&&this._getBase()+n.location.hash.replace("#!",""):E&&n.location.pathname+n.location.search)!==t.canonicalPath&&(this.stop(),t.handled=!1,E&&(n.location.href=t.canonicalPath))}}function T(t){return t.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function I(t,e,i){var n=this.page=i||C,r=n._window,s=n._hashbang,a=n._getBase();"/"===t[0]&&0!==t.indexOf(a)&&(t=a+(s?"#!":"")+t);var o=t.indexOf("?");this.canonicalPath=t;var c=new RegExp("^"+T(a));if(this.path=t.replace(c,"")||"/",s&&(this.path=this.path.replace("#!","")||"/"),this.title=g&&r.document.title,this.state=e||{},this.state.path=t,this.querystring=~o?n._decodeURLEncodedURIComponent(t.slice(o+1)):"",this.pathname=n._decodeURLEncodedURIComponent(~o?t.slice(0,o):t),this.params={},this.hash="",!s){if(!~this.path.indexOf("#"))return;var h=this.path.split("#");this.path=this.pathname=h[0],this.hash=n._decodeURLEncodedURIComponent(h[1])||"",this.querystring=this.querystring.split("#")[0]}}function A(t,i,n){var r=this.page=n||H,s=i||{};s.strict=s.strict||n._strict,this.path="*"===t?"(.*)":t,this.method="GET",this.regexp=e(this.path,this.keys=[],s)}R.prototype.configure=function(t){var e=t||{};this._window=e.window||b&&!0,this._decodeURLComponents=!1!==e.decodeURLComponents,this._popstate=!1!==e.popstate&&b,this._click=!1!==e.click&&g,this._hashbang=!!e.hashbang;var i=this._window;this._popstate?i.addEventListener("popstate",this._onpopstate,!1):b&&i.removeEventListener("popstate",this._onpopstate,!1),this._click?i.document.addEventListener(x,this.clickHandler,!1):g&&i.document.removeEventListener(x,this.clickHandler,!1),this._hashbang&&b&&!$?i.addEventListener("hashchange",this._onpopstate,!1):b&&i.removeEventListener("hashchange",this._onpopstate,!1)},R.prototype.base=function(t){if(0===arguments.length)return this._base;this._base=t},R.prototype._getBase=function(){var t=this._base;if(t)return t;var e=b&&this._window&&this._window.location;return b&&this._hashbang&&e&&"file:"===e.protocol&&(t=e.pathname),t},R.prototype.strict=function(t){if(0===arguments.length)return this._strict;this._strict=t},R.prototype.start=function(t){var e=t||{};if(this.configure(e),!1!==e.dispatch){var i;if(this._running=!0,E){var n,r=this._window.location;i=this._hashbang&&~r.hash.indexOf("#!")?r.hash.substr(2)+r.search:this._hashbang?r.search+r.hash:r.pathname+r.search+r.hash}this.replace(i,null,!0,e.dispatch)}},R.prototype.stop=function(){if(this._running){this.current="",this.len=0,this._running=!1;var t=this._window;this._click&&t.document.removeEventListener(x,this.clickHandler,!1),b&&t.removeEventListener("popstate",this._onpopstate,!1),b&&t.removeEventListener("hashchange",this._onpopstate,!1)}},R.prototype.show=function(t,e,i,n){var r=new I(t,e,this),s=this.prevContext;return this.prevContext=r,this.current=r.path,!1!==i&&this.dispatch(r,s),!1!==r.handled&&!1!==n&&r.pushState(),r},R.prototype.back=function(t,e){var i=this;if(this.len>0){var n=this._window;$&&n.history.back(),this.len--}else t?setTimeout(function(){i.show(t,e)}):setTimeout(function(){i.show(i._getBase(),e)})},R.prototype.redirect=function(t,e){var i=this;"string"==typeof t&&"string"==typeof e&&C.call(this,t,function(t){setTimeout(function(){i.replace(e)},0)}),"string"==typeof t&&void 0===e&&setTimeout(function(){i.replace(t)},0)},R.prototype.replace=function(t,e,i,n){var r=new I(t,e,this),s=this.prevContext;return this.prevContext=r,this.current=r.path,r.init=i,r.save(),!1!==n&&this.dispatch(r,s),r},R.prototype.dispatch=function(t,e){var i=0,n=0,r=this;function s(){var t=r.exits[n++];if(!t)return a();t(e,s)}function a(){var e=r.callbacks[i++];if(t.path===r.current)return e?void e(t,a):O.call(r,t);t.handled=!1}e?s():a()},R.prototype.exit=function(t,e){if("function"==typeof t)return this.exit("*",t);for(var i=new A(t,null,this),n=1;n<arguments.length;++n)this.exits.push(i.middleware(arguments[n]))},R.prototype.clickHandler=function(t){if(1===this._which(t)&&!(t.metaKey||t.ctrlKey||t.shiftKey||t.defaultPrevented)){var e=t.target,i=t.path||(t.composedPath?t.composedPath():null);if(i)for(var n=0;n<i.length;n++)if(i[n].nodeName&&"A"===i[n].nodeName.toUpperCase()&&i[n].href){e=i[n];break}for(;e&&"A"!==e.nodeName.toUpperCase();)e=e.parentNode;if(e&&"A"===e.nodeName.toUpperCase()){var r="object"==typeof e.href&&"SVGAnimatedString"===e.href.constructor.name;if(!e.hasAttribute("download")&&"external"!==e.getAttribute("rel")){var s=e.getAttribute("href");if((this._hashbang||!this._samePath(e)||!e.hash&&"#"!==s)&&!(s&&s.indexOf("mailto:")>-1)&&(r?!e.target.baseVal:!e.target)&&(r||this.sameOrigin(e.href))){var a=r?e.href.baseVal:e.pathname+e.search+(e.hash||"");a="/"!==a[0]?"/"+a:a,_&&a.match(/^\/[a-zA-Z]:\//)&&(a=a.replace(/^\/[a-zA-Z]:\//,"/"));var o=a,c=this._getBase();0===a.indexOf(c)&&(a=a.substr(c.length)),this._hashbang&&(a=a.replace("#!","")),(!c||o!==a||E&&"file:"===this._window.location.protocol)&&(t.preventDefault(),this.show(o))}}}}},R.prototype._onpopstate=(S=!1,b?(g&&"complete"===document.readyState?S=!0:(!0).addEventListener("load",function(){setTimeout(function(){S=!0},0)}),function t(e){if(S){var i=this;if(e.state){var n=e.state.path;this.replace(n,e.state)}else if(E){var r=this._window.location;this.show(r.pathname+r.search+r.hash,void 0,void 0,!1)}}}):function(){}),R.prototype._which=function(t){return null==(t=t||b&&this._window.event).which?t.button:t.which},R.prototype._toURL=function(t){var e=this._window;if("function"==typeof URL&&E)return new URL(t,e.location.toString());if(g){var i=e.document.createElement("a");return i.href=t,i}},R.prototype.sameOrigin=function(t){if(!t||!E)return!1;var e=this._toURL(t),i,n=this._window.location;return n.protocol===e.protocol&&n.hostname===e.hostname&&n.port===e.port},R.prototype._samePath=function(t){if(!E)return!1;var e,i=this._window.location;return t.pathname===i.pathname&&t.search===i.search},R.prototype._decodeURLEncodedURIComponent=function(t){return"string"!=typeof t?t:this._decodeURLComponents?decodeURIComponent(t.replace(/\+/g," ")):t},I.prototype.pushState=function(){var t=this.page,e=t._window,i=t._hashbang;t.len++,$&&e.history.pushState(this.state,this.title,i&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},I.prototype.save=function(){var t=this.page;$&&t._window.history.replaceState(this.state,this.title,t._hashbang&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},A.prototype.middleware=function(t){var e=this;return function(i,n){if(e.match(i.path,i.params))return t(i,n);n()}},A.prototype.match=function(t,e){var i=this.keys,n=t.indexOf("?"),r=~n?t.slice(0,n):t,s=this.regexp.exec(decodeURIComponent(r));if(!s)return!1;for(var a=1,o=s.length;a<o;++a){var c=i[a-1],h=this.page._decodeURLEncodedURIComponent(s[a]);void 0===h&&hasOwnProperty.call(e,c.name)||(e[c.name]=h)}return!0};var H=k(),L=H,P=H;return L.default=P,L}),(()=>{"use strict";const t=void 0!==!0?require("flairjs"):(!0).flair,{Class:e,Struct:i,Enum:n,Interface:r,Mixin:s,Aspects:a,AppDomain:o,$$:c,attr:h,bring:l,Container:p,include:d,Port:u,on:f,post:v,telemetry:m,Reflector:y,Serializer:w,Tasks:g,as:b,is:$,isComplies:_,isDerivedFrom:x,isAbstract:E,isSealed:S,isStatic:R,isSingleton:k,isDeprecated:C,isImplements:O,isInstanceOf:T,isMixed:I,getAssembly:A,getAttr:H,getContext:L,getResource:P,getRoute:V,getType:U,ns:j,getTypeOf:B,getTypeName:M,typeOf:D,dispose:F,using:z,Args:N,Exception:W,noop:q,nip:K,nim:G,nie:J,event:Z}=t,{TaskInfo:Q}=t.Tasks,{env:X}=t.options,Y=X.isServer?null:(!0).document,{forEachAsync:tt,replaceAll:et,splitAndTrim:it,findIndexByProp:nt,findItemByProp:rt,which:st,guid:at,isArrowFunc:ot,isASyncFunc:ct,sieve:ht,b64EncodeUnicode:lt,b64DecodeUnicode:pt}=t.utils,{$$static:dt,$$abstract:ut,$$virtual:ft,$$override:vt,$$sealed:mt,$$private:yt,$$privateSet:wt,$$protected:gt,$$protectedSet:bt,$$readonly:$t,$$async:_t,$$overload:xt,$$enumerate:Et,$$dispose:St,$$post:Rt,$$on:kt,$$timer:Ct,$$type:Ot,$$args:Tt,$$inject:It,$$resource:At,$$asset:Ht,$$singleton:Lt,$$serialize:Pt,$$deprecate:Vt,$$session:Ut,$$state:jt,$$conditional:Bt,$$noserialize:Mt,$$ns:Dt}=c,Ft=o.context.current().name;let zt=X.isServer?__filename:(!0).document.currentScript.src.replace((!0).document.location.href,"./"),Nt=zt.substr(0,zt.lastIndexOf("/")+1);o.loadPathOf("flair.app",Nt);const Wt=t=>{o.onError(t)};let qt=JSON.parse('{"host":"flair.app.ServerHost | flair.app.ClientHost","app":"flair.app.App","load":[],"container":{},"envVars":[],"envVarsloadOptions":{"overwrite":true},"mounts":{"main":"/"},"main-appSettings":[],"main-middlewares":[],"url":{"404":"/404","home":"/"},"http":{"enable":false,"port":80,"timeout":-1},"https":{"enable":false,"port":443,"timeout":-1,"privateKey":"","publicCert":""}}'),Kt=t.Port("settingsReader");if("function"==typeof Kt){let t=Kt("flair.app");t&&(qt=Object.assign(qt,t))}qt=Object.freeze(qt),o.context.current().currentAssemblyBeingLoaded("./flair.app{.min}.js"),(async()=>{try{c("abstract"),c("ns","flair.app"),e("Bootware",function(){c("virtual"),this.construct=((t,e,i)=>{let n=N("name: string, version: string","name: string, version: string, isMountSpecific: boolean","name: string, isMountSpecific: boolean","name: string")(t,e,i);n.throwOnError(this.construct),this.info=Object.freeze({name:n.values.name||"",version:n.values.version||"",isMountSpecific:n.values.isMountSpecific||!1})}),c("virtual"),c("async"),this.boot=q,c("readonly"),this.info=null,c("virtual"),c("async"),this.ready=q,c("virtual"),this.dispose=q})}catch(t){Wt(t)}})(),(async()=>{try{const{IDisposable:t}=j(),{Bootware:i}=j("flair.app");c("ns","flair.app"),e("App",i,[t],function(){c("override"),this.construct=(t=>{let e=A(this);t(e.title,e.version)}),c("override"),this.boot=(async t=>{t(),o.host().error.add(this.onError)}),c("virtual"),c("async"),this.start=q,c("virtual"),c("async"),this.stop=q,c("virtual"),this.onError=(t=>{throw W.OperationFailed(t.error,this.onError)}),c("override"),this.dispose=(()=>{o.host().error.remove(this.onError)})})}catch(t){Wt(t)}})(),(async()=>{try{const{IDisposable:t}=j(),{Bootware:i}=j("flair.app");c("ns","flair.app"),e("Host",i,[t],function(){c("privateSet"),this.isStarted=!1,c("virtual"),this.start=(async()=>{this.isStarted=!0}),c("virtual"),this.stop=(async()=>{this.isStarted=!1}),this.restart=(async()=>{await this.stop(),await this.start()}),this.error=Z(t=>({error:t})),this.raiseError=(t=>{this.error(t)})})}catch(t){Wt(t)}})(),(async()=>{try{const{IDisposable:t}=j();c("ns","flair.app"),e("Handler",[t],function(){c("virtual"),this.construct=(()=>{}),c("virtual"),this.dispose=(()=>{})})}catch(t){Wt(t)}})(),(async()=>{try{const{Handler:t}=j("flair.app");c("ns","flair.api"),e("RestHandler",t,function(){c("virtual"),this.get=q,c("virtual"),this.post=q,c("virtual"),this.put=q,c("virtual"),this.delete=q})}catch(t){Wt(t)}})(),(async()=>{try{const{Bootware:t}=j("flair.app");c("static"),c("ns","flair.app"),e("BootEngine",function(){this.start=async function(){let e=[],i=[];const n=async()=>{let n=null,r=null,s=null;for(let a of qt.load)(a=st(a))&&(n=await d(a))&&"boolean"!=typeof n&&(r=b(n,t))&&(s=new r,e.push(s),s.info.isMountSpecific&&i.push(s))},r=async t=>{if(X.isWorker){0!==i.length&&console.warn("Mount specific bootwares are not supported for worker environment. Revisit worker:flair.app->load setting.");for(let i of e)i.info.isMountSpecific||await i[t]()}else{let n=o.host().mounts,r=Object.keys(n),s="",a=null;a=n[s="main"];for(let i of e)await i[t](a);for(let e of r)if("main"!==e){a=n[e];for(let e of i)await e[t](a)}}},s=async()=>{if(!X.isWorker){let e=st(qt.host),i=b(await d(e),t),n=null;if(!i)throw W.InvalidDefinition(e,this.start);n=new i,await n.boot(),o.host(n)}await r("boot");let e=st(qt.app),i=b(await d(e),t),n=null;if(!i)throw W.InvalidDefinition(e,this.start);n=new i,await n.boot(),o.app(n)},a=async()=>{X.isWorker||await o.host().start(),await o.app().start()},c=()=>new Promise((t,e)=>{"loading"!==document.readyState?t():(!0).document.addEventListener("DOMContentLoaded",()=>{t()})}),h=()=>new Promise((t,e)=>{(!0).document.addEventListener("deviceready",()=>{t()},!1)}),l=async()=>{X.isClient&&!X.isWorker&&(await c(),X.isCordova&&await h()),X.isWorker||await o.host().ready(),await r("ready"),await o.app().ready()};await n(),await s(),await a(),await l(),console.log("ready!")}})}catch(t){Wt(t)}})(),(async()=>{try{const{Host:t}=j("flair.app");c("sealed"),c("ns","flair.app"),e("ClientHost",t,function(){let t={},e=(!0).page,i=null;c("override"),this.construct=(t=>{t("Page","1.x")}),this.app=(()=>this.mounts["main"]),this.mounts={get:()=>t,set:q},c("override"),this.boot=(async i=>{i();let n=null,r="",s=null;const a=t=>{let e={},i=qt[`${t}-appSettings`];if(i&&i.length>0)for(let t of i)e[t.name]=t.value;return e.click=!1,e.popstate=!1,e.dispatch=!1,e.hashbang=!1,e.decodeURLComponents=!0,e};n=a("main");let o=e(n);o.strict(n.strict),o.base("/");for(let i of Object.keys(qt.mounts))"main"===i?(r="/",s=o):(n=a(i),r=qt.mounts[i],(s=e.create(n)).strict(n.strict),s.base(r)),t[i]=Object.freeze({name:i,root:r,app:s});t=Object.freeze(t)}),c("override"),this.start=(async t=>{t(),i=(()=>{let t=(!0).location.hash;"#!/"===t.substr(0,3)&&(t=t.substr(3)),"#!"===t.substr(0,2)&&(t=t.substr(2)),"#/"===t.substr(0,2)&&(t=t.substr(2)),"#"===t.substr(0,1)&&(t=t.substr(1));let e=null,i="";for(let n of this.mounts)if(t.startsWith(n.root)){e=n.app,t=t.substr(n.root.length),i=n;break}e||(i="main",e=this.mounts[i]),"/"!==t.substr(0,1)&&(t="/"+t),setTimeout(()=>{try{e(t)}catch(t){this.error(t)}},0)})}),c("override"),this.ready=(async t=>{t(),(!0).addEventListener("hashchange",i),this.app.redirect(qt.url.home),console.log(`${o.app().info.name}, v${o.app().info.version}`)}),c("override"),this.stop=(async t=>{t(),(!0).removeEventListener("hashchange",i)}),c("override"),this.dispose=(e=>{e(),t=null})})}catch(t){Wt(t)}})(),(async()=>{try{const t=await d("express | x"),i=await d("fs | x"),n=await d("http | x"),r=await d("https | x"),s=await d("http-shutdown | x"),{Host:a}=j("flair.app");c("sealed"),c("ns","flair.app"),e("ServerHost",a,function(){let e={},a=null,h=null,l=qt["https"],p=qt["http"];c("override"),this.construct=(t=>{t("Express","4.x")}),this.app=(()=>this.mounts["main"].app),this.mounts={get:()=>e,set:q},c("override"),this.boot=(async i=>{i();const n=(t,e)=>{let i=qt[`${t}-appSettings`];if(i&&i.length>0)for(let t of i)e.set(t.name,t.value)};let r=t();n("main",r);let s="",a=null;for(let i of Object.keys(qt.mounts))"main"===i?(s="/",a=r):(s=qt.mounts[i],a=t()),e[i]=Object.freeze({name:i,root:s,app:a}),"main"!==i&&(n(i,a),r.use(s,a));e=Object.freeze(e)}),c("override"),this.start=(async t=>{if(t(),p.enable&&(a=n.createServer(this.app()),(a=s(a)).on("error",t=>{this.error(t)}),-1!==p.timeout&&(a.timeout=p.timeout)),l.enable){const t=i.readFileSync(o.resolvePath(l.privateKey),"utf8"),e=i.readFileSync(o.resolvePath(l.publicCert),"utf8"),n={key:t,cert:e};h=r.createServer(n,this.app()),(h=s(h)).on("error",t=>{this.error(t)}),-1!==l.timeout&&(h.timeout=l.timeout)}}),c("override"),this.ready=(t=>new Promise((e,i)=>{t();let n=p.port||80,r=process.env.PORT||l.port||443;a&&h?a.listen(n,()=>{h.listen(r,()=>{console.log(`${o.app().info.name}, v${o.app().info.version} (http: ${n}, https: ${r})`),e()})}):a?a.listen(n,()=>{console.log(`${o.app().info.name}, v${o.app().info.version} (http: ${n})`),e()}):h?h.listen(r,()=>{console.log(`${o.app().info.name}, v${o.app().info.version} (https: ${r})`),e()}):(console.log(`${o.app().info.name}, v${o.app().info.version}`),e())})),c("override"),this.stop=(async t=>{t(),a&&(console.log("http server is shutting down..."),a.shutdown(()=>{a=null,console.log("http server is cleanly shutdown!")})),h&&(console.log("https server is shutting down..."),h.shutdown(()=>{h=null,console.log("https server is cleanly shutdown!")}))}),c("override"),this.dispose=(t=>{t(),e=null})})}catch(t){Wt(t)}})(),(async()=>{try{const{Bootware:t}=j("flair.app");c("sealed"),c("ns","flair.boot"),e("DIContainer",t,function(){c("override"),this.construct=(t=>{t("DI Container")}),c("override"),this.boot=(async()=>{let t=qt.container;for(let e in t)t.hasOwnProperty(e)&&p.register(e,t[e])})})}catch(t){Wt(t)}})(),(async()=>{try{const{Bootware:t}=j("flair.app");c("sealed"),c("ns","flair.boot"),e("Middlewares",t,function(){c("override"),this.construct=(t=>{t("Express Middlewares",!0)}),c("override"),this.boot=(async t=>{let e=qt[`${t.name}-middlewares`];if(e&&e.length>0){let i=null,n=null;for(let r of e)if(r.module)try{i=require(r.name),n=r.func?i[r.func]:i;let e=[],s=null;r.args=r.args||[];for(let t of r.args){if("string"==typeof t&&t.startsWith("return "))s=new Function(t)();else if("object"==typeof t)for(let e in t)t.hasOwnProperty(e)&&"string"==typeof(s=t[e])&&s.startsWith("return ")&&(s=new Function(t)(),t[e]=s);else s=t;e.push(s)}t.app.use(n(...e))}catch(t){throw W.OperationFailed(`Middleware ${r.module} load failed.`,t,this.boot)}}})})}catch(t){Wt(t)}})(),(async()=>{try{const t=await d("node-env-file | x"),{Bootware:i}=j("flair.app");c("sealed"),c("ns","flair.boot"),e("NodeEnv",i,function(){c("override"),this.construct=(t=>{t("Node Server Environment")}),c("override"),this.boot=(async()=>{if(qt.envVars.length>0)for(let e of qt.envVars)t(o.resolvePath(e),qt.envVarsLoadOptions)})})}catch(t){Wt(t)}})(),(async()=>{try{const{Bootware:t}=j("flair.app");c("sealed"),c("ns","flair.boot"),e("ResHeaders",t,function(){c("override"),this.construct=(t=>{t("Server Response Headers",!0)}),c("override"),this.boot=(async t=>{let e=qt[`${t.name}-resHeaders`];e&&e.length>0&&t.app.use((t,i,n)=>{for(let t of e)i.setHeader(t.name,t.value);n()})})})}catch(t){Wt(t)}})(),(async()=>{try{const{Bootware:t}=j("flair.app"),{RestHandler:i}=j("flair.api"),{ViewHandler:n,ViewMiddleware:r}=j("flair.ui");c("sealed"),c("ns","flair.boot"),e("Router",t,function(){let t=null;c("override"),this.construct=(t=>{t("Router",!0)}),c("override"),this.boot=(async e=>{t||(t=o.context.current().allRoutes(!0)).sort((t,e)=>t.index<e.index?-1:t.index>e.index?1:0);let s=!1;const a=()=>{for(let n of t)n.mount===e.name&&n.verbs.forEach(t=>{e.app[t](n.path,(e,r,a)=>{const o=t=>{a(t)},c=t=>{t||a()};d(n.handler).then(a=>{let h=b(a,i);if(h)try{z(new h,i=>{(s=i[t](e,r))&&"function"==typeof s.then?s.then(t=>{c(t)}).catch(o):c(s)})}catch(t){o(t)}else o(W.InvalidDefinition(`Invalid route handler. ${n.handler}`))}).catch(o)})});e.app.use((t,e,i)=>{var n=new Error("Not Found");n.status=404,i(n)}),X.isProd,e.app.use((t,e,i)=>{i.status(t.status||500),e.xhr?i.status(500).send({error:t.toString()}):i.render("error",{message:t.message,error:t}),i.end()})},c=()=>{const i=(t,e)=>new Promise((i,n)=>{let s=qt[`${t}-middlewares`]||[];s&&s.length>0?tt(s,(t,i,n)=>{d(n).then(s=>{let a=b(s,r);if(a)try{let n;(new a).run(e).then(()=>{e.$stop?i():t()}).catch(i)}catch(t){i(t)}else i(W.InvalidDefinition(`Invalid view middleware. (${n})`))}).catch(i)}).then(i).catch(n):i()});let s="view";for(let r of t)r.mount===e.name&&e.app(r.path,t=>{const a=t=>{o.host().raiseError(t)},c=t=>{e.app.redirect(t)};t.$stop=!1,t.$redirect="",i(e.name,t).then(()=>{t.$stop?(t.handled=!0,t.$redirect&&c(t.$redirect)):d(r.handler).then(e=>{let i=b(e,n);if(i)try{z(new i,e=>{e[s](t).then(()=>{t.handled=!0,t.$redirect&&c(t.$redirect)}).catch(a)})}catch(t){a(t)}else a(W.InvalidDefinition(`Invalid route handler. (${r.handler})`))}).catch(a)}).catch(e=>{t.$stop?(t.handled=!0,t.$redirect&&c(t.$redirect)):a(e)})});e.app("*",t=>{let i=qt.url["404"];i?(t.handled=!0,e.app.redirect(i)):(!0).history.back()})};X.isServer?a():c()})})}catch(t){Wt(t)}})(),(async()=>{try{const{Handler:t}=j("flair.app"),{ViewTransition:i}=j("flair.ui");c("ns","flair.ui"),e("ViewHandler",t,function(){let t=!1,e=!1,n="";c("override"),this.construct=((t,e,i,r)=>{t(),n=e||"main",this.viewTransition=r,this.title=this.title+(i?" - "+i:"")}),this.init=(async()=>{if(!t){t=!0,this.name=this.$self.id+"_"+at();let e=u("clientFile");if(this.style&&this.style.endsWith(".css")&&(this.style=await e(this.style)),this.html&&this.html.endsWith(".html")&&(this.html=await e(this.html)),this.viewTransition){let t=b(await d(this.viewTransition),i);this.viewTransition=t?new t:""}}}),c("privateSet"),this.viewTransition="",c("privateSet"),this.name="",c("protectedSet"),this.title="",c("protected"),this.style="",c("protected"),this.html="",c("protectedSet"),this.meta=null,this.view=(async t=>{if(t){await this.init();let e=this.append();this.loadView(t,e),await this.swap()}}),c("protected"),c("virtual"),c("async"),this.loadView=q,c("static"),this.currentView="",c("static"),this.currentViewMeta=[],c("private"),this.append=(()=>{if(!e){e=!0;let t=Y.createElement("div");if(t.id=this.name,t.setAttribute("hidden",""),this.style){let e=Y.createElement("style");e.setAttribute("scoped",""),e.innerText=this.style.trim(),t.appendChild(e)}let i=Y.createElement("div"),r;return i.innerHTML=this.html.trim(),t.appendChild(i),Y.getElementById(n).appendChild(t),t}return null}),c("private"),this.swap=(async()=>{let t=Y.getElementById(this.name);if(this.$static.currentView){let e=Y.getElementById(this.$static.currentView),i;for(let t of this.meta)Y.head.removeChild(Y.querySelector('meta[name="'+t+'"]'));this.viewTransition?(await this.viewTransition.leave(e,t),await this.viewTransition.enter(t,e)):(e.hidden=!0,t.hidden=!1),Y.getElementById(n).removeChild(e)}for(let t of this.meta){var e=document.createElement("meta");for(let i in t)e[i]=t[i];Y.head.appendChild(e)}this.$static.currentView||(t.hidden=!1),Y.title=this.title,this.$static.currentView=this.name,this.$static.currentViewMeta=this.meta})})}catch(t){Wt(t)}})(),(async()=>{try{c("ns","flair.ui"),e("ViewMiddleware",function(){c("virtual"),c("async"),this.run=q})}catch(t){Wt(t)}})(),(async()=>{try{c("ns","flair.ui"),e("ViewTransition",function(){c("virtual"),c("async"),this.enter=q,c("virtual"),c("async"),this.leave=q})}catch(t){Wt(t)}})(),o.context.current().currentAssemblyBeingLoaded(""),o.registerAdo('{"name":"flair.app","file":"./flair.app{.min}.js","mainAssembly":"flair","desc":"True Object Oriented JavaScript","title":"Flair.js","version":"0.30.93","lupdate":"Sun, 28 Apr 2019 17:40:00 GMT","builder":{"name":"<<name>>","version":"<<version>>","format":"fasm","formatVersion":"1","contains":["initializer","types","enclosureVars","enclosedTypes","resources","assets","routes","selfreg"]},"copyright":"(c) 2017-2019 Vikas Burman","license":"MIT","types":["flair.app.Bootware","flair.app.App","flair.app.Host","flair.app.Handler","flair.api.RestHandler","flair.app.BootEngine","flair.app.ClientHost","flair.app.ServerHost","flair.boot.DIContainer","flair.boot.Middlewares","flair.boot.NodeEnv","flair.boot.ResHeaders","flair.boot.Router","flair.ui.ViewHandler","flair.ui.ViewMiddleware","flair.ui.ViewTransition"],"resources":[],"assets":[],"routes":[]}')})();