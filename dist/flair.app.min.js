/**
 * @preserve
 * Flair.js
 * True Object Oriented JavaScript
 * 
 * Assembly: flair.app
 *     File: ./flair.app.js
 *  Version: 0.8.75
 *  Sun, 23 Jun 2019 20:53:59 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * MIT
 */
!function(t,e){"use strict";"function"==typeof!0&&(!0).amd?(!0)(e):"object"==typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),module.exports=exports=e):t["flair.app"]=e}(this,async function(t,e){"use strict";const{Class:i,Struct:s,Enum:a,Interface:r,Mixin:n,Aspects:o,AppDomain:l,$$:c,attr:h,bring:u,Container:p,include:d,Port:f,on:v,post:w,telemetry:m,Reflector:y,Serializer:g,Tasks:b,as:$,is:S,isComplies:x,isDerivedFrom:T,isAbstract:E,isSealed:R,isStatic:I,isSingleton:O,isDeprecated:V,isImplements:H,isInstanceOf:W,isMixed:k,getAssembly:C,getAttr:P,getContext:j,getResource:B,getRoute:A,getType:M,ns:U,getTypeOf:D,getTypeName:L,typeOf:F,dispose:z,using:N,Args:J,Exception:q,noop:G,nip:K,nim:_,nie:Q,event:X}=t,{TaskInfo:Y}=t.Tasks,{env:Z}=t.options,{guid:tt,forEachAsync:et,replaceAll:it,splitAndTrim:st,findIndexByProp:at,findItemByProp:rt,which:nt,isArrowFunc:ot,isASyncFunc:lt,sieve:ct,deepMerge:ht,getLoadedScript:ut,b64EncodeUnicode:pt,b64DecodeUnicode:dt}=t.utils,{$$static:ft,$$abstract:vt,$$virtual:wt,$$override:mt,$$sealed:yt,$$private:gt,$$privateSet:bt,$$protected:$t,$$protectedSet:St,$$readonly:xt,$$async:Tt,$$overload:Et,$$enumerate:Rt,$$dispose:It,$$post:Ot,$$on:Vt,$$timer:Ht,$$type:Wt,$$args:kt,$$inject:Ct,$$resource:Pt,$$asset:jt,$$singleton:Bt,$$serialize:At,$$deprecate:Mt,$$session:Ut,$$state:Dt,$$conditional:Lt,$$noserialize:Ft,$$ns:zt}=c,Nt=Z.isServer||Z.isWorker?null:(!0).document,Jt=l.context.current().name,qt=e,Gt=qt.substr(0,qt.lastIndexOf("/")+1);l.loadPathOf("flair.app",Gt);let Kt=JSON.parse('{"host":"flair.app.ServerHost | flair.app.ClientHost","app":"flair.app.App","boot":{"files":[],"preambles":[],"bootwares":[]},"di":{"container":{}},"client":{"view":{"el":"main","title":"","transition":""},"routes":{"home":"","notfound":""},"i18n":{"lang":{"default":"en","locales":[{"code":"en","name":"English","native":"English"}]}},"routing":{"mounts":{"main":"/"},"main-settings":[{"name":"hashbang","value":false},{"name":"lang","value":false},{"name":"sensitive","value":false}],"main-interceptors":[]}},"server":{"express":{"server-http":{"enable":false,"port":80,"timeout":-1},"server-https":{"enable":false,"port":443,"timeout":-1,"privateKey":"","publicCert":""}},"envVars":{"vars":[],"options":{"overwrite":true}},"routing":{"mounts":{"main":"/"},"main-settings":[],"main-middlewares":[],"main-interceptors":[],"main-resHeaders":[]}}}'),_t=t.Port("settingsReader");if("function"==typeof _t){let t=_t("flair.app");t&&(Kt=ht([Kt,t],!1))}Kt=Object.freeze(Kt);let Qt=JSON.parse("{}");Qt=Object.freeze(Qt);let Xt=()=>{};return l.context.current().currentAssemblyBeingLoaded("./flair.app{.min}.js"),await(async()=>{c("abstract"),c("ns","flair.app"),i("Bootware",function(){c("virtual"),this.construct=((t,e,i)=>{let s=J("name: string, version: string","name: string, version: string, isMountSpecific: boolean","name: string, isMountSpecific: boolean","name: string")(t,e,i);s.throwOnError(this.construct),this.info=Object.freeze({name:s.values.name||"",version:s.values.version||"",isMountSpecific:s.values.isMountSpecific||!1})}),c("virtual"),c("async"),this.boot=G,c("readonly"),this.info=null,c("virtual"),c("async"),this.ready=G,c("virtual"),this.dispose=G})})(),await(async()=>{const{IDisposable:t}=U();c("ns","flair.app"),i("Handler",[t],function(){c("virtual"),this.construct=(()=>{}),c("virtual"),this.dispose=(()=>{})})})(),await(async()=>{const{Handler:t}=U("flair.app");c("ns","flair.api"),i("RestHandler",t,function(){c("private"),this.run=(async(t,e,i)=>{if("function"==typeof t)try{await t(e,i)}catch(t){i.status(t.status||500).json({status:t.status,message:t.message})}else i.status(501).json({status:"501",message:"Not Implemented"})}),this.get=(async(t,e)=>{await this.run(this.onGet,t,e)}),this.post=(async(t,e)=>{await this.run(this.onPost,t,e)}),this.put=(async(t,e)=>{await this.run(this.onPut,t,e)}),this.patch=(async(t,e)=>{await this.run(this.onPatch,t,e)}),this.delete=(async(t,e)=>{await this.run(this.onDelete,t,e)})})})(),await(async()=>{const{IDisposable:t}=U(),{Bootware:e}=U("flair.app");c("ns","flair.app"),i("App",e,[t],function(){c("override"),this.construct=(t=>{let e=C(this);t(e.title,e.version)}),c("override"),c("sealed"),this.boot=(async t=>{t(),l.host().error.add(this.handleError)}),this.start=(async()=>{if(!Z.isServer&&!Z.isWorker){const{ViewState:t}=U("flair.ui");new t}await this.onStart()}),c("virtual"),c("async"),this.onStart=G,c("override"),c("sealed"),this.ready=(async()=>{await this.onReady()}),c("virtual"),c("async"),this.onReady=G,this.stop=(async()=>{if(!Z.isServer&&!Z.isWorker){const{ViewState:t}=U("flair.ui");(new t).clear()}await this.onStop()}),c("virtual"),c("async"),this.onStop=G,c("private"),this.handleError=(t=>{this.onError(t.args.error)}),c("virtual"),this.onError=(t=>{throw q.OperationFailed(t,this.onError)}),c("override"),this.dispose=(t=>{t(),l.host().error.remove(this.handleError)})})})(),await(async()=>{const{IDisposable:t}=U(),{Bootware:e}=U("flair.app");c("ns","flair.app"),i("Host",e,[t],function(){c("virtual"),c("async"),this.start=G,c("virtual"),c("async"),this.stop=G,this.error=X(t=>({error:t})),this.raiseError=(t=>{this.error(t)})})})(),await(async()=>{const{Handler:t}=U("flair.app");c("ns","flair.ui"),i("ViewHandler",t,function(){let t="";c("override"),this.construct=((e,i,s,a)=>{e(),i=i||Kt.client.view.el||"main",s=s||Kt.client.view.title||"",a=a||Kt.client.view.transition||"",t=i,this.viewTransition=a,this.title=this.title+(s?" - "+s:"")}),c("privateSet"),this.viewTransition="",c("protectedSet"),this.name="",c("protectedSet"),this.title="",c("protectedSet"),this.meta=null,this.view=(async e=>{const{ViewTransition:i}=U("flair.ui");if(this.name=this.name||this.$Type.getName(!0),this.viewTransition){let t=$(await d(this.viewTransition),i);this.viewTransition=t?new t:""}let s=Nt.createElement("div"),a=Nt.getElementById(t);s.id=this.name,s.setAttribute("hidden",""),a.appendChild(s),await this.onView(e,s),await this.swap()}),c("protected"),c("virtual"),c("async"),this.onView=G,c("private"),this.swap=(async()=>{let e=Nt.getElementById(this.name);if(this.$Type.currentView){let i=Nt.getElementById(this.$Type.currentView);if(this.$Type.currentViewMeta)for(let t of this.$Type.currentViewMeta)Nt.head.removeChild(Nt.querySelector('meta[name="'+t+'"]'));this.viewTransition?(await this.viewTransition.leave(i,e),await this.viewTransition.enter(e,i)):(i&&(i.hidden=!0),e.hidden=!1);let s=Nt.getElementById(t);i&&s.removeChild(i)}if(this.meta)for(let t of this.meta){var i=document.createElement("meta");for(let e in t)i[e]=t[e];Nt.head.appendChild(i)}this.$Type.currentView||(e.hidden=!1),Nt.title=this.title,this.$static.currentView=this.name,this.$static.currentViewMeta=this.meta}),c("static"),this.currentView=null,c("static"),this.currentViewMeta=null})})(),await(async()=>{c("sealed"),c("ns","flair.ui"),i("Page",function(){let t=[],e;this.construct=(t=>{this.hasbang=t.hasbang||!1,this.lang=t.lang||!1,this.base=t.base||"",this.sensitive=t.sensitive||!1,this.base.endsWith("/")&&(this.base=this.base.substr(0,this.base.length-1)),this.base.startsWith("/")||(this.base="/"+this.base)}),c("readonly"),this.hasbang=!1,c("readonly"),this.lang=!1,c("readonly"),this.base="",c("readonly"),this.sensitive=!1,c("private"),this.pathToRegExp=((t,e)=>{t.startsWith("/")&&(t=t.substr(1)),t.endsWith("/")&&(t=t.substr(0,t.length-1));let i=t?t.split("/"):[],s="",a=0;for(let t of i)(t=t.trim()).startsWith(":")?(e.push({name:t.substr(1),index:a}),s+="/.[^/]*"):s+="/"+t,a++;s+="/";let r=null;return r=this.sensitive?new RegExp(s):new RegExp(s,"i")}),this.breakUrl=(e=>{let i={url:e,path:"",loc:"",params:{},handler:null,route:null},s=e;if("/"===s.substr(0,1)&&(s=s.substr(1)),"#!/"===s.substr(0,3)&&(s=s.substr(3)),"#!"===s.substr(0,2)&&(s=s.substr(2)),"#/"===s.substr(0,2)&&(s=s.substr(2)),"#"===s.substr(0,1)&&(s=s.substr(1)),"/"===s.substr(0,1)&&(s=s.substr(1)),(s="/"+s).startsWith(this.base)&&(s=s.substr(this.base.length)),this.lang){s.startsWith("/")&&(s=s.substr(1));let t=s.split("/");if(t.length>0){let e=t[0].trim();-1!==l.host().supportedLocales.indexOf(e)&&(i.loc=e),t.shift(),(s=t.join("/")).startsWith("/")||(s="/"+s)}}s.startsWith("/")||(s="/"+s);let a=s.indexOf("?"),r="",n=null;if(-1!==a){r=s.substr(a+1),s=s.substr(0,a);let t=r.split("&"),e=null;for(let i of t)e=i.split("="),(n=n||{})[e[0].trim()]=decodeURIComponent(e[1].trim())}s.endsWith("/")||(s+="/"),i.path=s;for(let e of t){let t=e.regex.exec(decodeURIComponent(s));if(t&&t.input===t[0]){s.startsWith("/")&&(s=s.substr(1)),s.endsWith("/")&&(s=s.substr(0,s.length-1));let t=s?s.split("/"):[];for(let s of e.keys)i.params[s.name]=t[s.index];i.handler=e.handler,i.route=e.route;break}}return n&&(i.params=Object.assign(i.params,n)),i}),this.buildUrl=((t,e)=>{let i=this.base;if(i.endsWith("/")||(i+="/"),this.lang&&(i+=l.host().currentLocale+"/"),t.startsWith("/")&&(t=t.substr(1)),(i+=t).startsWith("/")||(i="/"+i),(i=this.hasbang?"#!"+i:"#"+i).endsWith("/")||(i+="/"),e){let t=-1,s="?",a=null;for(let r in e)e.hasOwnProperty(r)&&(t=i.indexOf(`:${r}`),a=encodeURIComponent(e[r].toString()),-1!==t?i=it(i,`:${r}`,a):s+=`${r}=${a}`);"?"!==s&&(i+=s)}return i}),this.rebuildUrl=(t=>{let e=this.breakUrl(t);return this.buildUrl(e.path,e.params)}),this.add=((e,i)=>{let s=[];t.push({route:e,path:e.path,keys:s,regex:this.pathToRegExp(e.path,s),handler:i})}),this.add404=(t=>{e=t}),this.run=(async t=>{let i={$url:t,$route:"",$handler:"",$mount:"",$path:"",$stop:!1,$redirect:{route:"",params:{}}},s=this.breakUrl(t),a=s.loc,r=s.params;s.route&&(i.$route=s.route.name,i.$handler=s.route.handler,i.$mount=s.route.mount,i.$path=s.route.path),r&&(i=Object.assign(i,r));try{if(s.handler){if(this.lang&&l.host().locale(a),await s.handler(i),i.$redirect.route){let t=i.$redirect,e=i.$params;setTimeout(()=>{l.host().redirect(t,e)},0)}}else await e(i)}catch(t){l.host().raiseError(t)}})})})(),await(async()=>{const{RestHandler:t}=U("flair.api");c("ns","flair.api"),i("RESTfulService",t,function(){})})(),await(async()=>{c("ns","flair.api"),i("RestInterceptor",function(){c("virtual"),c("async"),this.run=G})})(),await(async()=>{const{Bootware:e}=U("flair.app");c("static"),c("ns","flair.app"),i("BootEngine",function(){this.start=async function(){let i=[],s=[];const a=async()=>{for(let t of Kt.boot.files)(t=nt(t))&&await d(t)},r=async()=>{let e=null;for(let i of Kt.boot.preambles)(i=nt(i))&&(e=await d(i),await e(t))},n=async()=>{let t=null,a=null,r=null;for(let n of Kt.boot.bootwares)(n=nt(n))&&(t=await d(n))&&"boolean"!=typeof t&&(a=$(t,e))&&(r=new a,i.push(r),r.info.isMountSpecific&&s.push(r))},o=async t=>{if(Z.isWorker){0!==s.length&&console.warn("Mount specific bootwares are not supported for worker environment. Revisit worker:flair.app->load setting.");for(let e of i)e.info.isMountSpecific||await e[t]()}else{let e=l.host().mounts,a=Object.keys(e),r="",n=null;n=e[r="main"];for(let e of i)await e[t](n);for(let i of a)if("main"!==i){n=e[i];for(let e of s)await e[t](n)}}},c=async()=>{const t=await d(Kt.host),e=await d(Kt.app);if(!Z.isWorker){let e=new t;await e.boot(),l.host(e)}await o("boot");let i=new e;await i.boot(),l.app(i)},h=async()=>{Z.isWorker||await l.host().start(),await l.app().start()},u=()=>new Promise((t,e)=>{"loading"!==document.readyState?t():(!0).document.addEventListener("DOMContentLoaded",()=>{t()})}),p=()=>new Promise((t,e)=>{(!0).document.addEventListener("deviceready",()=>{t()},!1)}),f=async()=>{Z.isClient&&!Z.isWorker&&(await u(),Z.isCordova&&await p()),Z.isWorker||await l.host().ready(),await o("ready"),await l.app().ready()};await a(),await r(),await n(),await c(),await h(),await f(),console.log("ready!")}})})(),await(async()=>{const{Host:t}=U("flair.app"),{ViewHandler:e,Page:s}=U("flair.ui");c("sealed"),c("ns","flair.app"),i("ClientHost",t,function(){let t={},i=null;c("override"),this.construct=(t=>{t("Client")}),this.app={get:()=>this.mounts["main"].app,set:G},this.mounts={get:()=>t,set:G},c("state"),c("private"),this.currentLocale=Kt.client.i18n.lang.default,this.defaultLocale={get:()=>Kt.client.i18n.lang.default,set:G},this.supportedLocales={get:()=>Kt.client.i18n.lang.locales.slice(),set:G},this.locale=((t,e)=>{if(t&&this.currentLocale!==t&&(this.currentLocale=t,e)){let t,e=this((!0).location.hash).rebuildUrl((!0).location.hash);this.go(e)}return this.currentLocale}),this.routeToUrl=((t,e)=>{if(!t)return null;let i=l.context.current().getRoute(t),s;return i?this.mounts[i.mount].app.buildUrl(i.path,e):it(t,".","_")}),this.pathToUrl=((t,e)=>{let i;return this.urlToApp(t).buildUrl(t,e)}),c("private"),this.urlToApp=(t=>{"#!/"===t.substr(0,3)&&(t=t.substr(3)),"#!"===t.substr(0,2)&&(t=t.substr(2)),t.startsWith("/")||(t="/"+t);let e=null;for(let i in this.mounts)this.mounts.hasOwnProperty(i)&&t.startsWith(i.base)&&i.base.length>e.base.length&&(e=i);return e?e.app:this.app}),this.view={get:()=>e.currentView,set:G},this.redirect=(async(t,e,i)=>{await this.navigate(t,e,!0),i&&await this.refresh()}),this.navigate=(async(t,e,i)=>{e=e||{};let s=this.routeToUrl(t,e);s?await this.go(s,i):this.raiseError(q.NotFound(t,this.navigate))}),this.go=(async(t,e)=>{e?history.replaceState(null,null,(!0).document.location.pathname+t):("#"===t.substr(0,1)&&(t=t.substr(1)),window.location.hash=t)}),this.refresh=(async()=>{setTimeout(()=>{i()},0)}),c("override"),this.boot=(async e=>{e();let i={},a=null;const r=t=>{let e=Kt.client.routing[`${t}-settings`];if(e&&e.length>0)for(let t of e)i[t.name]=t.value;return i.base=Kt.client.routing.mounts[t],i};i=r("main");let n=new s(i);for(let e of Object.keys(Kt.client.routing.mounts))"main"===e?a=n:(i=r(e),a=new s(i)),t[e]=Object.freeze({name:e,root:a.base,app:a});t=Object.freeze(t)}),c("override"),this.start=(async t=>{t(),i=(async()=>{let t=this.urlToApp((!0).location.hash);await t.run((!0).location.hash)})}),c("override"),this.ready=(async t=>{t(),(!0).addEventListener("hashchange",i),Kt.client.routes.home&&await this.redirect(Kt.client.routes.home,{},!0),console.log(`${l.app().info.name}, v${l.app().info.version}`)}),c("override"),this.stop=(async t=>{t(),(!0).removeEventListener("hashchange",i)}),c("override"),this.dispose=(e=>{e(),t=null})})})(),await(async()=>{const{Host:t}=U("flair.app");c("sealed"),c("ns","flair.app"),i("ServerHost",t,function(){let t={},e=null,i=null,s=Kt.server.express["server-http"],a=Kt.server.express["server-https"];c("override"),this.construct=(t=>{t("Server")}),this.app={get:()=>this.mounts["main"].app,set:G},this.mounts={get:()=>t,set:G},c("override"),this.boot=(async e=>{e();const i=await d("express | x"),s=(t,e)=>{let i=Kt.server.routing[`${t}-settings`];if(i&&i.length>0)for(let t of i)e.set(t.name,t.value)};let a=i();s("main",a);let r="",n=null;for(let e of Object.keys(Kt.server.routing.mounts))"main"===e?(r="/",n=a):(r=Kt.server.routing.mounts[e],n=i()),t[e]=Object.freeze({name:e,root:r,app:n}),"main"!==e&&(s(e,n),a.use(r,n));t=Object.freeze(t)}),c("override"),this.start=(async t=>{t();const r=await d("fs | x"),n=await d("http | x"),o=await d("https | x"),c=await d("http-shutdown | x");if(s.enable&&((e=c(e=n.createServer(this.app))).on("error",t=>{this.error(t)}),-1!==s.timeout&&(e.timeout=s.timeout)),a.enable){const t=r.readFileSync(l.resolvePath(a.privateKey),"utf8"),e=r.readFileSync(l.resolvePath(a.publicCert),"utf8"),s={key:t,cert:e};(i=c(i=o.createServer(s,this.app))).on("error",t=>{this.error(t)}),-1!==a.timeout&&(i.timeout=a.timeout)}}),c("override"),this.ready=(t=>new Promise((r,n)=>{t();let o=s.port||80,c=process.env.PORT||a.port||443;e&&i?e.listen(o,()=>{i.listen(c,()=>{console.log(`${l.app().info.name}, v${l.app().info.version} (http: ${o}, https: ${c})`),r()})}):e?e.listen(o,()=>{console.log(`${l.app().info.name}, v${l.app().info.version} (http: ${o})`),r()}):i?i.listen(c,()=>{console.log(`${l.app().info.name}, v${l.app().info.version} (https: ${c})`),r()}):(console.log(`${l.app().info.name}, v${l.app().info.version}`),r())})),c("override"),this.stop=(async t=>{t(),e&&(console.log("http server is shutting down..."),e.shutdown(()=>{e=null,console.log("http server is cleanly shutdown!")})),i&&(console.log("https server is shutting down..."),i.shutdown(()=>{i=null,console.log("https server is cleanly shutdown!")}))}),c("override"),this.dispose=(e=>{e(),t=null})})})(),await(async()=>{const{Bootware:t}=U("flair.app");c("sealed"),c("ns","flair.boot"),i("ClientRouter",t,function(){const{ViewHandler:t,ViewInterceptor:e}=U("flair.ui");let i=null;c("override"),this.construct=(t=>{t("Client Router",!0)}),c("override"),this.boot=(async(s,a)=>{s(),i||(i=l.context.current().allRoutes(!0)).sort((t,e)=>t.index<e.index?-1:t.index>e.index?1:0);const r=async(t,i)=>{let s=$(await d(t),e);if(!s)throw q.InvalidDefinition(`Invalid interceptor type. (${t})`);{let t=new s;await t.run(i)}},n=async(e,i)=>{let s=$(await d(e),t);if(!s)throw q.InvalidDefinition(`Invalid route handler. (${e})`);{let t=new s;await t.view(i)}},o=function(t){return async e=>{let i=Kt.client.routing[`${t.mount}-interceptors`]||[];for(let t of i)if(await r(t,e),e.$stop)break;e.$stop||await n(t.handler,e)}};let c=a.app;for(let t of i)t.mount===a.name&&t.name!==Kt.client.routes.notfound&&c.add(t,o(t));c.add404(async t=>{let e=Kt.client.routes.notfound;e&&(e=l.context.current().getRoute(e)),e?await n(e.handler,t):setTimeout(()=>{(!0).history.back()},0)})})})})(),await(async()=>{const{Bootware:t}=U("flair.app");c("sealed"),c("ns","flair.boot"),i("DIContainer",t,function(){c("override"),this.construct=(t=>{t("DI Container")}),c("override"),this.boot=(async t=>{t();let e=Kt.di.container;for(let t in e)e.hasOwnProperty(t)&&p.register(t,e[t])})})})(),await(async()=>{const{Bootware:t}=U("flair.app");c("sealed"),c("ns","flair.boot"),i("Middlewares",t,function(){c("override"),this.construct=(t=>{t("Express Middlewares",!0)}),c("override"),this.boot=(async(t,e)=>{t();let i=Kt.server.routing[`${e.name}-middlewares`];if(i&&i.length>0){let t=null,s=null;for(let a of i)if(a.name)try{t=require(a.name),s=a.func?t[a.func]:t;let i=[],r=null;a.args=a.args||[];for(let t of a.args){if("string"==typeof t&&t.startsWith("return "))r=new Function(t)();else if("object"==typeof t){for(let e in t)t.hasOwnProperty(e)&&"string"==typeof(r=t[e])&&r.startsWith("return ")&&(r=new Function(t)(),t[e]=r);r=t}else r=t;i.push(r)}e.app.use(s(...i))}catch(t){throw q.OperationFailed(`Middleware ${a.module} load failed.`,t,this.boot)}}})})})(),await(async()=>{const{Bootware:t}=U("flair.app");c("sealed"),c("ns","flair.boot"),i("NodeEnv",t,function(){c("override"),this.construct=(t=>{t("Node Server Environment")}),c("override"),this.boot=(async t=>{if(t(),Kt.server.envVars.vars.length>0){const t=await d("node-env-file | x");if(t)for(let e of Kt.server.envVars.vars)t(l.resolvePath(e),Kt.server.envVars.options)}})})})(),await(async()=>{const{Bootware:t}=U("flair.app");c("sealed"),c("ns","flair.boot"),i("ResHeaders",t,function(){c("override"),this.construct=(t=>{t("Server Response Headers",!0)}),c("override"),this.boot=(async(t,e)=>{t();let i=Kt[`${e.name}-resHeaders`];i&&i.length>0&&e.app.use((t,e,s)=>{for(let t of i)e.setHeader(t.name,t.value);s()})})})})(),await(async()=>{const{Bootware:t}=U("flair.app");c("sealed"),c("ns","flair.boot"),i("ServerRouter",t,function(){const{RestHandler:t,RestInterceptor:e}=U("flair.api");let i=null;c("override"),this.construct=(t=>{t("Server Router",!0)}),c("override"),this.boot=(async(s,a)=>{s(),i||(i=l.context.current().allRoutes(!0)).sort((t,e)=>t.index<e.index?-1:t.index>e.index?1:0);let r=!1;const n=(t,e,i)=>new Promise((s,a)=>{try{let r;(new t).run(e,i).then(()=>{e.$stop?a():s()}).catch(a)}catch(t){a(t)}}),o=(t,i,s)=>et(t,(t,a,r)=>{d(r).then(o=>{let l=$(o,e);l?n(l,i,s).then(t).catch(a):a(q.InvalidDefinition(`Invalid interceptor type. (${r})`))}).catch(a)});for(let e of i)e.mount===a.name&&e.verbs.forEach(i=>{a.app[i](e.path,(s,n,l)=>{const c=t=>{l(t)},h=t=>{t||l()},u=()=>{d(e.handler).then(a=>{let o=$(a,t);if(o)try{N(new o,t=>{(r=t[i](s,n))&&"function"==typeof r.then?r.then(t=>{h(t)}).catch(c):h(r)})}catch(t){c(t)}else c(q.InvalidDefinition(`Invalid route handler. ${e.handler}`))}).catch(c)};s.$stop=!1;let p=Kt.server.routing[`${a.name}-interceptors`]||[];o(p,s,n).then(()=>{s.$stop?n.end():u()}).catch(t=>{s.stop?n.end():c(t)})})});a.app.use((t,e,i)=>{var s=new Error("Not Found");s.status=404,i(s)}),Z.isProd,a.app.use((t,e,i)=>{i.status(t.status||500),e.xhr?i.status(500).send({error:t.toString()}):i.render("error",{message:t.message,error:t}),i.end()})})})})(),await(async()=>{c("ns","flair.ui"),i("ViewInterceptor",function(){c("virtual"),c("async"),this.run=G})})(),await(async()=>{c("singleton"),c("ns","flair.ui"),i("ViewState",function(){c("state"),c("private"),this.store={},this.get=((t,e)=>(t=t||"",e=e||"",this.store[t+"/"+e]||null)),this.set=((t,e,i)=>{t=t||"",e=e||"","boolean"==typeof i||i?this.store[t+"/"+e]=i:delete this.store[t+"/"+e]}),this.clear=(()=>{this.store=null})})})(),await(async()=>{c("ns","flair.ui"),i("ViewTransition",function(){c("virtual"),c("async"),this.enter=G,c("virtual"),c("async"),this.leave=G})})(),l.context.current().currentAssemblyBeingLoaded(""),l.registerAdo('{"name":"flair.app","file":"./flair.app{.min}.js","mainAssembly":"flair","desc":"True Object Oriented JavaScript","title":"Flair.js","version":"0.8.75","lupdate":"Sun, 23 Jun 2019 20:53:59 GMT","builder":{"name":"flairBuild","version":"1","format":"fasm","formatVersion":"1","contains":["init","func","type","vars","reso","asst","rout","sreg"]},"copyright":"(c) 2017-2019 Vikas Burman","license":"MIT","types":["flair.app.Bootware","flair.app.Handler","flair.api.RestHandler","flair.app.App","flair.app.Host","flair.ui.ViewHandler","flair.ui.Page","flair.api.RESTfulService","flair.api.RestInterceptor","flair.app.BootEngine","flair.app.ClientHost","flair.app.ServerHost","flair.boot.ClientRouter","flair.boot.DIContainer","flair.boot.Middlewares","flair.boot.NodeEnv","flair.boot.ResHeaders","flair.boot.ServerRouter","flair.ui.ViewInterceptor","flair.ui.ViewState","flair.ui.ViewTransition"],"resources":[],"assets":[],"routes":[]}'),Object.freeze({name:"flair.app",settings:Kt,config:Qt})});