/**
 * @preserve
 * FlairJS
 * True Object Oriented JavaScript
 * 
 * Assembly: flair.cli
 *     File: ./flair.cli.js
 *  Version: 0.15.622
 *  Sat, 02 Mar 2019 03:27:33 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * Licensed under MIT
 */
const e=require("recursive-readdir-sync"),n=require("copy-dir"),t=require("path"),i=require("fs-extra"),s=require("del"),r={name:"flair.cli",version:"0.15.622",format:"fasm",formatVersion:"1",contains:["initializer","types","enclosureVars","enclosedTypes","resources","assets","selfreg"]};let c=(e,n)=>{const s=()=>{return i.readdirSync(e).filter(n=>{return i.statSync(t.join(e,n)).isDirectory()})};return n?s():["/"].concat(s())},o=e=>{s.sync([e+"/**","!"+e])};const u=e=>{return e.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1")},a=(e,n,t)=>{return e.replace(new RegExp(u(n),"g"),t)};process.on("unhandledRejection",e=>{console.log(e)});const l=e=>{if(!e.skipBumpVersion){let n=e.packageJSON.version.split(".");n[0]=parseInt(n[0]),n[1]=parseInt(n[1]),n[2]=parseInt(n[2]),n[2]>=99999?(n[2]=0,n[1]>=999?(n[1]=0,n[0]+=1):n[1]+=1):n[2]+=1;let t=n[0].toString()+"."+n[1].toString()+"."+n[2].toString();e.packageJSON.version=t,i.writeFileSync(e.package,JSON.stringify(e.packageJSON,null,4),"utf8"),e.logger(0,"version",t)}},f=(e,s,r)=>{let c=[];if(e?s.postBuildDeps&&s.depsConfig&&s.depsConfig.post.length>0&&(c=s.depsConfig.post.slice()):s.preBuildDeps&&s.depsConfig&&s.depsConfig.pre.length>0&&(c=s.depsConfig.pre.slice()),0===c.length)return void r();s.logger(0,"deps",e?"(post)":"(pre)",!0);const o=c=>{if(0!==c.length){let r=c.shift();if(s.logger(1,"",r.dest),!e&&r.src.startsWith("http")){let e=null,n="";e=r.src.startsWith("https")?require("https"):require("http"),e.get(r.src,e=>{e.on("data",e=>{n+=e}),e.on("end",()=>{let e=t.resolve(r.dest);i.ensureFileSync(e),i.writeFileSync(e,n,"utf8"),o(c)})}).on("error",e=>{throw`Failed to fetch dependency: ${r.src}. 

 ${e}`})}else{let e=t.resolve(r.src),s=t.resolve(r.dest);i.lstatSync(e).isDirectory()?n.sync(e,s):i.copyFileSync(e,s),o(c)}}else r()};o(c)},p=(e,n)=>{const s="\\s*([\\(\\)\\w@_\\-.\\\\/]+)\\s*",r="<filename>",c="<!--\\s*inject:<filename>-->",o="^([ \\t]*)(.*?)"+c.replace(r,s),u=new RegExp(o,"m");let a,l,f,p,m;for(;p=u.exec(n);){m=p[0],f=p[1],l=p[2],a=p[3];var d=f+l+i.readFileSync(t.join(e,a),"utf8").split(/\r?\n/).map((e,n)=>{return n>0?f+e:e}).join("\n");n=n.replace(m,function(){return d})}return n},m=(n,s)=>{const u=n.logger,l=(e,t=true)=>{t?i.writeFileSync(n.current.asm,e,{flag:"a"}):i.writeFileSync(n.current.asm,e)},f=()=>{let e=`/**
`+` * @preserve
`+` * ${n.packageJSON.title}
`+` * ${n.packageJSON.description}
`+` * 
`+` * Assembly: ${n.current.asmName}
`+` *     File: ${n.current.asm.replace(n.current.dest,".")}
`+` *  Version: ${n.packageJSON.version}
`+` *  ${(new Date).toUTCString()}
`+` * 
`+` * ${n.packageJSON.copyright}
`+` * Licensed under ${n.packageJSON.license}
`+` */
`;l(e)},m=()=>{if(i.existsSync(n.current.asmMain)){let e=i.readFileSync(n.current.asmMain,"utf8");e=p(n.current.asmPath,e);for(let t in n.current.ado)n.current.ado.hasOwnProperty(t)&&"string"==typeof n.current.ado[t]&&(e=e.replace(`<<${t}>>`,n.current.ado[t]));l(e),u(0,"index",n.current.asmMain)}},d=()=>{i.existsSync(n.current.asm)&&(n.current.asmLupdate=i.statSync(n.current.asm).mtime,i.removeSync(n.current.asm)),i.ensureFileSync(n.current.asm)},y=()=>{n.current.ado={name:n.current.asmName,file:n.current.asm.replace(n.current.dest,".").replace(".js","{.min}.js"),desc:n.packageJSON.description,version:n.packageJSON.version,lupdate:(new Date).toUTCString(),builder:r,copyright:n.packageJSON.copyright,license:n.packageJSON.license,types:[],resources:[],assets:[]},n.skipRegistrationsFor.indexOf(n.current.asmName)===-1&&n.current.adosJSON.push(n.current.ado)},g=e=>{return new Promise((t,i)=>{let s=n.lintJS.executeOnFiles([e]);(s.errorCount>0||s.warningCount>0)&&(console.log(n.eslintFormatter(s.results)),i(`Lint for ${e} failed.`)),t()})},S=e=>{return new Promise((t,i)=>{n.lintCSS({files:[e],config:n.lintConfig.css}).then(n=>{n.errored?(console.log(n.output),i(`Lint for ${e} failed.`)):t()}).catch(i)})},h=e=>{return new Promise((t,s)=>{let r=i.readFileSync(e,"utf8");n.lintHTML(r,n.lintConfig.html).then(i=>{if(i&&i.length>0){let r=[];i.forEach(e=>{let t=e.rule||e.data.name;"undefined"!=typeof n.lintConfig.html[t]&&n.lintConfig.html[t]===!1||r.push(e)}),r.length>0?(console.log(r),s(`Lint for ${e} failed.`)):t()}else t()}).catch(s)})},N=e=>{return new Promise((t,i)=>{let s=n.minifyJS([e],n.minifyConfig.js);s.error?(console.log(s.error),i(`Minify for ${e} failed.`)):t(s.code)})},x=e=>{return new Promise((t,s)=>{let r=i.readFileSync(e,"utf8"),c=new n.minifyCSS(n.minifyConfig.css).minify(r);c.errors.length>0?(console.log(c.errors),s(`Minify for ${e} failed.`)):t(c.styles)})},C=e=>{return new Promise((t,s)=>{let r=i.readFileSync(e,"utf8"),c=n.minifyHTML(r,n.minifyConfig.html);t(c)})},b=e=>{return new Promise((s,r)=>{if(!n.fullBuild&&n.current.asmLupdate){let t=i.statSync(e).mtime;if(t<n.current.asmLupdate)return void s()}let c=t.extname(e).substr(1);if(n.lintTypes.indexOf(c)!==-1)switch(c){case"js":g(e).then(s).catch(r);break;case"css":S(e).then(s).catch(r);break;case"html":h(e).then(s).catch(r);break;default:s()}else s()})},O=e=>{return new Promise((s,r)=>{let c=t.extname(e).substr(1),o=e.replace("."+c,".min."+c);if(n.minifyTypes.indexOf(c)!==-1){let n=null;switch(c){case"js":n=N(e);break;case"css":n=x(e);break;case"html":n=C(e)}null===n?s(""):n.then(e=>{i.writeFileSync(o,e,"utf8"),s(e)}).catch(r)}else s("")})},j=e=>{return new Promise((s,r)=>{let c=i.readFileSync(e,"utf8"),o=t.extname(e).substr(1),u=e+".gz";if(n.gzipTypes.indexOf(o)!==-1){let e=n.gzipConfig[o]||n.gzipConfig.all;i.writeFileSync(u,n.zlib.gzipSync(c,e))}s()})},v=(e,s)=>{if(s=s||[],0===n.current.ado.assets.length)return n.current.ado.assets=s,void e();let r=n.current.ado.assets.splice(0,1)[0];if(s.push(r.dest.replace(n.current.dest,".")),!n.fullBuild&&i.existsSync(r.dest)){let n=i.statSync(r.src).mtime.toString(),t=i.statSync(r.dest).mtime.toString();if(n===t)return void v(e,s)}n.current.isAssetsHeadingPrinted||(u(0,"assets",""),n.current.isAssetsHeadingPrinted=!0),i.ensureDirSync(t.dirname(r.dest)),i.copyFileSync(r.src,r.dest),r.stat=r.dest.replace(n.current.dest,".")+" ("+Math.round(i.statSync(r.dest).size/1024)+"kb";let c="";const o=()=>{r.stat+=")",u(1,"",r.stat),delete r.stat,v(e,s)},a=()=>{let e="";n.gzip?n.minify&&i.existsSync(c)?(e=c+".gz",j(c).then(()=>{i.existsSync(e)&&(r.stat+=", "+Math.round(i.statSync(e).size/1024)+"kb gzipped"),o()}).catch(e=>{throw e})):(e=r.dest+".gz",j(r.dest).then(()=>{i.existsSync(e)&&(r.stat+=", "+Math.round(i.statSync(e).size/1024)+"kb gzipped"),o()}).catch(e=>{throw e})):(n.fullBuild||(e=c+".gz",i.existsSync(e)?i.removeSync(e):(e=r.dest+".gz",i.existsSync(e)&&i.removeSync(e))),o())},l=()=>{c=r.dest.replace("."+r.ext,".min."+r.ext),n.minify?O(r.dest).then(()=>{i.existsSync(c)&&(r.stat+=", "+Math.round(i.statSync(c).size/1024)+"kb minified"),a()}).catch(e=>{throw e}):(!n.fullBuild&&i.existsSync(c)&&i.removeSync(c),a())};n.lintAssets?b(r.dest).then(l).catch(e=>{throw e}):l()},z=e=>{if(0===n.current.ado.types.length)return void e();let t="";i.existsSync(n.current.asmSettings)&&(t=JSON.stringify(i.readJSONSync(n.current.asmSettings)),u(0,"settings",n.current.asmSettings));let s=`(() => {
`+`'use strict';

`+`/* eslint-disable no-unused-vars */
`+`const flair = (typeof global !== 'undefined' ? require('flair') : (typeof WorkerGlobalScope !== 'undefined' ? WorkerGlobalScope.flair : window.flair));
`+`const { Class, Struct, Enum, Interface, Mixin } = flair;
`+`const { Aspects } = flair;
`+`const { AppDomain } = flair;
`+`const { $$, attr } = flair;
`+`const { Container, include } = flair;
`+`const { Port } = flair;
`+`const { on, post, telemetry } = flair;
`+`const { Reflector } = flair;
`+`const { Serializer } = flair;
`+`const { as, is, isComplies, isDerivedFrom, isImplements, isInstanceOf, isMixed } = flair;
`+`const { getAssembly, getAttr, getContext, getResource, getType, getTypeOf, typeOf } = flair;
`+`const { dispose, using } = flair;
`+`const { args, Exception, noop  } = flair;
`+`const { isServer, isWorker } = flair.options.env;
`+`/* eslint-enable no-unused-vars */
`+`
`;t?s+=`const settings = JSON.parse('${t}'); // eslint-disable-line no-unused-vars
`:`const settings = {}; // eslint-disable-line no-unused-vars
`,l(s),u(0,"types","");let r=`flair.AppDomain.context.current().currentAssemblyBeingLoaded('${n.current.ado.file}');
`;l(r);let c=[];for(let o of n.current.ado.types){c.push(o.qualifiedName),u(1,"",o.qualifiedName+" (./"+o.file+")");let e=i.readFileSync(o.file,"utf8");e=a(e,`$$('ns', '(auto)');`,`$$$('ns', '${o.nsName}');`),e=a(e,`$$("ns", "(auto)");`,`$$$("ns", "${o.nsName}");`),e=a(e,`Class('(auto)'`,`Class('${o.typeName}'`),e=a(e,`Class("(auto)"`,`Class("${o.typeName}"`),e=a(e,`Struct('(auto)'`,`Struct('${o.typeName}'`),e=a(e,`Struct("(auto)"`,`Struct("${o.typeName}"`),e=a(e,`Mixin('(auto)'`,`Mixin('${o.typeName}'`),e=a(e,`Mixin("(auto)"`,`Mixin("${o.typeName}"`),e=a(e,`Enum('(auto)'`,`Enum('${o.typeName}'`),e=a(e,`Enum("(auto)"`,`Enum("${o.typeName}"`),e=a(e,`Interface('(auto)'`,`Interface('${o.typeName}'`),e=a(e,`Interface("(auto)"`,`Interface("${o.typeName}"`),e=p(o.nsPath,e),l(e)}n.current.ado.types=c,r=`flair.AppDomain.context.current().currentAssemblyBeingLoaded('');
`,l(r);let f=`
`+`})();
`;l(f),e()},w=(e,t)=>{if(t=t||[],0===n.current.ado.resources.length)return n.current.ado.resources=t,void e();let s=n.current.ado.resources.splice(0,1)[0];t.push(s.qualifiedName),1===t.length&&u(0,"resources",""),u(1,"",s.qualifiedName+" (./"+s.file+")");const r=r=>{let c="";r?c="utf8;":n.utf8EncodeResourceTypes.indexOf(s.ext)!==-1?(r=i.readFileSync(s.file,"utf8"),c="utf8;"):r=i.readFileSync(s.file),r=new Buffer(r).toString("base64"),c+="base64;";let o={name:s.qualifiedName,encodingType:c,asmFile:n.current.ado.file,file:"./"+s.file,data:r},u=`(() => { let rdo = JSON.parse('${JSON.stringify(o)}'); flair.AppDomain.context.current().registerResource(rdo);})();
`;l(u),w(e,t)},c=()=>{if(n.minifyResources)if(n.minifyTypes.indexOf(s.ext)!==-1)if(n.minifyTypes.indexOf(s.ext)!==-1){let e=null;switch(s.ext){case"js":e=N(s.file);break;case"css":e=x(s.file);break;case"html":e=C(s.file)}null===e?r():e.then(r).catch(e=>{throw e})}else r();else r();else r()};n.lintResources?b(s.file).then(c).catch(e=>{throw e}):c()},k=()=>{if(n.skipRegistrationsFor.indexOf(n.current.asmName)===-1){u(0,"self-reg","yes");let e=`(() => { flair.AppDomain.registerAdo('${JSON.stringify(n.current.ado)}');})();
`;l(e)}},J=e=>{n.current.stat=n.current.asm.replace(n.current.dest,".")+" ("+Math.round(i.statSync(n.current.asm).size/1024)+"kb";let t="";const s=()=>{n.current.stat+=")",e()},r=()=>{let e=t+".gz";n.gzip?j(t).then(()=>{n.current.stat+=", "+Math.round(i.statSync(e).size/1024)+"kb gzipped",s()}).catch(e=>{throw e}):(!n.fullBuild&&i.existsSync(e)&&i.removeSync(e),s())},c=()=>{t=n.current.asm.replace(".js",".min.js"),n.minify?O(n.current.asm).then(()=>{n.current.stat+=", "+Math.round(i.statSync(t).size/1024)+"kb minified",r()}).catch(e=>{throw e}):(!n.fullBuild&&i.existsSync(t)&&i.removeSync(t),r())};n.lint?b(n.current.asm).then(c).catch(e=>{throw e}):c()},T=()=>{if(0!==n.current.adosJSON.length){u(0,"preamble",n.current.preamble.replace(n.current.dest.replace("./",""),"."));let e=JSON.stringify(n.current.adosJSON),t=`(() => { let ados = JSON.parse('${e}');flair.AppDomain.registerAdo(ados);})();`;i.writeFileSync(n.current.preamble,t)}},F=()=>{let i=e(n.current.nsPath);for(let s of i)if(s.indexOf("/_")===-1){let e={nsPath:n.current.nsPath,nsName:n.current.nsName,ext:t.extname(s).toLowerCase().substr(1),file:s};if(!s.endsWith(".spec.js")&&(s.endsWith(".res.js")?(e.typeName=t.basename(s).replace(".res.js",""),e.type="res"):s.endsWith(".js")?(e.typeName=t.basename(s).replace(".js",""),e.type="type"):s.endsWith(".res."+e.ext)&&(e.typeName=t.basename(s).replace(".res."+e.ext,""),e.type="res"),e.type)){if(e.typeName.indexOf(".")!==-1)throw`Type/Resource names cannot contain dots. (${e.typeName})`;e.qualifiedName=("(root)"!==n.current.nsName?n.current.nsName+".":"")+e.typeName,"res"===e.type?n.current.ado.resources.push(e):n.current.ado.types.push(e)}}},B=()=>{if(n.current.astSrc="./"+t.join(n.current.asmPath,"(assets)"),n.current.astDest="./"+t.join(n.current.dest,n.current.asmName),i.existsSync(n.current.astSrc)){let i=e(n.current.astSrc);for(let s of i)if(s.indexOf("/_")===-1){let e={ext:t.extname(s).toLowerCase().substr(1),src:"./"+s,dest:"./"+t.join(n.current.astDest,s.replace(n.current.astSrc.replace("./",""),""))};n.current.ado.assets.push(e)}}delete n.current.astSrc,delete n.current.astDest},P=()=>{if(n.current.libsSrc="./"+t.join(n.current.asmPath,"(libs)"),n.current.libsDest="./"+t.join(n.current.dest,n.current.asmName),i.existsSync(n.current.libsSrc)){u(0,"libs",n.current.libsSrc);let s=e(n.current.libsSrc);for(let r of s)if(r.indexOf("/_")===-1){let e={ext:t.extname(r).toLowerCase().substr(1),src:"./"+r,dest:"./"+t.join(n.current.libsDest,r.replace(n.current.libsSrc.replace("./",""),""))};i.copySync(e.src,e.dest,{errorOnExist:!0})}}delete n.current.libsSrc,delete n.current.libsDest},R=e=>{if(0===n.current.namespaces.length)return delete n.current.nsName,delete n.current.nsPath,void e();let i=n.current.namespaces.splice(0,1)[0];return i.startsWith("_")?void R(e):["(assets)","(libs)","(bundle)"].indexOf(i)!==-1?void R(e):(n.current.nsName=i,n.current.nsPath="./"+t.join(n.current.asmPath,n.current.nsName),F(),void R(e))},D=e=>{if(0===n.current.assemblies.length)return void e();let i=n.current.assemblies.splice(0,1)[0];if(i.startsWith("_"))return void D(e);u(0,"asm",i,!0),n.current.asmName=i,n.current.asmPath="./"+t.join(n.current.src,n.current.asmName),n.current.asm="./"+t.join(n.current.dest,n.current.asmName+".js"),n.current.asmMain="./"+t.join(n.current.src,n.current.asmName,"index.js"),n.current.asmSettings="./"+t.join(n.current.src,n.current.asmName,"settings.json"),d(),y(),f(),m();let s=c(n.current.asmPath,!0);n.current.namespaces=s,R(()=>{B(),v(()=>{P(),z(()=>{w(()=>{k(),J(()=>{u(0,"==>",n.current.stat),D(e)})})})})})},q=e=>{if(0===n.sources.length)return void e();let i=n.sources.splice(0,1)[0];if(i.startsWith("_"))return void q(e);u(0,"group",`${i.replace(i,".")} (start)`,!0),n.current={},n.current.src=i,n.current.dest=i.replace(n.current.src,n.dest),n.current.adosJSON=[],n.current.preamble=t.join(n.current.dest,"preamble.js");let s=c(n.current.src,!0);n.current.assemblies=s,D(()=>{T(),u(0,"group",`${i.replace(i,".")} (end)`,!0),n.current={},q(e)})};n.fullBuild&&(o(n.dest),u(0,"clean","done")),q(s)};exports.flairBuild=function(e,n){e=e||{},e.engine=e.engine||"",e.package=e.package||"./package.json",e.dest=e.dest||"./dist",e.src=e.src||"./src",e.processAsGroups=e.processAsGroups||!1,e.fullBuild=e.fullBuild||!1,e.skipBumpVersion=e.skipBumpVersion||!1,e.suppressLogging=e.suppressLogging||!1,e.lint=void 0===e.lint||e.lint,e.lintConfig=e.lintConfig||"",e.lintTypes=e.lintTypes||["js","css","html"],e.minify=void 0===e.minify||e.minify,e.minifyConfig=e.minifyConfig||"",e.minifyTypes=e.minifyTypes||["js","css","html"],e.gzip=e.gzip||!1,e.gzipConfig=e.gzipConfig||"",e.gzipTypes=e.gzipTypes||["js","css","html","txt","xml","md","json","svg","jpg","jpeg","gif","png"],e.lintAssets=e.lintAssets||!1,e.minifyAssets=e.minifyAssets||!1,e.gzipAssets=e.gzipAssets||!1,e.lintResources=void 0===e.lintResources||e.lintResources,e.minifyResources=void 0===e.minifyResources||e.minifyResources,e.utf8EncodeResourceTypes=e.utf8EncodeResourceTypes||["txt","xml","js","md","json","css","html","svg"],e.depsConfig=e.depsConfig||"",e.preBuildDeps=e.preBuildDeps||!1,e.postBuildDeps=e.postBuildDeps||!1,e.fullBuild?(e.lint=!!e.lintConfig,e.minify=!!e.minifyConfig,e.gzip=!!e.gzipConfig,e.preBuildDeps=!!e.depsConfig,e.postBuildDeps=!!e.depsConfig,e.lintResources=e.lint&&e.lintResources,e.minifyResources=e.minify&&e.minifyResources,e.minifyAssets=e.minify&&e.minifyAssets,e.gzipAssets=e.gzip&&e.gzipAssets):(e.lintResources=e.lint&&e.lintResources,e.lintTypes=["js"],e.minify=!1,e.gzip=!1,e.minifyAssets=!1,e.gzipAssets=!1,e.minifyResources=!1,e.preBuildDeps=!1),e.skipRegistrationsFor=["flair","flair.build"];const s=(n,t,i,s,r)=>{if(!e.suppressLogging){let e=15;t=" ".repeat(e-t.length)+t+(0===n?": ":""),0!==n&&(i="- "+i),t=t+"  ".repeat(n)+i.toString(),s&&(t="\n"+t),r&&(t+="\n"),console.log(t)}};if(e.logger=s,e.packageJSON=i.readJSONSync(t.resolve(e.package)),e.lintConfig=e.lintConfig?i.readJSONSync(t.resolve(e.lintConfig)):null,e.minifyConfig=e.minifyConfig?i.readJSONSync(t.resolve(e.minifyConfig)):null,e.gzipConfig=e.gzipConfig?i.readJSONSync(t.resolve(e.gzipConfig)):null,e.depsConfig=e.depsConfig?i.readJSONSync(t.resolve(e.depsConfig)):null,e.lint&&e.lintConfig){if(e.lintTypes.indexOf("js")!==-1){const n=new require("eslint").CLIEngine;e.lintJS=new n(e.lintConfig.js),e.eslintFormatter=e.lintJS.getFormatter()}e.lintTypes.indexOf("css")!==-1&&(e.lintCSS=require("stylelint").lint),e.lintTypes.indexOf("html")!==-1&&(e.lintHTML=require("htmllint"))}e.minify&&e.minifyConfig&&(e.minifyTypes.indexOf("js")!==-1&&(e.minifyJS=require("uglify-js-harmony").minify),e.minifyTypes.indexOf("css")!==-1&&(e.minifyCSS=require("clean-css")),e.minifyTypes.indexOf("html")!==-1&&(e.minifyHTML=require("html-minifier").minify)),e.gzip&&e.gzipConfig&&(e.zlib=require("zlib")),s(0,"flairBuild","start",!0);let r=[];e.processAsGroups?r=c(e.src,!0):r.push(e.src),e.sources=r,l(e),f(!1,e,()=>{m(e,()=>{f(!0,e,()=>{s(0,"flairBuild","end",!0,!0),"function"==typeof n&&n()})})})},(()=>{flair.AppDomain.registerAdo('{"name":"flair.cli","file":"./flair.cli{.min}.js","desc":"True Object Oriented JavaScript","version":"0.15.622","lupdate":"Sat, 02 Mar 2019 03:27:33 GMT","builder":{"name":"<<name>>","version":"<<version>>","format":"fasm","formatVersion":"1","contains":["initializer","types","enclosureVars","enclosedTypes","resources","assets","selfreg"]},"copyright":"(c) 2017-2019 Vikas Burman","license":"MIT","types":[],"resources":[],"assets":[]}')})();