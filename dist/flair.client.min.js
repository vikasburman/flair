/**
 * @preserve
 * Flair.js
 * True Object Oriented JavaScript
 * 
 * Assembly: flair.client
 *     File: ./flair.client.js
 *  Version: 0.51.96
 *  Wed, 08 May 2019 18:44:53 GMT
 * 
 * (c) 2017-2019 Vikas Burman
 * MIT
 */
!function(e,t){"use strict";"function"==typeof!0&&(!0).amd?(!0)(t):"object"==typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),module.exports=exports=t):e["flair.client"]=t}(this,async function(e){"use strict";const t=void 0!==!0?require("flairjs"):(!0).flair,{Class:i,Struct:s,Enum:n,Interface:r,Mixin:a,Aspects:o,AppDomain:l,$$:c,attr:d,bring:h,Container:p,include:u,Port:f,on:m,post:$,telemetry:v,Reflector:y,Serializer:w,Tasks:b,as:g,is:T,isComplies:x,isDerivedFrom:V,isAbstract:I,isSealed:S,isStatic:A,isSingleton:C,isDeprecated:O,isImplements:j,isInstanceOf:E,isMixed:B,getAssembly:k,getAttr:R,getContext:z,getResource:H,getRoute:L,getType:M,ns:P,getTypeOf:D,getTypeName:F,typeOf:J,dispose:N,using:U,Args:W,Exception:q,noop:G,nip:_,nim:K,nie:Q,event:X}=t,{TaskInfo:Y}=t.Tasks,{env:Z}=t.options,{forEachAsync:ee,replaceAll:te,splitAndTrim:ie,findIndexByProp:se,findItemByProp:ne,which:re,guid:ae,isArrowFunc:oe,isASyncFunc:le,sieve:ce,b64EncodeUnicode:de,b64DecodeUnicode:he}=t.utils,{$$static:pe,$$abstract:ue,$$virtual:fe,$$override:me,$$sealed:$e,$$private:ve,$$privateSet:ye,$$protected:we,$$protectedSet:be,$$readonly:ge,$$async:Te,$$overload:xe,$$enumerate:Ve,$$dispose:Ie,$$post:Se,$$on:Ae,$$timer:Ce,$$type:Oe,$$args:je,$$inject:Ee,$$resource:Be,$$asset:ke,$$singleton:Re,$$serialize:ze,$$deprecate:He,$$session:Le,$$state:Me,$$conditional:Pe,$$noserialize:De,$$ns:Fe}=c,Je=Z.isServer||Z.isWorker?null:(!0).document,Ne=l.context.current().name,Ue=e,We=Ue.substr(0,Ue.lastIndexOf("/")+1);l.loadPathOf("flair.client",We);let qe=JSON.parse('{"el":"main","title":"","viewTransition":"","url":{"404":"/404","home":"/"},"mounts":{"main":"/"},"main-options":[],"main-interceptors":[]}'),Ge=t.Port("settingsReader");if("function"==typeof Ge){let e=Ge("flair.client");e&&(qe=Object.assign(qe,e))}qe=Object.freeze(qe);let _e=JSON.parse("{}");_e=Object.freeze(_e),l.context.current().currentAssemblyBeingLoaded("./flair.client{.min}.js"),await(async()=>{c("ns","flair.ui"),i("ViewTransition",function(){c("virtual"),c("async"),this.enter=G,c("virtual"),c("async"),this.leave=G})})(),await(async()=>{const{Host:e}=P("flair.app"),t=await u("page/page{.min}.js","page");c("sealed"),c("ns","flair.app"),i("ClientHost",e,function(){let e={},i=null;c("override"),this.construct=(e=>{e("Page","1.x")}),this.app={get:()=>this.mounts["main"].app,set:G},this.mounts={get:()=>e,set:G},c("override"),this.boot=(async i=>{i();let s=null,n="",r=null;const a=e=>{let t={},i=qe[`${e}-options`];if(i&&i.length>0)for(let e of i)t[e.name]=e.value;return t.click=!1,t.popstate=!1,t.dispatch=!1,t.hashbang=!1,t.decodeURLComponents=!0,t.window=!0,t};s=a("main"),t(s);let o=t;o.strict(s.strict),o.base("/");for(let i of Object.keys(qe.mounts))"main"===i?(n="/",r=o):(s=a(i),n=qe.mounts[i],(r=t.create(s)).strict(s.strict),r.base(n)),e[i]=Object.freeze({name:i,root:n,app:r});e=Object.freeze(e)}),c("override"),this.start=(async e=>{e(),i=(()=>{let e=(!0).location.hash;"#!/"===e.substr(0,3)&&(e=e.substr(3)),"#!"===e.substr(0,2)&&(e=e.substr(2)),"#/"===e.substr(0,2)&&(e=e.substr(2)),"#"===e.substr(0,1)&&(e=e.substr(1));let t=null,i="";for(let s of this.mounts)if(e.startsWith(s.root)){t=s.app,e=e.substr(s.root.length),i=s;break}t||(i="main",t=this.mounts[i]),"/"!==e.substr(0,1)&&(e="/"+e),setTimeout(()=>{try{t(e)}catch(e){this.error(e)}},0)})}),c("override"),this.ready=(async e=>{e(),(!0).addEventListener("hashchange",i),this.app.redirect(qe.url.home),console.log(`${l.app().info.name}, v${l.app().info.version}`)}),c("override"),this.stop=(async e=>{e(),(!0).removeEventListener("hashchange",i)}),c("override"),this.dispose=(t=>{t(),e=null})})})(),await(async()=>{const{Bootware:e}=P("flair.app"),{ViewHandler:t,ViewInterceptor:s}=P("flair.ui");c("sealed"),c("ns","flair.boot"),i("ClientRouter",e,function(){let e=null;c("override"),this.construct=(e=>{e("Client Router",!0)}),c("override"),this.boot=(async(i,n)=>{i(),e||(e=l.context.current().allRoutes(!0)).sort((e,t)=>e.index<t.index?-1:e.index>t.index?1:0);const r=(e,t)=>new Promise((i,s)=>{try{let n;(new e).run(t).then(()=>{t.$stop?s():i()}).catch(s)}catch(e){s(e)}}),a=(e,t)=>ee(e,(e,i,n)=>{u(n).then(a=>{let o=g(a,s);o?r(o,t).then(e).catch(i):i(q.InvalidDefinition(`Invalid interceptor type. (${n})`))}).catch(i)});let o="view";for(let i of e)i.mount===n.name&&n.app(i.path,e=>{const s=e=>{l.host().raiseError(e)},r=e=>{n.app.redirect(e)},c=()=>{u(i.handler).then(n=>{let a=g(n,t);if(a)try{U(new a,t=>{t[o](e).then(()=>{e.handled=!0,e.$redirect&&r(e.$redirect)}).catch(s)})}catch(e){s(e)}else s(q.InvalidDefinition(`Invalid route handler. (${i.handler})`))}).catch(s)};e.$stop=!1,e.$redirect="";let d=qe[`${n.name}-interceptors`]||[];a(d,e).then(()=>{e.$stop?(e.handled=!0,e.$redirect&&r(e.$redirect)):c()}).catch(t=>{e.$stop?(e.handled=!0,e.$redirect&&r(e.$redirect)):s(t)})});n.app("*",e=>{let t=qe.url["404"];t?(e.handled=!0,e.pathname!==t&&n.app.redirect(t)):(!0).history.back()})})})})(),await(async()=>{const{Handler:e}=P("flair.app"),{ViewTransition:t}=P("flair.ui");c("ns","flair.ui"),i("ViewHandler",e,function(){let e="";c("override"),this.construct=((t,i,s,n)=>{t(),e=i||"main",this.viewTransition=n,this.title=this.title+(s?" - "+s:"")}),c("privateSet"),this.viewTransition="",c("protectedSet"),this.name="",c("protectedSet"),this.title="",c("protectedSet"),this.meta=null,this.view=(async i=>{if(this.name=this.name||this.$self.id+"_"+ae(),this.viewTransition){let e=g(await u(this.viewTransition),t);this.viewTransition=e?new e:""}let s=Je.createElement("div"),n=Je.getElementById(e);s.id=this.name,s.setAttribute("hidden",""),n.appendChild(s),this.load(i,s),await this.swap()}),c("protected"),c("virtual"),c("async"),this.loadView=G,c("private"),this.swap=(async()=>{let t=Je.getElementById(this.name);if(this.$static.currentView){let i=Je.getElementById(this.$static.currentView),s;for(let e of this.meta)Je.head.removeChild(Je.querySelector('meta[name="'+e+'"]'));this.viewTransition?(await this.viewTransition.leave(i,t),await this.viewTransition.enter(t,i)):(i.hidden=!0,t.hidden=!1),Je.getElementById(e).removeChild(i)}for(let e of this.meta){var i=document.createElement("meta");for(let t in e)i[t]=e[t];Je.head.appendChild(i)}this.$static.currentView||(t.hidden=!1),Je.title=this.title,this.$static.currentView=this.name,this.$static.currentViewMeta=this.meta}),c("static"),this.currentView="",c("static"),this.currentViewMeta=[]})})(),await(async()=>{c("ns","flair.ui"),i("ViewInterceptor",function(){c("virtual"),c("async"),this.run=G})})(),await(async()=>{c("singleton"),c("ns","flair.ui"),i("ViewState",function(){c("state"),c("private"),this.store={},this.get=((e,t)=>(e=e||"",t=t||"",this.store[e+"/"+t]||null)),this.set=((e,t,i)=>{e=e||"",t=t||"","boolean"==typeof i||i?this.store[e+"/"+t]=i:delete this.store[e+"/"+t]}),this.clear=(()=>{this.store=null})})})(),l.context.current().currentAssemblyBeingLoaded(""),l.registerAdo('{"name":"flair.client","file":"./flair.client{.min}.js","mainAssembly":"flair","desc":"True Object Oriented JavaScript","title":"Flair.js","version":"0.51.96","lupdate":"Wed, 08 May 2019 18:44:53 GMT","builder":{"name":"flairBuild","version":"1","format":"fasm","formatVersion":"1","contains":["init","func","type","vars","reso","asst","rout","sreg"]},"copyright":"(c) 2017-2019 Vikas Burman","license":"MIT","types":["flair.ui.ViewTransition","flair.app.ClientHost","flair.boot.ClientRouter","flair.ui.ViewHandler","flair.ui.ViewInterceptor","flair.ui.ViewState"],"resources":[],"assets":[],"routes":[]}'),"function"==typeof onLoadComplete&&onLoadComplete()});